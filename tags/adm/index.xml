<rss xmlns:atom="http://www.w3.org/2005/Atom" version="2.0">
    <channel>
        <title>ADM - 标签 - plantegg</title>
        <link>https://plantegg.github.io/tags/adm/</link>
        <description>ADM - 标签 - plantegg</description>
        <generator>Hugo -- gohugo.io</generator><language>zh-Hans</language><lastBuildDate>Fri, 13 Aug 2021 17:30:03 &#43;0000</lastBuildDate><atom:link href="https://plantegg.github.io/tags/adm/" rel="self" type="application/rss+xml" /><item>
    <title>AMD Zen CPU 架构以及不同CPU性能大PK</title>
    <link>https://plantegg.github.io/posts/amd_zen_cpu%E6%9E%B6%E6%9E%84/</link>
    <pubDate>Fri, 13 Aug 2021 17:30:03 &#43;0000</pubDate><author>
        <name>作者</name>
    </author><guid>https://plantegg.github.io/posts/amd_zen_cpu%E6%9E%B6%E6%9E%84/</guid>
    <description><![CDATA[<h1 id="amd-zen-cpu-架构" class="headerLink">
    <a href="#amd-zen-cpu-%e6%9e%b6%e6%9e%84" class="header-mark"></a>AMD Zen CPU 架构</h1><h2 id="前言" class="headerLink">
    <a href="#%e5%89%8d%e8%a8%80" class="header-mark"></a>前言</h2><p>本文先介绍AMD Zen 架构，结合前一篇文章《<a href="https://www.atatech.org/articles/211563" target="_blank" rel="noopener noreferrer">CPU的生产和概念</a>》一起来看效果会更好，在<a href="https://www.atatech.org/articles/211563" target="_blank" rel="noopener noreferrer">CPU的生产和概念</a>中主要是以Intel方案来介绍，CPU的生产和概念中的 多核和多个CPU方案2 就是指的AMD Zen2架构。</p>
<p>Zen1 和 Intel 还比较像，只是一个CPU会封装多个小的Die来得到多核能力，导致NUMA node比较多。</p>
<p>AMD 从Zen2开始架构有了比较大的变化，Zen2架构改动比较大，将IO从Core Die中抽离出来，形成一个专门的IO Die，这个IO Die可以用上一代的工艺实现来提升成品率降低成本。剩下的core Die 专注在core和cache的实现上，同时可以通过最新一代的工艺来提升性能。并且在一个CPU上封装一个 IO Die + 8个 core Die这样一块CPU做到像Intel一样就是一个大NUMA，但是成本低了很多，也许在云计算时代这么搞比较合适。当然会被大家笑话为胶水核（用胶水把多个Die拼在一起），性能肯定是不如一个大Die好，但是挡不住便宜啊。这估计就是大家所说的 **AMD YES！**吧</p>
<p>比如Core Die用7nm工艺，IO Die用14nm工艺，一块CPU封装8个Core Die+1个IO Die的话既能得到一个多核的CPU成本有非常低，参考 《CPU的生产和概念》中的良品率和成品部分。</p>
<p>介绍完AMD架构后，会拿海光7280这块CPU（实际是OEM的AMD Zen1 架构，一块芯片封装4个die）和 Intel的CPU用MySQL 来对比一下实际性能。</p>
<p>网上Intel CPU架构、技术参数等各种资料还是很丰富的，但是AMD EPYC就比较少了，所以先来学习一下EPYC的架构特点。</p>
<p><img class="tw-inline" loading="lazy" src=https://cdn.jsdelivr.net/gh/plantegg/plantegg.github.io/images/951413iMgBlog/image-20220331120118117.png   alt="image-20220331120118117"  ></p>
<h2 id="amd-epyc-cpu演进路线" class="headerLink">
    <a href="#amd-epyc-cpu%e6%bc%94%e8%bf%9b%e8%b7%af%e7%ba%bf" class="header-mark"></a>AMD EPYC CPU演进路线</h2><p><img class="tw-inline" loading="lazy" src=https://cdn.jsdelivr.net/gh/plantegg/plantegg.github.io/images/951413iMgBlog/amd-rome-naples-chiplets.jpg   alt="img"  ></p>
<p>后面会针对 第二代的 EPYC来做一个对比测试。</p>
<p><img class="tw-inline" loading="lazy" src=https://cdn.jsdelivr.net/gh/plantegg/plantegg.github.io/images/951413iMgBlog/AMD-Packaging-to-X3D-FAD-2020.jpg   alt="AMD Accelerated Computing FAD 2020"  ></p>
<p>AMD EPYC CPU Families:</p>

<div class="table-wrapper">
  <table>
    <thead>
        <tr>
            <th style="text-align: left">Family Name</th>
            <th style="text-align: left">AMD EPYC Naples</th>
            <th style="text-align: left">AMD EPYC Rome</th>
            <th style="text-align: left">AMD EPYC Milan</th>
            <th style="text-align: left">AMD EPYC Genoa</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td style="text-align: left">Family Branding</td>
            <td style="text-align: left">EPYC 7001</td>
            <td style="text-align: left">EPYC 7002</td>
            <td style="text-align: left">EPYC 7003</td>
            <td style="text-align: left">EPYC 7004?</td>
        </tr>
        <tr>
            <td style="text-align: left">Family Launch</td>
            <td style="text-align: left">2017</td>
            <td style="text-align: left">2019</td>
            <td style="text-align: left">2021</td>
            <td style="text-align: left">2022</td>
        </tr>
        <tr>
            <td style="text-align: left">CPU Architecture</td>
            <td style="text-align: left">Zen 1</td>
            <td style="text-align: left">Zen 2</td>
            <td style="text-align: left">Zen 3</td>
            <td style="text-align: left">Zen 4</td>
        </tr>
        <tr>
            <td style="text-align: left">Process Node</td>
            <td style="text-align: left">14nm GloFo</td>
            <td style="text-align: left">7nm TSMC</td>
            <td style="text-align: left">7nm TSMC</td>
            <td style="text-align: left">5nm TSMC</td>
        </tr>
        <tr>
            <td style="text-align: left">Platform Name</td>
            <td style="text-align: left">SP3</td>
            <td style="text-align: left">SP3</td>
            <td style="text-align: left">SP3</td>
            <td style="text-align: left">SP5</td>
        </tr>
        <tr>
            <td style="text-align: left">Socket</td>
            <td style="text-align: left">LGA 4094</td>
            <td style="text-align: left">LGA 4094</td>
            <td style="text-align: left">LGA 4094</td>
            <td style="text-align: left">LGA 6096</td>
        </tr>
        <tr>
            <td style="text-align: left">Max Core Count</td>
            <td style="text-align: left">32</td>
            <td style="text-align: left">64</td>
            <td style="text-align: left">64</td>
            <td style="text-align: left">96</td>
        </tr>
        <tr>
            <td style="text-align: left">Max Thread Count</td>
            <td style="text-align: left">64</td>
            <td style="text-align: left">128</td>
            <td style="text-align: left">128</td>
            <td style="text-align: left">192</td>
        </tr>
        <tr>
            <td style="text-align: left">Max L3 Cache</td>
            <td style="text-align: left">64 MB</td>
            <td style="text-align: left">256 MB</td>
            <td style="text-align: left">256 MB</td>
            <td style="text-align: left">384 MB?</td>
        </tr>
        <tr>
            <td style="text-align: left">Chiplet Design</td>
            <td style="text-align: left">4 CCD&rsquo;s (2 CCX&rsquo;s per CCD)，4 Die</td>
            <td style="text-align: left">8 CCD&rsquo;s (2 CCX&rsquo;s per CCD) + 1 IOD ，9 Die</td>
            <td style="text-align: left">8 CCD&rsquo;s (1 CCX per CCD) + 1 IOD</td>
            <td style="text-align: left">12 CCD&rsquo;s (1 CCX per CCD) + 1 IOD</td>
        </tr>
        <tr>
            <td style="text-align: left">Memory Support</td>
            <td style="text-align: left">DDR4-2666</td>
            <td style="text-align: left">DDR4-3200</td>
            <td style="text-align: left">DDR4-3200</td>
            <td style="text-align: left">DDR5-5200</td>
        </tr>
        <tr>
            <td style="text-align: left">Memory Channels</td>
            <td style="text-align: left">8 Channel</td>
            <td style="text-align: left">8 Channel</td>
            <td style="text-align: left">8 Channel</td>
            <td style="text-align: left">12 Channel</td>
        </tr>
        <tr>
            <td style="text-align: left">PCIe Gen Support</td>
            <td style="text-align: left">64 Gen 3</td>
            <td style="text-align: left">128 Gen 4</td>
            <td style="text-align: left">128 Gen 4</td>
            <td style="text-align: left">128 Gen 5</td>
        </tr>
        <tr>
            <td style="text-align: left">TDP Range</td>
            <td style="text-align: left">200W</td>
            <td style="text-align: left">280W</td>
            <td style="text-align: left">280W</td>
            <td style="text-align: left">320W (cTDP 400W)</td>
        </tr>
    </tbody>
  </table>
</div>
<p>命名规范：</p>
<!-- raw HTML omitted -->
<h2 id="zen1" class="headerLink">
    <a href="#zen1" class="header-mark"></a>Zen1</h2><p>hygon 5280封装后类似下图(一块CPU封装了2个Die，还有封装4个Die的，core更多更贵而已)</p>
<!-- raw HTML omitted -->
<p>或者4个Die封装在一起</p>
<p><img class="tw-inline" loading="lazy" src=https://cdn.jsdelivr.net/gh/plantegg/plantegg.github.io/images/951413iMgBlog/image-20210813085044786.png   alt="image-20210813085044786"  ></p>
<h3 id="zen1-die" class="headerLink">
    <a href="#zen1-die" class="header-mark"></a>Zen1 Die</h3><p>下面这块Die集成了两个CCX（每个CCX四个物理core), 同时还有IO接口</p>
<p><img class="tw-inline" loading="lazy" src=https://cdn.jsdelivr.net/gh/plantegg/plantegg.github.io/images/951413iMgBlog/zeppelin_face_down2.png   alt="Блоки CCX"  ></p>
<p><img class="tw-inline" loading="lazy" src=https://cdn.jsdelivr.net/gh/plantegg/plantegg.github.io/images/951413iMgBlog/515px-zen-1zep.svg.png   alt="img"  ></p>
<p>Quad-Zeppelin Configuration, as found in <a href="https://en.wikichip.org/wiki/amd/epyc" target="_blank" rel="noopener noreferrer">EPYC</a>.</p>
<p><img class="tw-inline" loading="lazy" src=https://cdn.jsdelivr.net/gh/plantegg/plantegg.github.io/images/951413iMgBlog/512px-zen-4zep.svg.png   alt="img"  ></p>
<h3 id="zen-cpu-complexccx" class="headerLink">
    <a href="#zen-cpu-complexccx" class="header-mark"></a>Zen CPU Complex(CCX)</h3><p>hygon 5280使用这个结构， There are 4 cores per CCX and 2 CCXs per die for 8 cores.</p>
<ul>
<li>44 mm² area</li>
<li>L3 8 MiB; 16 mm²</li>
<li>1,400,000,000 transistors</li>
</ul>
<p><img class="tw-inline" loading="lazy" src=https://cdn.jsdelivr.net/gh/plantegg/plantegg.github.io/images/951413iMgBlog/450px-amd_zen_ccx.png   alt="amd zen ccx.png"  ></p>
<p><img class="tw-inline" loading="lazy" src=https://cdn.jsdelivr.net/gh/plantegg/plantegg.github.io/images/951413iMgBlog/700px-amd_zen_ccx_2_annotated.png   alt="amd zen ccx 2"  ></p>
<h3 id="封装后的zen14die" class="headerLink">
    <a href="#%e5%b0%81%e8%a3%85%e5%90%8e%e7%9a%84zen14die" class="header-mark"></a>封装后的Zen1（4Die）</h3><p><img class="tw-inline" loading="lazy" src=https://cdn.jsdelivr.net/gh/plantegg/plantegg.github.io/images/951413iMgBlog/image-20210813085044786.png   alt="image-20210813085044786"  ></p>
<p>4个Die的内部关系</p>
<p><img class="tw-inline" loading="lazy" src=https://cdn.jsdelivr.net/gh/plantegg/plantegg.github.io/images/951413iMgBlog/800px-AMD_Naples_SoC.svg.png   alt="AMD Naples SoC.svg"  ></p>
<p>详实数据和结构</p>
<p><img class="tw-inline" loading="lazy" src=https://cdn.jsdelivr.net/gh/plantegg/plantegg.github.io/images/951413iMgBlog/AMD-EPYC-Infinity-Fabric-Topology-Mapping.webp   alt="Топология процессора"  ></p>
<h2 id="zen2-romehttpsenwikichiporgwikiamdmicroarchitectureszen_2" class="headerLink">
    <a href="#zen2-romehttpsenwikichiporgwikiamdmicroarchitectureszen_2" class="header-mark"></a><a href="https://en.wikichip.org/wiki/amd/microarchitectures/zen_2" target="_blank" rel="noopener noreferrer">Zen2 Rome</a></h2><p>Zen2开始最大的变化就是将IO从Core Die中抽离出来，形成一个专门的IO Die。封装后如下图：</p>
<!-- raw HTML omitted -->
<p>以上结构的CPU在2路服务器下的内部结构：</p>
<p><img class="tw-inline" loading="lazy" src=https://cdn.jsdelivr.net/gh/plantegg/plantegg.github.io/images/951413iMgBlog/1624282522149-35de1452-3e8d-4632-a53a-b99f1ed39a21.png   alt="img"  ></p>
<p>跨socket的内存访问的数据流跟互联有关，如上图标示，比如从左边的CCD0到右边的CCD0的内存，大概需要经过10跳。</p>

<div class="table-wrapper">
  <table>
    <thead>
        <tr>
            <th style="text-align: "></th>
            <th style="text-align: ">node0</th>
            <th style="text-align: ">node1</th>
            <th style="text-align: ">node2</th>
            <th style="text-align: ">node3</th>
            <th style="text-align: ">node4</th>
            <th style="text-align: ">node5</th>
            <th style="text-align: ">node6</th>
            <th style="text-align: ">node7</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td style="text-align: ">node0</td>
            <td style="text-align: ">89.67</td>
            <td style="text-align: ">99.357</td>
            <td style="text-align: ">108.11</td>
            <td style="text-align: ">110.54</td>
            <td style="text-align: ">181.85</td>
            <td style="text-align: ">187.71</td>
            <td style="text-align: ">179.507</td>
            <td style="text-align: ">179.463</td>
        </tr>
        <tr>
            <td style="text-align: ">node1</td>
            <td style="text-align: "></td>
            <td style="text-align: ">90.983</td>
            <td style="text-align: ">111.65</td>
            <td style="text-align: ">106.11</td>
            <td style="text-align: ">188.77</td>
            <td style="text-align: ">194.7</td>
            <td style="text-align: ">188.179</td>
            <td style="text-align: ">189.512</td>
        </tr>
        <tr>
            <td style="text-align: ">node2</td>
            <td style="text-align: "></td>
            <td style="text-align: "></td>
            <td style="text-align: ">91.2</td>
            <td style="text-align: ">98.272</td>
            <td style="text-align: ">180.95</td>
            <td style="text-align: ">190.53</td>
            <td style="text-align: ">184.865</td>
            <td style="text-align: ">186.088</td>
        </tr>
        <tr>
            <td style="text-align: ">node3</td>
            <td style="text-align: "></td>
            <td style="text-align: "></td>
            <td style="text-align: "></td>
            <td style="text-align: ">89.971</td>
            <td style="text-align: ">186.81</td>
            <td style="text-align: ">193.43</td>
            <td style="text-align: ">192.459</td>
            <td style="text-align: ">192.615</td>
        </tr>
        <tr>
            <td style="text-align: ">node4</td>
            <td style="text-align: "></td>
            <td style="text-align: "></td>
            <td style="text-align: "></td>
            <td style="text-align: "></td>
            <td style="text-align: ">89.566</td>
            <td style="text-align: ">97.943</td>
            <td style="text-align: ">108.19</td>
            <td style="text-align: ">109.942</td>
        </tr>
        <tr>
            <td style="text-align: ">node5</td>
            <td style="text-align: "></td>
            <td style="text-align: "></td>
            <td style="text-align: "></td>
            <td style="text-align: "></td>
            <td style="text-align: "></td>
            <td style="text-align: ">90.927</td>
            <td style="text-align: ">111.123</td>
            <td style="text-align: ">108.046</td>
        </tr>
        <tr>
            <td style="text-align: ">node6</td>
            <td style="text-align: "></td>
            <td style="text-align: "></td>
            <td style="text-align: "></td>
            <td style="text-align: "></td>
            <td style="text-align: "></td>
            <td style="text-align: "></td>
            <td style="text-align: ">91.212</td>
            <td style="text-align: ">103.719</td>
        </tr>
        <tr>
            <td style="text-align: ">node7</td>
            <td style="text-align: "></td>
            <td style="text-align: "></td>
            <td style="text-align: "></td>
            <td style="text-align: "></td>
            <td style="text-align: "></td>
            <td style="text-align: "></td>
            <td style="text-align: "></td>
            <td style="text-align: ">89.692</td>
        </tr>
    </tbody>
  </table>
</div>
<p>上面表格是3 xGMI互联的情况下，测试出来的访存时延，可以看到在某些node间访存时延会有一些的突增，不够均匀，比如node1到node 5、node2到node5；上述latency跨socket如果用默认BIOS值在280左右</p>
<p>以下表格是厂商默认值和优化值对比（用优化值能将latency从280下降到180左右）：</p>

<div class="table-wrapper">
  <table>
    <thead>
        <tr>
            <th style="text-align: ">参数</th>
            <th style="text-align: ">可选项</th>
            <th style="text-align: ">默认值 （milan:V260 rome:V26.02）</th>
            <th style="text-align: ">优化值</th>
            <th style="text-align: ">备注</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td style="text-align: ">xGMI Link Width Control</td>
            <td style="text-align: ">Manual/Auto</td>
            <td style="text-align: ">Auto</td>
            <td style="text-align: ">Manual</td>
            <td style="text-align: "></td>
        </tr>
        <tr>
            <td style="text-align: ">xGMI Force Link Width Control</td>
            <td style="text-align: ">Unforce/Force</td>
            <td style="text-align: ">Unforce</td>
            <td style="text-align: ">Force</td>
            <td style="text-align: "></td>
        </tr>
        <tr>
            <td style="text-align: ">xGMI Force Link Width</td>
            <td style="text-align: ">0/1/2</td>
            <td style="text-align: ">2</td>
            <td style="text-align: ">2</td>
            <td style="text-align: ">2 = Force xGMI link width to x16</td>
        </tr>
        <tr>
            <td style="text-align: ">3-link xGMI max speed</td>
            <td style="text-align: ">[00]6.4Gbps     ……   [0A]16Gbps   ……[13]25Gbps     *[FF]Auto</td>
            <td style="text-align: ">Auto</td>
            <td style="text-align: ">16Gbps</td>
            <td style="text-align: ">IEC的rome和milan都是16Gbs，其他产品要与硬件确认</td>
        </tr>
    </tbody>
  </table>
</div>
<p>另外发现启用透明大页后测试内存时延能降低20%（通过perf发现没开THP的tlb miss很高）</p>
<p><img class="tw-inline" loading="lazy" src=https://cdn.jsdelivr.net/gh/plantegg/plantegg.github.io/images/951413iMgBlog/AMD_Rome_layout-617x486.jpg   alt="AMD Rome layout"  ></p>
<p><img class="tw-inline" loading="lazy" src=https://cdn.jsdelivr.net/gh/plantegg/plantegg.github.io/images/951413iMgBlog/amd-rome-feature-chart.jpg   alt="img"  ></p>
<h3 id="zen2-core-complex-die" class="headerLink">
    <a href="#zen2-core-complex-die" class="header-mark"></a>Zen2 Core Complex Die</h3><ul>
<li>TSMC <a href="https://en.wikichip.org/wiki/N7" target="_blank" rel="noopener noreferrer">7-nanometer process</a></li>
<li>13 metal layers[<a href="https://en.wikichip.org/wiki/amd/microarchitectures/zen_2#cite_note-isscc2020j-zen2-1" target="_blank" rel="noopener noreferrer">1</a>]</li>
<li>3,800,000,000 transistors[<a href="https://en.wikichip.org/wiki/amd/microarchitectures/zen_2#cite_note-isscc2020p-chiplet-2" target="_blank" rel="noopener noreferrer">2</a>]</li>
<li>Die size: 74 mm²</li>
<li>CCX size: 31.3 mm²， 4core per CCX // 16M L3 perf CCX</li>
<li>2 × 16 MiB L3 cache: 2 × 16.8 mm² (estimated) // 中间蓝色部分是L3 16M，一个Die封装两个CCX的情况下</li>
</ul>
<p><img class="tw-inline" loading="lazy" src=https://cdn.jsdelivr.net/gh/plantegg/plantegg.github.io/images/951413iMgBlog/500px-AMD_Zen_2_CCD.jpg   alt="AMD Zen 2 CCD.jpg"  ></p>
<p><img class="tw-inline" loading="lazy" src=https://cdn.jsdelivr.net/gh/plantegg/plantegg.github.io/images/951413iMgBlog/4f71c923-4601-4d98-a311-91da8996c526.png   alt="img"  ></p>
<p>在Zen2/Rome架构中，一个CCD由两个CCX构成，一个CCX包含4个物理核，共享16MB的L3 cache。</p>
<h2 id="zen3" class="headerLink">
    <a href="#zen3" class="header-mark"></a>Zen3</h2><p><img class="tw-inline" loading="lazy" src=https://cdn.jsdelivr.net/gh/plantegg/plantegg.github.io/images/951413iMgBlog/AMD-3D-V-Cache-Stack-Chiplet-Design-For-Next-Gen-Ryzen-Desktop-CPUs-1030x518.png   alt="img"  ></p>
<p>在Zen3/Milan架构中，抛弃了两个CCX组成一个CCD的概念，一个CCD直接由8个物理核构成，共享整个Die上的32MB L3 cache。</p>
<p>再就是<strong>可以选择</strong>增加 v-cache，3D封装更大的L3 cache，如下图，一个CCD 默认是32M L3，但是 v-cache 可以增加一块 64 MB的L3进去（TSMC的SOIC封装在一起），这块 L3 Die 可以单独生产</p>
<p><img class="tw-inline" loading="lazy" src=https://cdn.jsdelivr.net/gh/plantegg/plantegg.github.io/images/951413iMgBlog/image-20220923162521398.png   alt="image-20220923162521398"  ></p>
<p><img class="tw-inline" loading="lazy" src=https://cdn.jsdelivr.net/gh/plantegg/plantegg.github.io/images/951413iMgBlog/2005042726.png   alt="AMD 3D V-Cache"  ></p>
<p><img class="tw-inline" loading="lazy" src=https://cdn.jsdelivr.net/gh/plantegg/plantegg.github.io/images/951413iMgBlog/1628095021605-740x594.jpg   alt="img"  ></p>
<p><img class="tw-inline" loading="lazy" src=https://cdn.jsdelivr.net/gh/plantegg/plantegg.github.io/images/951413iMgBlog/Milan-X4.png   alt="img"  ></p>
<h3 id="milan-x芯片面积及定价策略" class="headerLink">
    <a href="#milan-x%e8%8a%af%e7%89%87%e9%9d%a2%e7%a7%af%e5%8f%8a%e5%ae%9a%e4%bb%b7%e7%ad%96%e7%95%a5" class="header-mark"></a><strong>Milan-X芯片面积及定价策略</strong></h3>
<div class="table-wrapper">
  <table>
    <thead>
        <tr>
            <th style="text-align: "></th>
            <th style="text-align: ">TDP (W)</th>
            <th style="text-align: ">Cores</th>
            <th style="text-align: ">Base Freq (GHz)</th>
            <th style="text-align: ">Max. Freq (GHz)</th>
            <th style="text-align: ">L3(MB)</th>
            <th style="text-align: ">Channels DDR</th>
            <th style="text-align: ">Max DDR Freq</th>
            <th style="text-align: ">PCIeLane</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td style="text-align: ">7763</td>
            <td style="text-align: ">280</td>
            <td style="text-align: ">64</td>
            <td style="text-align: ">2.45</td>
            <td style="text-align: ">3.5</td>
            <td style="text-align: ">256</td>
            <td style="text-align: ">8</td>
            <td style="text-align: ">3200</td>
            <td style="text-align: ">x128</td>
        </tr>
        <tr>
            <td style="text-align: ">7773X</td>
            <td style="text-align: ">280</td>
            <td style="text-align: ">64</td>
            <td style="text-align: ">2.2</td>
            <td style="text-align: ">3.5</td>
            <td style="text-align: ">768</td>
            <td style="text-align: ">8</td>
            <td style="text-align: ">3200</td>
            <td style="text-align: ">x128</td>
        </tr>
    </tbody>
  </table>
</div>
<p>比如上表中 7773X 相对 7763 封装了更大的L3，同时降低了主频来控制发热</p>
<p>下表为标品的芯片面积和售价数据，对比可以看出，扩容2倍L3的芯片整体硅面积增加了31%，售价提升了12%</p>

<div class="table-wrapper">
  <table>
    <thead>
        <tr>
            <th style="text-align: "></th>
            <th style="text-align: ">area mm^2</th>
            <th style="text-align: ">price 1KU($)</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td style="text-align: ">7763</td>
            <td style="text-align: ">IOD 416+CCD 81*8=1064</td>
            <td style="text-align: ">7890</td>
        </tr>
        <tr>
            <td style="text-align: ">7773x</td>
            <td style="text-align: ">+add L3D 41*8=1392</td>
            <td style="text-align: ">8800</td>
        </tr>
    </tbody>
  </table>
</div>
<p>AMD PPOG文档中摘录的关于CPU的micro-bench相关的数据：</p>
<p>1，访存时延上， Vcache普遍有2~6ns的延迟优化；访存带宽上二者基本一致；</p>
<p>2，spec CPU上，整形跑分基本持平，vcache的容量增加部分被主频的降低抵消；浮点跑分提升10%，mem-intensive类型的HPC/AI类应用，将得到比较明显的提升；</p>
<p>3，spec JBB上，vcache的改善明显，critical和max jOPS均得到了10%以上的提升；</p>

<div class="table-wrapper">
  <table>
    <thead>
        <tr>
            <th style="text-align: ">Workloads</th>
            <th style="text-align: ">7763</th>
            <th style="text-align: ">7773X vcache</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td style="text-align: ">NPS4 Core0 Node0 (ns)</td>
            <td style="text-align: ">85</td>
            <td style="text-align: ">83</td>
        </tr>
        <tr>
            <td style="text-align: ">NPS4 Core0 Node1 (ns)</td>
            <td style="text-align: ">97</td>
            <td style="text-align: ">92</td>
        </tr>
        <tr>
            <td style="text-align: ">NPS4 Core0 Node2 (ns)</td>
            <td style="text-align: ">106</td>
            <td style="text-align: ">100</td>
        </tr>
        <tr>
            <td style="text-align: ">NPS4 Core0 Node3 (ns)</td>
            <td style="text-align: ">109</td>
            <td style="text-align: ">104</td>
        </tr>
        <tr>
            <td style="text-align: ">STREAM Add (GBps)</td>
            <td style="text-align: ">100%</td>
            <td style="text-align: ">99.9%</td>
        </tr>
        <tr>
            <td style="text-align: ">STREAM Copy(GBps)</td>
            <td style="text-align: ">100%</td>
            <td style="text-align: ">99.9%</td>
        </tr>
        <tr>
            <td style="text-align: ">STREAM Scale(GBps)</td>
            <td style="text-align: ">100%</td>
            <td style="text-align: ">100.1%</td>
        </tr>
        <tr>
            <td style="text-align: ">STREAM Triad(GBps)</td>
            <td style="text-align: ">100%</td>
            <td style="text-align: ">99.8%</td>
        </tr>
        <tr>
            <td style="text-align: ">SPEC CPU2017 FP Rate Base</td>
            <td style="text-align: ">100%</td>
            <td style="text-align: ">109.8%</td>
        </tr>
        <tr>
            <td style="text-align: ">SPEC CPU2017 Int Rate Base</td>
            <td style="text-align: ">100%</td>
            <td style="text-align: ">100.9%</td>
        </tr>
        <tr>
            <td style="text-align: ">SPECjbb2015-MultiJVM Critical-Jops</td>
            <td style="text-align: ">100%</td>
            <td style="text-align: ">111.6%</td>
        </tr>
        <tr>
            <td style="text-align: ">SPECjbb2015-MultiJVM Max-jOPS</td>
            <td style="text-align: ">100%</td>
            <td style="text-align: ">116.7%</td>
        </tr>
    </tbody>
  </table>
</div>
<h2 id="zen1-vs-zen2" class="headerLink">
    <a href="#zen1-vs-zen2" class="header-mark"></a>Zen1 VS Zen2</h2><p>Here is what the Naples and Rome packages look like from the outside:</p>
<p><img class="tw-inline" loading="lazy" src=https://cdn.jsdelivr.net/gh/plantegg/plantegg.github.io/images/951413iMgBlog/amd-rome-epyc-zen1-zen2.jpg   alt="img"  ></p>
<p>numa</p>
<p><img class="tw-inline" loading="lazy" src=https://cdn.jsdelivr.net/gh/plantegg/plantegg.github.io/images/951413iMgBlog/image-20210813091455662.png   alt="image-20210813091455662"  ></p>
<p>zen1 numa distance:</p>
<p><img class="tw-inline" loading="lazy" src=https://cdn.jsdelivr.net/gh/plantegg/plantegg.github.io/images/951413iMgBlog/OctalNUMA_575px.png   alt="img"  ></p>
<p>hygon numa distance:</p>
<div class="code-block highlight is-open show-line-numbers  tw-group tw-my-2">
  <div class="
    code-block-title 
    
    tw-flex 
    tw-flex-row 
    tw-justify-between 
    tw-w-full tw-bg-bgColor-secondary
    ">      
    <button 
      class="
        tw-select-none 
        tw-mx-2 
        tw-block
        group-[.is-open]:tw-rotate-90
        tw-transition-[transform] 
        tw-duration-500 
        tw-ease-in-out
        print:!tw-hidden"
      disabled
      aria-hidden="true"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M285.476 272.971L91.132 467.314c-9.373 9.373-24.569 9.373-33.941 0l-22.667-22.667c-9.357-9.357-9.375-24.522-.04-33.901L188.505 256 34.484 101.255c-9.335-9.379-9.317-24.544.04-33.901l22.667-22.667c9.373-9.373 24.569-9.373 33.941 0L285.475 239.03c9.373 9.372 9.373 24.568.001 33.941z"/></svg></button>

    <div class="code-block-title-bar tw-w-full">
      <p class="tw-select-none !tw-my-1">text</p>
    </div>
    <div class="tw-flex">
      <button 
        class="
          line-number-button
          tw-select-none 
          tw-mx-2 
          tw-hidden 
          group-[.is-open]:tw-block 
          group-[.show-line-numbers]:tw-text-fgColor-link 
          print:!tw-hidden" 
        title="Toggle line numbers"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M61.77 401l17.5-20.15a19.92 19.92 0 0 0 5.07-14.19v-3.31C84.34 356 80.5 352 73 352H16a8 8 0 0 0-8 8v16a8 8 0 0 0 8 8h22.83a157.41 157.41 0 0 0-11 12.31l-5.61 7c-4 5.07-5.25 10.13-2.8 14.88l1.05 1.93c3 5.76 6.29 7.88 12.25 7.88h4.73c10.33 0 15.94 2.44 15.94 9.09 0 4.72-4.2 8.22-14.36 8.22a41.54 41.54 0 0 1-15.47-3.12c-6.49-3.88-11.74-3.5-15.6 3.12l-5.59 9.31c-3.72 6.13-3.19 11.72 2.63 15.94 7.71 4.69 20.38 9.44 37 9.44 34.16 0 48.5-22.75 48.5-44.12-.03-14.38-9.12-29.76-28.73-34.88zM496 224H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zm0-160H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16V80a16 16 0 0 0-16-16zm0 320H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zM16 160h64a8 8 0 0 0 8-8v-16a8 8 0 0 0-8-8H64V40a8 8 0 0 0-8-8H32a8 8 0 0 0-7.14 4.42l-8 16A8 8 0 0 0 24 64h8v64H16a8 8 0 0 0-8 8v16a8 8 0 0 0 8 8zm-3.91 160H80a8 8 0 0 0 8-8v-16a8 8 0 0 0-8-8H41.32c3.29-10.29 48.34-18.68 48.34-56.44 0-29.06-25-39.56-44.47-39.56-21.36 0-33.8 10-40.46 18.75-4.37 5.59-3 10.84 2.8 15.37l8.58 6.88c5.61 4.56 11 2.47 16.12-2.44a13.44 13.44 0 0 1 9.46-3.84c3.33 0 9.28 1.56 9.28 8.75C51 248.19 0 257.31 0 304.59v4C0 316 5.08 320 12.09 320z"/></svg></button>

      <button 
        class="
          wrap-code-button
          tw-select-none 
          tw-mx-2 
          tw-hidden 
          group-[.is-open]:tw-block 
          group-[.is-wrap]:tw-text-fgColor-link 
          print:!tw-hidden" 
        title="Toggle code wrap"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M16 132h416c8.837 0 16-7.163 16-16V76c0-8.837-7.163-16-16-16H16C7.163 60 0 67.163 0 76v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16z"/></svg></button>
      
      <button 
        class="
          copy-code-button
          tw-select-none
          tw-mx-2 
          tw-hidden
          group-[.is-open]:tw-block
          hover:tw-text-fgColor-link 
          print:!tw-hidden"
        title="Copy code">
          <span class="copy-icon tw-block"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M433.941 65.941l-51.882-51.882A48 48 0 0 0 348.118 0H176c-26.51 0-48 21.49-48 48v48H48c-26.51 0-48 21.49-48 48v320c0 26.51 21.49 48 48 48h224c26.51 0 48-21.49 48-48v-48h80c26.51 0 48-21.49 48-48V99.882a48 48 0 0 0-14.059-33.941zM266 464H54a6 6 0 0 1-6-6V150a6 6 0 0 1 6-6h74v224c0 26.51 21.49 48 48 48h96v42a6 6 0 0 1-6 6zm128-96H182a6 6 0 0 1-6-6V54a6 6 0 0 1 6-6h106v88c0 13.255 10.745 24 24 24h88v202a6 6 0 0 1-6 6zm6-256h-64V48h9.632c1.591 0 3.117.632 4.243 1.757l48.368 48.368a6 6 0 0 1 1.757 4.243V112z"/></svg></span>
          <span class="check-icon tw-hidden"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M173.898 439.404l-166.4-166.4c-9.997-9.997-9.997-26.206 0-36.204l36.203-36.204c9.997-9.998 26.207-9.998 36.204 0L192 312.69 432.095 72.596c9.997-9.997 26.207-9.997 36.204 0l36.203 36.204c9.997 9.997 9.997 26.206 0 36.204l-294.4 294.401c-9.998 9.997-26.207 9.997-36.204-.001z"/></svg></span>
      </button>
        
      <button 
        class="
          tw-select-none 
          tw-mx-2 
          tw-block 
          group-[.is-open]:tw-hidden 
          print:!tw-hidden" 
        disabled
        aria-hidden="true"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M328 256c0 39.8-32.2 72-72 72s-72-32.2-72-72 32.2-72 72-72 72 32.2 72 72zm104-72c-39.8 0-72 32.2-72 72s32.2 72 72 72 72-32.2 72-72-32.2-72-72-72zm-352 0c-39.8 0-72 32.2-72 72s32.2 72 72 72 72-32.2 72-72-32.2-72-72-72z"/></svg></button>
    </div>
  </div>
  <pre style="counter-reset: codeblock;" class="tw-block tw-m-0 tw-p-0"><code 
    id="codeblock-id-1" 
    class="
      chroma 
      !tw-block 
      tw-p-0
      tw-m-0
      tw-transition-[max-height] 
      tw-duration-500 
      tw-ease-in-out 
      group-[.is-closed]:!tw-max-h-0 
      group-[.is-wrap]:tw-text-wrap
      tw-overflow-y-hidden
      tw-overflow-x-auto
      tw-scrollbar-thin
      "><span class="line"><span class="cl"># numactl -H  //Zen1 hygon 7280  2 socket enable die interleaving
</span></span><span class="line"><span class="cl">available: 2 nodes (0-1)
</span></span><span class="line"><span class="cl">node 0 cpus: 0 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95
</span></span><span class="line"><span class="cl">node 0 size: 257578 MB
</span></span><span class="line"><span class="cl">node 0 free: 115387 MB
</span></span><span class="line"><span class="cl">node 1 cpus: 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127
</span></span><span class="line"><span class="cl">node 1 size: 257005 MB
</span></span><span class="line"><span class="cl">node 1 free: 221031 MB
</span></span><span class="line"><span class="cl">node distances:
</span></span><span class="line"><span class="cl">node   0   1
</span></span><span class="line"><span class="cl">  0:  10  22
</span></span><span class="line"><span class="cl">  1:  22  10
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">  #numactl -H //Zen1 hygon 5280  2 socket disable die interleaving
</span></span><span class="line"><span class="cl">available: 4 nodes (0-3)
</span></span><span class="line"><span class="cl">node 0 cpus: 0 1 2 3 4 5 6 7 32 33 34 35 36 37 38 39
</span></span><span class="line"><span class="cl">node 0 size: 128854 MB
</span></span><span class="line"><span class="cl">node 0 free: 89350 MB
</span></span><span class="line"><span class="cl">node 1 cpus: 8 9 10 11 12 13 14 15 40 41 42 43 44 45 46 47
</span></span><span class="line"><span class="cl">node 1 size: 129019 MB
</span></span><span class="line"><span class="cl">node 1 free: 89326 MB
</span></span><span class="line"><span class="cl">node 2 cpus: 16 17 18 19 20 21 22 23 48 49 50 51 52 53 54 55
</span></span><span class="line"><span class="cl">node 2 size: 128965 MB
</span></span><span class="line"><span class="cl">node 2 free: 86542 MB
</span></span><span class="line"><span class="cl">node 3 cpus: 24 25 26 27 28 29 30 31 56 57 58 59 60 61 62 63
</span></span><span class="line"><span class="cl">node 3 size: 129020 MB
</span></span><span class="line"><span class="cl">node 3 free: 98227 MB
</span></span><span class="line"><span class="cl">node distances:
</span></span><span class="line"><span class="cl">node   0   1   2   3
</span></span><span class="line"><span class="cl">  0:  10  16  28  22
</span></span><span class="line"><span class="cl">  1:  16  10  22  28
</span></span><span class="line"><span class="cl">  2:  28  22  10  16
</span></span><span class="line"><span class="cl">  3:  22  28  16  10</span></span></code></pre>
</div>
<p>看完这些结构上的原理，让我们实际来看看AMD的性能怎么样。</p>
<h2 id="hygon-7280-pcm数据" class="headerLink">
    <a href="#hygon-7280-pcm%e6%95%b0%e6%8d%ae" class="header-mark"></a>hygon 7280 PCM数据</h2><p>hygon pcm(performance counter monitor) 工具由芯片公司提供</p>
<div class="code-block highlight is-open show-line-numbers  tw-group tw-my-2">
  <div class="
    code-block-title 
    
    tw-flex 
    tw-flex-row 
    tw-justify-between 
    tw-w-full tw-bg-bgColor-secondary
    ">      
    <button 
      class="
        tw-select-none 
        tw-mx-2 
        tw-block
        group-[.is-open]:tw-rotate-90
        tw-transition-[transform] 
        tw-duration-500 
        tw-ease-in-out
        print:!tw-hidden"
      disabled
      aria-hidden="true"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M285.476 272.971L91.132 467.314c-9.373 9.373-24.569 9.373-33.941 0l-22.667-22.667c-9.357-9.357-9.375-24.522-.04-33.901L188.505 256 34.484 101.255c-9.335-9.379-9.317-24.544.04-33.901l22.667-22.667c9.373-9.373 24.569-9.373 33.941 0L285.475 239.03c9.373 9.372 9.373 24.568.001 33.941z"/></svg></button>

    <div class="code-block-title-bar tw-w-full">
      <p class="tw-select-none !tw-my-1">shell</p>
    </div>
    <div class="tw-flex">
      <button 
        class="
          line-number-button
          tw-select-none 
          tw-mx-2 
          tw-hidden 
          group-[.is-open]:tw-block 
          group-[.show-line-numbers]:tw-text-fgColor-link 
          print:!tw-hidden" 
        title="Toggle line numbers"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M61.77 401l17.5-20.15a19.92 19.92 0 0 0 5.07-14.19v-3.31C84.34 356 80.5 352 73 352H16a8 8 0 0 0-8 8v16a8 8 0 0 0 8 8h22.83a157.41 157.41 0 0 0-11 12.31l-5.61 7c-4 5.07-5.25 10.13-2.8 14.88l1.05 1.93c3 5.76 6.29 7.88 12.25 7.88h4.73c10.33 0 15.94 2.44 15.94 9.09 0 4.72-4.2 8.22-14.36 8.22a41.54 41.54 0 0 1-15.47-3.12c-6.49-3.88-11.74-3.5-15.6 3.12l-5.59 9.31c-3.72 6.13-3.19 11.72 2.63 15.94 7.71 4.69 20.38 9.44 37 9.44 34.16 0 48.5-22.75 48.5-44.12-.03-14.38-9.12-29.76-28.73-34.88zM496 224H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zm0-160H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16V80a16 16 0 0 0-16-16zm0 320H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zM16 160h64a8 8 0 0 0 8-8v-16a8 8 0 0 0-8-8H64V40a8 8 0 0 0-8-8H32a8 8 0 0 0-7.14 4.42l-8 16A8 8 0 0 0 24 64h8v64H16a8 8 0 0 0-8 8v16a8 8 0 0 0 8 8zm-3.91 160H80a8 8 0 0 0 8-8v-16a8 8 0 0 0-8-8H41.32c3.29-10.29 48.34-18.68 48.34-56.44 0-29.06-25-39.56-44.47-39.56-21.36 0-33.8 10-40.46 18.75-4.37 5.59-3 10.84 2.8 15.37l8.58 6.88c5.61 4.56 11 2.47 16.12-2.44a13.44 13.44 0 0 1 9.46-3.84c3.33 0 9.28 1.56 9.28 8.75C51 248.19 0 257.31 0 304.59v4C0 316 5.08 320 12.09 320z"/></svg></button>

      <button 
        class="
          wrap-code-button
          tw-select-none 
          tw-mx-2 
          tw-hidden 
          group-[.is-open]:tw-block 
          group-[.is-wrap]:tw-text-fgColor-link 
          print:!tw-hidden" 
        title="Toggle code wrap"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M16 132h416c8.837 0 16-7.163 16-16V76c0-8.837-7.163-16-16-16H16C7.163 60 0 67.163 0 76v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16z"/></svg></button>
      
      <button 
        class="
          copy-code-button
          tw-select-none
          tw-mx-2 
          tw-hidden
          group-[.is-open]:tw-block
          hover:tw-text-fgColor-link 
          print:!tw-hidden"
        title="Copy code">
          <span class="copy-icon tw-block"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M433.941 65.941l-51.882-51.882A48 48 0 0 0 348.118 0H176c-26.51 0-48 21.49-48 48v48H48c-26.51 0-48 21.49-48 48v320c0 26.51 21.49 48 48 48h224c26.51 0 48-21.49 48-48v-48h80c26.51 0 48-21.49 48-48V99.882a48 48 0 0 0-14.059-33.941zM266 464H54a6 6 0 0 1-6-6V150a6 6 0 0 1 6-6h74v224c0 26.51 21.49 48 48 48h96v42a6 6 0 0 1-6 6zm128-96H182a6 6 0 0 1-6-6V54a6 6 0 0 1 6-6h106v88c0 13.255 10.745 24 24 24h88v202a6 6 0 0 1-6 6zm6-256h-64V48h9.632c1.591 0 3.117.632 4.243 1.757l48.368 48.368a6 6 0 0 1 1.757 4.243V112z"/></svg></span>
          <span class="check-icon tw-hidden"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M173.898 439.404l-166.4-166.4c-9.997-9.997-9.997-26.206 0-36.204l36.203-36.204c9.997-9.998 26.207-9.998 36.204 0L192 312.69 432.095 72.596c9.997-9.997 26.207-9.997 36.204 0l36.203 36.204c9.997 9.997 9.997 26.206 0 36.204l-294.4 294.401c-9.998 9.997-26.207 9.997-36.204-.001z"/></svg></span>
      </button>
        
      <button 
        class="
          tw-select-none 
          tw-mx-2 
          tw-block 
          group-[.is-open]:tw-hidden 
          print:!tw-hidden" 
        disabled
        aria-hidden="true"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M328 256c0 39.8-32.2 72-72 72s-72-32.2-72-72 32.2-72 72-72 72 32.2 72 72zm104-72c-39.8 0-72 32.2-72 72s32.2 72 72 72 72-32.2 72-72-32.2-72-72-72zm-352 0c-39.8 0-72 32.2-72 72s32.2 72 72 72 72-32.2 72-72-32.2-72-72-72z"/></svg></button>
    </div>
  </div>
  <pre style="counter-reset: codeblock;" class="tw-block tw-m-0 tw-p-0"><code 
    id="codeblock-id-2" 
    class="
      chroma 
      !tw-block 
      tw-p-0
      tw-m-0
      tw-transition-[max-height] 
      tw-duration-500 
      tw-ease-in-out 
      group-[.is-closed]:!tw-max-h-0 
      group-[.is-wrap]:tw-text-wrap
      tw-overflow-y-hidden
      tw-overflow-x-auto
      tw-scrollbar-thin
      "><span class="line"><span class="cl"><span class="o">[</span>root@hygon3 16:58 /root/PCM<span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="c1">#./pcm.x -r -topdown -i=1 -nc -ns -l2</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> Processor Counter Monitor  <span class="o">(</span>2019-08-21 17:07:31 +0800 <span class="nv">ID</span><span class="o">=</span>378f2fc<span class="o">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Number of physical cores: <span class="m">64</span>
</span></span><span class="line"><span class="cl">Number of logical cores: <span class="m">128</span>
</span></span><span class="line"><span class="cl">Number of online logical cores: <span class="m">128</span>
</span></span><span class="line"><span class="cl">Threads <span class="o">(</span>logical cores<span class="o">)</span> per physical core: <span class="m">2</span>
</span></span><span class="line"><span class="cl">Num sockets: <span class="m">2</span>
</span></span><span class="line"><span class="cl">Physical cores per socket: <span class="m">32</span>
</span></span><span class="line"><span class="cl">Core PMU <span class="o">(</span>perfmon<span class="o">)</span> version: <span class="m">3</span>
</span></span><span class="line"><span class="cl">Number of core PMU generic <span class="o">(</span>programmable<span class="o">)</span> counters: <span class="m">6</span>
</span></span><span class="line"><span class="cl">Width of generic <span class="o">(</span>programmable<span class="o">)</span> counters: <span class="m">64</span> bits
</span></span><span class="line"><span class="cl">Ccxs per Node: <span class="m">8</span>
</span></span><span class="line"><span class="cl">Logical cores per Ccx: <span class="m">8</span>
</span></span><span class="line"><span class="cl">Physical Cores per Ccx: <span class="m">4</span>
</span></span><span class="line"><span class="cl">Nodes per socket: <span class="m">4</span>
</span></span><span class="line"><span class="cl">Number of core PMU fixed counters: <span class="m">0</span>
</span></span><span class="line"><span class="cl">Width of fixed counters: <span class="m">0</span> bits
</span></span><span class="line"><span class="cl">Nominal core frequency: <span class="m">2000000000</span> Hz
</span></span><span class="line"><span class="cl">Package thermal spec power: -1 Watt<span class="p">;</span> Package minimum power: -1 Watt<span class="p">;</span> Package maximum power: -1 Watt<span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> Resetting PMU configuration
</span></span><span class="line"><span class="cl"> Zeroed PMU registers
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Detected Hygon C86 <span class="m">7280</span> 32-core Processor  <span class="s2">&#34;Hygon(r) microarchitecture codename DHYANA&#34;</span> stepping <span class="m">1</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> EXEC  : instructions per nominal CPU cycle
</span></span><span class="line"><span class="cl"> IPC   : instructions per CPU cycle
</span></span><span class="line"><span class="cl"> FREQ  : relation to nominal CPU <span class="nv">frequency</span><span class="o">=</span><span class="s1">&#39;unhalted clock ticks&#39;</span>/<span class="s1">&#39;invariant timer ticks&#39;</span> <span class="o">(</span>includes Intel Turbo Boost<span class="o">)</span>
</span></span><span class="line"><span class="cl"> AFREQ : relation to nominal CPU frequency <span class="k">while</span> in active state <span class="o">(</span>not in power-saving C state<span class="o">)=</span><span class="s1">&#39;unhalted clock ticks&#39;</span>/<span class="s1">&#39;invariant timer ticks while in C0-state&#39;</span>  <span class="o">(</span>includes Intel Turbo Boost<span class="o">)</span>
</span></span><span class="line"><span class="cl"> L3MISS: L3 <span class="o">(</span><span class="nb">read</span><span class="o">)</span> cache misses
</span></span><span class="line"><span class="cl"> L3MPKI: L3 misses per kilo instructions
</span></span><span class="line"><span class="cl"> L3HIT : L3 <span class="o">(</span><span class="nb">read</span><span class="o">)</span> cache hit ratio <span class="o">(</span>0.00-1.00<span class="o">)</span>
</span></span><span class="line"><span class="cl"> L2DMISS:L2 data cache misses
</span></span><span class="line"><span class="cl"> L2DHIT :L2 data cache hit ratio <span class="o">(</span>0.00-1.00<span class="o">)</span>
</span></span><span class="line"><span class="cl"> L2DMPKI:number of L2 data cache misses per kilo instruction
</span></span><span class="line"><span class="cl"> L2IMISS:L2 instruction cache misses
</span></span><span class="line"><span class="cl"> L2IHIT :L2 instructoon cache hit ratio <span class="o">(</span>0.00-1.00<span class="o">)</span>
</span></span><span class="line"><span class="cl"> L2IMPKI:number of L2  instruction cache misses per kilo instruction
</span></span><span class="line"><span class="cl"> L2MPKI :number of both L2 instruction and data cache misses per kilo instruction
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> Core <span class="o">(</span>SKT<span class="o">)</span> <span class="p">|</span>  EXEC  <span class="p">|</span>   IPC  <span class="p">|</span>  FREQ  <span class="p">|</span>  AFREQ <span class="p">|</span> L2DMISS<span class="p">|</span> L2DHIT <span class="p">|</span> L2DMPKI<span class="p">|</span> L2IMISS<span class="p">|</span> L2IHIT <span class="p">|</span> L2IMPKI<span class="p">|</span> L2MPKI <span class="p">|</span> L3MISS <span class="p">|</span> L3MPKI <span class="p">|</span>  L3HIT <span class="p">|</span> TEMP
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">---------------------------------------------------------------------------------------------------------------
</span></span><span class="line"><span class="cl"> TOTAL  *     1.29     1.20     1.08     1.00     <span class="m">12</span> M     0.73     0.04     <span class="m">10</span> M     0.87     0.03     0.07     <span class="m">19</span> M     0.00     0.55     N/A
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> Instructions retired:  <span class="m">336</span> G <span class="p">;</span> Active cycles:  <span class="m">281</span> G <span class="p">;</span> Time <span class="o">(</span>TSC<span class="o">)</span>: <span class="m">2082</span> Mticks <span class="p">;</span> C0 <span class="o">(</span>active,non-halted<span class="o">)</span> core residency: 107.90 %
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> PHYSICAL CORE IPC                 : 2.39 <span class="o">=</span>&gt; corresponds to 34.14 % utilization <span class="k">for</span> cores in active state
</span></span><span class="line"><span class="cl"> Instructions per nominal CPU cycle: 2.58 <span class="o">=</span>&gt; corresponds to 36.84 % core utilization over <span class="nb">time</span> interval
</span></span><span class="line"><span class="cl">---------------------------------------------------------------------------------------------------------------
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Cleaning up
</span></span><span class="line"><span class="cl"> Zeroed PMU registers</span></span></code></pre>
</div>
<p>在本地启动benchmarksql压力，并将进程绑定到0-8core，然后采集到数据：</p>
<div class="code-block highlight is-open show-line-numbers  tw-group tw-my-2">
  <div class="
    code-block-title 
    
    tw-flex 
    tw-flex-row 
    tw-justify-between 
    tw-w-full tw-bg-bgColor-secondary
    ">      
    <button 
      class="
        tw-select-none 
        tw-mx-2 
        tw-block
        group-[.is-open]:tw-rotate-90
        tw-transition-[transform] 
        tw-duration-500 
        tw-ease-in-out
        print:!tw-hidden"
      disabled
      aria-hidden="true"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M285.476 272.971L91.132 467.314c-9.373 9.373-24.569 9.373-33.941 0l-22.667-22.667c-9.357-9.357-9.375-24.522-.04-33.901L188.505 256 34.484 101.255c-9.335-9.379-9.317-24.544.04-33.901l22.667-22.667c9.373-9.373 24.569-9.373 33.941 0L285.475 239.03c9.373 9.372 9.373 24.568.001 33.941z"/></svg></button>

    <div class="code-block-title-bar tw-w-full">
      <p class="tw-select-none !tw-my-1">shell</p>
    </div>
    <div class="tw-flex">
      <button 
        class="
          line-number-button
          tw-select-none 
          tw-mx-2 
          tw-hidden 
          group-[.is-open]:tw-block 
          group-[.show-line-numbers]:tw-text-fgColor-link 
          print:!tw-hidden" 
        title="Toggle line numbers"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M61.77 401l17.5-20.15a19.92 19.92 0 0 0 5.07-14.19v-3.31C84.34 356 80.5 352 73 352H16a8 8 0 0 0-8 8v16a8 8 0 0 0 8 8h22.83a157.41 157.41 0 0 0-11 12.31l-5.61 7c-4 5.07-5.25 10.13-2.8 14.88l1.05 1.93c3 5.76 6.29 7.88 12.25 7.88h4.73c10.33 0 15.94 2.44 15.94 9.09 0 4.72-4.2 8.22-14.36 8.22a41.54 41.54 0 0 1-15.47-3.12c-6.49-3.88-11.74-3.5-15.6 3.12l-5.59 9.31c-3.72 6.13-3.19 11.72 2.63 15.94 7.71 4.69 20.38 9.44 37 9.44 34.16 0 48.5-22.75 48.5-44.12-.03-14.38-9.12-29.76-28.73-34.88zM496 224H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zm0-160H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16V80a16 16 0 0 0-16-16zm0 320H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zM16 160h64a8 8 0 0 0 8-8v-16a8 8 0 0 0-8-8H64V40a8 8 0 0 0-8-8H32a8 8 0 0 0-7.14 4.42l-8 16A8 8 0 0 0 24 64h8v64H16a8 8 0 0 0-8 8v16a8 8 0 0 0 8 8zm-3.91 160H80a8 8 0 0 0 8-8v-16a8 8 0 0 0-8-8H41.32c3.29-10.29 48.34-18.68 48.34-56.44 0-29.06-25-39.56-44.47-39.56-21.36 0-33.8 10-40.46 18.75-4.37 5.59-3 10.84 2.8 15.37l8.58 6.88c5.61 4.56 11 2.47 16.12-2.44a13.44 13.44 0 0 1 9.46-3.84c3.33 0 9.28 1.56 9.28 8.75C51 248.19 0 257.31 0 304.59v4C0 316 5.08 320 12.09 320z"/></svg></button>

      <button 
        class="
          wrap-code-button
          tw-select-none 
          tw-mx-2 
          tw-hidden 
          group-[.is-open]:tw-block 
          group-[.is-wrap]:tw-text-fgColor-link 
          print:!tw-hidden" 
        title="Toggle code wrap"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M16 132h416c8.837 0 16-7.163 16-16V76c0-8.837-7.163-16-16-16H16C7.163 60 0 67.163 0 76v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16z"/></svg></button>
      
      <button 
        class="
          copy-code-button
          tw-select-none
          tw-mx-2 
          tw-hidden
          group-[.is-open]:tw-block
          hover:tw-text-fgColor-link 
          print:!tw-hidden"
        title="Copy code">
          <span class="copy-icon tw-block"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M433.941 65.941l-51.882-51.882A48 48 0 0 0 348.118 0H176c-26.51 0-48 21.49-48 48v48H48c-26.51 0-48 21.49-48 48v320c0 26.51 21.49 48 48 48h224c26.51 0 48-21.49 48-48v-48h80c26.51 0 48-21.49 48-48V99.882a48 48 0 0 0-14.059-33.941zM266 464H54a6 6 0 0 1-6-6V150a6 6 0 0 1 6-6h74v224c0 26.51 21.49 48 48 48h96v42a6 6 0 0 1-6 6zm128-96H182a6 6 0 0 1-6-6V54a6 6 0 0 1 6-6h106v88c0 13.255 10.745 24 24 24h88v202a6 6 0 0 1-6 6zm6-256h-64V48h9.632c1.591 0 3.117.632 4.243 1.757l48.368 48.368a6 6 0 0 1 1.757 4.243V112z"/></svg></span>
          <span class="check-icon tw-hidden"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M173.898 439.404l-166.4-166.4c-9.997-9.997-9.997-26.206 0-36.204l36.203-36.204c9.997-9.998 26.207-9.998 36.204 0L192 312.69 432.095 72.596c9.997-9.997 26.207-9.997 36.204 0l36.203 36.204c9.997 9.997 9.997 26.206 0 36.204l-294.4 294.401c-9.998 9.997-26.207 9.997-36.204-.001z"/></svg></span>
      </button>
        
      <button 
        class="
          tw-select-none 
          tw-mx-2 
          tw-block 
          group-[.is-open]:tw-hidden 
          print:!tw-hidden" 
        disabled
        aria-hidden="true"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M328 256c0 39.8-32.2 72-72 72s-72-32.2-72-72 32.2-72 72-72 72 32.2 72 72zm104-72c-39.8 0-72 32.2-72 72s32.2 72 72 72 72-32.2 72-72-32.2-72-72-72zm-352 0c-39.8 0-72 32.2-72 72s32.2 72 72 72 72-32.2 72-72-32.2-72-72-72z"/></svg></button>
    </div>
  </div>
  <pre style="counter-reset: codeblock;" class="tw-block tw-m-0 tw-p-0"><code 
    id="codeblock-id-3" 
    class="
      chroma 
      !tw-block 
      tw-p-0
      tw-m-0
      tw-transition-[max-height] 
      tw-duration-500 
      tw-ease-in-out 
      group-[.is-closed]:!tw-max-h-0 
      group-[.is-wrap]:tw-text-wrap
      tw-overflow-y-hidden
      tw-overflow-x-auto
      tw-scrollbar-thin
      "><span class="line"><span class="cl"><span class="c1">#./pcm.x -r -topdown -i=1 -l2</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> Processor Counter Monitor  <span class="o">(</span>2019-08-21 17:07:31 +0800 <span class="nv">ID</span><span class="o">=</span>378f2fc<span class="o">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Number of physical cores: <span class="m">64</span>
</span></span><span class="line"><span class="cl">Number of logical cores: <span class="m">128</span>
</span></span><span class="line"><span class="cl">Number of online logical cores: <span class="m">128</span>
</span></span><span class="line"><span class="cl">Threads <span class="o">(</span>logical cores<span class="o">)</span> per physical core: <span class="m">2</span>
</span></span><span class="line"><span class="cl">Num sockets: <span class="m">2</span>
</span></span><span class="line"><span class="cl">Physical cores per socket: <span class="m">32</span>
</span></span><span class="line"><span class="cl">Core PMU <span class="o">(</span>perfmon<span class="o">)</span> version: <span class="m">3</span>
</span></span><span class="line"><span class="cl">Number of core PMU generic <span class="o">(</span>programmable<span class="o">)</span> counters: <span class="m">6</span>
</span></span><span class="line"><span class="cl">Width of generic <span class="o">(</span>programmable<span class="o">)</span> counters: <span class="m">64</span> bits
</span></span><span class="line"><span class="cl">Ccxs per Node: <span class="m">8</span>
</span></span><span class="line"><span class="cl">Logical cores per Ccx: <span class="m">8</span>
</span></span><span class="line"><span class="cl">Physical Cores per Ccx: <span class="m">4</span>
</span></span><span class="line"><span class="cl">Nodes per socket: <span class="m">4</span>
</span></span><span class="line"><span class="cl">Number of core PMU fixed counters: <span class="m">0</span>
</span></span><span class="line"><span class="cl">Width of fixed counters: <span class="m">0</span> bits
</span></span><span class="line"><span class="cl">Nominal core frequency: <span class="m">2000000000</span> Hz
</span></span><span class="line"><span class="cl">Package thermal spec power: -1 Watt<span class="p">;</span> Package minimum power: -1 Watt<span class="p">;</span> Package maximum power: -1 Watt<span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> Resetting PMU configuration
</span></span><span class="line"><span class="cl"> Zeroed PMU registers
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Detected Hygon C86 <span class="m">7280</span> 32-core Processor  <span class="s2">&#34;Hygon(r) microarchitecture codename DHYANA&#34;</span> stepping <span class="m">1</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> EXEC  : instructions per nominal CPU cycle
</span></span><span class="line"><span class="cl"> IPC   : instructions per CPU cycle
</span></span><span class="line"><span class="cl"> FREQ  : relation to nominal CPU <span class="nv">frequency</span><span class="o">=</span><span class="s1">&#39;unhalted clock ticks&#39;</span>/<span class="s1">&#39;invariant timer ticks&#39;</span> <span class="o">(</span>includes Intel Turbo Boost<span class="o">)</span>
</span></span><span class="line"><span class="cl"> AFREQ : relation to nominal CPU frequency <span class="k">while</span> in active state <span class="o">(</span>not in power-saving C state<span class="o">)=</span><span class="s1">&#39;unhalted clock ticks&#39;</span>/<span class="s1">&#39;invariant timer ticks while in C0-state&#39;</span>  <span class="o">(</span>includes Intel Turbo Boost<span class="o">)</span>
</span></span><span class="line"><span class="cl"> L3MISS: L3 <span class="o">(</span><span class="nb">read</span><span class="o">)</span> cache misses
</span></span><span class="line"><span class="cl"> L3MPKI: L3 misses per kilo instructions
</span></span><span class="line"><span class="cl"> L3HIT : L3 <span class="o">(</span><span class="nb">read</span><span class="o">)</span> cache hit ratio <span class="o">(</span>0.00-1.00<span class="o">)</span>
</span></span><span class="line"><span class="cl"> L2DMISS:L2 data cache misses
</span></span><span class="line"><span class="cl"> L2DHIT :L2 data cache hit ratio <span class="o">(</span>0.00-1.00<span class="o">)</span>
</span></span><span class="line"><span class="cl"> L2DMPKI:number of L2 data cache misses per kilo instruction
</span></span><span class="line"><span class="cl"> L2IMISS:L2 instruction cache misses
</span></span><span class="line"><span class="cl"> L2IHIT :L2 instructoon cache hit ratio <span class="o">(</span>0.00-1.00<span class="o">)</span>
</span></span><span class="line"><span class="cl"> L2IMPKI:number of L2  instruction cache misses per kilo instruction
</span></span><span class="line"><span class="cl"> L2MPKI :number of both L2 instruction and data cache misses per kilo instruction
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> Core <span class="o">(</span>SKT<span class="o">)</span> <span class="p">|</span>  EXEC  <span class="p">|</span>   IPC  <span class="p">|</span>  FREQ  <span class="p">|</span>  AFREQ <span class="p">|</span> L2DMISS<span class="p">|</span> L2DHIT <span class="p">|</span> L2DMPKI<span class="p">|</span> L2IMISS<span class="p">|</span> L2IHIT <span class="p">|</span> L2IMPKI<span class="p">|</span> L2MPKI <span class="p">|</span> L3MISS <span class="p">|</span> L3MPKI <span class="p">|</span>  L3HIT <span class="p">|</span> TEMP
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">   <span class="m">0</span>    <span class="m">0</span>     1.34     1.26     1.06     1.00   <span class="m">8901</span> K     0.72     3.15     <span class="m">15</span> M     0.68     5.43     8.58     <span class="m">71</span> M     4.00     0.60      N/A
</span></span><span class="line"><span class="cl">   <span class="m">1</span>    <span class="m">0</span>     1.42     1.33     1.06     1.00   <span class="m">8491</span> K     0.73     2.83     <span class="m">14</span> M     0.68     4.67     7.50     <span class="m">71</span> M     4.00     0.60      N/A
</span></span><span class="line"><span class="cl">   <span class="m">2</span>    <span class="m">0</span>     1.41     1.33     1.06     1.00   <span class="m">8206</span> K     0.74     2.75     <span class="m">12</span> M     0.72     4.25     7.00     <span class="m">71</span> M     4.00     0.60      N/A
</span></span><span class="line"><span class="cl">   <span class="m">3</span>    <span class="m">0</span>     1.46     1.38     1.06     1.00   <span class="m">7464</span> K     0.75     2.40     <span class="m">11</span> M     0.68     3.81     6.21     <span class="m">71</span> M     4.00     0.60      N/A
</span></span><span class="line"><span class="cl">   <span class="m">4</span>    <span class="m">0</span>     1.31     1.24     1.06     1.00   <span class="m">9118</span> K     0.71     3.28     <span class="m">15</span> M     0.69     5.61     8.88     <span class="m">70</span> M     4.00     0.61      N/A
</span></span><span class="line"><span class="cl">   <span class="m">5</span>    <span class="m">0</span>     1.41     1.33     1.06     1.00   <span class="m">8700</span> K     0.74     2.92     <span class="m">13</span> M     0.69     4.66     7.57     <span class="m">70</span> M     4.00     0.61      N/A
</span></span><span class="line"><span class="cl">   <span class="m">6</span>    <span class="m">0</span>     1.41     1.33     1.06     1.00   <span class="m">8094</span> K     0.74     2.79     <span class="m">12</span> M     0.70     4.40     7.18     <span class="m">70</span> M     4.00     0.61      N/A
</span></span><span class="line"><span class="cl">   <span class="m">7</span>    <span class="m">0</span>     1.43     1.35     1.06     1.00   <span class="m">7873</span> K     0.74     2.68     <span class="m">12</span> M     0.71     4.13     6.81     <span class="m">70</span> M     4.00     0.61      N/A
</span></span><span class="line"><span class="cl">   <span class="m">8</span>    <span class="m">0</span>     1.44     1.36     1.06     1.00   <span class="m">8544</span> K     0.73     2.79     <span class="m">14</span> M     0.67     4.87     7.66     <span class="m">20</span> M     1.00     0.61      N/A
</span></span><span class="line"><span class="cl">   <span class="m">9</span>    <span class="m">0</span>     1.24     1.16     1.06     1.00    <span class="m">524</span> K     0.51     0.21     <span class="m">86</span> K     0.94     0.03     0.24     <span class="m">20</span> M     1.00     0.61      N/A
</span></span><span class="line"><span class="cl">  <span class="m">10</span>    <span class="m">0</span>     1.26     1.18     1.07     1.00    <span class="m">379</span> K     0.50     0.15     <span class="m">60</span> K     0.95     0.02     0.17     <span class="m">20</span> M     1.00     0.61      N/A
</span></span><span class="line"><span class="cl">  <span class="m">11</span>    <span class="m">0</span>     1.24     1.16     1.07     1.00    <span class="m">533</span> K     0.50     0.20     <span class="m">96</span> K     0.94     0.04     0.24     <span class="m">20</span> M     1.00     0.61      N/A
</span></span><span class="line"><span class="cl">  <span class="m">12</span>    <span class="m">0</span>     1.22     1.14     1.07     1.00   <span class="m">1180</span> K     0.34     0.47     <span class="m">98</span> K     0.94     0.04     0.51   <span class="m">3872</span> K     0.12     0.46      N/A
</span></span><span class="line"><span class="cl">  <span class="m">13</span>    <span class="m">0</span>     1.24     1.16     1.07     1.00    <span class="m">409</span> K     0.49     0.16     <span class="m">64</span> K     0.94     0.03     0.19   <span class="m">3872</span> K     0.12     0.46      N/A
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">  ---------------------------------------------------------------------------------------------------------------
</span></span><span class="line"><span class="cl"> SKT    <span class="m">0</span>     1.18     1.11     1.06     1.00    <span class="m">113</span> M     0.67     0.73    <span class="m">139</span> M     0.71     0.89     1.62    <span class="m">186</span> M     1.12     0.59      N/A
</span></span><span class="line"><span class="cl"> SKT    <span class="m">1</span>     1.23     1.14     1.08     1.00     <span class="m">33</span> M     0.53     0.21     <span class="m">11</span> M     0.89     0.07     0.28     <span class="m">38</span> M     0.12     0.45      N/A
</span></span><span class="line"><span class="cl">---------------------------------------------------------------------------------------------------------------
</span></span><span class="line"><span class="cl"> TOTAL  *     1.21     1.13     1.07     1.00    <span class="m">147</span> M     0.65     0.46    <span class="m">150</span> M     0.74     0.47     0.93    <span class="m">224</span> M     0.62     0.57     N/A
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> Instructions retired:  <span class="m">319</span> G <span class="p">;</span> Active cycles:  <span class="m">283</span> G <span class="p">;</span> Time <span class="o">(</span>TSC<span class="o">)</span>: <span class="m">2108</span> Mticks <span class="p">;</span> C0 <span class="o">(</span>active,non-halted<span class="o">)</span> core residency: 107.12 %
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> PHYSICAL CORE IPC                 : 2.25 <span class="o">=</span>&gt; corresponds to 32.18 % utilization <span class="k">for</span> cores in active state
</span></span><span class="line"><span class="cl"> Instructions per nominal CPU cycle: 2.41 <span class="o">=</span>&gt; corresponds to 34.48 % core utilization over <span class="nb">time</span> interval
</span></span><span class="line"><span class="cl">---------------------------------------------------------------------------------------------------------------
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Cleaning up
</span></span><span class="line"><span class="cl"> Zeroed PMU registers</span></span></code></pre>
</div>
<h2 id="apple-m1" class="headerLink">
    <a href="#apple-m1" class="header-mark"></a>Apple M1</h2><!-- raw HTML omitted -->
<h3 id="the-m1" class="headerLink">
    <a href="#the-m1" class="header-mark"></a><strong>The M1</strong></h3><p>The critically-acclaimed M1 processor delivers:</p>
<ul>
<li>16 billion transistors and a 119mm squared-die size.</li>
<li>4 performance cores, 12MB L2 Cache.</li>
<li>4 efficiency cores ith 4MB L2 cache.</li>
<li>8 GPU Cores.</li>
<li>16GB DDR4x memory at 68GB/s.</li>
</ul>
<h3 id="the-m1-pro" class="headerLink">
    <a href="#the-m1-pro" class="header-mark"></a><strong>The M1 Pro</strong></h3><p>The M1 Pro takes this higher, with:</p>
<ul>
<li>33.7 billion transistors on a 240mm squared die.</li>
<li>8 performance cores, 24MB L2 Cache.</li>
<li>2 efficiency cores with 4MB L2 cache.</li>
<li>16 GPU Cores.</li>
<li>32GB DDR5 memory at 200GB/s.</li>
</ul>
<p>对比下 i9-12000，i9也有GPU只是没有说多少个，它的GPU频率在0.3到1.55GHz之间</p>
<p><img class="tw-inline" loading="lazy" src=https://cdn.jsdelivr.net/gh/plantegg/plantegg.github.io/images/951413iMgBlog/400px-alder_lake_die_2.png   alt="alder lake die 2.png"  ></p>

<div class="table-wrapper">
  <table>
    <thead>
        <tr>
            <th style="text-align: ">ISA</th>
            <th style="text-align: ">x86-64 (x86)</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td style="text-align: ">Microarchitecture</td>
            <td style="text-align: "><a href="https://en.wikichip.org/wiki/intel/microarchitectures/alder_lake" target="_blank" rel="noopener noreferrer">Alder Lake</a>, <a href="https://en.wikichip.org/wiki/intel/microarchitectures/golden_cove" target="_blank" rel="noopener noreferrer">Golden Cove</a>, <a href="https://en.wikichip.org/wiki/intel/microarchitectures/gracemont" target="_blank" rel="noopener noreferrer">Gracemont</a></td>
        </tr>
        <tr>
            <td style="text-align: ">Process</td>
            <td style="text-align: "><a href="https://en.wikichip.org/w/index.php?title=Intel_7_process&amp;action=edit&amp;redlink=1" target="_blank" rel="noopener noreferrer">Intel 7</a></td>
        </tr>
        <tr>
            <td style="text-align: ">Die</td>
            <td style="text-align: ">215.25 mm²&quot; 20.5 mm × 10.5 mm</td>
        </tr>
        <tr>
            <td style="text-align: ">MCP</td>
            <td style="text-align: ">No (1 dies)</td>
        </tr>
        <tr>
            <td style="text-align: ">Cores</td>
            <td style="text-align: ">16</td>
        </tr>
        <tr>
            <td style="text-align: ">Threads</td>
            <td style="text-align: ">24</td>
        </tr>
        <tr>
            <td style="text-align: "><a href="https://en.wikichip.org/wiki/Property:l1$_size" target="_blank" rel="noopener noreferrer">l1$ size</a></td>
            <td style="text-align: ">0.75 MiB (768 KiB, 786,432 B, 7.324219e-4 GiB) <a href="https://en.wikichip.org/wiki/Special:SearchByProperty/:l1-24-20size/0.75-20MiB" target="_blank" rel="noopener noreferrer">+</a> and 0.625 MiB (640 KiB, 655,360 B, 6.103516e-4 GiB) <a href="https://en.wikichip.org/wiki/Special:SearchByProperty/:l1-24-20size/0.625-20MiB" target="_blank" rel="noopener noreferrer">+</a></td>
        </tr>
        <tr>
            <td style="text-align: "><a href="https://en.wikichip.org/wiki/Property:l1d$_size" target="_blank" rel="noopener noreferrer">l1d$ size</a></td>
            <td style="text-align: ">0.25 MiB (256 KiB, 262,144 B, 2.441406e-4 GiB) <a href="https://en.wikichip.org/wiki/Special:SearchByProperty/:l1d-24-20size/0.25-20MiB" target="_blank" rel="noopener noreferrer">+</a> and 0.375 MiB (384 KiB, 393,216 B, 3.662109e-4 GiB) <a href="https://en.wikichip.org/wiki/Special:SearchByProperty/:l1d-24-20size/0.375-20MiB" target="_blank" rel="noopener noreferrer">+</a></td>
        </tr>
        <tr>
            <td style="text-align: "><a href="https://en.wikichip.org/wiki/Property:l1i$_size" target="_blank" rel="noopener noreferrer">l1i$ size</a></td>
            <td style="text-align: ">0.5 MiB (512 KiB, 524,288 B, 4.882812e-4 GiB) <a href="https://en.wikichip.org/wiki/Special:SearchByProperty/:l1i-24-20size/0.5-20MiB" target="_blank" rel="noopener noreferrer">+</a> and 0.25 MiB (256 KiB, 262,144 B, 2.441406e-4 GiB) <a href="https://en.wikichip.org/wiki/Special:SearchByProperty/:l1i-24-20size/0.25-20MiB" target="_blank" rel="noopener noreferrer">+</a></td>
        </tr>
        <tr>
            <td style="text-align: "><a href="https://en.wikichip.org/wiki/Property:l2$_size" target="_blank" rel="noopener noreferrer">l2$ size</a></td>
            <td style="text-align: ">4 MiB (4,096 KiB, 4,194,304 B, 0.00391 GiB) <a href="https://en.wikichip.org/wiki/Special:SearchByProperty/:l2-24-20size/4-20MiB" target="_blank" rel="noopener noreferrer">+</a> and 10 MiB (10,240 KiB, 10,485,760 B, 0.00977 GiB) <a href="https://en.wikichip.org/wiki/Special:SearchByProperty/:l2-24-20size/10-20MiB" target="_blank" rel="noopener noreferrer">+</a></td>
        </tr>
        <tr>
            <td style="text-align: "><a href="https://en.wikichip.org/wiki/Property:l3$_size" target="_blank" rel="noopener noreferrer">l3$ size</a></td>
            <td style="text-align: ">6 MiB (6,144 KiB, 6,291,456 B, 0.00586 GiB) <a href="https://en.wikichip.org/wiki/Special:SearchByProperty/:l3-24-20size/6-20MiB" target="_blank" rel="noopener noreferrer">+</a> and 24 MiB (24,576 KiB, 25,165,824 B, 0.0234 GiB) <a href="https://en.wikichip.org/wiki/Special:SearchByProperty/:l3-24-20size/24-20MiB" target="_blank" rel="noopener noreferrer">+</a></td>
        </tr>
    </tbody>
  </table>
</div>
<h3 id="the-m1-max" class="headerLink">
    <a href="#the-m1-max" class="header-mark"></a><strong>The M1 Max</strong></h3><p>The M1 Max provides:</p>
<ul>
<li>57 billion transistors on a 420mm squared die.</li>
<li>8 performance cores, 24MB L2 Cache.</li>
<li>2 efficiency cores with 4MB L2 cache.</li>
<li>32 GPU Cores.</li>
<li>64GB DDR5 memory at 400GB/s.</li>
</ul>
<h3 id="and-the-new-m1-ultra" class="headerLink">
    <a href="#and-the-new-m1-ultra" class="header-mark"></a><strong>And the new M1 Ultra</strong></h3><p>The M1 Ultra brings you:</p>
<ul>
<li>114 billion transistors on a 840mm squared die.</li>
<li>16 performance cores, 48MB L2 Cache.</li>
<li>4 efficiency cores with 4MB L2 cache.</li>
<li>64 GPU Cores.</li>
<li>Up to 128GB DDR5 memory at 800GB/s.</li>
</ul>
<h2 id="倚天710" class="headerLink">
    <a href="#%e5%80%9a%e5%a4%a9710" class="header-mark"></a>倚天710</h2><p>一个die有64core，每两个core是一个cluster，一块cpu封装两个die</p>
<p>一个die大小是314平方毫米，600亿晶体管</p>
<p><img class="tw-inline" loading="lazy" src=https://cdn.jsdelivr.net/gh/plantegg/plantegg.github.io/images/951413iMgBlog/image-20211205130348832.png   alt="image-20211205130348832"  ></p>
<p>平头哥的几款芯片：</p>
<p><img class="tw-inline" loading="lazy" src=https://cdn.jsdelivr.net/gh/plantegg/plantegg.github.io/images/951413iMgBlog/v2-4a587237e30986b36c5657761c31ae21_r.jpg   alt="preview"  ></p>
<h2 id="总结" class="headerLink">
    <a href="#%e6%80%bb%e7%bb%93" class="header-mark"></a>总结</h2><p>AMD和Intel在服务器领域CPU设计上走了两个不同的方向，Intel通过RingBus、Mesh等方案在一块Die上集成多个core，成本高，在多核场景下性能好。</p>
<p>AMD则是通过设计小的Die来降低成本，然后将多个Die封装到一块CPU上来售卖，Zen1架构的多个Die之间延迟高，于是Zen2将IO抽离出来用一块单独的IO Die来负责IO，这样多核之间的时延比Zen1好了很多。</p>
<p>而在云计算场景下AMD的设计非常有竞争优势，因为云计算大部分时候是要把一块大的CPU分拆售卖，从架构上AMD对分拆售卖非常友好。</p>
<p>整体来说AMD用领先了一代的工艺（7nm VS 14nm)，在MySQL查询场景中终于可以接近Intel了，但是海光、鲲鹏、飞腾还是不给力。</p>
<h2 id="参考资料" class="headerLink">
    <a href="#%e5%8f%82%e8%80%83%e8%b5%84%e6%96%99" class="header-mark"></a>参考资料</h2><p><a href="/2021/06/01/CPU%e7%9a%84%e5%88%b6%e9%80%a0%e5%92%8c%e6%a6%82%e5%bf%b5/" rel="">CPU的制造和概念</a></p>
<p>[CPU 性能和Cache Line](/2021/05/16/CPU Cache Line 和性能/)</p>
<p>[Perf IPC以及CPU性能](/2021/05/16/Perf IPC以及CPU利用率/)</p>
<p><a href="/2021/06/18/%e5%87%a0%e6%ac%beCPU%e6%80%a7%e8%83%bd%e5%af%b9%e6%af%94/" rel="">Intel、海光、鲲鹏920、飞腾2500 CPU性能对比</a></p>
<p><a href="/2021/05/15/%e9%a3%9e%e8%85%beARM%e8%8a%af%e7%89%87%28FT2500%29%e7%9a%84%e6%80%a7%e8%83%bd%e6%b5%8b%e8%af%95/" rel="">飞腾ARM芯片(FT2500)的性能测试</a></p>
<p><a href="/2021/05/14/%e5%8d%81%e5%b9%b4%e5%90%8e%e6%95%b0%e6%8d%ae%e5%ba%93%e8%bf%98%e6%98%af%e4%b8%8d%e6%95%a2%e6%8b%a5%e6%8a%b1NUMA/" rel="">十年后数据库还是不敢拥抱NUMA？</a></p>
<p><a href="/2021/03/07/%e4%b8%80%e6%ac%a1%e6%b5%b7%e5%85%89%e7%89%a9%e7%90%86%e6%9c%ba%e8%b5%84%e6%ba%90%e7%ab%9e%e4%ba%89%e5%8e%8b%e6%b5%8b%e7%9a%84%e8%ae%b0%e5%bd%95/" rel="">一次海光物理机资源竞争压测的记录</a></p>
<p>[Intel PAUSE指令变化是如何影响自旋锁以及MySQL的性能的](/2019/12/16/Intel PAUSE指令变化是如何影响自旋锁以及MySQL的性能的/)</p>
<p><a href="https://blog.csdn.net/xuanjian_bjtu/article/details/107178226" target="_blank" rel="noopener noreferrer">lmbench测试要考虑cache等</a></p>
]]></description>
</item><item>
    <title>Intel AMD 鲲鹏 海光 飞腾性能PK</title>
    <link>https://plantegg.github.io/posts/intel-amd-%E9%B2%B2%E9%B9%8F-%E6%B5%B7%E5%85%89-%E9%A3%9E%E8%85%BE%E6%80%A7%E8%83%BDpk/</link>
    <pubDate>Sun, 21 Mar 2021 17:30:03 &#43;0000</pubDate><author>
        <name>作者</name>
    </author><guid>https://plantegg.github.io/posts/intel-amd-%E9%B2%B2%E9%B9%8F-%E6%B5%B7%E5%85%89-%E9%A3%9E%E8%85%BE%E6%80%A7%E8%83%BDpk/</guid>
    <description><![CDATA[<h1 id="intel-amd-鲲鹏-海光-飞腾性能pk" class="headerLink">
    <a href="#intel-amd-%e9%b2%b2%e9%b9%8f-%e6%b5%b7%e5%85%89-%e9%a3%9e%e8%85%be%e6%80%a7%e8%83%bdpk" class="header-mark"></a>Intel AMD 鲲鹏 海光 飞腾性能PK</h1><h2 id="前言" class="headerLink">
    <a href="#%e5%89%8d%e8%a8%80" class="header-mark"></a>前言</h2><p>本文在sysbench、tpcc等实践场景下对多款CPU的性能进行对比，同时分析各款CPU的硬件指标，最后分析不同场景下的实际性能和核心参数的关系。</p>
<p>本文的姊妹篇：<a href="https://zhuanlan.zhihu.com/p/387117470" target="_blank" rel="noopener noreferrer">十年后数据库还是不敢拥抱NUMA？</a> 主要讲述的是 同一块CPU的不同NUMA结构配置带来的几倍性能差异，这些性能差异原因也可以从本文最后时延测试数据得到印证，一起阅读效果更好。</p>
<h2 id="性能定义" class="headerLink">
    <a href="#%e6%80%a7%e8%83%bd%e5%ae%9a%e4%b9%89" class="header-mark"></a>性能定义</h2><p>同一个平台下（X86、ARM是两个平台）编译好的程序可以认为他们的 <strong>指令</strong> 数是一样的，那么执行效率就是每个时钟周期所能执行的指令数量了。</p>
<p>执行指令数量第一取决的就是CPU主频了，但是目前主流CPU都是2.5G左右，另外就是单核下的并行度（多发射）以及多核，再就是分支预测等，这些基本归结到了访问内存的延时。</p>
<p>X86和ARM这两不同平台首先指令就不一样了，然后还有上面所说的主频、内存时延的差异</p>
<p>IPC的说明：</p>
<blockquote>
  <p>IPC: insns per cycle  insn/cycles  也就是每个时钟周期能执行的指令数量，越大程序跑的越快</p>
<p>程序的执行时间 = 指令数/(主频*IPC) //单核下，多核的话再除以核数</p>

</blockquote><h2 id="参与比较的几款cpu参数" class="headerLink">
    <a href="#%e5%8f%82%e4%b8%8e%e6%af%94%e8%be%83%e7%9a%84%e5%87%a0%e6%ac%becpu%e5%8f%82%e6%95%b0" class="header-mark"></a>参与比较的几款CPU参数</h2><p>先来看看测试所用到的几款CPU的主要指标，大家关注下主频、各级cache大小、<a href="https://zhuanlan.zhihu.com/p/387117470" target="_blank" rel="noopener noreferrer">numa结构</a></p>
<h3 id="hygon-7280" class="headerLink">
    <a href="#hygon-7280" class="header-mark"></a>Hygon 7280</h3><p>Hygon 7280 就是AMD Zen架构，最大IPC能到5.</p>
<div class="code-block highlight is-open show-line-numbers  tw-group tw-my-2">
  <div class="
    code-block-title 
    
    tw-flex 
    tw-flex-row 
    tw-justify-between 
    tw-w-full tw-bg-bgColor-secondary
    ">      
    <button 
      class="
        tw-select-none 
        tw-mx-2 
        tw-block
        group-[.is-open]:tw-rotate-90
        tw-transition-[transform] 
        tw-duration-500 
        tw-ease-in-out
        print:!tw-hidden"
      disabled
      aria-hidden="true"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M285.476 272.971L91.132 467.314c-9.373 9.373-24.569 9.373-33.941 0l-22.667-22.667c-9.357-9.357-9.375-24.522-.04-33.901L188.505 256 34.484 101.255c-9.335-9.379-9.317-24.544.04-33.901l22.667-22.667c9.373-9.373 24.569-9.373 33.941 0L285.475 239.03c9.373 9.372 9.373 24.568.001 33.941z"/></svg></button>

    <div class="code-block-title-bar tw-w-full">
      <p class="tw-select-none !tw-my-1">shell</p>
    </div>
    <div class="tw-flex">
      <button 
        class="
          line-number-button
          tw-select-none 
          tw-mx-2 
          tw-hidden 
          group-[.is-open]:tw-block 
          group-[.show-line-numbers]:tw-text-fgColor-link 
          print:!tw-hidden" 
        title="Toggle line numbers"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M61.77 401l17.5-20.15a19.92 19.92 0 0 0 5.07-14.19v-3.31C84.34 356 80.5 352 73 352H16a8 8 0 0 0-8 8v16a8 8 0 0 0 8 8h22.83a157.41 157.41 0 0 0-11 12.31l-5.61 7c-4 5.07-5.25 10.13-2.8 14.88l1.05 1.93c3 5.76 6.29 7.88 12.25 7.88h4.73c10.33 0 15.94 2.44 15.94 9.09 0 4.72-4.2 8.22-14.36 8.22a41.54 41.54 0 0 1-15.47-3.12c-6.49-3.88-11.74-3.5-15.6 3.12l-5.59 9.31c-3.72 6.13-3.19 11.72 2.63 15.94 7.71 4.69 20.38 9.44 37 9.44 34.16 0 48.5-22.75 48.5-44.12-.03-14.38-9.12-29.76-28.73-34.88zM496 224H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zm0-160H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16V80a16 16 0 0 0-16-16zm0 320H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zM16 160h64a8 8 0 0 0 8-8v-16a8 8 0 0 0-8-8H64V40a8 8 0 0 0-8-8H32a8 8 0 0 0-7.14 4.42l-8 16A8 8 0 0 0 24 64h8v64H16a8 8 0 0 0-8 8v16a8 8 0 0 0 8 8zm-3.91 160H80a8 8 0 0 0 8-8v-16a8 8 0 0 0-8-8H41.32c3.29-10.29 48.34-18.68 48.34-56.44 0-29.06-25-39.56-44.47-39.56-21.36 0-33.8 10-40.46 18.75-4.37 5.59-3 10.84 2.8 15.37l8.58 6.88c5.61 4.56 11 2.47 16.12-2.44a13.44 13.44 0 0 1 9.46-3.84c3.33 0 9.28 1.56 9.28 8.75C51 248.19 0 257.31 0 304.59v4C0 316 5.08 320 12.09 320z"/></svg></button>

      <button 
        class="
          wrap-code-button
          tw-select-none 
          tw-mx-2 
          tw-hidden 
          group-[.is-open]:tw-block 
          group-[.is-wrap]:tw-text-fgColor-link 
          print:!tw-hidden" 
        title="Toggle code wrap"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M16 132h416c8.837 0 16-7.163 16-16V76c0-8.837-7.163-16-16-16H16C7.163 60 0 67.163 0 76v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16z"/></svg></button>
      
      <button 
        class="
          copy-code-button
          tw-select-none
          tw-mx-2 
          tw-hidden
          group-[.is-open]:tw-block
          hover:tw-text-fgColor-link 
          print:!tw-hidden"
        title="Copy code">
          <span class="copy-icon tw-block"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M433.941 65.941l-51.882-51.882A48 48 0 0 0 348.118 0H176c-26.51 0-48 21.49-48 48v48H48c-26.51 0-48 21.49-48 48v320c0 26.51 21.49 48 48 48h224c26.51 0 48-21.49 48-48v-48h80c26.51 0 48-21.49 48-48V99.882a48 48 0 0 0-14.059-33.941zM266 464H54a6 6 0 0 1-6-6V150a6 6 0 0 1 6-6h74v224c0 26.51 21.49 48 48 48h96v42a6 6 0 0 1-6 6zm128-96H182a6 6 0 0 1-6-6V54a6 6 0 0 1 6-6h106v88c0 13.255 10.745 24 24 24h88v202a6 6 0 0 1-6 6zm6-256h-64V48h9.632c1.591 0 3.117.632 4.243 1.757l48.368 48.368a6 6 0 0 1 1.757 4.243V112z"/></svg></span>
          <span class="check-icon tw-hidden"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M173.898 439.404l-166.4-166.4c-9.997-9.997-9.997-26.206 0-36.204l36.203-36.204c9.997-9.998 26.207-9.998 36.204 0L192 312.69 432.095 72.596c9.997-9.997 26.207-9.997 36.204 0l36.203 36.204c9.997 9.997 9.997 26.206 0 36.204l-294.4 294.401c-9.998 9.997-26.207 9.997-36.204-.001z"/></svg></span>
      </button>
        
      <button 
        class="
          tw-select-none 
          tw-mx-2 
          tw-block 
          group-[.is-open]:tw-hidden 
          print:!tw-hidden" 
        disabled
        aria-hidden="true"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M328 256c0 39.8-32.2 72-72 72s-72-32.2-72-72 32.2-72 72-72 72 32.2 72 72zm104-72c-39.8 0-72 32.2-72 72s32.2 72 72 72 72-32.2 72-72-32.2-72-72-72zm-352 0c-39.8 0-72 32.2-72 72s32.2 72 72 72 72-32.2 72-72-32.2-72-72-72z"/></svg></button>
    </div>
  </div>
  <pre style="counter-reset: codeblock;" class="tw-block tw-m-0 tw-p-0"><code 
    id="codeblock-id-1" 
    class="
      chroma 
      !tw-block 
      tw-p-0
      tw-m-0
      tw-transition-[max-height] 
      tw-duration-500 
      tw-ease-in-out 
      group-[.is-closed]:!tw-max-h-0 
      group-[.is-wrap]:tw-text-wrap
      tw-overflow-y-hidden
      tw-overflow-x-auto
      tw-scrollbar-thin
      "><span class="line"><span class="cl">架构：                           x86_64
</span></span><span class="line"><span class="cl">CPU 运行模式：                   32-bit, 64-bit
</span></span><span class="line"><span class="cl">字节序：                         Little Endian
</span></span><span class="line"><span class="cl">Address sizes:                   <span class="m">43</span> bits physical, <span class="m">48</span> bits virtual
</span></span><span class="line"><span class="cl">CPU:                             <span class="m">128</span>
</span></span><span class="line"><span class="cl">在线 CPU 列表：                  0-127
</span></span><span class="line"><span class="cl">每个核的线程数：                 <span class="m">2</span>
</span></span><span class="line"><span class="cl">每个座的核数：                   <span class="m">32</span>
</span></span><span class="line"><span class="cl">座：                             <span class="m">2</span>
</span></span><span class="line"><span class="cl">NUMA 节点：                      <span class="m">8</span>
</span></span><span class="line"><span class="cl">厂商 ID：                        HygonGenuine
</span></span><span class="line"><span class="cl">CPU 系列：                       <span class="m">24</span>
</span></span><span class="line"><span class="cl">型号：                           <span class="m">1</span>
</span></span><span class="line"><span class="cl">型号名称：                       Hygon C86 <span class="m">7280</span> 32-core Processor
</span></span><span class="line"><span class="cl">步进：                           <span class="m">1</span>
</span></span><span class="line"><span class="cl">CPU MHz：                        2194.586
</span></span><span class="line"><span class="cl">BogoMIPS：                       3999.63
</span></span><span class="line"><span class="cl">虚拟化：                         AMD-V
</span></span><span class="line"><span class="cl">L1d 缓存：                       <span class="m">2</span> MiB  
</span></span><span class="line"><span class="cl">L1i 缓存：                       <span class="m">4</span> MiB
</span></span><span class="line"><span class="cl">L2 缓存：                        <span class="m">32</span> MiB
</span></span><span class="line"><span class="cl">L3 缓存：                        <span class="m">128</span> MiB
</span></span><span class="line"><span class="cl">NUMA 节点0 CPU：                 0-7,64-71
</span></span><span class="line"><span class="cl">NUMA 节点1 CPU：                 8-15,72-79
</span></span><span class="line"><span class="cl">NUMA 节点2 CPU：                 16-23,80-87
</span></span><span class="line"><span class="cl">NUMA 节点3 CPU：                 24-31,88-95
</span></span><span class="line"><span class="cl">NUMA 节点4 CPU：                 32-39,96-103
</span></span><span class="line"><span class="cl">NUMA 节点5 CPU：                 40-47,104-111
</span></span><span class="line"><span class="cl">NUMA 节点6 CPU：                 48-55,112-119
</span></span><span class="line"><span class="cl">NUMA 节点7 CPU：                 56-63,120-127</span></span></code></pre>
</div>
<h3 id="amd-epyc-7h12" class="headerLink">
    <a href="#amd-epyc-7h12" class="header-mark"></a>AMD EPYC 7H12</h3><p>AMD EPYC 7H12 64-Core（ECS，非物理机），最大IPC能到5.</p>
<div class="code-block highlight is-open show-line-numbers  tw-group tw-my-2">
  <div class="
    code-block-title 
    
    tw-flex 
    tw-flex-row 
    tw-justify-between 
    tw-w-full tw-bg-bgColor-secondary
    ">      
    <button 
      class="
        tw-select-none 
        tw-mx-2 
        tw-block
        group-[.is-open]:tw-rotate-90
        tw-transition-[transform] 
        tw-duration-500 
        tw-ease-in-out
        print:!tw-hidden"
      disabled
      aria-hidden="true"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M285.476 272.971L91.132 467.314c-9.373 9.373-24.569 9.373-33.941 0l-22.667-22.667c-9.357-9.357-9.375-24.522-.04-33.901L188.505 256 34.484 101.255c-9.335-9.379-9.317-24.544.04-33.901l22.667-22.667c9.373-9.373 24.569-9.373 33.941 0L285.475 239.03c9.373 9.372 9.373 24.568.001 33.941z"/></svg></button>

    <div class="code-block-title-bar tw-w-full">
      <p class="tw-select-none !tw-my-1">shell</p>
    </div>
    <div class="tw-flex">
      <button 
        class="
          line-number-button
          tw-select-none 
          tw-mx-2 
          tw-hidden 
          group-[.is-open]:tw-block 
          group-[.show-line-numbers]:tw-text-fgColor-link 
          print:!tw-hidden" 
        title="Toggle line numbers"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M61.77 401l17.5-20.15a19.92 19.92 0 0 0 5.07-14.19v-3.31C84.34 356 80.5 352 73 352H16a8 8 0 0 0-8 8v16a8 8 0 0 0 8 8h22.83a157.41 157.41 0 0 0-11 12.31l-5.61 7c-4 5.07-5.25 10.13-2.8 14.88l1.05 1.93c3 5.76 6.29 7.88 12.25 7.88h4.73c10.33 0 15.94 2.44 15.94 9.09 0 4.72-4.2 8.22-14.36 8.22a41.54 41.54 0 0 1-15.47-3.12c-6.49-3.88-11.74-3.5-15.6 3.12l-5.59 9.31c-3.72 6.13-3.19 11.72 2.63 15.94 7.71 4.69 20.38 9.44 37 9.44 34.16 0 48.5-22.75 48.5-44.12-.03-14.38-9.12-29.76-28.73-34.88zM496 224H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zm0-160H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16V80a16 16 0 0 0-16-16zm0 320H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zM16 160h64a8 8 0 0 0 8-8v-16a8 8 0 0 0-8-8H64V40a8 8 0 0 0-8-8H32a8 8 0 0 0-7.14 4.42l-8 16A8 8 0 0 0 24 64h8v64H16a8 8 0 0 0-8 8v16a8 8 0 0 0 8 8zm-3.91 160H80a8 8 0 0 0 8-8v-16a8 8 0 0 0-8-8H41.32c3.29-10.29 48.34-18.68 48.34-56.44 0-29.06-25-39.56-44.47-39.56-21.36 0-33.8 10-40.46 18.75-4.37 5.59-3 10.84 2.8 15.37l8.58 6.88c5.61 4.56 11 2.47 16.12-2.44a13.44 13.44 0 0 1 9.46-3.84c3.33 0 9.28 1.56 9.28 8.75C51 248.19 0 257.31 0 304.59v4C0 316 5.08 320 12.09 320z"/></svg></button>

      <button 
        class="
          wrap-code-button
          tw-select-none 
          tw-mx-2 
          tw-hidden 
          group-[.is-open]:tw-block 
          group-[.is-wrap]:tw-text-fgColor-link 
          print:!tw-hidden" 
        title="Toggle code wrap"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M16 132h416c8.837 0 16-7.163 16-16V76c0-8.837-7.163-16-16-16H16C7.163 60 0 67.163 0 76v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16z"/></svg></button>
      
      <button 
        class="
          copy-code-button
          tw-select-none
          tw-mx-2 
          tw-hidden
          group-[.is-open]:tw-block
          hover:tw-text-fgColor-link 
          print:!tw-hidden"
        title="Copy code">
          <span class="copy-icon tw-block"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M433.941 65.941l-51.882-51.882A48 48 0 0 0 348.118 0H176c-26.51 0-48 21.49-48 48v48H48c-26.51 0-48 21.49-48 48v320c0 26.51 21.49 48 48 48h224c26.51 0 48-21.49 48-48v-48h80c26.51 0 48-21.49 48-48V99.882a48 48 0 0 0-14.059-33.941zM266 464H54a6 6 0 0 1-6-6V150a6 6 0 0 1 6-6h74v224c0 26.51 21.49 48 48 48h96v42a6 6 0 0 1-6 6zm128-96H182a6 6 0 0 1-6-6V54a6 6 0 0 1 6-6h106v88c0 13.255 10.745 24 24 24h88v202a6 6 0 0 1-6 6zm6-256h-64V48h9.632c1.591 0 3.117.632 4.243 1.757l48.368 48.368a6 6 0 0 1 1.757 4.243V112z"/></svg></span>
          <span class="check-icon tw-hidden"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M173.898 439.404l-166.4-166.4c-9.997-9.997-9.997-26.206 0-36.204l36.203-36.204c9.997-9.998 26.207-9.998 36.204 0L192 312.69 432.095 72.596c9.997-9.997 26.207-9.997 36.204 0l36.203 36.204c9.997 9.997 9.997 26.206 0 36.204l-294.4 294.401c-9.998 9.997-26.207 9.997-36.204-.001z"/></svg></span>
      </button>
        
      <button 
        class="
          tw-select-none 
          tw-mx-2 
          tw-block 
          group-[.is-open]:tw-hidden 
          print:!tw-hidden" 
        disabled
        aria-hidden="true"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M328 256c0 39.8-32.2 72-72 72s-72-32.2-72-72 32.2-72 72-72 72 32.2 72 72zm104-72c-39.8 0-72 32.2-72 72s32.2 72 72 72 72-32.2 72-72-32.2-72-72-72zm-352 0c-39.8 0-72 32.2-72 72s32.2 72 72 72 72-32.2 72-72-32.2-72-72-72z"/></svg></button>
    </div>
  </div>
  <pre style="counter-reset: codeblock;" class="tw-block tw-m-0 tw-p-0"><code 
    id="codeblock-id-2" 
    class="
      chroma 
      !tw-block 
      tw-p-0
      tw-m-0
      tw-transition-[max-height] 
      tw-duration-500 
      tw-ease-in-out 
      group-[.is-closed]:!tw-max-h-0 
      group-[.is-wrap]:tw-text-wrap
      tw-overflow-y-hidden
      tw-overflow-x-auto
      tw-scrollbar-thin
      "><span class="line"><span class="cl"><span class="c1"># lscpu</span>
</span></span><span class="line"><span class="cl">Architecture:          x86_64
</span></span><span class="line"><span class="cl">CPU op-mode<span class="o">(</span>s<span class="o">)</span>:        32-bit, 64-bit
</span></span><span class="line"><span class="cl">Byte Order:            Little Endian
</span></span><span class="line"><span class="cl">CPU<span class="o">(</span>s<span class="o">)</span>:                <span class="m">64</span>
</span></span><span class="line"><span class="cl">On-line CPU<span class="o">(</span>s<span class="o">)</span> list:   0-63
</span></span><span class="line"><span class="cl">Thread<span class="o">(</span>s<span class="o">)</span> per core:    <span class="m">2</span>
</span></span><span class="line"><span class="cl">Core<span class="o">(</span>s<span class="o">)</span> per socket:    <span class="m">16</span>
</span></span><span class="line"><span class="cl">座：                 <span class="m">2</span>
</span></span><span class="line"><span class="cl">NUMA 节点：         <span class="m">2</span>
</span></span><span class="line"><span class="cl">厂商 ID：           AuthenticAMD
</span></span><span class="line"><span class="cl">CPU 系列：          <span class="m">23</span>
</span></span><span class="line"><span class="cl">型号：              <span class="m">49</span>
</span></span><span class="line"><span class="cl">型号名称：        AMD EPYC 7H12 64-Core Processor
</span></span><span class="line"><span class="cl">步进：              <span class="m">0</span>
</span></span><span class="line"><span class="cl">CPU MHz：             2595.124
</span></span><span class="line"><span class="cl">BogoMIPS：            5190.24
</span></span><span class="line"><span class="cl">虚拟化：           AMD-V
</span></span><span class="line"><span class="cl">超管理器厂商：  KVM
</span></span><span class="line"><span class="cl">虚拟化类型：     完全
</span></span><span class="line"><span class="cl">L1d 缓存：          32K
</span></span><span class="line"><span class="cl">L1i 缓存：          32K
</span></span><span class="line"><span class="cl">L2 缓存：           512K
</span></span><span class="line"><span class="cl">L3 缓存：           16384K
</span></span><span class="line"><span class="cl">NUMA 节点0 CPU：    0-31
</span></span><span class="line"><span class="cl">NUMA 节点1 CPU：    32-63</span></span></code></pre>
</div>
<h3 id="intel" class="headerLink">
    <a href="#intel" class="header-mark"></a>Intel</h3><p>这次对比测试用到了两块Intel CPU，分别是 8163、8269 。他们的信息如下，最大IPC 是4：</p>
<div class="code-block highlight is-open show-line-numbers  tw-group tw-my-2">
  <div class="
    code-block-title 
    
    tw-flex 
    tw-flex-row 
    tw-justify-between 
    tw-w-full tw-bg-bgColor-secondary
    ">      
    <button 
      class="
        tw-select-none 
        tw-mx-2 
        tw-block
        group-[.is-open]:tw-rotate-90
        tw-transition-[transform] 
        tw-duration-500 
        tw-ease-in-out
        print:!tw-hidden"
      disabled
      aria-hidden="true"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M285.476 272.971L91.132 467.314c-9.373 9.373-24.569 9.373-33.941 0l-22.667-22.667c-9.357-9.357-9.375-24.522-.04-33.901L188.505 256 34.484 101.255c-9.335-9.379-9.317-24.544.04-33.901l22.667-22.667c9.373-9.373 24.569-9.373 33.941 0L285.475 239.03c9.373 9.372 9.373 24.568.001 33.941z"/></svg></button>

    <div class="code-block-title-bar tw-w-full">
      <p class="tw-select-none !tw-my-1">shell</p>
    </div>
    <div class="tw-flex">
      <button 
        class="
          line-number-button
          tw-select-none 
          tw-mx-2 
          tw-hidden 
          group-[.is-open]:tw-block 
          group-[.show-line-numbers]:tw-text-fgColor-link 
          print:!tw-hidden" 
        title="Toggle line numbers"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M61.77 401l17.5-20.15a19.92 19.92 0 0 0 5.07-14.19v-3.31C84.34 356 80.5 352 73 352H16a8 8 0 0 0-8 8v16a8 8 0 0 0 8 8h22.83a157.41 157.41 0 0 0-11 12.31l-5.61 7c-4 5.07-5.25 10.13-2.8 14.88l1.05 1.93c3 5.76 6.29 7.88 12.25 7.88h4.73c10.33 0 15.94 2.44 15.94 9.09 0 4.72-4.2 8.22-14.36 8.22a41.54 41.54 0 0 1-15.47-3.12c-6.49-3.88-11.74-3.5-15.6 3.12l-5.59 9.31c-3.72 6.13-3.19 11.72 2.63 15.94 7.71 4.69 20.38 9.44 37 9.44 34.16 0 48.5-22.75 48.5-44.12-.03-14.38-9.12-29.76-28.73-34.88zM496 224H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zm0-160H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16V80a16 16 0 0 0-16-16zm0 320H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zM16 160h64a8 8 0 0 0 8-8v-16a8 8 0 0 0-8-8H64V40a8 8 0 0 0-8-8H32a8 8 0 0 0-7.14 4.42l-8 16A8 8 0 0 0 24 64h8v64H16a8 8 0 0 0-8 8v16a8 8 0 0 0 8 8zm-3.91 160H80a8 8 0 0 0 8-8v-16a8 8 0 0 0-8-8H41.32c3.29-10.29 48.34-18.68 48.34-56.44 0-29.06-25-39.56-44.47-39.56-21.36 0-33.8 10-40.46 18.75-4.37 5.59-3 10.84 2.8 15.37l8.58 6.88c5.61 4.56 11 2.47 16.12-2.44a13.44 13.44 0 0 1 9.46-3.84c3.33 0 9.28 1.56 9.28 8.75C51 248.19 0 257.31 0 304.59v4C0 316 5.08 320 12.09 320z"/></svg></button>

      <button 
        class="
          wrap-code-button
          tw-select-none 
          tw-mx-2 
          tw-hidden 
          group-[.is-open]:tw-block 
          group-[.is-wrap]:tw-text-fgColor-link 
          print:!tw-hidden" 
        title="Toggle code wrap"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M16 132h416c8.837 0 16-7.163 16-16V76c0-8.837-7.163-16-16-16H16C7.163 60 0 67.163 0 76v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16z"/></svg></button>
      
      <button 
        class="
          copy-code-button
          tw-select-none
          tw-mx-2 
          tw-hidden
          group-[.is-open]:tw-block
          hover:tw-text-fgColor-link 
          print:!tw-hidden"
        title="Copy code">
          <span class="copy-icon tw-block"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M433.941 65.941l-51.882-51.882A48 48 0 0 0 348.118 0H176c-26.51 0-48 21.49-48 48v48H48c-26.51 0-48 21.49-48 48v320c0 26.51 21.49 48 48 48h224c26.51 0 48-21.49 48-48v-48h80c26.51 0 48-21.49 48-48V99.882a48 48 0 0 0-14.059-33.941zM266 464H54a6 6 0 0 1-6-6V150a6 6 0 0 1 6-6h74v224c0 26.51 21.49 48 48 48h96v42a6 6 0 0 1-6 6zm128-96H182a6 6 0 0 1-6-6V54a6 6 0 0 1 6-6h106v88c0 13.255 10.745 24 24 24h88v202a6 6 0 0 1-6 6zm6-256h-64V48h9.632c1.591 0 3.117.632 4.243 1.757l48.368 48.368a6 6 0 0 1 1.757 4.243V112z"/></svg></span>
          <span class="check-icon tw-hidden"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M173.898 439.404l-166.4-166.4c-9.997-9.997-9.997-26.206 0-36.204l36.203-36.204c9.997-9.998 26.207-9.998 36.204 0L192 312.69 432.095 72.596c9.997-9.997 26.207-9.997 36.204 0l36.203 36.204c9.997 9.997 9.997 26.206 0 36.204l-294.4 294.401c-9.998 9.997-26.207 9.997-36.204-.001z"/></svg></span>
      </button>
        
      <button 
        class="
          tw-select-none 
          tw-mx-2 
          tw-block 
          group-[.is-open]:tw-hidden 
          print:!tw-hidden" 
        disabled
        aria-hidden="true"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M328 256c0 39.8-32.2 72-72 72s-72-32.2-72-72 32.2-72 72-72 72 32.2 72 72zm104-72c-39.8 0-72 32.2-72 72s32.2 72 72 72 72-32.2 72-72-32.2-72-72-72zm-352 0c-39.8 0-72 32.2-72 72s32.2 72 72 72 72-32.2 72-72-32.2-72-72-72z"/></svg></button>
    </div>
  </div>
  <pre style="counter-reset: codeblock;" class="tw-block tw-m-0 tw-p-0"><code 
    id="codeblock-id-3" 
    class="
      chroma 
      !tw-block 
      tw-p-0
      tw-m-0
      tw-transition-[max-height] 
      tw-duration-500 
      tw-ease-in-out 
      group-[.is-closed]:!tw-max-h-0 
      group-[.is-wrap]:tw-text-wrap
      tw-overflow-y-hidden
      tw-overflow-x-auto
      tw-scrollbar-thin
      "><span class="line"><span class="cl"><span class="c1">#lscpu</span>
</span></span><span class="line"><span class="cl">Architecture:          x86_64
</span></span><span class="line"><span class="cl">CPU op-mode<span class="o">(</span>s<span class="o">)</span>:        32-bit, 64-bit
</span></span><span class="line"><span class="cl">Byte Order:            Little Endian
</span></span><span class="line"><span class="cl">CPU<span class="o">(</span>s<span class="o">)</span>:                <span class="m">96</span>
</span></span><span class="line"><span class="cl">On-line CPU<span class="o">(</span>s<span class="o">)</span> list:   0-95
</span></span><span class="line"><span class="cl">Thread<span class="o">(</span>s<span class="o">)</span> per core:    <span class="m">2</span>
</span></span><span class="line"><span class="cl">Core<span class="o">(</span>s<span class="o">)</span> per socket:    <span class="m">24</span>
</span></span><span class="line"><span class="cl">Socket<span class="o">(</span>s<span class="o">)</span>:             <span class="m">2</span>
</span></span><span class="line"><span class="cl">NUMA node<span class="o">(</span>s<span class="o">)</span>:          <span class="m">1</span>
</span></span><span class="line"><span class="cl">Vendor ID:             GenuineIntel
</span></span><span class="line"><span class="cl">CPU family:            <span class="m">6</span>
</span></span><span class="line"><span class="cl">Model:                 <span class="m">85</span>
</span></span><span class="line"><span class="cl">Model name:            Intel<span class="o">(</span>R<span class="o">)</span> Xeon<span class="o">(</span>R<span class="o">)</span> Platinum <span class="m">8163</span> CPU @ 2.50GHz
</span></span><span class="line"><span class="cl">Stepping:              <span class="m">4</span>
</span></span><span class="line"><span class="cl">CPU MHz:               2499.121
</span></span><span class="line"><span class="cl">CPU max MHz:           3100.0000
</span></span><span class="line"><span class="cl">CPU min MHz:           1000.0000
</span></span><span class="line"><span class="cl">BogoMIPS:              4998.90
</span></span><span class="line"><span class="cl">Virtualization:        VT-x
</span></span><span class="line"><span class="cl">L1d cache:             32K
</span></span><span class="line"><span class="cl">L1i cache:             32K
</span></span><span class="line"><span class="cl">L2 cache:              1024K
</span></span><span class="line"><span class="cl">L3 cache:              33792K
</span></span><span class="line"><span class="cl">NUMA node0 CPU<span class="o">(</span>s<span class="o">)</span>:     0-95   
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">-----8269CY
</span></span><span class="line"><span class="cl"><span class="c1">#lscpu</span>
</span></span><span class="line"><span class="cl">Architecture:          x86_64
</span></span><span class="line"><span class="cl">CPU op-mode<span class="o">(</span>s<span class="o">)</span>:        32-bit, 64-bit
</span></span><span class="line"><span class="cl">Byte Order:            Little Endian
</span></span><span class="line"><span class="cl">CPU<span class="o">(</span>s<span class="o">)</span>:                <span class="m">104</span>
</span></span><span class="line"><span class="cl">On-line CPU<span class="o">(</span>s<span class="o">)</span> list:   0-103
</span></span><span class="line"><span class="cl">Thread<span class="o">(</span>s<span class="o">)</span> per core:    <span class="m">2</span>
</span></span><span class="line"><span class="cl">Core<span class="o">(</span>s<span class="o">)</span> per socket:    <span class="m">26</span>
</span></span><span class="line"><span class="cl">Socket<span class="o">(</span>s<span class="o">)</span>:             <span class="m">2</span>
</span></span><span class="line"><span class="cl">NUMA node<span class="o">(</span>s<span class="o">)</span>:          <span class="m">2</span>
</span></span><span class="line"><span class="cl">Vendor ID:             GenuineIntel
</span></span><span class="line"><span class="cl">CPU family:            <span class="m">6</span>
</span></span><span class="line"><span class="cl">Model:                 <span class="m">85</span>
</span></span><span class="line"><span class="cl">Model name:            Intel<span class="o">(</span>R<span class="o">)</span> Xeon<span class="o">(</span>R<span class="o">)</span> Platinum 8269CY CPU @ 2.50GHz
</span></span><span class="line"><span class="cl">Stepping:              <span class="m">7</span>
</span></span><span class="line"><span class="cl">CPU MHz:               3200.000
</span></span><span class="line"><span class="cl">CPU max MHz:           3800.0000
</span></span><span class="line"><span class="cl">CPU min MHz:           1200.0000
</span></span><span class="line"><span class="cl">BogoMIPS:              4998.89
</span></span><span class="line"><span class="cl">Virtualization:        VT-x
</span></span><span class="line"><span class="cl">L1d cache:             32K
</span></span><span class="line"><span class="cl">L1i cache:             32K
</span></span><span class="line"><span class="cl">L2 cache:              1024K
</span></span><span class="line"><span class="cl">L3 cache:              36608K
</span></span><span class="line"><span class="cl">NUMA node0 CPU<span class="o">(</span>s<span class="o">)</span>:     0-25,52-77
</span></span><span class="line"><span class="cl">NUMA node1 CPU<span class="o">(</span>s<span class="o">)</span>:     26-51,78-103</span></span></code></pre>
</div>
<h3 id="鲲鹏920" class="headerLink">
    <a href="#%e9%b2%b2%e9%b9%8f920" class="header-mark"></a>鲲鹏920</h3><div class="code-block highlight is-open show-line-numbers  tw-group tw-my-2">
  <div class="
    code-block-title 
    
    tw-flex 
    tw-flex-row 
    tw-justify-between 
    tw-w-full tw-bg-bgColor-secondary
    ">      
    <button 
      class="
        tw-select-none 
        tw-mx-2 
        tw-block
        group-[.is-open]:tw-rotate-90
        tw-transition-[transform] 
        tw-duration-500 
        tw-ease-in-out
        print:!tw-hidden"
      disabled
      aria-hidden="true"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M285.476 272.971L91.132 467.314c-9.373 9.373-24.569 9.373-33.941 0l-22.667-22.667c-9.357-9.357-9.375-24.522-.04-33.901L188.505 256 34.484 101.255c-9.335-9.379-9.317-24.544.04-33.901l22.667-22.667c9.373-9.373 24.569-9.373 33.941 0L285.475 239.03c9.373 9.372 9.373 24.568.001 33.941z"/></svg></button>

    <div class="code-block-title-bar tw-w-full">
      <p class="tw-select-none !tw-my-1">text</p>
    </div>
    <div class="tw-flex">
      <button 
        class="
          line-number-button
          tw-select-none 
          tw-mx-2 
          tw-hidden 
          group-[.is-open]:tw-block 
          group-[.show-line-numbers]:tw-text-fgColor-link 
          print:!tw-hidden" 
        title="Toggle line numbers"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M61.77 401l17.5-20.15a19.92 19.92 0 0 0 5.07-14.19v-3.31C84.34 356 80.5 352 73 352H16a8 8 0 0 0-8 8v16a8 8 0 0 0 8 8h22.83a157.41 157.41 0 0 0-11 12.31l-5.61 7c-4 5.07-5.25 10.13-2.8 14.88l1.05 1.93c3 5.76 6.29 7.88 12.25 7.88h4.73c10.33 0 15.94 2.44 15.94 9.09 0 4.72-4.2 8.22-14.36 8.22a41.54 41.54 0 0 1-15.47-3.12c-6.49-3.88-11.74-3.5-15.6 3.12l-5.59 9.31c-3.72 6.13-3.19 11.72 2.63 15.94 7.71 4.69 20.38 9.44 37 9.44 34.16 0 48.5-22.75 48.5-44.12-.03-14.38-9.12-29.76-28.73-34.88zM496 224H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zm0-160H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16V80a16 16 0 0 0-16-16zm0 320H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zM16 160h64a8 8 0 0 0 8-8v-16a8 8 0 0 0-8-8H64V40a8 8 0 0 0-8-8H32a8 8 0 0 0-7.14 4.42l-8 16A8 8 0 0 0 24 64h8v64H16a8 8 0 0 0-8 8v16a8 8 0 0 0 8 8zm-3.91 160H80a8 8 0 0 0 8-8v-16a8 8 0 0 0-8-8H41.32c3.29-10.29 48.34-18.68 48.34-56.44 0-29.06-25-39.56-44.47-39.56-21.36 0-33.8 10-40.46 18.75-4.37 5.59-3 10.84 2.8 15.37l8.58 6.88c5.61 4.56 11 2.47 16.12-2.44a13.44 13.44 0 0 1 9.46-3.84c3.33 0 9.28 1.56 9.28 8.75C51 248.19 0 257.31 0 304.59v4C0 316 5.08 320 12.09 320z"/></svg></button>

      <button 
        class="
          wrap-code-button
          tw-select-none 
          tw-mx-2 
          tw-hidden 
          group-[.is-open]:tw-block 
          group-[.is-wrap]:tw-text-fgColor-link 
          print:!tw-hidden" 
        title="Toggle code wrap"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M16 132h416c8.837 0 16-7.163 16-16V76c0-8.837-7.163-16-16-16H16C7.163 60 0 67.163 0 76v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16z"/></svg></button>
      
      <button 
        class="
          copy-code-button
          tw-select-none
          tw-mx-2 
          tw-hidden
          group-[.is-open]:tw-block
          hover:tw-text-fgColor-link 
          print:!tw-hidden"
        title="Copy code">
          <span class="copy-icon tw-block"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M433.941 65.941l-51.882-51.882A48 48 0 0 0 348.118 0H176c-26.51 0-48 21.49-48 48v48H48c-26.51 0-48 21.49-48 48v320c0 26.51 21.49 48 48 48h224c26.51 0 48-21.49 48-48v-48h80c26.51 0 48-21.49 48-48V99.882a48 48 0 0 0-14.059-33.941zM266 464H54a6 6 0 0 1-6-6V150a6 6 0 0 1 6-6h74v224c0 26.51 21.49 48 48 48h96v42a6 6 0 0 1-6 6zm128-96H182a6 6 0 0 1-6-6V54a6 6 0 0 1 6-6h106v88c0 13.255 10.745 24 24 24h88v202a6 6 0 0 1-6 6zm6-256h-64V48h9.632c1.591 0 3.117.632 4.243 1.757l48.368 48.368a6 6 0 0 1 1.757 4.243V112z"/></svg></span>
          <span class="check-icon tw-hidden"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M173.898 439.404l-166.4-166.4c-9.997-9.997-9.997-26.206 0-36.204l36.203-36.204c9.997-9.998 26.207-9.998 36.204 0L192 312.69 432.095 72.596c9.997-9.997 26.207-9.997 36.204 0l36.203 36.204c9.997 9.997 9.997 26.206 0 36.204l-294.4 294.401c-9.998 9.997-26.207 9.997-36.204-.001z"/></svg></span>
      </button>
        
      <button 
        class="
          tw-select-none 
          tw-mx-2 
          tw-block 
          group-[.is-open]:tw-hidden 
          print:!tw-hidden" 
        disabled
        aria-hidden="true"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M328 256c0 39.8-32.2 72-72 72s-72-32.2-72-72 32.2-72 72-72 72 32.2 72 72zm104-72c-39.8 0-72 32.2-72 72s32.2 72 72 72 72-32.2 72-72-32.2-72-72-72zm-352 0c-39.8 0-72 32.2-72 72s32.2 72 72 72 72-32.2 72-72-32.2-72-72-72z"/></svg></button>
    </div>
  </div>
  <pre style="counter-reset: codeblock;" class="tw-block tw-m-0 tw-p-0"><code 
    id="codeblock-id-4" 
    class="
      chroma 
      !tw-block 
      tw-p-0
      tw-m-0
      tw-transition-[max-height] 
      tw-duration-500 
      tw-ease-in-out 
      group-[.is-closed]:!tw-max-h-0 
      group-[.is-wrap]:tw-text-wrap
      tw-overflow-y-hidden
      tw-overflow-x-auto
      tw-scrollbar-thin
      "><span class="line"><span class="cl">[root@ARM 19:15 /root/lmbench3]
</span></span><span class="line"><span class="cl">#numactl -H
</span></span><span class="line"><span class="cl">available: 4 nodes (0-3)
</span></span><span class="line"><span class="cl">node 0 cpus: 0 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23
</span></span><span class="line"><span class="cl">node 0 size: 192832 MB
</span></span><span class="line"><span class="cl">node 0 free: 146830 MB
</span></span><span class="line"><span class="cl">node 1 cpus: 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47
</span></span><span class="line"><span class="cl">node 1 size: 193533 MB
</span></span><span class="line"><span class="cl">node 1 free: 175354 MB
</span></span><span class="line"><span class="cl">node 2 cpus: 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71
</span></span><span class="line"><span class="cl">node 2 size: 193533 MB
</span></span><span class="line"><span class="cl">node 2 free: 175718 MB
</span></span><span class="line"><span class="cl">node 3 cpus: 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95
</span></span><span class="line"><span class="cl">node 3 size: 193532 MB
</span></span><span class="line"><span class="cl">node 3 free: 183643 MB
</span></span><span class="line"><span class="cl">node distances:
</span></span><span class="line"><span class="cl">node   0   1   2   3
</span></span><span class="line"><span class="cl">  0:  10  12  20  22
</span></span><span class="line"><span class="cl">  1:  12  10  22  24
</span></span><span class="line"><span class="cl">  2:  20  22  10  12
</span></span><span class="line"><span class="cl">  3:  22  24  12  10
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">node 0 &lt;------------ socket distance ------------&gt; node 2
</span></span><span class="line"><span class="cl">    | (die distance)                                  | (die distance)
</span></span><span class="line"><span class="cl">node 1                                             node 3
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  #lscpu
</span></span><span class="line"><span class="cl">Architecture:          aarch64
</span></span><span class="line"><span class="cl">Byte Order:            Little Endian
</span></span><span class="line"><span class="cl">CPU(s):                96
</span></span><span class="line"><span class="cl">On-line CPU(s) list:   0-95
</span></span><span class="line"><span class="cl">Thread(s) per core:    1
</span></span><span class="line"><span class="cl">Core(s) per socket:    48
</span></span><span class="line"><span class="cl">Socket(s):             2
</span></span><span class="line"><span class="cl">NUMA node(s):          4
</span></span><span class="line"><span class="cl">Model:                 0
</span></span><span class="line"><span class="cl">CPU max MHz:           2600.0000
</span></span><span class="line"><span class="cl">CPU min MHz:           200.0000
</span></span><span class="line"><span class="cl">BogoMIPS:              200.00
</span></span><span class="line"><span class="cl">L1d cache:             64K
</span></span><span class="line"><span class="cl">L1i cache:             64K
</span></span><span class="line"><span class="cl">L2 cache:              512K
</span></span><span class="line"><span class="cl">L3 cache:              24576K //一个Die下24core共享24M L3，每个core 1MB
</span></span><span class="line"><span class="cl">NUMA node0 CPU(s):     0-23
</span></span><span class="line"><span class="cl">NUMA node1 CPU(s):     24-47
</span></span><span class="line"><span class="cl">NUMA node2 CPU(s):     48-71
</span></span><span class="line"><span class="cl">NUMA node3 CPU(s):     72-95
</span></span><span class="line"><span class="cl">Flags:                 fp asimd evtstrm aes pmull sha1 sha2 crc32 atomics fphp asimdhp cpuid asimdrdm jscvt fcma dcpop asimddp asimdfhm</span></span></code></pre>
</div>
<h3 id="飞腾2500" class="headerLink">
    <a href="#%e9%a3%9e%e8%85%be2500" class="header-mark"></a>飞腾2500</h3><p>飞腾2500用nop去跑IPC的话，只能到1，但是跑其它代码能到2.33，理论值据说也是4但是我没跑到过</p>
<div class="code-block highlight is-open show-line-numbers  tw-group tw-my-2">
  <div class="
    code-block-title 
    
    tw-flex 
    tw-flex-row 
    tw-justify-between 
    tw-w-full tw-bg-bgColor-secondary
    ">      
    <button 
      class="
        tw-select-none 
        tw-mx-2 
        tw-block
        group-[.is-open]:tw-rotate-90
        tw-transition-[transform] 
        tw-duration-500 
        tw-ease-in-out
        print:!tw-hidden"
      disabled
      aria-hidden="true"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M285.476 272.971L91.132 467.314c-9.373 9.373-24.569 9.373-33.941 0l-22.667-22.667c-9.357-9.357-9.375-24.522-.04-33.901L188.505 256 34.484 101.255c-9.335-9.379-9.317-24.544.04-33.901l22.667-22.667c9.373-9.373 24.569-9.373 33.941 0L285.475 239.03c9.373 9.372 9.373 24.568.001 33.941z"/></svg></button>

    <div class="code-block-title-bar tw-w-full">
      <p class="tw-select-none !tw-my-1">shell</p>
    </div>
    <div class="tw-flex">
      <button 
        class="
          line-number-button
          tw-select-none 
          tw-mx-2 
          tw-hidden 
          group-[.is-open]:tw-block 
          group-[.show-line-numbers]:tw-text-fgColor-link 
          print:!tw-hidden" 
        title="Toggle line numbers"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M61.77 401l17.5-20.15a19.92 19.92 0 0 0 5.07-14.19v-3.31C84.34 356 80.5 352 73 352H16a8 8 0 0 0-8 8v16a8 8 0 0 0 8 8h22.83a157.41 157.41 0 0 0-11 12.31l-5.61 7c-4 5.07-5.25 10.13-2.8 14.88l1.05 1.93c3 5.76 6.29 7.88 12.25 7.88h4.73c10.33 0 15.94 2.44 15.94 9.09 0 4.72-4.2 8.22-14.36 8.22a41.54 41.54 0 0 1-15.47-3.12c-6.49-3.88-11.74-3.5-15.6 3.12l-5.59 9.31c-3.72 6.13-3.19 11.72 2.63 15.94 7.71 4.69 20.38 9.44 37 9.44 34.16 0 48.5-22.75 48.5-44.12-.03-14.38-9.12-29.76-28.73-34.88zM496 224H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zm0-160H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16V80a16 16 0 0 0-16-16zm0 320H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zM16 160h64a8 8 0 0 0 8-8v-16a8 8 0 0 0-8-8H64V40a8 8 0 0 0-8-8H32a8 8 0 0 0-7.14 4.42l-8 16A8 8 0 0 0 24 64h8v64H16a8 8 0 0 0-8 8v16a8 8 0 0 0 8 8zm-3.91 160H80a8 8 0 0 0 8-8v-16a8 8 0 0 0-8-8H41.32c3.29-10.29 48.34-18.68 48.34-56.44 0-29.06-25-39.56-44.47-39.56-21.36 0-33.8 10-40.46 18.75-4.37 5.59-3 10.84 2.8 15.37l8.58 6.88c5.61 4.56 11 2.47 16.12-2.44a13.44 13.44 0 0 1 9.46-3.84c3.33 0 9.28 1.56 9.28 8.75C51 248.19 0 257.31 0 304.59v4C0 316 5.08 320 12.09 320z"/></svg></button>

      <button 
        class="
          wrap-code-button
          tw-select-none 
          tw-mx-2 
          tw-hidden 
          group-[.is-open]:tw-block 
          group-[.is-wrap]:tw-text-fgColor-link 
          print:!tw-hidden" 
        title="Toggle code wrap"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M16 132h416c8.837 0 16-7.163 16-16V76c0-8.837-7.163-16-16-16H16C7.163 60 0 67.163 0 76v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16z"/></svg></button>
      
      <button 
        class="
          copy-code-button
          tw-select-none
          tw-mx-2 
          tw-hidden
          group-[.is-open]:tw-block
          hover:tw-text-fgColor-link 
          print:!tw-hidden"
        title="Copy code">
          <span class="copy-icon tw-block"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M433.941 65.941l-51.882-51.882A48 48 0 0 0 348.118 0H176c-26.51 0-48 21.49-48 48v48H48c-26.51 0-48 21.49-48 48v320c0 26.51 21.49 48 48 48h224c26.51 0 48-21.49 48-48v-48h80c26.51 0 48-21.49 48-48V99.882a48 48 0 0 0-14.059-33.941zM266 464H54a6 6 0 0 1-6-6V150a6 6 0 0 1 6-6h74v224c0 26.51 21.49 48 48 48h96v42a6 6 0 0 1-6 6zm128-96H182a6 6 0 0 1-6-6V54a6 6 0 0 1 6-6h106v88c0 13.255 10.745 24 24 24h88v202a6 6 0 0 1-6 6zm6-256h-64V48h9.632c1.591 0 3.117.632 4.243 1.757l48.368 48.368a6 6 0 0 1 1.757 4.243V112z"/></svg></span>
          <span class="check-icon tw-hidden"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M173.898 439.404l-166.4-166.4c-9.997-9.997-9.997-26.206 0-36.204l36.203-36.204c9.997-9.998 26.207-9.998 36.204 0L192 312.69 432.095 72.596c9.997-9.997 26.207-9.997 36.204 0l36.203 36.204c9.997 9.997 9.997 26.206 0 36.204l-294.4 294.401c-9.998 9.997-26.207 9.997-36.204-.001z"/></svg></span>
      </button>
        
      <button 
        class="
          tw-select-none 
          tw-mx-2 
          tw-block 
          group-[.is-open]:tw-hidden 
          print:!tw-hidden" 
        disabled
        aria-hidden="true"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M328 256c0 39.8-32.2 72-72 72s-72-32.2-72-72 32.2-72 72-72 72 32.2 72 72zm104-72c-39.8 0-72 32.2-72 72s32.2 72 72 72 72-32.2 72-72-32.2-72-72-72zm-352 0c-39.8 0-72 32.2-72 72s32.2 72 72 72 72-32.2 72-72-32.2-72-72-72z"/></svg></button>
    </div>
  </div>
  <pre style="counter-reset: codeblock;" class="tw-block tw-m-0 tw-p-0"><code 
    id="codeblock-id-5" 
    class="
      chroma 
      !tw-block 
      tw-p-0
      tw-m-0
      tw-transition-[max-height] 
      tw-duration-500 
      tw-ease-in-out 
      group-[.is-closed]:!tw-max-h-0 
      group-[.is-wrap]:tw-text-wrap
      tw-overflow-y-hidden
      tw-overflow-x-auto
      tw-scrollbar-thin
      "><span class="line"><span class="cl"><span class="c1">#lscpu</span>
</span></span><span class="line"><span class="cl">Architecture:          aarch64
</span></span><span class="line"><span class="cl">Byte Order:            Little Endian
</span></span><span class="line"><span class="cl">CPU<span class="o">(</span>s<span class="o">)</span>:                <span class="m">128</span>
</span></span><span class="line"><span class="cl">On-line CPU<span class="o">(</span>s<span class="o">)</span> list:   0-127
</span></span><span class="line"><span class="cl">Thread<span class="o">(</span>s<span class="o">)</span> per core:    <span class="m">1</span>
</span></span><span class="line"><span class="cl">Core<span class="o">(</span>s<span class="o">)</span> per socket:    <span class="m">64</span>
</span></span><span class="line"><span class="cl">Socket<span class="o">(</span>s<span class="o">)</span>:             <span class="m">2</span>
</span></span><span class="line"><span class="cl">NUMA node<span class="o">(</span>s<span class="o">)</span>:          <span class="m">16</span>
</span></span><span class="line"><span class="cl">Model:                 <span class="m">3</span>
</span></span><span class="line"><span class="cl">BogoMIPS:              100.00
</span></span><span class="line"><span class="cl">L1d cache:             32K
</span></span><span class="line"><span class="cl">L1i cache:             32K
</span></span><span class="line"><span class="cl">L2 cache:              2048K
</span></span><span class="line"><span class="cl">L3 cache:              65536K
</span></span><span class="line"><span class="cl">NUMA node0 CPU<span class="o">(</span>s<span class="o">)</span>:     0-7
</span></span><span class="line"><span class="cl">NUMA node1 CPU<span class="o">(</span>s<span class="o">)</span>:     8-15
</span></span><span class="line"><span class="cl">NUMA node2 CPU<span class="o">(</span>s<span class="o">)</span>:     16-23
</span></span><span class="line"><span class="cl">NUMA node3 CPU<span class="o">(</span>s<span class="o">)</span>:     24-31
</span></span><span class="line"><span class="cl">NUMA node4 CPU<span class="o">(</span>s<span class="o">)</span>:     32-39
</span></span><span class="line"><span class="cl">NUMA node5 CPU<span class="o">(</span>s<span class="o">)</span>:     40-47
</span></span><span class="line"><span class="cl">NUMA node6 CPU<span class="o">(</span>s<span class="o">)</span>:     48-55
</span></span><span class="line"><span class="cl">NUMA node7 CPU<span class="o">(</span>s<span class="o">)</span>:     56-63
</span></span><span class="line"><span class="cl">NUMA node8 CPU<span class="o">(</span>s<span class="o">)</span>:     64-71
</span></span><span class="line"><span class="cl">NUMA node9 CPU<span class="o">(</span>s<span class="o">)</span>:     72-79
</span></span><span class="line"><span class="cl">NUMA node10 CPU<span class="o">(</span>s<span class="o">)</span>:    80-87
</span></span><span class="line"><span class="cl">NUMA node11 CPU<span class="o">(</span>s<span class="o">)</span>:    88-95
</span></span><span class="line"><span class="cl">NUMA node12 CPU<span class="o">(</span>s<span class="o">)</span>:    96-103
</span></span><span class="line"><span class="cl">NUMA node13 CPU<span class="o">(</span>s<span class="o">)</span>:    104-111
</span></span><span class="line"><span class="cl">NUMA node14 CPU<span class="o">(</span>s<span class="o">)</span>:    112-119
</span></span><span class="line"><span class="cl">NUMA node15 CPU<span class="o">(</span>s<span class="o">)</span>:    120-127
</span></span><span class="line"><span class="cl">Flags:                 fp asimd evtstrm aes pmull sha1 sha2 crc32 cpuid</span></span></code></pre>
</div>
<h2 id="单核以及超线程计算prime性能比较" class="headerLink">
    <a href="#%e5%8d%95%e6%a0%b8%e4%bb%a5%e5%8f%8a%e8%b6%85%e7%ba%bf%e7%a8%8b%e8%ae%a1%e7%ae%97prime%e6%80%a7%e8%83%bd%e6%af%94%e8%be%83" class="header-mark"></a>单核以及超线程计算Prime性能比较</h2><p>测试命令，这个测试命令无论在哪个CPU下，用2个物理核用时都是一个物理核的一半，所以这个计算是可以完全并行的</p>
<div class="code-block highlight is-open show-line-numbers  tw-group tw-my-2">
  <div class="
    code-block-title 
    
    tw-flex 
    tw-flex-row 
    tw-justify-between 
    tw-w-full tw-bg-bgColor-secondary
    ">      
    <button 
      class="
        tw-select-none 
        tw-mx-2 
        tw-block
        group-[.is-open]:tw-rotate-90
        tw-transition-[transform] 
        tw-duration-500 
        tw-ease-in-out
        print:!tw-hidden"
      disabled
      aria-hidden="true"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M285.476 272.971L91.132 467.314c-9.373 9.373-24.569 9.373-33.941 0l-22.667-22.667c-9.357-9.357-9.375-24.522-.04-33.901L188.505 256 34.484 101.255c-9.335-9.379-9.317-24.544.04-33.901l22.667-22.667c9.373-9.373 24.569-9.373 33.941 0L285.475 239.03c9.373 9.372 9.373 24.568.001 33.941z"/></svg></button>

    <div class="code-block-title-bar tw-w-full">
      <p class="tw-select-none !tw-my-1">text</p>
    </div>
    <div class="tw-flex">
      <button 
        class="
          line-number-button
          tw-select-none 
          tw-mx-2 
          tw-hidden 
          group-[.is-open]:tw-block 
          group-[.show-line-numbers]:tw-text-fgColor-link 
          print:!tw-hidden" 
        title="Toggle line numbers"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M61.77 401l17.5-20.15a19.92 19.92 0 0 0 5.07-14.19v-3.31C84.34 356 80.5 352 73 352H16a8 8 0 0 0-8 8v16a8 8 0 0 0 8 8h22.83a157.41 157.41 0 0 0-11 12.31l-5.61 7c-4 5.07-5.25 10.13-2.8 14.88l1.05 1.93c3 5.76 6.29 7.88 12.25 7.88h4.73c10.33 0 15.94 2.44 15.94 9.09 0 4.72-4.2 8.22-14.36 8.22a41.54 41.54 0 0 1-15.47-3.12c-6.49-3.88-11.74-3.5-15.6 3.12l-5.59 9.31c-3.72 6.13-3.19 11.72 2.63 15.94 7.71 4.69 20.38 9.44 37 9.44 34.16 0 48.5-22.75 48.5-44.12-.03-14.38-9.12-29.76-28.73-34.88zM496 224H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zm0-160H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16V80a16 16 0 0 0-16-16zm0 320H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zM16 160h64a8 8 0 0 0 8-8v-16a8 8 0 0 0-8-8H64V40a8 8 0 0 0-8-8H32a8 8 0 0 0-7.14 4.42l-8 16A8 8 0 0 0 24 64h8v64H16a8 8 0 0 0-8 8v16a8 8 0 0 0 8 8zm-3.91 160H80a8 8 0 0 0 8-8v-16a8 8 0 0 0-8-8H41.32c3.29-10.29 48.34-18.68 48.34-56.44 0-29.06-25-39.56-44.47-39.56-21.36 0-33.8 10-40.46 18.75-4.37 5.59-3 10.84 2.8 15.37l8.58 6.88c5.61 4.56 11 2.47 16.12-2.44a13.44 13.44 0 0 1 9.46-3.84c3.33 0 9.28 1.56 9.28 8.75C51 248.19 0 257.31 0 304.59v4C0 316 5.08 320 12.09 320z"/></svg></button>

      <button 
        class="
          wrap-code-button
          tw-select-none 
          tw-mx-2 
          tw-hidden 
          group-[.is-open]:tw-block 
          group-[.is-wrap]:tw-text-fgColor-link 
          print:!tw-hidden" 
        title="Toggle code wrap"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M16 132h416c8.837 0 16-7.163 16-16V76c0-8.837-7.163-16-16-16H16C7.163 60 0 67.163 0 76v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16z"/></svg></button>
      
      <button 
        class="
          copy-code-button
          tw-select-none
          tw-mx-2 
          tw-hidden
          group-[.is-open]:tw-block
          hover:tw-text-fgColor-link 
          print:!tw-hidden"
        title="Copy code">
          <span class="copy-icon tw-block"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M433.941 65.941l-51.882-51.882A48 48 0 0 0 348.118 0H176c-26.51 0-48 21.49-48 48v48H48c-26.51 0-48 21.49-48 48v320c0 26.51 21.49 48 48 48h224c26.51 0 48-21.49 48-48v-48h80c26.51 0 48-21.49 48-48V99.882a48 48 0 0 0-14.059-33.941zM266 464H54a6 6 0 0 1-6-6V150a6 6 0 0 1 6-6h74v224c0 26.51 21.49 48 48 48h96v42a6 6 0 0 1-6 6zm128-96H182a6 6 0 0 1-6-6V54a6 6 0 0 1 6-6h106v88c0 13.255 10.745 24 24 24h88v202a6 6 0 0 1-6 6zm6-256h-64V48h9.632c1.591 0 3.117.632 4.243 1.757l48.368 48.368a6 6 0 0 1 1.757 4.243V112z"/></svg></span>
          <span class="check-icon tw-hidden"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M173.898 439.404l-166.4-166.4c-9.997-9.997-9.997-26.206 0-36.204l36.203-36.204c9.997-9.998 26.207-9.998 36.204 0L192 312.69 432.095 72.596c9.997-9.997 26.207-9.997 36.204 0l36.203 36.204c9.997 9.997 9.997 26.206 0 36.204l-294.4 294.401c-9.998 9.997-26.207 9.997-36.204-.001z"/></svg></span>
      </button>
        
      <button 
        class="
          tw-select-none 
          tw-mx-2 
          tw-block 
          group-[.is-open]:tw-hidden 
          print:!tw-hidden" 
        disabled
        aria-hidden="true"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M328 256c0 39.8-32.2 72-72 72s-72-32.2-72-72 32.2-72 72-72 72 32.2 72 72zm104-72c-39.8 0-72 32.2-72 72s32.2 72 72 72 72-32.2 72-72-32.2-72-72-72zm-352 0c-39.8 0-72 32.2-72 72s32.2 72 72 72 72-32.2 72-72-32.2-72-72-72z"/></svg></button>
    </div>
  </div>
  <pre style="counter-reset: codeblock;" class="tw-block tw-m-0 tw-p-0"><code 
    id="codeblock-id-6" 
    class="
      chroma 
      !tw-block 
      tw-p-0
      tw-m-0
      tw-transition-[max-height] 
      tw-duration-500 
      tw-ease-in-out 
      group-[.is-closed]:!tw-max-h-0 
      group-[.is-wrap]:tw-text-wrap
      tw-overflow-y-hidden
      tw-overflow-x-auto
      tw-scrollbar-thin
      "><span class="line"><span class="cl">taskset -c 1 /usr/bin/sysbench --num-threads=1 --test=cpu --cpu-max-prime=50000 run //单核绑一个core; 2个thread就绑一对HT</span></span></code></pre>
</div>
<p>测试结果为耗时，单位秒</p>
<!-- raw HTML omitted -->
<p>从上面的测试结果来看，简单纯计算场景下 AMD/海光 的单核能力还是比较强的，但是超线程完全不给力（数据库场景超线程就给力了）；而Intel的超线程非常给力，一对超线程能达到单物理core的1.8倍，并且从E5到8269更是好了不少。
ARM基本都没有超线程所有没有跑鲲鹏、飞腾。</p>
<p>计算Prime毕竟太简单，让我们来看看他们在数据库下的真实能力吧</p>
<h2 id="对比mysql-sysbench和tpcc性能" class="headerLink">
    <a href="#%e5%af%b9%e6%af%94mysql-sysbench%e5%92%8ctpcc%e6%80%a7%e8%83%bd" class="header-mark"></a>对比MySQL sysbench和tpcc性能</h2><p>MySQL 默认用5.7.34社区版，操作系统默认是centos，测试中所有mysqld都做了绑核，一样的压力配置尽量将CPU跑到100%， HT表示将mysqld绑定到一对HT核。</p>
<h3 id="sysbench点查" class="headerLink">
    <a href="#sysbench%e7%82%b9%e6%9f%a5" class="header-mark"></a>sysbench点查</h3><p>测试命令类似如下：</p>
<div class="code-block highlight is-open show-line-numbers  tw-group tw-my-2">
  <div class="
    code-block-title 
    
    tw-flex 
    tw-flex-row 
    tw-justify-between 
    tw-w-full tw-bg-bgColor-secondary
    ">      
    <button 
      class="
        tw-select-none 
        tw-mx-2 
        tw-block
        group-[.is-open]:tw-rotate-90
        tw-transition-[transform] 
        tw-duration-500 
        tw-ease-in-out
        print:!tw-hidden"
      disabled
      aria-hidden="true"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M285.476 272.971L91.132 467.314c-9.373 9.373-24.569 9.373-33.941 0l-22.667-22.667c-9.357-9.357-9.375-24.522-.04-33.901L188.505 256 34.484 101.255c-9.335-9.379-9.317-24.544.04-33.901l22.667-22.667c9.373-9.373 24.569-9.373 33.941 0L285.475 239.03c9.373 9.372 9.373 24.568.001 33.941z"/></svg></button>

    <div class="code-block-title-bar tw-w-full">
      <p class="tw-select-none !tw-my-1">text</p>
    </div>
    <div class="tw-flex">
      <button 
        class="
          line-number-button
          tw-select-none 
          tw-mx-2 
          tw-hidden 
          group-[.is-open]:tw-block 
          group-[.show-line-numbers]:tw-text-fgColor-link 
          print:!tw-hidden" 
        title="Toggle line numbers"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M61.77 401l17.5-20.15a19.92 19.92 0 0 0 5.07-14.19v-3.31C84.34 356 80.5 352 73 352H16a8 8 0 0 0-8 8v16a8 8 0 0 0 8 8h22.83a157.41 157.41 0 0 0-11 12.31l-5.61 7c-4 5.07-5.25 10.13-2.8 14.88l1.05 1.93c3 5.76 6.29 7.88 12.25 7.88h4.73c10.33 0 15.94 2.44 15.94 9.09 0 4.72-4.2 8.22-14.36 8.22a41.54 41.54 0 0 1-15.47-3.12c-6.49-3.88-11.74-3.5-15.6 3.12l-5.59 9.31c-3.72 6.13-3.19 11.72 2.63 15.94 7.71 4.69 20.38 9.44 37 9.44 34.16 0 48.5-22.75 48.5-44.12-.03-14.38-9.12-29.76-28.73-34.88zM496 224H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zm0-160H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16V80a16 16 0 0 0-16-16zm0 320H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zM16 160h64a8 8 0 0 0 8-8v-16a8 8 0 0 0-8-8H64V40a8 8 0 0 0-8-8H32a8 8 0 0 0-7.14 4.42l-8 16A8 8 0 0 0 24 64h8v64H16a8 8 0 0 0-8 8v16a8 8 0 0 0 8 8zm-3.91 160H80a8 8 0 0 0 8-8v-16a8 8 0 0 0-8-8H41.32c3.29-10.29 48.34-18.68 48.34-56.44 0-29.06-25-39.56-44.47-39.56-21.36 0-33.8 10-40.46 18.75-4.37 5.59-3 10.84 2.8 15.37l8.58 6.88c5.61 4.56 11 2.47 16.12-2.44a13.44 13.44 0 0 1 9.46-3.84c3.33 0 9.28 1.56 9.28 8.75C51 248.19 0 257.31 0 304.59v4C0 316 5.08 320 12.09 320z"/></svg></button>

      <button 
        class="
          wrap-code-button
          tw-select-none 
          tw-mx-2 
          tw-hidden 
          group-[.is-open]:tw-block 
          group-[.is-wrap]:tw-text-fgColor-link 
          print:!tw-hidden" 
        title="Toggle code wrap"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M16 132h416c8.837 0 16-7.163 16-16V76c0-8.837-7.163-16-16-16H16C7.163 60 0 67.163 0 76v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16z"/></svg></button>
      
      <button 
        class="
          copy-code-button
          tw-select-none
          tw-mx-2 
          tw-hidden
          group-[.is-open]:tw-block
          hover:tw-text-fgColor-link 
          print:!tw-hidden"
        title="Copy code">
          <span class="copy-icon tw-block"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M433.941 65.941l-51.882-51.882A48 48 0 0 0 348.118 0H176c-26.51 0-48 21.49-48 48v48H48c-26.51 0-48 21.49-48 48v320c0 26.51 21.49 48 48 48h224c26.51 0 48-21.49 48-48v-48h80c26.51 0 48-21.49 48-48V99.882a48 48 0 0 0-14.059-33.941zM266 464H54a6 6 0 0 1-6-6V150a6 6 0 0 1 6-6h74v224c0 26.51 21.49 48 48 48h96v42a6 6 0 0 1-6 6zm128-96H182a6 6 0 0 1-6-6V54a6 6 0 0 1 6-6h106v88c0 13.255 10.745 24 24 24h88v202a6 6 0 0 1-6 6zm6-256h-64V48h9.632c1.591 0 3.117.632 4.243 1.757l48.368 48.368a6 6 0 0 1 1.757 4.243V112z"/></svg></span>
          <span class="check-icon tw-hidden"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M173.898 439.404l-166.4-166.4c-9.997-9.997-9.997-26.206 0-36.204l36.203-36.204c9.997-9.998 26.207-9.998 36.204 0L192 312.69 432.095 72.596c9.997-9.997 26.207-9.997 36.204 0l36.203 36.204c9.997 9.997 9.997 26.206 0 36.204l-294.4 294.401c-9.998 9.997-26.207 9.997-36.204-.001z"/></svg></span>
      </button>
        
      <button 
        class="
          tw-select-none 
          tw-mx-2 
          tw-block 
          group-[.is-open]:tw-hidden 
          print:!tw-hidden" 
        disabled
        aria-hidden="true"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M328 256c0 39.8-32.2 72-72 72s-72-32.2-72-72 32.2-72 72-72 72 32.2 72 72zm104-72c-39.8 0-72 32.2-72 72s32.2 72 72 72 72-32.2 72-72-32.2-72-72-72zm-352 0c-39.8 0-72 32.2-72 72s32.2 72 72 72 72-32.2 72-72-32.2-72-72-72z"/></svg></button>
    </div>
  </div>
  <pre style="counter-reset: codeblock;" class="tw-block tw-m-0 tw-p-0"><code 
    id="codeblock-id-7" 
    class="
      chroma 
      !tw-block 
      tw-p-0
      tw-m-0
      tw-transition-[max-height] 
      tw-duration-500 
      tw-ease-in-out 
      group-[.is-closed]:!tw-max-h-0 
      group-[.is-wrap]:tw-text-wrap
      tw-overflow-y-hidden
      tw-overflow-x-auto
      tw-scrollbar-thin
      "><span class="line"><span class="cl">sysbench --test=&#39;/usr/share/doc/sysbench/tests/db/select.lua&#39; --oltp_tables_count=1 --report-interval=1 --oltp-table-size=10000000  --mysql-port=3307 --mysql-db=sysbench_single --mysql-user=root --mysql-password=&#39;Bj6f9g96!@#&#39;  --max-requests=0   --oltp_skip_trx=on --oltp_auto_inc=on  --oltp_range_size=5  --mysql-table-engine=innodb --rand-init=on   --max-time=300 --mysql-host=x86.51 --num-threads=4 run</span></span></code></pre>
</div>
<p>测试结果分别取QPS/IPC两个数据(测试中的差异AMD、Hygon CPU跑在CentOS7.9， intel CPU、Kunpeng 920 跑在AliOS上, xdb表示用集团的xdb替换社区的MySQL Server， 麒麟是国产OS)：</p>
<!-- raw HTML omitted -->
<p>说明：麒麟OS下CPU很难跑满，大致能跑到90%-95%左右，麒麟上装的社区版MySQL-5.7.29；飞腾要特别注意mysqld所在socket，同时以上飞腾数据都是走&ndash;socket压测锁的，32core走网络压测QPS为：99496（15%的网络损耗）</p>
<p>从上面的结果先看单物理核能力ARM 和 X86之间的差异还是很明显的</p>
<h3 id="tpcc-1000仓" class="headerLink">
    <a href="#tpcc-1000%e4%bb%93" class="header-mark"></a>tpcc 1000仓</h3><p>测试结果(测试中Hygon 7280分别跑在CentOS7.9和麒麟上， 鲲鹏/intel CPU 跑在AliOS、麒麟是国产OS)：</p>
<p>tpcc测试数据，结果为1000仓，tpmC (NewOrders) ，未标注CPU 则为跑满了</p>
<!-- raw HTML omitted -->
<p>测试过程CPU均跑满（未跑满的话会标注出来），IPC跑不起来性能就必然低，超线程虽然总性能好了但是会导致IPC降低(参考前面的公式)。可以看到对本来IPC比较低的场景，启用超线程后一般对性能会提升更大一些。</p>
<p>tpcc并发到一定程度后主要是锁导致性能上不去，所以超多核意义不大，可以做<a href="https://www.aliyun.com/product/drds?spm=5176.19720258.J_8058803260.33.e9392c4aRo26Yg" target="_blank" rel="noopener noreferrer">分库分表搞多个mysqld实例</a></p>
<p>比如在Hygon 7280 2.1GHz 麒麟上起两个MySQLD实例，每个实例各绑定32物理core，性能刚好翻倍：<img class="tw-inline" loading="lazy" src=https://cdn.jsdelivr.net/gh/plantegg/plantegg.github.io/images/951413iMgBlog/image-20210823082702539-7857743.png   alt="image-20210823082702539"  ></p>
<p>32核的时候对比下MySQL 社区版在Hygon7280和Intel 8163下的表现，IPC的差异还是很明显的，基本和TPS差异一致：</p>
<p><img class="tw-inline" loading="lazy" src=https://cdn.jsdelivr.net/gh/plantegg/plantegg.github.io/images/951413iMgBlog/image-20210817181752243-7857743.png   alt="image-20210817181752243"  ></p>
<p>从sysbench和tpcc测试结果来看AMD和Intel差异不大，ARM和X86差异比较大，国产CPU还有很大的进步空间。就像前面所说抛开指令集的差异，主频差不多，内存管够为什么还有这么大的性能差别呢？</p>
<h2 id="三款cpu的性能指标" class="headerLink">
    <a href="#%e4%b8%89%e6%ac%becpu%e7%9a%84%e6%80%a7%e8%83%bd%e6%8c%87%e6%a0%87" class="header-mark"></a>三款CPU的性能指标</h2><p>下面让我们回到硬件本身的数据来看这个问题</p>
<p>先记住这个图，描述的是CPU访问寄存器、L1 cache、L2 cache等延时，关键记住他们的差异
<img class="tw-inline" loading="lazy" src=https://cdn.jsdelivr.net/gh/plantegg/plantegg.github.io/images/951413iMgBlog/1647855571774-4dfa1be7-7d3b-412b-9aa7-44c68656aed6.png   alt="各级延时"  ></p>
<p>接下来用<a href="https://github.com/intel/lmbench" target="_blank" rel="noopener noreferrer">lmbench</a>来测试各个机器的内存延时</p>
<p>stream主要用于测试带宽，对应的时延是在带宽跑满情况下的带宽。</p>
<p>lat_mem_rd用来测试操作不同数据大小的时延。</p>
<h3 id="飞腾2500-1" class="headerLink">
    <a href="#%e9%a3%9e%e8%85%be2500-1" class="header-mark"></a>飞腾2500</h3><p>用stream测试带宽和latency，可以看到带宽随着numa距离不断减少、对应的latency不断增加，到最近的numa node有10%的损耗，这个损耗和numactl给出的距离完全一致。跨socket访问内存latency是node内的3倍，带宽是三分之一，但是socket1性能和socket0性能完全一致。从这个延时来看如果要是跑一个32core的实例性能一定不会太好，并且抖动剧烈</p>
<div class="code-block highlight is-open show-line-numbers  tw-group tw-my-2">
  <div class="
    code-block-title 
    
    tw-flex 
    tw-flex-row 
    tw-justify-between 
    tw-w-full tw-bg-bgColor-secondary
    ">      
    <button 
      class="
        tw-select-none 
        tw-mx-2 
        tw-block
        group-[.is-open]:tw-rotate-90
        tw-transition-[transform] 
        tw-duration-500 
        tw-ease-in-out
        print:!tw-hidden"
      disabled
      aria-hidden="true"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M285.476 272.971L91.132 467.314c-9.373 9.373-24.569 9.373-33.941 0l-22.667-22.667c-9.357-9.357-9.375-24.522-.04-33.901L188.505 256 34.484 101.255c-9.335-9.379-9.317-24.544.04-33.901l22.667-22.667c9.373-9.373 24.569-9.373 33.941 0L285.475 239.03c9.373 9.372 9.373 24.568.001 33.941z"/></svg></button>

    <div class="code-block-title-bar tw-w-full">
      <p class="tw-select-none !tw-my-1">text</p>
    </div>
    <div class="tw-flex">
      <button 
        class="
          line-number-button
          tw-select-none 
          tw-mx-2 
          tw-hidden 
          group-[.is-open]:tw-block 
          group-[.show-line-numbers]:tw-text-fgColor-link 
          print:!tw-hidden" 
        title="Toggle line numbers"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M61.77 401l17.5-20.15a19.92 19.92 0 0 0 5.07-14.19v-3.31C84.34 356 80.5 352 73 352H16a8 8 0 0 0-8 8v16a8 8 0 0 0 8 8h22.83a157.41 157.41 0 0 0-11 12.31l-5.61 7c-4 5.07-5.25 10.13-2.8 14.88l1.05 1.93c3 5.76 6.29 7.88 12.25 7.88h4.73c10.33 0 15.94 2.44 15.94 9.09 0 4.72-4.2 8.22-14.36 8.22a41.54 41.54 0 0 1-15.47-3.12c-6.49-3.88-11.74-3.5-15.6 3.12l-5.59 9.31c-3.72 6.13-3.19 11.72 2.63 15.94 7.71 4.69 20.38 9.44 37 9.44 34.16 0 48.5-22.75 48.5-44.12-.03-14.38-9.12-29.76-28.73-34.88zM496 224H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zm0-160H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16V80a16 16 0 0 0-16-16zm0 320H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zM16 160h64a8 8 0 0 0 8-8v-16a8 8 0 0 0-8-8H64V40a8 8 0 0 0-8-8H32a8 8 0 0 0-7.14 4.42l-8 16A8 8 0 0 0 24 64h8v64H16a8 8 0 0 0-8 8v16a8 8 0 0 0 8 8zm-3.91 160H80a8 8 0 0 0 8-8v-16a8 8 0 0 0-8-8H41.32c3.29-10.29 48.34-18.68 48.34-56.44 0-29.06-25-39.56-44.47-39.56-21.36 0-33.8 10-40.46 18.75-4.37 5.59-3 10.84 2.8 15.37l8.58 6.88c5.61 4.56 11 2.47 16.12-2.44a13.44 13.44 0 0 1 9.46-3.84c3.33 0 9.28 1.56 9.28 8.75C51 248.19 0 257.31 0 304.59v4C0 316 5.08 320 12.09 320z"/></svg></button>

      <button 
        class="
          wrap-code-button
          tw-select-none 
          tw-mx-2 
          tw-hidden 
          group-[.is-open]:tw-block 
          group-[.is-wrap]:tw-text-fgColor-link 
          print:!tw-hidden" 
        title="Toggle code wrap"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M16 132h416c8.837 0 16-7.163 16-16V76c0-8.837-7.163-16-16-16H16C7.163 60 0 67.163 0 76v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16z"/></svg></button>
      
      <button 
        class="
          copy-code-button
          tw-select-none
          tw-mx-2 
          tw-hidden
          group-[.is-open]:tw-block
          hover:tw-text-fgColor-link 
          print:!tw-hidden"
        title="Copy code">
          <span class="copy-icon tw-block"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M433.941 65.941l-51.882-51.882A48 48 0 0 0 348.118 0H176c-26.51 0-48 21.49-48 48v48H48c-26.51 0-48 21.49-48 48v320c0 26.51 21.49 48 48 48h224c26.51 0 48-21.49 48-48v-48h80c26.51 0 48-21.49 48-48V99.882a48 48 0 0 0-14.059-33.941zM266 464H54a6 6 0 0 1-6-6V150a6 6 0 0 1 6-6h74v224c0 26.51 21.49 48 48 48h96v42a6 6 0 0 1-6 6zm128-96H182a6 6 0 0 1-6-6V54a6 6 0 0 1 6-6h106v88c0 13.255 10.745 24 24 24h88v202a6 6 0 0 1-6 6zm6-256h-64V48h9.632c1.591 0 3.117.632 4.243 1.757l48.368 48.368a6 6 0 0 1 1.757 4.243V112z"/></svg></span>
          <span class="check-icon tw-hidden"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M173.898 439.404l-166.4-166.4c-9.997-9.997-9.997-26.206 0-36.204l36.203-36.204c9.997-9.998 26.207-9.998 36.204 0L192 312.69 432.095 72.596c9.997-9.997 26.207-9.997 36.204 0l36.203 36.204c9.997 9.997 9.997 26.206 0 36.204l-294.4 294.401c-9.998 9.997-26.207 9.997-36.204-.001z"/></svg></span>
      </button>
        
      <button 
        class="
          tw-select-none 
          tw-mx-2 
          tw-block 
          group-[.is-open]:tw-hidden 
          print:!tw-hidden" 
        disabled
        aria-hidden="true"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M328 256c0 39.8-32.2 72-72 72s-72-32.2-72-72 32.2-72 72-72 72 32.2 72 72zm104-72c-39.8 0-72 32.2-72 72s32.2 72 72 72 72-32.2 72-72-32.2-72-72-72zm-352 0c-39.8 0-72 32.2-72 72s32.2 72 72 72 72-32.2 72-72-32.2-72-72-72z"/></svg></button>
    </div>
  </div>
  <pre style="counter-reset: codeblock;" class="tw-block tw-m-0 tw-p-0"><code 
    id="codeblock-id-8" 
    class="
      chroma 
      !tw-block 
      tw-p-0
      tw-m-0
      tw-transition-[max-height] 
      tw-duration-500 
      tw-ease-in-out 
      group-[.is-closed]:!tw-max-h-0 
      group-[.is-wrap]:tw-text-wrap
      tw-overflow-y-hidden
      tw-overflow-x-auto
      tw-scrollbar-thin
      "><span class="line"><span class="cl">time for i in $(seq 7 8 128); do echo $i; numactl -C $i -m 0 ./bin/stream -W 5 -N 5 -M 64M; done
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">#numactl -C 7 -m 0 ./bin/stream  -W 5 -N 5 -M 64M
</span></span><span class="line"><span class="cl">STREAM copy latency: 2.84 nanoseconds
</span></span><span class="line"><span class="cl">STREAM copy bandwidth: 5638.21 MB/sec
</span></span><span class="line"><span class="cl">STREAM scale latency: 2.72 nanoseconds
</span></span><span class="line"><span class="cl">STREAM scale bandwidth: 5885.97 MB/sec
</span></span><span class="line"><span class="cl">STREAM add latency: 2.26 nanoseconds
</span></span><span class="line"><span class="cl">STREAM add bandwidth: 10615.13 MB/sec
</span></span><span class="line"><span class="cl">STREAM triad latency: 4.53 nanoseconds
</span></span><span class="line"><span class="cl">STREAM triad bandwidth: 5297.93 MB/sec
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">#numactl -C 7 -m 1 ./bin/stream  -W 5 -N 5 -M 64M
</span></span><span class="line"><span class="cl">STREAM copy latency: 3.16 nanoseconds
</span></span><span class="line"><span class="cl">STREAM copy bandwidth: 5058.71 MB/sec
</span></span><span class="line"><span class="cl">STREAM scale latency: 3.15 nanoseconds
</span></span><span class="line"><span class="cl">STREAM scale bandwidth: 5074.78 MB/sec
</span></span><span class="line"><span class="cl">STREAM add latency: 2.35 nanoseconds
</span></span><span class="line"><span class="cl">STREAM add bandwidth: 10197.36 MB/sec
</span></span><span class="line"><span class="cl">STREAM triad latency: 5.12 nanoseconds
</span></span><span class="line"><span class="cl">STREAM triad bandwidth: 4686.37 MB/sec
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">#numactl -C 7 -m 2 ./bin/stream  -W 5 -N 5 -M 64M
</span></span><span class="line"><span class="cl">STREAM copy latency: 3.85 nanoseconds
</span></span><span class="line"><span class="cl">STREAM copy bandwidth: 4150.98 MB/sec
</span></span><span class="line"><span class="cl">STREAM scale latency: 3.95 nanoseconds
</span></span><span class="line"><span class="cl">STREAM scale bandwidth: 4054.30 MB/sec
</span></span><span class="line"><span class="cl">STREAM add latency: 2.64 nanoseconds
</span></span><span class="line"><span class="cl">STREAM add bandwidth: 9100.12 MB/sec
</span></span><span class="line"><span class="cl">STREAM triad latency: 6.39 nanoseconds
</span></span><span class="line"><span class="cl">STREAM triad bandwidth: 3757.70 MB/sec
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">#numactl -C 7 -m 3 ./bin/stream  -W 5 -N 5 -M 64M
</span></span><span class="line"><span class="cl">STREAM copy latency: 3.69 nanoseconds
</span></span><span class="line"><span class="cl">STREAM copy bandwidth: 4340.24 MB/sec
</span></span><span class="line"><span class="cl">STREAM scale latency: 3.62 nanoseconds
</span></span><span class="line"><span class="cl">STREAM scale bandwidth: 4422.18 MB/sec
</span></span><span class="line"><span class="cl">STREAM add latency: 2.47 nanoseconds
</span></span><span class="line"><span class="cl">STREAM add bandwidth: 9704.82 MB/sec
</span></span><span class="line"><span class="cl">STREAM triad latency: 5.74 nanoseconds
</span></span><span class="line"><span class="cl">STREAM triad bandwidth: 4177.85 MB/sec
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">[root@101a05001.cloud.a05.am11 /root/lmbench3]
</span></span><span class="line"><span class="cl">#numactl -C 7 -m 7 ./bin/stream  -W 5 -N 5 -M 64M
</span></span><span class="line"><span class="cl">STREAM copy latency: 3.95 nanoseconds
</span></span><span class="line"><span class="cl">STREAM copy bandwidth: 4051.51 MB/sec
</span></span><span class="line"><span class="cl">STREAM scale latency: 3.94 nanoseconds
</span></span><span class="line"><span class="cl">STREAM scale bandwidth: 4060.63 MB/sec
</span></span><span class="line"><span class="cl">STREAM add latency: 2.54 nanoseconds
</span></span><span class="line"><span class="cl">STREAM add bandwidth: 9434.51 MB/sec
</span></span><span class="line"><span class="cl">STREAM triad latency: 6.13 nanoseconds
</span></span><span class="line"><span class="cl">STREAM triad bandwidth: 3913.36 MB/sec
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">[root@101a05001.cloud.a05.am11 /root/lmbench3]
</span></span><span class="line"><span class="cl">#numactl -C 7 -m 10 ./bin/stream  -W 5 -N 5 -M 64M
</span></span><span class="line"><span class="cl">STREAM copy latency: 8.80 nanoseconds
</span></span><span class="line"><span class="cl">STREAM copy bandwidth: 1817.78 MB/sec
</span></span><span class="line"><span class="cl">STREAM scale latency: 8.59 nanoseconds
</span></span><span class="line"><span class="cl">STREAM scale bandwidth: 1861.65 MB/sec
</span></span><span class="line"><span class="cl">STREAM add latency: 5.55 nanoseconds
</span></span><span class="line"><span class="cl">STREAM add bandwidth: 4320.68 MB/sec
</span></span><span class="line"><span class="cl">STREAM triad latency: 13.94 nanoseconds
</span></span><span class="line"><span class="cl">STREAM triad bandwidth: 1721.76 MB/sec
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">[root@101a05001.cloud.a05.am11 /root/lmbench3]
</span></span><span class="line"><span class="cl">#numactl -C 7 -m 11 ./bin/stream  -W 5 -N 5 -M 64M
</span></span><span class="line"><span class="cl">STREAM copy latency: 9.27 nanoseconds
</span></span><span class="line"><span class="cl">STREAM copy bandwidth: 1726.52 MB/sec
</span></span><span class="line"><span class="cl">STREAM scale latency: 9.31 nanoseconds
</span></span><span class="line"><span class="cl">STREAM scale bandwidth: 1718.10 MB/sec
</span></span><span class="line"><span class="cl">STREAM add latency: 5.65 nanoseconds
</span></span><span class="line"><span class="cl">STREAM add bandwidth: 4250.89 MB/sec
</span></span><span class="line"><span class="cl">STREAM triad latency: 14.09 nanoseconds
</span></span><span class="line"><span class="cl">STREAM triad bandwidth: 1703.66 MB/sec
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">//在另外一个socket上测试本numa，和node0性能完全一致
</span></span><span class="line"><span class="cl">[root@101a0500 /root/lmbench3]
</span></span><span class="line"><span class="cl">#numactl -C 88 -m 11 ./bin/stream  -W 5 -N 5 -M 64M 
</span></span><span class="line"><span class="cl">STREAM copy latency: 2.93 nanoseconds
</span></span><span class="line"><span class="cl">STREAM copy bandwidth: 5454.67 MB/sec
</span></span><span class="line"><span class="cl">STREAM scale latency: 2.96 nanoseconds
</span></span><span class="line"><span class="cl">STREAM scale bandwidth: 5400.03 MB/sec
</span></span><span class="line"><span class="cl">STREAM add latency: 2.28 nanoseconds
</span></span><span class="line"><span class="cl">STREAM add bandwidth: 10543.42 MB/sec
</span></span><span class="line"><span class="cl">STREAM triad latency: 4.52 nanoseconds
</span></span><span class="line"><span class="cl">STREAM triad bandwidth: 5308.40 MB/sec
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">[root@101a0500 /root/lmbench3]
</span></span><span class="line"><span class="cl">#numactl -C 7 -m 15 ./bin/stream  -W 5 -N 5 -M 64M
</span></span><span class="line"><span class="cl">STREAM copy latency: 8.73 nanoseconds
</span></span><span class="line"><span class="cl">STREAM copy bandwidth: 1831.77 MB/sec
</span></span><span class="line"><span class="cl">STREAM scale latency: 8.81 nanoseconds
</span></span><span class="line"><span class="cl">STREAM scale bandwidth: 1815.13 MB/sec
</span></span><span class="line"><span class="cl">STREAM add latency: 5.63 nanoseconds
</span></span><span class="line"><span class="cl">STREAM add bandwidth: 4265.21 MB/sec
</span></span><span class="line"><span class="cl">STREAM triad latency: 13.09 nanoseconds
</span></span><span class="line"><span class="cl">STREAM triad bandwidth: 1833.68 MB/sec</span></span></code></pre>
</div>
<p>Lat_mem_rd 用cpu7访问node0和node15对比结果，随着数据的加大，延时在加大，64M时能有3倍差距，和上面测试一致</p>
<p>下图 第一列 表示读写数据的大小（单位M），第二列表示访问延时（单位纳秒），一般可以看到在L1/L2/L3 cache大小的地方延时会有跳跃，远超过L3大小后，延时就是内存延时了</p>
<p><img class="tw-inline" loading="lazy" src=https://cdn.jsdelivr.net/gh/plantegg/plantegg.github.io/images/951413iMgBlog/image-20210924185044090-7857743.png   alt="image-20210924185044090"  ></p>
<p>测试命令如下</p>
<div class="code-block highlight is-open show-line-numbers  tw-group tw-my-2">
  <div class="
    code-block-title 
    
    tw-flex 
    tw-flex-row 
    tw-justify-between 
    tw-w-full tw-bg-bgColor-secondary
    ">      
    <button 
      class="
        tw-select-none 
        tw-mx-2 
        tw-block
        group-[.is-open]:tw-rotate-90
        tw-transition-[transform] 
        tw-duration-500 
        tw-ease-in-out
        print:!tw-hidden"
      disabled
      aria-hidden="true"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M285.476 272.971L91.132 467.314c-9.373 9.373-24.569 9.373-33.941 0l-22.667-22.667c-9.357-9.357-9.375-24.522-.04-33.901L188.505 256 34.484 101.255c-9.335-9.379-9.317-24.544.04-33.901l22.667-22.667c9.373-9.373 24.569-9.373 33.941 0L285.475 239.03c9.373 9.372 9.373 24.568.001 33.941z"/></svg></button>

    <div class="code-block-title-bar tw-w-full">
      <p class="tw-select-none !tw-my-1">text</p>
    </div>
    <div class="tw-flex">
      <button 
        class="
          line-number-button
          tw-select-none 
          tw-mx-2 
          tw-hidden 
          group-[.is-open]:tw-block 
          group-[.show-line-numbers]:tw-text-fgColor-link 
          print:!tw-hidden" 
        title="Toggle line numbers"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M61.77 401l17.5-20.15a19.92 19.92 0 0 0 5.07-14.19v-3.31C84.34 356 80.5 352 73 352H16a8 8 0 0 0-8 8v16a8 8 0 0 0 8 8h22.83a157.41 157.41 0 0 0-11 12.31l-5.61 7c-4 5.07-5.25 10.13-2.8 14.88l1.05 1.93c3 5.76 6.29 7.88 12.25 7.88h4.73c10.33 0 15.94 2.44 15.94 9.09 0 4.72-4.2 8.22-14.36 8.22a41.54 41.54 0 0 1-15.47-3.12c-6.49-3.88-11.74-3.5-15.6 3.12l-5.59 9.31c-3.72 6.13-3.19 11.72 2.63 15.94 7.71 4.69 20.38 9.44 37 9.44 34.16 0 48.5-22.75 48.5-44.12-.03-14.38-9.12-29.76-28.73-34.88zM496 224H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zm0-160H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16V80a16 16 0 0 0-16-16zm0 320H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zM16 160h64a8 8 0 0 0 8-8v-16a8 8 0 0 0-8-8H64V40a8 8 0 0 0-8-8H32a8 8 0 0 0-7.14 4.42l-8 16A8 8 0 0 0 24 64h8v64H16a8 8 0 0 0-8 8v16a8 8 0 0 0 8 8zm-3.91 160H80a8 8 0 0 0 8-8v-16a8 8 0 0 0-8-8H41.32c3.29-10.29 48.34-18.68 48.34-56.44 0-29.06-25-39.56-44.47-39.56-21.36 0-33.8 10-40.46 18.75-4.37 5.59-3 10.84 2.8 15.37l8.58 6.88c5.61 4.56 11 2.47 16.12-2.44a13.44 13.44 0 0 1 9.46-3.84c3.33 0 9.28 1.56 9.28 8.75C51 248.19 0 257.31 0 304.59v4C0 316 5.08 320 12.09 320z"/></svg></button>

      <button 
        class="
          wrap-code-button
          tw-select-none 
          tw-mx-2 
          tw-hidden 
          group-[.is-open]:tw-block 
          group-[.is-wrap]:tw-text-fgColor-link 
          print:!tw-hidden" 
        title="Toggle code wrap"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M16 132h416c8.837 0 16-7.163 16-16V76c0-8.837-7.163-16-16-16H16C7.163 60 0 67.163 0 76v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16z"/></svg></button>
      
      <button 
        class="
          copy-code-button
          tw-select-none
          tw-mx-2 
          tw-hidden
          group-[.is-open]:tw-block
          hover:tw-text-fgColor-link 
          print:!tw-hidden"
        title="Copy code">
          <span class="copy-icon tw-block"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M433.941 65.941l-51.882-51.882A48 48 0 0 0 348.118 0H176c-26.51 0-48 21.49-48 48v48H48c-26.51 0-48 21.49-48 48v320c0 26.51 21.49 48 48 48h224c26.51 0 48-21.49 48-48v-48h80c26.51 0 48-21.49 48-48V99.882a48 48 0 0 0-14.059-33.941zM266 464H54a6 6 0 0 1-6-6V150a6 6 0 0 1 6-6h74v224c0 26.51 21.49 48 48 48h96v42a6 6 0 0 1-6 6zm128-96H182a6 6 0 0 1-6-6V54a6 6 0 0 1 6-6h106v88c0 13.255 10.745 24 24 24h88v202a6 6 0 0 1-6 6zm6-256h-64V48h9.632c1.591 0 3.117.632 4.243 1.757l48.368 48.368a6 6 0 0 1 1.757 4.243V112z"/></svg></span>
          <span class="check-icon tw-hidden"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M173.898 439.404l-166.4-166.4c-9.997-9.997-9.997-26.206 0-36.204l36.203-36.204c9.997-9.998 26.207-9.998 36.204 0L192 312.69 432.095 72.596c9.997-9.997 26.207-9.997 36.204 0l36.203 36.204c9.997 9.997 9.997 26.206 0 36.204l-294.4 294.401c-9.998 9.997-26.207 9.997-36.204-.001z"/></svg></span>
      </button>
        
      <button 
        class="
          tw-select-none 
          tw-mx-2 
          tw-block 
          group-[.is-open]:tw-hidden 
          print:!tw-hidden" 
        disabled
        aria-hidden="true"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M328 256c0 39.8-32.2 72-72 72s-72-32.2-72-72 32.2-72 72-72 72 32.2 72 72zm104-72c-39.8 0-72 32.2-72 72s32.2 72 72 72 72-32.2 72-72-32.2-72-72-72zm-352 0c-39.8 0-72 32.2-72 72s32.2 72 72 72 72-32.2 72-72-32.2-72-72-72z"/></svg></button>
    </div>
  </div>
  <pre style="counter-reset: codeblock;" class="tw-block tw-m-0 tw-p-0"><code 
    id="codeblock-id-9" 
    class="
      chroma 
      !tw-block 
      tw-p-0
      tw-m-0
      tw-transition-[max-height] 
      tw-duration-500 
      tw-ease-in-out 
      group-[.is-closed]:!tw-max-h-0 
      group-[.is-wrap]:tw-text-wrap
      tw-overflow-y-hidden
      tw-overflow-x-auto
      tw-scrollbar-thin
      "><span class="line"><span class="cl">numactl -C 7 -m 0 ./bin/lat_mem_rd -W 5 -N 5 -t 64M  //-C 7 cpu 7, -m 0 node0, -W 热身 -t stride</span></span></code></pre>
</div>
<p>同样的机型，开关numa的测试结果，关numa 时延、带宽都差了几倍，<a href="https://zhuanlan.zhihu.com/p/387117470" target="_blank" rel="noopener noreferrer">所以一定要开NUMA</a></p>
<p><img class="tw-inline" loading="lazy" src=https://cdn.jsdelivr.net/gh/plantegg/plantegg.github.io/images/951413iMgBlog/image-20210924192330025-7857743.png   alt="image-20210924192330025"  ></p>
<h3 id="鲲鹏920-1" class="headerLink">
    <a href="#%e9%b2%b2%e9%b9%8f920-1" class="header-mark"></a>鲲鹏920</h3><div class="code-block highlight is-open show-line-numbers  tw-group tw-my-2">
  <div class="
    code-block-title 
    
    tw-flex 
    tw-flex-row 
    tw-justify-between 
    tw-w-full tw-bg-bgColor-secondary
    ">      
    <button 
      class="
        tw-select-none 
        tw-mx-2 
        tw-block
        group-[.is-open]:tw-rotate-90
        tw-transition-[transform] 
        tw-duration-500 
        tw-ease-in-out
        print:!tw-hidden"
      disabled
      aria-hidden="true"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M285.476 272.971L91.132 467.314c-9.373 9.373-24.569 9.373-33.941 0l-22.667-22.667c-9.357-9.357-9.375-24.522-.04-33.901L188.505 256 34.484 101.255c-9.335-9.379-9.317-24.544.04-33.901l22.667-22.667c9.373-9.373 24.569-9.373 33.941 0L285.475 239.03c9.373 9.372 9.373 24.568.001 33.941z"/></svg></button>

    <div class="code-block-title-bar tw-w-full">
      <p class="tw-select-none !tw-my-1">text</p>
    </div>
    <div class="tw-flex">
      <button 
        class="
          line-number-button
          tw-select-none 
          tw-mx-2 
          tw-hidden 
          group-[.is-open]:tw-block 
          group-[.show-line-numbers]:tw-text-fgColor-link 
          print:!tw-hidden" 
        title="Toggle line numbers"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M61.77 401l17.5-20.15a19.92 19.92 0 0 0 5.07-14.19v-3.31C84.34 356 80.5 352 73 352H16a8 8 0 0 0-8 8v16a8 8 0 0 0 8 8h22.83a157.41 157.41 0 0 0-11 12.31l-5.61 7c-4 5.07-5.25 10.13-2.8 14.88l1.05 1.93c3 5.76 6.29 7.88 12.25 7.88h4.73c10.33 0 15.94 2.44 15.94 9.09 0 4.72-4.2 8.22-14.36 8.22a41.54 41.54 0 0 1-15.47-3.12c-6.49-3.88-11.74-3.5-15.6 3.12l-5.59 9.31c-3.72 6.13-3.19 11.72 2.63 15.94 7.71 4.69 20.38 9.44 37 9.44 34.16 0 48.5-22.75 48.5-44.12-.03-14.38-9.12-29.76-28.73-34.88zM496 224H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zm0-160H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16V80a16 16 0 0 0-16-16zm0 320H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zM16 160h64a8 8 0 0 0 8-8v-16a8 8 0 0 0-8-8H64V40a8 8 0 0 0-8-8H32a8 8 0 0 0-7.14 4.42l-8 16A8 8 0 0 0 24 64h8v64H16a8 8 0 0 0-8 8v16a8 8 0 0 0 8 8zm-3.91 160H80a8 8 0 0 0 8-8v-16a8 8 0 0 0-8-8H41.32c3.29-10.29 48.34-18.68 48.34-56.44 0-29.06-25-39.56-44.47-39.56-21.36 0-33.8 10-40.46 18.75-4.37 5.59-3 10.84 2.8 15.37l8.58 6.88c5.61 4.56 11 2.47 16.12-2.44a13.44 13.44 0 0 1 9.46-3.84c3.33 0 9.28 1.56 9.28 8.75C51 248.19 0 257.31 0 304.59v4C0 316 5.08 320 12.09 320z"/></svg></button>

      <button 
        class="
          wrap-code-button
          tw-select-none 
          tw-mx-2 
          tw-hidden 
          group-[.is-open]:tw-block 
          group-[.is-wrap]:tw-text-fgColor-link 
          print:!tw-hidden" 
        title="Toggle code wrap"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M16 132h416c8.837 0 16-7.163 16-16V76c0-8.837-7.163-16-16-16H16C7.163 60 0 67.163 0 76v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16z"/></svg></button>
      
      <button 
        class="
          copy-code-button
          tw-select-none
          tw-mx-2 
          tw-hidden
          group-[.is-open]:tw-block
          hover:tw-text-fgColor-link 
          print:!tw-hidden"
        title="Copy code">
          <span class="copy-icon tw-block"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M433.941 65.941l-51.882-51.882A48 48 0 0 0 348.118 0H176c-26.51 0-48 21.49-48 48v48H48c-26.51 0-48 21.49-48 48v320c0 26.51 21.49 48 48 48h224c26.51 0 48-21.49 48-48v-48h80c26.51 0 48-21.49 48-48V99.882a48 48 0 0 0-14.059-33.941zM266 464H54a6 6 0 0 1-6-6V150a6 6 0 0 1 6-6h74v224c0 26.51 21.49 48 48 48h96v42a6 6 0 0 1-6 6zm128-96H182a6 6 0 0 1-6-6V54a6 6 0 0 1 6-6h106v88c0 13.255 10.745 24 24 24h88v202a6 6 0 0 1-6 6zm6-256h-64V48h9.632c1.591 0 3.117.632 4.243 1.757l48.368 48.368a6 6 0 0 1 1.757 4.243V112z"/></svg></span>
          <span class="check-icon tw-hidden"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M173.898 439.404l-166.4-166.4c-9.997-9.997-9.997-26.206 0-36.204l36.203-36.204c9.997-9.998 26.207-9.998 36.204 0L192 312.69 432.095 72.596c9.997-9.997 26.207-9.997 36.204 0l36.203 36.204c9.997 9.997 9.997 26.206 0 36.204l-294.4 294.401c-9.998 9.997-26.207 9.997-36.204-.001z"/></svg></span>
      </button>
        
      <button 
        class="
          tw-select-none 
          tw-mx-2 
          tw-block 
          group-[.is-open]:tw-hidden 
          print:!tw-hidden" 
        disabled
        aria-hidden="true"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M328 256c0 39.8-32.2 72-72 72s-72-32.2-72-72 32.2-72 72-72 72 32.2 72 72zm104-72c-39.8 0-72 32.2-72 72s32.2 72 72 72 72-32.2 72-72-32.2-72-72-72zm-352 0c-39.8 0-72 32.2-72 72s32.2 72 72 72 72-32.2 72-72-32.2-72-72-72z"/></svg></button>
    </div>
  </div>
  <pre style="counter-reset: codeblock;" class="tw-block tw-m-0 tw-p-0"><code 
    id="codeblock-id-10" 
    class="
      chroma 
      !tw-block 
      tw-p-0
      tw-m-0
      tw-transition-[max-height] 
      tw-duration-500 
      tw-ease-in-out 
      group-[.is-closed]:!tw-max-h-0 
      group-[.is-wrap]:tw-text-wrap
      tw-overflow-y-hidden
      tw-overflow-x-auto
      tw-scrollbar-thin
      "><span class="line"><span class="cl">#for i in $(seq 0 15); do echo core:$i; numactl -N $i -m 7 ./bin/stream  -W 5 -N 5 -M 64M; done
</span></span><span class="line"><span class="cl">STREAM copy latency: 1.84 nanoseconds
</span></span><span class="line"><span class="cl">STREAM copy bandwidth: 8700.75 MB/sec
</span></span><span class="line"><span class="cl">STREAM scale latency: 1.86 nanoseconds
</span></span><span class="line"><span class="cl">STREAM scale bandwidth: 8623.60 MB/sec
</span></span><span class="line"><span class="cl">STREAM add latency: 2.18 nanoseconds
</span></span><span class="line"><span class="cl">STREAM add bandwidth: 10987.04 MB/sec
</span></span><span class="line"><span class="cl">STREAM triad latency: 3.03 nanoseconds
</span></span><span class="line"><span class="cl">STREAM triad bandwidth: 7926.87 MB/sec
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">#numactl -C 7 -m 1 ./bin/stream  -W 5 -N 5 -M 64M
</span></span><span class="line"><span class="cl">STREAM copy latency: 2.05 nanoseconds
</span></span><span class="line"><span class="cl">STREAM copy bandwidth: 7802.45 MB/sec
</span></span><span class="line"><span class="cl">STREAM scale latency: 2.08 nanoseconds
</span></span><span class="line"><span class="cl">STREAM scale bandwidth: 7681.87 MB/sec
</span></span><span class="line"><span class="cl">STREAM add latency: 2.19 nanoseconds
</span></span><span class="line"><span class="cl">STREAM add bandwidth: 10954.76 MB/sec
</span></span><span class="line"><span class="cl">STREAM triad latency: 3.17 nanoseconds
</span></span><span class="line"><span class="cl">STREAM triad bandwidth: 7559.86 MB/sec
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">#numactl -C 7 -m 2 ./bin/stream  -W 5 -N 5 -M 64M
</span></span><span class="line"><span class="cl">STREAM copy latency: 3.51 nanoseconds
</span></span><span class="line"><span class="cl">STREAM copy bandwidth: 4556.86 MB/sec
</span></span><span class="line"><span class="cl">STREAM scale latency: 3.58 nanoseconds
</span></span><span class="line"><span class="cl">STREAM scale bandwidth: 4463.66 MB/sec
</span></span><span class="line"><span class="cl">STREAM add latency: 2.71 nanoseconds
</span></span><span class="line"><span class="cl">STREAM add bandwidth: 8869.79 MB/sec
</span></span><span class="line"><span class="cl">STREAM triad latency: 5.92 nanoseconds
</span></span><span class="line"><span class="cl">STREAM triad bandwidth: 4057.12 MB/sec
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">[root@ARM 19:14 /root/lmbench3]
</span></span><span class="line"><span class="cl">#numactl -C 7 -m 3 ./bin/stream  -W 5 -N 5 -M 64M
</span></span><span class="line"><span class="cl">STREAM copy latency: 3.94 nanoseconds
</span></span><span class="line"><span class="cl">STREAM copy bandwidth: 4064.25 MB/sec
</span></span><span class="line"><span class="cl">STREAM scale latency: 3.82 nanoseconds
</span></span><span class="line"><span class="cl">STREAM scale bandwidth: 4188.67 MB/sec
</span></span><span class="line"><span class="cl">STREAM add latency: 2.86 nanoseconds
</span></span><span class="line"><span class="cl">STREAM add bandwidth: 8390.70 MB/sec
</span></span><span class="line"><span class="cl">STREAM triad latency: 4.78 nanoseconds
</span></span><span class="line"><span class="cl">STREAM triad bandwidth: 5024.25 MB/sec
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">#numactl -C 24 -m 3 ./bin/stream  -W 5 -N 5 -M 64M
</span></span><span class="line"><span class="cl">STREAM copy latency: 4.10 nanoseconds
</span></span><span class="line"><span class="cl">STREAM copy bandwidth: 3904.63 MB/sec
</span></span><span class="line"><span class="cl">STREAM scale latency: 4.03 nanoseconds
</span></span><span class="line"><span class="cl">STREAM scale bandwidth: 3969.41 MB/sec
</span></span><span class="line"><span class="cl">STREAM add latency: 3.07 nanoseconds
</span></span><span class="line"><span class="cl">STREAM add bandwidth: 7816.08 MB/sec
</span></span><span class="line"><span class="cl">STREAM triad latency: 5.06 nanoseconds
</span></span><span class="line"><span class="cl">STREAM triad bandwidth: 4738.66 MB/sec</span></span></code></pre>
</div>
<h3 id="海光7280" class="headerLink">
    <a href="#%e6%b5%b7%e5%85%897280" class="header-mark"></a>海光7280</h3><p>可以看到跨numa（一个numa也就是一个socket，等同于跨socket）RT从1.5上升到2.5，这个数据比鲲鹏920要好很多。
这里还会测试同一块CPU设置不同数量的numa node对性能的影响，所以接下来的测试会列出numa node数量</p>
<div class="code-block highlight is-open show-line-numbers  tw-group tw-my-2">
  <div class="
    code-block-title 
    
    tw-flex 
    tw-flex-row 
    tw-justify-between 
    tw-w-full tw-bg-bgColor-secondary
    ">      
    <button 
      class="
        tw-select-none 
        tw-mx-2 
        tw-block
        group-[.is-open]:tw-rotate-90
        tw-transition-[transform] 
        tw-duration-500 
        tw-ease-in-out
        print:!tw-hidden"
      disabled
      aria-hidden="true"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M285.476 272.971L91.132 467.314c-9.373 9.373-24.569 9.373-33.941 0l-22.667-22.667c-9.357-9.357-9.375-24.522-.04-33.901L188.505 256 34.484 101.255c-9.335-9.379-9.317-24.544.04-33.901l22.667-22.667c9.373-9.373 24.569-9.373 33.941 0L285.475 239.03c9.373 9.372 9.373 24.568.001 33.941z"/></svg></button>

    <div class="code-block-title-bar tw-w-full">
      <p class="tw-select-none !tw-my-1">text</p>
    </div>
    <div class="tw-flex">
      <button 
        class="
          line-number-button
          tw-select-none 
          tw-mx-2 
          tw-hidden 
          group-[.is-open]:tw-block 
          group-[.show-line-numbers]:tw-text-fgColor-link 
          print:!tw-hidden" 
        title="Toggle line numbers"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M61.77 401l17.5-20.15a19.92 19.92 0 0 0 5.07-14.19v-3.31C84.34 356 80.5 352 73 352H16a8 8 0 0 0-8 8v16a8 8 0 0 0 8 8h22.83a157.41 157.41 0 0 0-11 12.31l-5.61 7c-4 5.07-5.25 10.13-2.8 14.88l1.05 1.93c3 5.76 6.29 7.88 12.25 7.88h4.73c10.33 0 15.94 2.44 15.94 9.09 0 4.72-4.2 8.22-14.36 8.22a41.54 41.54 0 0 1-15.47-3.12c-6.49-3.88-11.74-3.5-15.6 3.12l-5.59 9.31c-3.72 6.13-3.19 11.72 2.63 15.94 7.71 4.69 20.38 9.44 37 9.44 34.16 0 48.5-22.75 48.5-44.12-.03-14.38-9.12-29.76-28.73-34.88zM496 224H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zm0-160H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16V80a16 16 0 0 0-16-16zm0 320H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zM16 160h64a8 8 0 0 0 8-8v-16a8 8 0 0 0-8-8H64V40a8 8 0 0 0-8-8H32a8 8 0 0 0-7.14 4.42l-8 16A8 8 0 0 0 24 64h8v64H16a8 8 0 0 0-8 8v16a8 8 0 0 0 8 8zm-3.91 160H80a8 8 0 0 0 8-8v-16a8 8 0 0 0-8-8H41.32c3.29-10.29 48.34-18.68 48.34-56.44 0-29.06-25-39.56-44.47-39.56-21.36 0-33.8 10-40.46 18.75-4.37 5.59-3 10.84 2.8 15.37l8.58 6.88c5.61 4.56 11 2.47 16.12-2.44a13.44 13.44 0 0 1 9.46-3.84c3.33 0 9.28 1.56 9.28 8.75C51 248.19 0 257.31 0 304.59v4C0 316 5.08 320 12.09 320z"/></svg></button>

      <button 
        class="
          wrap-code-button
          tw-select-none 
          tw-mx-2 
          tw-hidden 
          group-[.is-open]:tw-block 
          group-[.is-wrap]:tw-text-fgColor-link 
          print:!tw-hidden" 
        title="Toggle code wrap"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M16 132h416c8.837 0 16-7.163 16-16V76c0-8.837-7.163-16-16-16H16C7.163 60 0 67.163 0 76v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16z"/></svg></button>
      
      <button 
        class="
          copy-code-button
          tw-select-none
          tw-mx-2 
          tw-hidden
          group-[.is-open]:tw-block
          hover:tw-text-fgColor-link 
          print:!tw-hidden"
        title="Copy code">
          <span class="copy-icon tw-block"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M433.941 65.941l-51.882-51.882A48 48 0 0 0 348.118 0H176c-26.51 0-48 21.49-48 48v48H48c-26.51 0-48 21.49-48 48v320c0 26.51 21.49 48 48 48h224c26.51 0 48-21.49 48-48v-48h80c26.51 0 48-21.49 48-48V99.882a48 48 0 0 0-14.059-33.941zM266 464H54a6 6 0 0 1-6-6V150a6 6 0 0 1 6-6h74v224c0 26.51 21.49 48 48 48h96v42a6 6 0 0 1-6 6zm128-96H182a6 6 0 0 1-6-6V54a6 6 0 0 1 6-6h106v88c0 13.255 10.745 24 24 24h88v202a6 6 0 0 1-6 6zm6-256h-64V48h9.632c1.591 0 3.117.632 4.243 1.757l48.368 48.368a6 6 0 0 1 1.757 4.243V112z"/></svg></span>
          <span class="check-icon tw-hidden"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M173.898 439.404l-166.4-166.4c-9.997-9.997-9.997-26.206 0-36.204l36.203-36.204c9.997-9.998 26.207-9.998 36.204 0L192 312.69 432.095 72.596c9.997-9.997 26.207-9.997 36.204 0l36.203 36.204c9.997 9.997 9.997 26.206 0 36.204l-294.4 294.401c-9.998 9.997-26.207 9.997-36.204-.001z"/></svg></span>
      </button>
        
      <button 
        class="
          tw-select-none 
          tw-mx-2 
          tw-block 
          group-[.is-open]:tw-hidden 
          print:!tw-hidden" 
        disabled
        aria-hidden="true"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M328 256c0 39.8-32.2 72-72 72s-72-32.2-72-72 32.2-72 72-72 72 32.2 72 72zm104-72c-39.8 0-72 32.2-72 72s32.2 72 72 72 72-32.2 72-72-32.2-72-72-72zm-352 0c-39.8 0-72 32.2-72 72s32.2 72 72 72 72-32.2 72-72-32.2-72-72-72z"/></svg></button>
    </div>
  </div>
  <pre style="counter-reset: codeblock;" class="tw-block tw-m-0 tw-p-0"><code 
    id="codeblock-id-11" 
    class="
      chroma 
      !tw-block 
      tw-p-0
      tw-m-0
      tw-transition-[max-height] 
      tw-duration-500 
      tw-ease-in-out 
      group-[.is-closed]:!tw-max-h-0 
      group-[.is-wrap]:tw-text-wrap
      tw-overflow-y-hidden
      tw-overflow-x-auto
      tw-scrollbar-thin
      "><span class="line"><span class="cl">[root@hygon8 14:32 /root/lmbench-master]
</span></span><span class="line"><span class="cl">#lscpu
</span></span><span class="line"><span class="cl">架构：                           x86_64
</span></span><span class="line"><span class="cl">CPU 运行模式：                   32-bit, 64-bit
</span></span><span class="line"><span class="cl">字节序：                         Little Endian
</span></span><span class="line"><span class="cl">Address sizes:                   43 bits physical, 48 bits virtual
</span></span><span class="line"><span class="cl">CPU:                             128
</span></span><span class="line"><span class="cl">在线 CPU 列表：                  0-127
</span></span><span class="line"><span class="cl">每个核的线程数：                 2
</span></span><span class="line"><span class="cl">每个座的核数：                   32
</span></span><span class="line"><span class="cl">座：                             2
</span></span><span class="line"><span class="cl">NUMA 节点：                      8
</span></span><span class="line"><span class="cl">厂商 ID：                        HygonGenuine
</span></span><span class="line"><span class="cl">CPU 系列：                       24
</span></span><span class="line"><span class="cl">型号：                           1
</span></span><span class="line"><span class="cl">型号名称：                       Hygon C86 7280 32-core Processor
</span></span><span class="line"><span class="cl">步进：                           1
</span></span><span class="line"><span class="cl">CPU MHz：                        2194.586
</span></span><span class="line"><span class="cl">BogoMIPS：                       3999.63
</span></span><span class="line"><span class="cl">虚拟化：                         AMD-V
</span></span><span class="line"><span class="cl">L1d 缓存：                       2 MiB
</span></span><span class="line"><span class="cl">L1i 缓存：                       4 MiB
</span></span><span class="line"><span class="cl">L2 缓存：                        32 MiB
</span></span><span class="line"><span class="cl">L3 缓存：                        128 MiB
</span></span><span class="line"><span class="cl">NUMA 节点0 CPU：                 0-7,64-71
</span></span><span class="line"><span class="cl">NUMA 节点1 CPU：                 8-15,72-79
</span></span><span class="line"><span class="cl">NUMA 节点2 CPU：                 16-23,80-87
</span></span><span class="line"><span class="cl">NUMA 节点3 CPU：                 24-31,88-95
</span></span><span class="line"><span class="cl">NUMA 节点4 CPU：                 32-39,96-103
</span></span><span class="line"><span class="cl">NUMA 节点5 CPU：                 40-47,104-111
</span></span><span class="line"><span class="cl">NUMA 节点6 CPU：                 48-55,112-119
</span></span><span class="line"><span class="cl">NUMA 节点7 CPU：                 56-63,120-127
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">//可以看到7号core比15、23、31号core明显要快，就近访问node 0的内存，跨numa node（跨Die）没有内存交织分配
</span></span><span class="line"><span class="cl">[root@hygon8 14:32 /root/lmbench-master]
</span></span><span class="line"><span class="cl">#time for i in $(seq 7 8 64); do echo $i; numactl -C $i -m 0 ./bin/stream -W 5 -N 5 -M 64M; done
</span></span><span class="line"><span class="cl">7
</span></span><span class="line"><span class="cl">STREAM copy latency: 1.38 nanoseconds    
</span></span><span class="line"><span class="cl">STREAM copy bandwidth: 11559.53 MB/sec
</span></span><span class="line"><span class="cl">STREAM scale latency: 1.16 nanoseconds
</span></span><span class="line"><span class="cl">STREAM scale bandwidth: 13815.87 MB/sec
</span></span><span class="line"><span class="cl">STREAM add latency: 1.40 nanoseconds
</span></span><span class="line"><span class="cl">STREAM add bandwidth: 17145.85 MB/sec
</span></span><span class="line"><span class="cl">STREAM triad latency: 1.44 nanoseconds
</span></span><span class="line"><span class="cl">STREAM triad bandwidth: 16637.18 MB/sec
</span></span><span class="line"><span class="cl">15
</span></span><span class="line"><span class="cl">STREAM copy latency: 1.67 nanoseconds
</span></span><span class="line"><span class="cl">STREAM copy bandwidth: 9591.77 MB/sec
</span></span><span class="line"><span class="cl">STREAM scale latency: 1.56 nanoseconds
</span></span><span class="line"><span class="cl">STREAM scale bandwidth: 10242.50 MB/sec
</span></span><span class="line"><span class="cl">STREAM add latency: 1.45 nanoseconds
</span></span><span class="line"><span class="cl">STREAM add bandwidth: 16581.00 MB/sec
</span></span><span class="line"><span class="cl">STREAM triad latency: 2.00 nanoseconds
</span></span><span class="line"><span class="cl">STREAM triad bandwidth: 12028.83 MB/sec
</span></span><span class="line"><span class="cl">23
</span></span><span class="line"><span class="cl">STREAM copy latency: 1.65 nanoseconds
</span></span><span class="line"><span class="cl">STREAM copy bandwidth: 9701.49 MB/sec
</span></span><span class="line"><span class="cl">STREAM scale latency: 1.53 nanoseconds
</span></span><span class="line"><span class="cl">STREAM scale bandwidth: 10427.98 MB/sec
</span></span><span class="line"><span class="cl">STREAM add latency: 1.42 nanoseconds
</span></span><span class="line"><span class="cl">STREAM add bandwidth: 16846.10 MB/sec
</span></span><span class="line"><span class="cl">STREAM triad latency: 1.97 nanoseconds
</span></span><span class="line"><span class="cl">STREAM triad bandwidth: 12189.72 MB/sec
</span></span><span class="line"><span class="cl">31
</span></span><span class="line"><span class="cl">STREAM copy latency: 1.64 nanoseconds
</span></span><span class="line"><span class="cl">STREAM copy bandwidth: 9742.86 MB/sec
</span></span><span class="line"><span class="cl">STREAM scale latency: 1.52 nanoseconds
</span></span><span class="line"><span class="cl">STREAM scale bandwidth: 10510.80 MB/sec
</span></span><span class="line"><span class="cl">STREAM add latency: 1.45 nanoseconds
</span></span><span class="line"><span class="cl">STREAM add bandwidth: 16559.86 MB/sec
</span></span><span class="line"><span class="cl">STREAM triad latency: 1.92 nanoseconds
</span></span><span class="line"><span class="cl">STREAM triad bandwidth: 12490.01 MB/sec
</span></span><span class="line"><span class="cl">39
</span></span><span class="line"><span class="cl">STREAM copy latency: 2.55 nanoseconds
</span></span><span class="line"><span class="cl">STREAM copy bandwidth: 6286.25 MB/sec
</span></span><span class="line"><span class="cl">STREAM scale latency: 2.51 nanoseconds
</span></span><span class="line"><span class="cl">STREAM scale bandwidth: 6383.11 MB/sec
</span></span><span class="line"><span class="cl">STREAM add latency: 1.76 nanoseconds
</span></span><span class="line"><span class="cl">STREAM add bandwidth: 13660.83 MB/sec
</span></span><span class="line"><span class="cl">STREAM triad latency: 3.68 nanoseconds
</span></span><span class="line"><span class="cl">STREAM triad bandwidth: 6523.02 MB/sec</span></span></code></pre>
</div>
<p>如果这种芯片在bios里设置Die interleaving，4块die当成一个numa node吐出来给OS</p>
<div class="code-block highlight is-open show-line-numbers  tw-group tw-my-2">
  <div class="
    code-block-title 
    
    tw-flex 
    tw-flex-row 
    tw-justify-between 
    tw-w-full tw-bg-bgColor-secondary
    ">      
    <button 
      class="
        tw-select-none 
        tw-mx-2 
        tw-block
        group-[.is-open]:tw-rotate-90
        tw-transition-[transform] 
        tw-duration-500 
        tw-ease-in-out
        print:!tw-hidden"
      disabled
      aria-hidden="true"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M285.476 272.971L91.132 467.314c-9.373 9.373-24.569 9.373-33.941 0l-22.667-22.667c-9.357-9.357-9.375-24.522-.04-33.901L188.505 256 34.484 101.255c-9.335-9.379-9.317-24.544.04-33.901l22.667-22.667c9.373-9.373 24.569-9.373 33.941 0L285.475 239.03c9.373 9.372 9.373 24.568.001 33.941z"/></svg></button>

    <div class="code-block-title-bar tw-w-full">
      <p class="tw-select-none !tw-my-1">text</p>
    </div>
    <div class="tw-flex">
      <button 
        class="
          line-number-button
          tw-select-none 
          tw-mx-2 
          tw-hidden 
          group-[.is-open]:tw-block 
          group-[.show-line-numbers]:tw-text-fgColor-link 
          print:!tw-hidden" 
        title="Toggle line numbers"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M61.77 401l17.5-20.15a19.92 19.92 0 0 0 5.07-14.19v-3.31C84.34 356 80.5 352 73 352H16a8 8 0 0 0-8 8v16a8 8 0 0 0 8 8h22.83a157.41 157.41 0 0 0-11 12.31l-5.61 7c-4 5.07-5.25 10.13-2.8 14.88l1.05 1.93c3 5.76 6.29 7.88 12.25 7.88h4.73c10.33 0 15.94 2.44 15.94 9.09 0 4.72-4.2 8.22-14.36 8.22a41.54 41.54 0 0 1-15.47-3.12c-6.49-3.88-11.74-3.5-15.6 3.12l-5.59 9.31c-3.72 6.13-3.19 11.72 2.63 15.94 7.71 4.69 20.38 9.44 37 9.44 34.16 0 48.5-22.75 48.5-44.12-.03-14.38-9.12-29.76-28.73-34.88zM496 224H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zm0-160H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16V80a16 16 0 0 0-16-16zm0 320H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zM16 160h64a8 8 0 0 0 8-8v-16a8 8 0 0 0-8-8H64V40a8 8 0 0 0-8-8H32a8 8 0 0 0-7.14 4.42l-8 16A8 8 0 0 0 24 64h8v64H16a8 8 0 0 0-8 8v16a8 8 0 0 0 8 8zm-3.91 160H80a8 8 0 0 0 8-8v-16a8 8 0 0 0-8-8H41.32c3.29-10.29 48.34-18.68 48.34-56.44 0-29.06-25-39.56-44.47-39.56-21.36 0-33.8 10-40.46 18.75-4.37 5.59-3 10.84 2.8 15.37l8.58 6.88c5.61 4.56 11 2.47 16.12-2.44a13.44 13.44 0 0 1 9.46-3.84c3.33 0 9.28 1.56 9.28 8.75C51 248.19 0 257.31 0 304.59v4C0 316 5.08 320 12.09 320z"/></svg></button>

      <button 
        class="
          wrap-code-button
          tw-select-none 
          tw-mx-2 
          tw-hidden 
          group-[.is-open]:tw-block 
          group-[.is-wrap]:tw-text-fgColor-link 
          print:!tw-hidden" 
        title="Toggle code wrap"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M16 132h416c8.837 0 16-7.163 16-16V76c0-8.837-7.163-16-16-16H16C7.163 60 0 67.163 0 76v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16z"/></svg></button>
      
      <button 
        class="
          copy-code-button
          tw-select-none
          tw-mx-2 
          tw-hidden
          group-[.is-open]:tw-block
          hover:tw-text-fgColor-link 
          print:!tw-hidden"
        title="Copy code">
          <span class="copy-icon tw-block"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M433.941 65.941l-51.882-51.882A48 48 0 0 0 348.118 0H176c-26.51 0-48 21.49-48 48v48H48c-26.51 0-48 21.49-48 48v320c0 26.51 21.49 48 48 48h224c26.51 0 48-21.49 48-48v-48h80c26.51 0 48-21.49 48-48V99.882a48 48 0 0 0-14.059-33.941zM266 464H54a6 6 0 0 1-6-6V150a6 6 0 0 1 6-6h74v224c0 26.51 21.49 48 48 48h96v42a6 6 0 0 1-6 6zm128-96H182a6 6 0 0 1-6-6V54a6 6 0 0 1 6-6h106v88c0 13.255 10.745 24 24 24h88v202a6 6 0 0 1-6 6zm6-256h-64V48h9.632c1.591 0 3.117.632 4.243 1.757l48.368 48.368a6 6 0 0 1 1.757 4.243V112z"/></svg></span>
          <span class="check-icon tw-hidden"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M173.898 439.404l-166.4-166.4c-9.997-9.997-9.997-26.206 0-36.204l36.203-36.204c9.997-9.998 26.207-9.998 36.204 0L192 312.69 432.095 72.596c9.997-9.997 26.207-9.997 36.204 0l36.203 36.204c9.997 9.997 9.997 26.206 0 36.204l-294.4 294.401c-9.998 9.997-26.207 9.997-36.204-.001z"/></svg></span>
      </button>
        
      <button 
        class="
          tw-select-none 
          tw-mx-2 
          tw-block 
          group-[.is-open]:tw-hidden 
          print:!tw-hidden" 
        disabled
        aria-hidden="true"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M328 256c0 39.8-32.2 72-72 72s-72-32.2-72-72 32.2-72 72-72 72 32.2 72 72zm104-72c-39.8 0-72 32.2-72 72s32.2 72 72 72 72-32.2 72-72-32.2-72-72-72zm-352 0c-39.8 0-72 32.2-72 72s32.2 72 72 72 72-32.2 72-72-32.2-72-72-72z"/></svg></button>
    </div>
  </div>
  <pre style="counter-reset: codeblock;" class="tw-block tw-m-0 tw-p-0"><code 
    id="codeblock-id-12" 
    class="
      chroma 
      !tw-block 
      tw-p-0
      tw-m-0
      tw-transition-[max-height] 
      tw-duration-500 
      tw-ease-in-out 
      group-[.is-closed]:!tw-max-h-0 
      group-[.is-wrap]:tw-text-wrap
      tw-overflow-y-hidden
      tw-overflow-x-auto
      tw-scrollbar-thin
      "><span class="line"><span class="cl">#lscpu
</span></span><span class="line"><span class="cl">架构：                           x86_64
</span></span><span class="line"><span class="cl">CPU 运行模式：                   32-bit, 64-bit
</span></span><span class="line"><span class="cl">字节序：                         Little Endian
</span></span><span class="line"><span class="cl">Address sizes:                   43 bits physical, 48 bits virtual
</span></span><span class="line"><span class="cl">CPU:                             128
</span></span><span class="line"><span class="cl">在线 CPU 列表：                  0-127
</span></span><span class="line"><span class="cl">每个核的线程数：                 2
</span></span><span class="line"><span class="cl">每个座的核数：                   32
</span></span><span class="line"><span class="cl">座：                             2
</span></span><span class="line"><span class="cl">NUMA 节点：                      2
</span></span><span class="line"><span class="cl">厂商 ID：                        HygonGenuine
</span></span><span class="line"><span class="cl">CPU 系列：                       24
</span></span><span class="line"><span class="cl">型号：                           1
</span></span><span class="line"><span class="cl">型号名称：                       Hygon C86 7280 32-core Processor
</span></span><span class="line"><span class="cl">步进：                           1
</span></span><span class="line"><span class="cl">CPU MHz：                        2108.234
</span></span><span class="line"><span class="cl">BogoMIPS：                       3999.45
</span></span><span class="line"><span class="cl">虚拟化：                         AMD-V
</span></span><span class="line"><span class="cl">L1d 缓存：                       2 MiB
</span></span><span class="line"><span class="cl">L1i 缓存：                       4 MiB
</span></span><span class="line"><span class="cl">L2 缓存：                        32 MiB
</span></span><span class="line"><span class="cl">L3 缓存：                        128 MiB
</span></span><span class="line"><span class="cl">//注意这里bios配置了Die Interleaving Enable
</span></span><span class="line"><span class="cl">//表示每路内多个Die内存交织分配，这样整个一个socket就是一个大Die
</span></span><span class="line"><span class="cl">NUMA 节点0 CPU：                 0-31,64-95  
</span></span><span class="line"><span class="cl">NUMA 节点1 CPU：                 32-63,96-127
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">//enable die interleaving 后继续streaming测试
</span></span><span class="line"><span class="cl">//最终测试结果表现就是7/15/23/31 core性能一致，因为默认一个numa内内存交织分配
</span></span><span class="line"><span class="cl">//可以看到同一路下的四个die内存交织访问，所以4个node内存延时一样了（被平均），都不如8node就近快
</span></span><span class="line"><span class="cl">[root@hygon3 16:09 /root/lmbench-master]
</span></span><span class="line"><span class="cl">#time for i in $(seq 7 8 64); do echo $i; numactl -C $i -m 0 ./bin/stream -W 5 -N 5 -M 64M; done
</span></span><span class="line"><span class="cl">7
</span></span><span class="line"><span class="cl">STREAM copy latency: 1.48 nanoseconds
</span></span><span class="line"><span class="cl">STREAM copy bandwidth: 10782.58 MB/sec
</span></span><span class="line"><span class="cl">STREAM scale latency: 1.20 nanoseconds
</span></span><span class="line"><span class="cl">STREAM scale bandwidth: 13364.38 MB/sec
</span></span><span class="line"><span class="cl">STREAM add latency: 1.46 nanoseconds
</span></span><span class="line"><span class="cl">STREAM add bandwidth: 16408.32 MB/sec
</span></span><span class="line"><span class="cl">STREAM triad latency: 1.53 nanoseconds
</span></span><span class="line"><span class="cl">STREAM triad bandwidth: 15696.00 MB/sec
</span></span><span class="line"><span class="cl">15
</span></span><span class="line"><span class="cl">STREAM copy latency: 1.51 nanoseconds
</span></span><span class="line"><span class="cl">STREAM copy bandwidth: 10601.25 MB/sec
</span></span><span class="line"><span class="cl">STREAM scale latency: 1.24 nanoseconds
</span></span><span class="line"><span class="cl">STREAM scale bandwidth: 12855.87 MB/sec
</span></span><span class="line"><span class="cl">STREAM add latency: 1.46 nanoseconds
</span></span><span class="line"><span class="cl">STREAM add bandwidth: 16382.42 MB/sec
</span></span><span class="line"><span class="cl">STREAM triad latency: 1.53 nanoseconds
</span></span><span class="line"><span class="cl">STREAM triad bandwidth: 15691.48 MB/sec
</span></span><span class="line"><span class="cl">23
</span></span><span class="line"><span class="cl">STREAM copy latency: 1.50 nanoseconds
</span></span><span class="line"><span class="cl">STREAM copy bandwidth: 10700.61 MB/sec
</span></span><span class="line"><span class="cl">STREAM scale latency: 1.27 nanoseconds
</span></span><span class="line"><span class="cl">STREAM scale bandwidth: 12634.63 MB/sec
</span></span><span class="line"><span class="cl">STREAM add latency: 1.47 nanoseconds
</span></span><span class="line"><span class="cl">STREAM add bandwidth: 16370.67 MB/sec
</span></span><span class="line"><span class="cl">STREAM triad latency: 1.55 nanoseconds
</span></span><span class="line"><span class="cl">STREAM triad bandwidth: 15455.75 MB/sec
</span></span><span class="line"><span class="cl">31
</span></span><span class="line"><span class="cl">STREAM copy latency: 1.50 nanoseconds
</span></span><span class="line"><span class="cl">STREAM copy bandwidth: 10637.39 MB/sec
</span></span><span class="line"><span class="cl">STREAM scale latency: 1.25 nanoseconds
</span></span><span class="line"><span class="cl">STREAM scale bandwidth: 12778.99 MB/sec
</span></span><span class="line"><span class="cl">STREAM add latency: 1.46 nanoseconds
</span></span><span class="line"><span class="cl">STREAM add bandwidth: 16420.65 MB/sec
</span></span><span class="line"><span class="cl">STREAM triad latency: 1.61 nanoseconds
</span></span><span class="line"><span class="cl">STREAM triad bandwidth: 14946.80 MB/sec
</span></span><span class="line"><span class="cl">39
</span></span><span class="line"><span class="cl">STREAM copy latency: 2.35 nanoseconds
</span></span><span class="line"><span class="cl">STREAM copy bandwidth: 6807.09 MB/sec
</span></span><span class="line"><span class="cl">STREAM scale latency: 2.32 nanoseconds
</span></span><span class="line"><span class="cl">STREAM scale bandwidth: 6906.93 MB/sec
</span></span><span class="line"><span class="cl">STREAM add latency: 1.63 nanoseconds
</span></span><span class="line"><span class="cl">STREAM add bandwidth: 14729.23 MB/sec
</span></span><span class="line"><span class="cl">STREAM triad latency: 3.36 nanoseconds
</span></span><span class="line"><span class="cl">STREAM triad bandwidth: 7151.67 MB/sec
</span></span><span class="line"><span class="cl">47
</span></span><span class="line"><span class="cl">STREAM copy latency: 2.31 nanoseconds
</span></span><span class="line"><span class="cl">STREAM copy bandwidth: 6938.47 MB/sec</span></span></code></pre>
</div>
<h3 id="intel-8269cy" class="headerLink">
    <a href="#intel-8269cy" class="header-mark"></a>intel 8269CY</h3><div class="code-block highlight is-open show-line-numbers  tw-group tw-my-2">
  <div class="
    code-block-title 
    
    tw-flex 
    tw-flex-row 
    tw-justify-between 
    tw-w-full tw-bg-bgColor-secondary
    ">      
    <button 
      class="
        tw-select-none 
        tw-mx-2 
        tw-block
        group-[.is-open]:tw-rotate-90
        tw-transition-[transform] 
        tw-duration-500 
        tw-ease-in-out
        print:!tw-hidden"
      disabled
      aria-hidden="true"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M285.476 272.971L91.132 467.314c-9.373 9.373-24.569 9.373-33.941 0l-22.667-22.667c-9.357-9.357-9.375-24.522-.04-33.901L188.505 256 34.484 101.255c-9.335-9.379-9.317-24.544.04-33.901l22.667-22.667c9.373-9.373 24.569-9.373 33.941 0L285.475 239.03c9.373 9.372 9.373 24.568.001 33.941z"/></svg></button>

    <div class="code-block-title-bar tw-w-full">
      <p class="tw-select-none !tw-my-1">text</p>
    </div>
    <div class="tw-flex">
      <button 
        class="
          line-number-button
          tw-select-none 
          tw-mx-2 
          tw-hidden 
          group-[.is-open]:tw-block 
          group-[.show-line-numbers]:tw-text-fgColor-link 
          print:!tw-hidden" 
        title="Toggle line numbers"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M61.77 401l17.5-20.15a19.92 19.92 0 0 0 5.07-14.19v-3.31C84.34 356 80.5 352 73 352H16a8 8 0 0 0-8 8v16a8 8 0 0 0 8 8h22.83a157.41 157.41 0 0 0-11 12.31l-5.61 7c-4 5.07-5.25 10.13-2.8 14.88l1.05 1.93c3 5.76 6.29 7.88 12.25 7.88h4.73c10.33 0 15.94 2.44 15.94 9.09 0 4.72-4.2 8.22-14.36 8.22a41.54 41.54 0 0 1-15.47-3.12c-6.49-3.88-11.74-3.5-15.6 3.12l-5.59 9.31c-3.72 6.13-3.19 11.72 2.63 15.94 7.71 4.69 20.38 9.44 37 9.44 34.16 0 48.5-22.75 48.5-44.12-.03-14.38-9.12-29.76-28.73-34.88zM496 224H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zm0-160H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16V80a16 16 0 0 0-16-16zm0 320H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zM16 160h64a8 8 0 0 0 8-8v-16a8 8 0 0 0-8-8H64V40a8 8 0 0 0-8-8H32a8 8 0 0 0-7.14 4.42l-8 16A8 8 0 0 0 24 64h8v64H16a8 8 0 0 0-8 8v16a8 8 0 0 0 8 8zm-3.91 160H80a8 8 0 0 0 8-8v-16a8 8 0 0 0-8-8H41.32c3.29-10.29 48.34-18.68 48.34-56.44 0-29.06-25-39.56-44.47-39.56-21.36 0-33.8 10-40.46 18.75-4.37 5.59-3 10.84 2.8 15.37l8.58 6.88c5.61 4.56 11 2.47 16.12-2.44a13.44 13.44 0 0 1 9.46-3.84c3.33 0 9.28 1.56 9.28 8.75C51 248.19 0 257.31 0 304.59v4C0 316 5.08 320 12.09 320z"/></svg></button>

      <button 
        class="
          wrap-code-button
          tw-select-none 
          tw-mx-2 
          tw-hidden 
          group-[.is-open]:tw-block 
          group-[.is-wrap]:tw-text-fgColor-link 
          print:!tw-hidden" 
        title="Toggle code wrap"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M16 132h416c8.837 0 16-7.163 16-16V76c0-8.837-7.163-16-16-16H16C7.163 60 0 67.163 0 76v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16z"/></svg></button>
      
      <button 
        class="
          copy-code-button
          tw-select-none
          tw-mx-2 
          tw-hidden
          group-[.is-open]:tw-block
          hover:tw-text-fgColor-link 
          print:!tw-hidden"
        title="Copy code">
          <span class="copy-icon tw-block"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M433.941 65.941l-51.882-51.882A48 48 0 0 0 348.118 0H176c-26.51 0-48 21.49-48 48v48H48c-26.51 0-48 21.49-48 48v320c0 26.51 21.49 48 48 48h224c26.51 0 48-21.49 48-48v-48h80c26.51 0 48-21.49 48-48V99.882a48 48 0 0 0-14.059-33.941zM266 464H54a6 6 0 0 1-6-6V150a6 6 0 0 1 6-6h74v224c0 26.51 21.49 48 48 48h96v42a6 6 0 0 1-6 6zm128-96H182a6 6 0 0 1-6-6V54a6 6 0 0 1 6-6h106v88c0 13.255 10.745 24 24 24h88v202a6 6 0 0 1-6 6zm6-256h-64V48h9.632c1.591 0 3.117.632 4.243 1.757l48.368 48.368a6 6 0 0 1 1.757 4.243V112z"/></svg></span>
          <span class="check-icon tw-hidden"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M173.898 439.404l-166.4-166.4c-9.997-9.997-9.997-26.206 0-36.204l36.203-36.204c9.997-9.998 26.207-9.998 36.204 0L192 312.69 432.095 72.596c9.997-9.997 26.207-9.997 36.204 0l36.203 36.204c9.997 9.997 9.997 26.206 0 36.204l-294.4 294.401c-9.998 9.997-26.207 9.997-36.204-.001z"/></svg></span>
      </button>
        
      <button 
        class="
          tw-select-none 
          tw-mx-2 
          tw-block 
          group-[.is-open]:tw-hidden 
          print:!tw-hidden" 
        disabled
        aria-hidden="true"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M328 256c0 39.8-32.2 72-72 72s-72-32.2-72-72 32.2-72 72-72 72 32.2 72 72zm104-72c-39.8 0-72 32.2-72 72s32.2 72 72 72 72-32.2 72-72-32.2-72-72-72zm-352 0c-39.8 0-72 32.2-72 72s32.2 72 72 72 72-32.2 72-72-32.2-72-72-72z"/></svg></button>
    </div>
  </div>
  <pre style="counter-reset: codeblock;" class="tw-block tw-m-0 tw-p-0"><code 
    id="codeblock-id-13" 
    class="
      chroma 
      !tw-block 
      tw-p-0
      tw-m-0
      tw-transition-[max-height] 
      tw-duration-500 
      tw-ease-in-out 
      group-[.is-closed]:!tw-max-h-0 
      group-[.is-wrap]:tw-text-wrap
      tw-overflow-y-hidden
      tw-overflow-x-auto
      tw-scrollbar-thin
      "><span class="line"><span class="cl">lscpu
</span></span><span class="line"><span class="cl">Architecture:          x86_64
</span></span><span class="line"><span class="cl">CPU op-mode(s):        32-bit, 64-bit
</span></span><span class="line"><span class="cl">Byte Order:            Little Endian
</span></span><span class="line"><span class="cl">CPU(s):                104
</span></span><span class="line"><span class="cl">On-line CPU(s) list:   0-103
</span></span><span class="line"><span class="cl">Thread(s) per core:    2
</span></span><span class="line"><span class="cl">Core(s) per socket:    26
</span></span><span class="line"><span class="cl">Socket(s):             2
</span></span><span class="line"><span class="cl">NUMA node(s):          2
</span></span><span class="line"><span class="cl">Vendor ID:             GenuineIntel
</span></span><span class="line"><span class="cl">CPU family:            6
</span></span><span class="line"><span class="cl">Model:                 85
</span></span><span class="line"><span class="cl">Model name:            Intel(R) Xeon(R) Platinum 8269CY CPU @ 2.50GHz
</span></span><span class="line"><span class="cl">Stepping:              7
</span></span><span class="line"><span class="cl">CPU MHz:               3200.000
</span></span><span class="line"><span class="cl">CPU max MHz:           3800.0000
</span></span><span class="line"><span class="cl">CPU min MHz:           1200.0000
</span></span><span class="line"><span class="cl">BogoMIPS:              4998.89
</span></span><span class="line"><span class="cl">Virtualization:        VT-x
</span></span><span class="line"><span class="cl">L1d cache:             32K
</span></span><span class="line"><span class="cl">L1i cache:             32K
</span></span><span class="line"><span class="cl">L2 cache:              1024K
</span></span><span class="line"><span class="cl">L3 cache:              36608K
</span></span><span class="line"><span class="cl">NUMA node0 CPU(s):     0-25,52-77
</span></span><span class="line"><span class="cl">NUMA node1 CPU(s):     26-51,78-103
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">[root@numaopen.cloud.et93 /home/ren/lmbench3]
</span></span><span class="line"><span class="cl">#time for i in $(seq 0 8 51); do echo $i; numactl -C $i -m 0 ./bin/stream -W 5 -N 5 -M 64M; done
</span></span><span class="line"><span class="cl">0
</span></span><span class="line"><span class="cl">STREAM copy latency: 1.15 nanoseconds
</span></span><span class="line"><span class="cl">STREAM copy bandwidth: 13941.80 MB/sec
</span></span><span class="line"><span class="cl">STREAM scale latency: 1.16 nanoseconds
</span></span><span class="line"><span class="cl">STREAM scale bandwidth: 13799.89 MB/sec
</span></span><span class="line"><span class="cl">STREAM add latency: 1.31 nanoseconds
</span></span><span class="line"><span class="cl">STREAM add bandwidth: 18318.23 MB/sec
</span></span><span class="line"><span class="cl">STREAM triad latency: 1.56 nanoseconds
</span></span><span class="line"><span class="cl">STREAM triad bandwidth: 15356.72 MB/sec
</span></span><span class="line"><span class="cl">16
</span></span><span class="line"><span class="cl">STREAM copy latency: 1.12 nanoseconds
</span></span><span class="line"><span class="cl">STREAM copy bandwidth: 14293.68 MB/sec
</span></span><span class="line"><span class="cl">STREAM scale latency: 1.13 nanoseconds
</span></span><span class="line"><span class="cl">STREAM scale bandwidth: 14162.47 MB/sec
</span></span><span class="line"><span class="cl">STREAM add latency: 1.31 nanoseconds
</span></span><span class="line"><span class="cl">STREAM add bandwidth: 18293.27 MB/sec
</span></span><span class="line"><span class="cl">STREAM triad latency: 1.53 nanoseconds
</span></span><span class="line"><span class="cl">STREAM triad bandwidth: 15692.47 MB/sec
</span></span><span class="line"><span class="cl">32
</span></span><span class="line"><span class="cl">STREAM copy latency: 1.52 nanoseconds
</span></span><span class="line"><span class="cl">STREAM copy bandwidth: 10551.71 MB/sec
</span></span><span class="line"><span class="cl">STREAM scale latency: 1.52 nanoseconds
</span></span><span class="line"><span class="cl">STREAM scale bandwidth: 10508.33 MB/sec
</span></span><span class="line"><span class="cl">STREAM add latency: 1.38 nanoseconds
</span></span><span class="line"><span class="cl">STREAM add bandwidth: 17363.22 MB/sec
</span></span><span class="line"><span class="cl">STREAM triad latency: 2.00 nanoseconds
</span></span><span class="line"><span class="cl">STREAM triad bandwidth: 12024.52 MB/sec
</span></span><span class="line"><span class="cl">40
</span></span><span class="line"><span class="cl">STREAM copy latency: 1.49 nanoseconds
</span></span><span class="line"><span class="cl">STREAM copy bandwidth: 10758.50 MB/sec
</span></span><span class="line"><span class="cl">STREAM scale latency: 1.50 nanoseconds
</span></span><span class="line"><span class="cl">STREAM scale bandwidth: 10680.17 MB/sec
</span></span><span class="line"><span class="cl">STREAM add latency: 1.34 nanoseconds
</span></span><span class="line"><span class="cl">STREAM add bandwidth: 17948.34 MB/sec
</span></span><span class="line"><span class="cl">STREAM triad latency: 1.98 nanoseconds
</span></span><span class="line"><span class="cl">STREAM triad bandwidth: 12133.22 MB/sec
</span></span><span class="line"><span class="cl">48
</span></span><span class="line"><span class="cl">STREAM copy latency: 1.49 nanoseconds
</span></span><span class="line"><span class="cl">STREAM copy bandwidth: 10736.56 MB/sec
</span></span><span class="line"><span class="cl">STREAM scale latency: 1.50 nanoseconds
</span></span><span class="line"><span class="cl">STREAM scale bandwidth: 10692.93 MB/sec
</span></span><span class="line"><span class="cl">STREAM add latency: 1.34 nanoseconds
</span></span><span class="line"><span class="cl">STREAM add bandwidth: 17902.85 MB/sec
</span></span><span class="line"><span class="cl">STREAM triad latency: 1.96 nanoseconds
</span></span><span class="line"><span class="cl">STREAM triad bandwidth: 12239.44 MB/sec</span></span></code></pre>
</div>
<h3 id="intelr-xeonr-cpu-e5-2682-v4" class="headerLink">
    <a href="#intelr-xeonr-cpu-e5-2682-v4" class="header-mark"></a>Intel(R) Xeon(R) CPU E5-2682 v4</h3><div class="code-block highlight is-open show-line-numbers  tw-group tw-my-2">
  <div class="
    code-block-title 
    
    tw-flex 
    tw-flex-row 
    tw-justify-between 
    tw-w-full tw-bg-bgColor-secondary
    ">      
    <button 
      class="
        tw-select-none 
        tw-mx-2 
        tw-block
        group-[.is-open]:tw-rotate-90
        tw-transition-[transform] 
        tw-duration-500 
        tw-ease-in-out
        print:!tw-hidden"
      disabled
      aria-hidden="true"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M285.476 272.971L91.132 467.314c-9.373 9.373-24.569 9.373-33.941 0l-22.667-22.667c-9.357-9.357-9.375-24.522-.04-33.901L188.505 256 34.484 101.255c-9.335-9.379-9.317-24.544.04-33.901l22.667-22.667c9.373-9.373 24.569-9.373 33.941 0L285.475 239.03c9.373 9.372 9.373 24.568.001 33.941z"/></svg></button>

    <div class="code-block-title-bar tw-w-full">
      <p class="tw-select-none !tw-my-1">text</p>
    </div>
    <div class="tw-flex">
      <button 
        class="
          line-number-button
          tw-select-none 
          tw-mx-2 
          tw-hidden 
          group-[.is-open]:tw-block 
          group-[.show-line-numbers]:tw-text-fgColor-link 
          print:!tw-hidden" 
        title="Toggle line numbers"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M61.77 401l17.5-20.15a19.92 19.92 0 0 0 5.07-14.19v-3.31C84.34 356 80.5 352 73 352H16a8 8 0 0 0-8 8v16a8 8 0 0 0 8 8h22.83a157.41 157.41 0 0 0-11 12.31l-5.61 7c-4 5.07-5.25 10.13-2.8 14.88l1.05 1.93c3 5.76 6.29 7.88 12.25 7.88h4.73c10.33 0 15.94 2.44 15.94 9.09 0 4.72-4.2 8.22-14.36 8.22a41.54 41.54 0 0 1-15.47-3.12c-6.49-3.88-11.74-3.5-15.6 3.12l-5.59 9.31c-3.72 6.13-3.19 11.72 2.63 15.94 7.71 4.69 20.38 9.44 37 9.44 34.16 0 48.5-22.75 48.5-44.12-.03-14.38-9.12-29.76-28.73-34.88zM496 224H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zm0-160H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16V80a16 16 0 0 0-16-16zm0 320H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zM16 160h64a8 8 0 0 0 8-8v-16a8 8 0 0 0-8-8H64V40a8 8 0 0 0-8-8H32a8 8 0 0 0-7.14 4.42l-8 16A8 8 0 0 0 24 64h8v64H16a8 8 0 0 0-8 8v16a8 8 0 0 0 8 8zm-3.91 160H80a8 8 0 0 0 8-8v-16a8 8 0 0 0-8-8H41.32c3.29-10.29 48.34-18.68 48.34-56.44 0-29.06-25-39.56-44.47-39.56-21.36 0-33.8 10-40.46 18.75-4.37 5.59-3 10.84 2.8 15.37l8.58 6.88c5.61 4.56 11 2.47 16.12-2.44a13.44 13.44 0 0 1 9.46-3.84c3.33 0 9.28 1.56 9.28 8.75C51 248.19 0 257.31 0 304.59v4C0 316 5.08 320 12.09 320z"/></svg></button>

      <button 
        class="
          wrap-code-button
          tw-select-none 
          tw-mx-2 
          tw-hidden 
          group-[.is-open]:tw-block 
          group-[.is-wrap]:tw-text-fgColor-link 
          print:!tw-hidden" 
        title="Toggle code wrap"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M16 132h416c8.837 0 16-7.163 16-16V76c0-8.837-7.163-16-16-16H16C7.163 60 0 67.163 0 76v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16z"/></svg></button>
      
      <button 
        class="
          copy-code-button
          tw-select-none
          tw-mx-2 
          tw-hidden
          group-[.is-open]:tw-block
          hover:tw-text-fgColor-link 
          print:!tw-hidden"
        title="Copy code">
          <span class="copy-icon tw-block"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M433.941 65.941l-51.882-51.882A48 48 0 0 0 348.118 0H176c-26.51 0-48 21.49-48 48v48H48c-26.51 0-48 21.49-48 48v320c0 26.51 21.49 48 48 48h224c26.51 0 48-21.49 48-48v-48h80c26.51 0 48-21.49 48-48V99.882a48 48 0 0 0-14.059-33.941zM266 464H54a6 6 0 0 1-6-6V150a6 6 0 0 1 6-6h74v224c0 26.51 21.49 48 48 48h96v42a6 6 0 0 1-6 6zm128-96H182a6 6 0 0 1-6-6V54a6 6 0 0 1 6-6h106v88c0 13.255 10.745 24 24 24h88v202a6 6 0 0 1-6 6zm6-256h-64V48h9.632c1.591 0 3.117.632 4.243 1.757l48.368 48.368a6 6 0 0 1 1.757 4.243V112z"/></svg></span>
          <span class="check-icon tw-hidden"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M173.898 439.404l-166.4-166.4c-9.997-9.997-9.997-26.206 0-36.204l36.203-36.204c9.997-9.998 26.207-9.998 36.204 0L192 312.69 432.095 72.596c9.997-9.997 26.207-9.997 36.204 0l36.203 36.204c9.997 9.997 9.997 26.206 0 36.204l-294.4 294.401c-9.998 9.997-26.207 9.997-36.204-.001z"/></svg></span>
      </button>
        
      <button 
        class="
          tw-select-none 
          tw-mx-2 
          tw-block 
          group-[.is-open]:tw-hidden 
          print:!tw-hidden" 
        disabled
        aria-hidden="true"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M328 256c0 39.8-32.2 72-72 72s-72-32.2-72-72 32.2-72 72-72 72 32.2 72 72zm104-72c-39.8 0-72 32.2-72 72s32.2 72 72 72 72-32.2 72-72-32.2-72-72-72zm-352 0c-39.8 0-72 32.2-72 72s32.2 72 72 72 72-32.2 72-72-32.2-72-72-72z"/></svg></button>
    </div>
  </div>
  <pre style="counter-reset: codeblock;" class="tw-block tw-m-0 tw-p-0"><code 
    id="codeblock-id-14" 
    class="
      chroma 
      !tw-block 
      tw-p-0
      tw-m-0
      tw-transition-[max-height] 
      tw-duration-500 
      tw-ease-in-out 
      group-[.is-closed]:!tw-max-h-0 
      group-[.is-wrap]:tw-text-wrap
      tw-overflow-y-hidden
      tw-overflow-x-auto
      tw-scrollbar-thin
      "><span class="line"><span class="cl">#time for i in $(seq 0 8 51); do echo $i; numactl -C $i -m 0 ./bin/stream -W 5 -N 5 -M 64M; done
</span></span><span class="line"><span class="cl">0
</span></span><span class="line"><span class="cl">STREAM copy latency: 1.59 nanoseconds
</span></span><span class="line"><span class="cl">STREAM copy bandwidth: 10092.31 MB/sec
</span></span><span class="line"><span class="cl">STREAM scale latency: 1.57 nanoseconds
</span></span><span class="line"><span class="cl">STREAM scale bandwidth: 10169.16 MB/sec
</span></span><span class="line"><span class="cl">STREAM add latency: 1.31 nanoseconds
</span></span><span class="line"><span class="cl">STREAM add bandwidth: 18360.83 MB/sec
</span></span><span class="line"><span class="cl">STREAM triad latency: 2.28 nanoseconds
</span></span><span class="line"><span class="cl">STREAM triad bandwidth: 10503.81 MB/sec
</span></span><span class="line"><span class="cl">8
</span></span><span class="line"><span class="cl">STREAM copy latency: 1.55 nanoseconds
</span></span><span class="line"><span class="cl">STREAM copy bandwidth: 10312.14 MB/sec
</span></span><span class="line"><span class="cl">STREAM scale latency: 1.56 nanoseconds
</span></span><span class="line"><span class="cl">STREAM scale bandwidth: 10283.70 MB/sec
</span></span><span class="line"><span class="cl">STREAM add latency: 1.30 nanoseconds
</span></span><span class="line"><span class="cl">STREAM add bandwidth: 18416.26 MB/sec
</span></span><span class="line"><span class="cl">STREAM triad latency: 2.23 nanoseconds
</span></span><span class="line"><span class="cl">STREAM triad bandwidth: 10777.08 MB/sec
</span></span><span class="line"><span class="cl">16
</span></span><span class="line"><span class="cl">STREAM copy latency: 2.02 nanoseconds
</span></span><span class="line"><span class="cl">STREAM copy bandwidth: 7914.25 MB/sec
</span></span><span class="line"><span class="cl">STREAM scale latency: 2.02 nanoseconds
</span></span><span class="line"><span class="cl">STREAM scale bandwidth: 7919.85 MB/sec
</span></span><span class="line"><span class="cl">STREAM add latency: 1.39 nanoseconds
</span></span><span class="line"><span class="cl">STREAM add bandwidth: 17276.06 MB/sec
</span></span><span class="line"><span class="cl">STREAM triad latency: 2.92 nanoseconds
</span></span><span class="line"><span class="cl">STREAM triad bandwidth: 8231.18 MB/sec
</span></span><span class="line"><span class="cl">24
</span></span><span class="line"><span class="cl">STREAM copy latency: 1.99 nanoseconds
</span></span><span class="line"><span class="cl">STREAM copy bandwidth: 8032.18 MB/sec
</span></span><span class="line"><span class="cl">STREAM scale latency: 1.98 nanoseconds
</span></span><span class="line"><span class="cl">STREAM scale bandwidth: 8061.12 MB/sec
</span></span><span class="line"><span class="cl">STREAM add latency: 1.39 nanoseconds
</span></span><span class="line"><span class="cl">STREAM add bandwidth: 17313.94 MB/sec
</span></span><span class="line"><span class="cl">STREAM triad latency: 2.88 nanoseconds
</span></span><span class="line"><span class="cl">STREAM triad bandwidth: 8318.93 MB/sec
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">#lscpu
</span></span><span class="line"><span class="cl">Architecture:          x86_64
</span></span><span class="line"><span class="cl">CPU op-mode(s):        32-bit, 64-bit
</span></span><span class="line"><span class="cl">Byte Order:            Little Endian
</span></span><span class="line"><span class="cl">CPU(s):                64
</span></span><span class="line"><span class="cl">On-line CPU(s) list:   0-63
</span></span><span class="line"><span class="cl">Thread(s) per core:    2
</span></span><span class="line"><span class="cl">Core(s) per socket:    16
</span></span><span class="line"><span class="cl">Socket(s):             2
</span></span><span class="line"><span class="cl">NUMA node(s):          2
</span></span><span class="line"><span class="cl">Vendor ID:             GenuineIntel
</span></span><span class="line"><span class="cl">CPU family:            6
</span></span><span class="line"><span class="cl">Model:                 79
</span></span><span class="line"><span class="cl">Model name:            Intel(R) Xeon(R) CPU E5-2682 v4 @ 2.50GHz
</span></span><span class="line"><span class="cl">Stepping:              1
</span></span><span class="line"><span class="cl">CPU MHz:               2500.000
</span></span><span class="line"><span class="cl">CPU max MHz:           3000.0000
</span></span><span class="line"><span class="cl">CPU min MHz:           1200.0000
</span></span><span class="line"><span class="cl">BogoMIPS:              5000.06
</span></span><span class="line"><span class="cl">Virtualization:        VT-x
</span></span><span class="line"><span class="cl">L1d cache:             32K
</span></span><span class="line"><span class="cl">L1i cache:             32K
</span></span><span class="line"><span class="cl">L2 cache:              256K
</span></span><span class="line"><span class="cl">L3 cache:              40960K
</span></span><span class="line"><span class="cl">NUMA node0 CPU(s):     0-15,32-47
</span></span><span class="line"><span class="cl">NUMA node1 CPU(s):     16-31,48-63</span></span></code></pre>
</div>
<h3 id="stream对比数据" class="headerLink">
    <a href="#stream%e5%af%b9%e6%af%94%e6%95%b0%e6%8d%ae" class="header-mark"></a>stream对比数据</h3><p>总结下几个CPU用stream测试访问内存的RT以及抖动和带宽对比数据</p>
<!-- raw HTML omitted -->
<p>从以上数据可以看出这5款CPU性能一款比一款好，飞腾2500慢的core上延时快到intel 8269的10倍了，平均延时5倍以上了。延时数据基本和单核上测试sysbench TPS一致。</p>
<h3 id="lat_mem_rd对比数据" class="headerLink">
    <a href="#lat_mem_rd%e5%af%b9%e6%af%94%e6%95%b0%e6%8d%ae" class="header-mark"></a>lat_mem_rd对比数据</h3><p>用不同的node上的core 跑lat_mem_rd测试访问node0内存的RT，只取最大64M的时延，时延和node距离完全一致，这里就不再列出测试原始数据了。</p>
<!-- raw HTML omitted -->
<p>测试命令：</p>
<div class="code-block highlight is-open show-line-numbers  tw-group tw-my-2">
  <div class="
    code-block-title 
    
    tw-flex 
    tw-flex-row 
    tw-justify-between 
    tw-w-full tw-bg-bgColor-secondary
    ">      
    <button 
      class="
        tw-select-none 
        tw-mx-2 
        tw-block
        group-[.is-open]:tw-rotate-90
        tw-transition-[transform] 
        tw-duration-500 
        tw-ease-in-out
        print:!tw-hidden"
      disabled
      aria-hidden="true"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M285.476 272.971L91.132 467.314c-9.373 9.373-24.569 9.373-33.941 0l-22.667-22.667c-9.357-9.357-9.375-24.522-.04-33.901L188.505 256 34.484 101.255c-9.335-9.379-9.317-24.544.04-33.901l22.667-22.667c9.373-9.373 24.569-9.373 33.941 0L285.475 239.03c9.373 9.372 9.373 24.568.001 33.941z"/></svg></button>

    <div class="code-block-title-bar tw-w-full">
      <p class="tw-select-none !tw-my-1">text</p>
    </div>
    <div class="tw-flex">
      <button 
        class="
          line-number-button
          tw-select-none 
          tw-mx-2 
          tw-hidden 
          group-[.is-open]:tw-block 
          group-[.show-line-numbers]:tw-text-fgColor-link 
          print:!tw-hidden" 
        title="Toggle line numbers"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M61.77 401l17.5-20.15a19.92 19.92 0 0 0 5.07-14.19v-3.31C84.34 356 80.5 352 73 352H16a8 8 0 0 0-8 8v16a8 8 0 0 0 8 8h22.83a157.41 157.41 0 0 0-11 12.31l-5.61 7c-4 5.07-5.25 10.13-2.8 14.88l1.05 1.93c3 5.76 6.29 7.88 12.25 7.88h4.73c10.33 0 15.94 2.44 15.94 9.09 0 4.72-4.2 8.22-14.36 8.22a41.54 41.54 0 0 1-15.47-3.12c-6.49-3.88-11.74-3.5-15.6 3.12l-5.59 9.31c-3.72 6.13-3.19 11.72 2.63 15.94 7.71 4.69 20.38 9.44 37 9.44 34.16 0 48.5-22.75 48.5-44.12-.03-14.38-9.12-29.76-28.73-34.88zM496 224H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zm0-160H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16V80a16 16 0 0 0-16-16zm0 320H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zM16 160h64a8 8 0 0 0 8-8v-16a8 8 0 0 0-8-8H64V40a8 8 0 0 0-8-8H32a8 8 0 0 0-7.14 4.42l-8 16A8 8 0 0 0 24 64h8v64H16a8 8 0 0 0-8 8v16a8 8 0 0 0 8 8zm-3.91 160H80a8 8 0 0 0 8-8v-16a8 8 0 0 0-8-8H41.32c3.29-10.29 48.34-18.68 48.34-56.44 0-29.06-25-39.56-44.47-39.56-21.36 0-33.8 10-40.46 18.75-4.37 5.59-3 10.84 2.8 15.37l8.58 6.88c5.61 4.56 11 2.47 16.12-2.44a13.44 13.44 0 0 1 9.46-3.84c3.33 0 9.28 1.56 9.28 8.75C51 248.19 0 257.31 0 304.59v4C0 316 5.08 320 12.09 320z"/></svg></button>

      <button 
        class="
          wrap-code-button
          tw-select-none 
          tw-mx-2 
          tw-hidden 
          group-[.is-open]:tw-block 
          group-[.is-wrap]:tw-text-fgColor-link 
          print:!tw-hidden" 
        title="Toggle code wrap"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M16 132h416c8.837 0 16-7.163 16-16V76c0-8.837-7.163-16-16-16H16C7.163 60 0 67.163 0 76v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16z"/></svg></button>
      
      <button 
        class="
          copy-code-button
          tw-select-none
          tw-mx-2 
          tw-hidden
          group-[.is-open]:tw-block
          hover:tw-text-fgColor-link 
          print:!tw-hidden"
        title="Copy code">
          <span class="copy-icon tw-block"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M433.941 65.941l-51.882-51.882A48 48 0 0 0 348.118 0H176c-26.51 0-48 21.49-48 48v48H48c-26.51 0-48 21.49-48 48v320c0 26.51 21.49 48 48 48h224c26.51 0 48-21.49 48-48v-48h80c26.51 0 48-21.49 48-48V99.882a48 48 0 0 0-14.059-33.941zM266 464H54a6 6 0 0 1-6-6V150a6 6 0 0 1 6-6h74v224c0 26.51 21.49 48 48 48h96v42a6 6 0 0 1-6 6zm128-96H182a6 6 0 0 1-6-6V54a6 6 0 0 1 6-6h106v88c0 13.255 10.745 24 24 24h88v202a6 6 0 0 1-6 6zm6-256h-64V48h9.632c1.591 0 3.117.632 4.243 1.757l48.368 48.368a6 6 0 0 1 1.757 4.243V112z"/></svg></span>
          <span class="check-icon tw-hidden"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M173.898 439.404l-166.4-166.4c-9.997-9.997-9.997-26.206 0-36.204l36.203-36.204c9.997-9.998 26.207-9.998 36.204 0L192 312.69 432.095 72.596c9.997-9.997 26.207-9.997 36.204 0l36.203 36.204c9.997 9.997 9.997 26.206 0 36.204l-294.4 294.401c-9.998 9.997-26.207 9.997-36.204-.001z"/></svg></span>
      </button>
        
      <button 
        class="
          tw-select-none 
          tw-mx-2 
          tw-block 
          group-[.is-open]:tw-hidden 
          print:!tw-hidden" 
        disabled
        aria-hidden="true"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M328 256c0 39.8-32.2 72-72 72s-72-32.2-72-72 32.2-72 72-72 72 32.2 72 72zm104-72c-39.8 0-72 32.2-72 72s32.2 72 72 72 72-32.2 72-72-32.2-72-72-72zm-352 0c-39.8 0-72 32.2-72 72s32.2 72 72 72 72-32.2 72-72-32.2-72-72-72z"/></svg></button>
    </div>
  </div>
  <pre style="counter-reset: codeblock;" class="tw-block tw-m-0 tw-p-0"><code 
    id="codeblock-id-15" 
    class="
      chroma 
      !tw-block 
      tw-p-0
      tw-m-0
      tw-transition-[max-height] 
      tw-duration-500 
      tw-ease-in-out 
      group-[.is-closed]:!tw-max-h-0 
      group-[.is-wrap]:tw-text-wrap
      tw-overflow-y-hidden
      tw-overflow-x-auto
      tw-scrollbar-thin
      "><span class="line"><span class="cl">for i in $(seq 0 8 127); do echo core:$i; numactl -C $i -m 0 ./bin/lat_mem_rd -W 5 -N 5 -t 64M; done &gt;lat.log 2&gt;&amp;1</span></span></code></pre>
</div>
<p>测试结果和numactl -H 看到的node distance完全一致，芯片厂家应该就是这样测试然后把这个延迟当做距离写进去了</p>
<p>最后用一张实际测试Inte E5 L1 、L2、L3的cache延时图来加深印象，可以看到在每级cache大小附近时延有个跳跃：
<img class="tw-inline" loading="lazy" src=https://cdn.jsdelivr.net/gh/plantegg/plantegg.github.io/images/951413iMgBlog/1647854557128-f35192b1-c1a4-4f19-b19d-41713ced19d6.png   alt="undefined"  >
纵坐标是访问延时 纳秒，横坐标是cache大小 M，为什么上图没放内存延时，因为延时太大，放出来就把L1、L2的跳跃台阶压平了</p>
<h2 id="结论" class="headerLink">
    <a href="#%e7%bb%93%e8%ae%ba" class="header-mark"></a>结论</h2><ul>
<li>X86比ARM性能要好</li>
<li>AMD和Intel单核基本差别不大，Intel适合要求核多的大实例，AMD适合云上拆分售卖</li>
<li>国产CPU还有比较大的进步空间</li>
<li>性能上的差异在数据库场景下归因下来主要在CPU访问内存的时延上</li>
<li>跨Numa Node时延差异很大，一定要开NUMA 就近访问内存</li>
<li>数据库场景下大实例因为锁导致CPU很难跑满，建议 <a href="https://www.aliyun.com/product/drds?spm=5176.19720258.J_8058803260.33.e9392c4aRo26Yg" target="_blank" rel="noopener noreferrer">分库分表搞多个mysqld实例</a></li>
</ul>
<p><strong>如果你一定要知道一块CPU性能的话先看 内存延时 而不是 主频</strong>，各种CPU自家打榜一般都是简单计算场景，内存访问不多，但是实际业务中大部分时候又是高频访问内存的。</p>
<h2 id="参考资料" class="headerLink">
    <a href="#%e5%8f%82%e8%80%83%e8%b5%84%e6%96%99" class="header-mark"></a>参考资料</h2><p><a href="https://zhuanlan.zhihu.com/p/387117470" target="_blank" rel="noopener noreferrer">十年后数据库还是不敢拥抱NUMA？</a>
<a href="https://plantegg.github.io/2019/12/16/Intel%20PAUSE%E6%8C%87%E4%BB%A4%E5%8F%98%E5%8C%96%E6%98%AF%E5%A6%82%E4%BD%95%E5%BD%B1%E5%93%8D%E8%87%AA%E6%97%8B%E9%94%81%E4%BB%A5%E5%8F%8AMySQL%E7%9A%84%E6%80%A7%E8%83%BD%E7%9A%84/" target="_blank" rel="noopener noreferrer">Intel PAUSE指令变化是如何影响自旋锁以及MySQL的性能的</a>
<a href="https://blog.csdn.net/xuanjian_bjtu/article/details/107178226" target="_blank" rel="noopener noreferrer">lmbench测试要考虑cache等</a>
<a href="https://zhuanlan.zhihu.com/p/385518829" target="_blank" rel="noopener noreferrer">CPU的制造和概念</a>
<a href="https://zhuanlan.zhihu.com/p/385519863" target="_blank" rel="noopener noreferrer">CPU 性能和Cache Line</a>
<a href="https://zhuanlan.zhihu.com/p/385519404" target="_blank" rel="noopener noreferrer">Perf IPC以及CPU性能</a>
<a href="https://plantegg.github.io/2021/07/19/CPU%E6%80%A7%E8%83%BD%E5%92%8CCACHE/" target="_blank" rel="noopener noreferrer">CPU性能和CACHE</a></p>
]]></description>
</item></channel>
</rss>
