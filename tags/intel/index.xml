<rss xmlns:atom="http://www.w3.org/2005/Atom" version="2.0">
    <channel>
        <title>Intel - 标签 - plantegg</title>
        <link>http://localhost:1313/tags/intel/</link>
        <description>Intel - 标签 - plantegg</description>
        <generator>Hugo -- gohugo.io</generator><language>zh-Hans</language><lastBuildDate>Sat, 01 Jan 2022 12:30:03 &#43;0000</lastBuildDate><atom:link href="http://localhost:1313/tags/intel/" rel="self" type="application/rss+xml" /><item>
    <title>Apple M1 Pro 和 Intel I9-12900K到底谁强</title>
    <link>http://localhost:1313/posts/apple_m1_pro%E5%92%8Cintel_i9-12900k%E8%B0%81%E5%BC%BA/</link>
    <pubDate>Sat, 01 Jan 2022 12:30:03 &#43;0000</pubDate><author>
        <name>作者</name>
    </author><guid>http://localhost:1313/posts/apple_m1_pro%E5%92%8Cintel_i9-12900k%E8%B0%81%E5%BC%BA/</guid>
    <description><![CDATA[<h1 id="apple-m1-pro-和-intel-i9-12900k到底谁强" class="headerLink">
    <a href="#apple-m1-pro-%e5%92%8c-intel-i9-12900k%e5%88%b0%e5%ba%95%e8%b0%81%e5%bc%ba" class="header-mark"></a>Apple M1 Pro 和 Intel I9-12900K到底谁强</h1><p>主要比较 M1 Pro和 I9-12900K，从芯片的参数来分析他们的差异。不和M1Max、M1Ultra比是因为从成本看没有可比性，M1Max、M1Ultra应该比I9贵多了，比起来意义不大，M1Max、M1Ultra的场景不一样。结论在最后</p>
<p>网上很多拿I9-12900K和M1 Max比实际没有意义，CPU core方面M1 Max和M1 Pro是一样的（跑分结果一样），干嘛不挑个便宜的去比较！</p>
<h2 id="the-m1-pro" class="headerLink">
    <a href="#the-m1-pro" class="header-mark"></a><strong>The M1 Pro</strong></h2><p>The M1 Pro takes this higher, with:</p>
<ul>
<li>33.7 billion transistors on a 240mm squared die.</li>
<li>8 performance cores, 24MB L2 Cache，每个core 3MB，cache跟不要钱一样的堆</li>
<li>2 efficiency cores with 4MB L2 cache，每个core 2MB</li>
<li>16 GPU Cores.</li>
<li>32GB DDR5 memory at 200GB/s.</li>
</ul>
<p><img class="tw-inline" loading="lazy" src=https://cdn.jsdelivr.net/gh/plantegg/plantegg.github.io/images/951413iMgBlog/image-20220402101632476-8873839.png   alt="image-20220402101632476"  ></p>
<p><strong>从性能来看不推荐买M1</strong>，内存还是DDR4，M1Pro以上就都是DDR5了（文后有惊喜告诉你怎么用M1的价格买到M1 Pro）</p>
<p><img class="tw-inline" loading="lazy" src=https://cdn.jsdelivr.net/gh/plantegg/plantegg.github.io/images/951413iMgBlog/image-20220402104020407-8873873.png   alt="image-20220402104020407"  ></p>
<p>上图中PCPU就是高性能核，共8个，PCPU左边的是低频节能的2个ECPU，机器不忙的时候可以用ECPU，节能。一旦有复杂任务就可以用PCPU。至于M1 Max在狂堆 GPU, 然后M1 Ultra学习AMD把两块M1 Max封装在一起，有没有用就看你的应用场景了，比如搞程序编译、跑跑Idea用M1 Pro就够了，没必要多花几倍的钱用在GPU上，搞视频编辑、图片处理可以考虑Max、Ultra。</p>
<h3 id="the-m1-max" class="headerLink">
    <a href="#the-m1-max" class="header-mark"></a><strong>The M1 Max</strong></h3><p>The M1 Max provides:（相对M1 Pro主要是多堆了 16个GPU，CPU方面是一样的，大多数跑分是M1 Pro和Max几乎一样，多花钱买那16个GPU不一定值得）</p>
<ul>
<li>57 billion transistors on a 420mm squared die.</li>
<li>8 performance cores, 24MB L2 Cache.</li>
<li>2 efficiency cores with 4MB L2 cache.</li>
<li>32 GPU Cores.</li>
<li>64GB DDR5 memory at 400GB/s.</li>
</ul>
<h3 id="and-the-new-m1-ultra" class="headerLink">
    <a href="#and-the-new-m1-ultra" class="header-mark"></a><strong>And the new M1 Ultra</strong></h3><p>The M1 Ultra brings you:（下面的数据完全是M1 Max的2倍，实际就是封装两块M1 Max）</p>
<ul>
<li>114 billion transistors on a 840mm squared die.</li>
<li>16 performance cores, 48MB L2 Cache.</li>
<li>4 efficiency cores with 4MB L2 cache.</li>
<li>64 GPU Cores.</li>
<li>Up to 128GB DDR5 memory at 800GB/s.</li>
</ul>
<h3 id="m1-pro主板拆解" class="headerLink">
    <a href="#m1-pro%e4%b8%bb%e6%9d%bf%e6%8b%86%e8%a7%a3" class="header-mark"></a>M1 Pro主板拆解</h3><p><img class="tw-inline" loading="lazy" src=https://cdn.jsdelivr.net/gh/plantegg/plantegg.github.io/images/951413iMgBlog/image-20220506142049220.png   alt="image-20220506142049220"  ></p>
<p>上图中，红框是 M1 Pro 芯片，黄框是三星 8GB 内存（共两块），绿框是铠侠的 128GB 闪存（共两块）。</p>
<h2 id="inel-i9-12900k" class="headerLink">
    <a href="#inel-i9-12900k" class="header-mark"></a>Inel I9-12900K</h2><p>对比下 i9-12900K，i9也有GPU只是没有说多少个，它的GPU频率在0.3到1.55GHz之间</p>
<p><img class="tw-inline" loading="lazy" src=https://cdn.jsdelivr.net/gh/plantegg/plantegg.github.io/images/951413iMgBlog/400px-alder_lake_die_2.png   alt="alder lake die 2.png"  ></p>

<div class="table-wrapper">
  <table>
    <thead>
        <tr>
            <th style="text-align: ">ISA</th>
            <th style="text-align: ">x86-64 (x86)</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td style="text-align: ">Microarchitecture</td>
            <td style="text-align: "><a href="https://en.wikichip.org/wiki/intel/microarchitectures/alder_lake" target="_blank" rel="noopener noreferrer">Alder Lake</a>, <a href="https://en.wikichip.org/wiki/intel/microarchitectures/golden_cove" target="_blank" rel="noopener noreferrer">Golden Cove</a>, <a href="https://en.wikichip.org/wiki/intel/microarchitectures/gracemont" target="_blank" rel="noopener noreferrer">Gracemont</a></td>
        </tr>
        <tr>
            <td style="text-align: ">Process</td>
            <td style="text-align: "><a href="https://en.wikichip.org/w/index.php?title=Intel_7_process&amp;action=edit&amp;redlink=1" target="_blank" rel="noopener noreferrer">Intel 7</a></td>
        </tr>
        <tr>
            <td style="text-align: ">Die</td>
            <td style="text-align: ">215.25 mm²&quot; 20.5 mm × 10.5 mm</td>
        </tr>
        <tr>
            <td style="text-align: ">MCP</td>
            <td style="text-align: ">No (1 dies)</td>
        </tr>
        <tr>
            <td style="text-align: ">Cores</td>
            <td style="text-align: ">16</td>
        </tr>
        <tr>
            <td style="text-align: ">Threads</td>
            <td style="text-align: ">24</td>
        </tr>
        <tr>
            <td style="text-align: "><a href="https://en.wikichip.org/wiki/Property:l1$_size" target="_blank" rel="noopener noreferrer">l1$ size</a></td>
            <td style="text-align: ">0.75 MiB (768 KiB, 786,432 B, 7.324219e-4 GiB) <a href="https://en.wikichip.org/wiki/Special:SearchByProperty/:l1-24-20size/0.75-20MiB" target="_blank" rel="noopener noreferrer">+</a> and 0.625 MiB (640 KiB, 655,360 B, 6.103516e-4 GiB) <a href="https://en.wikichip.org/wiki/Special:SearchByProperty/:l1-24-20size/0.625-20MiB" target="_blank" rel="noopener noreferrer">+</a></td>
        </tr>
        <tr>
            <td style="text-align: "><a href="https://en.wikichip.org/wiki/Property:l1d$_size" target="_blank" rel="noopener noreferrer">l1d$ size</a></td>
            <td style="text-align: ">0.25 MiB (256 KiB, 262,144 B, 2.441406e-4 GiB) <a href="https://en.wikichip.org/wiki/Special:SearchByProperty/:l1d-24-20size/0.25-20MiB" target="_blank" rel="noopener noreferrer">+</a> and 0.375 MiB (384 KiB, 393,216 B, 3.662109e-4 GiB) <a href="https://en.wikichip.org/wiki/Special:SearchByProperty/:l1d-24-20size/0.375-20MiB" target="_blank" rel="noopener noreferrer">+</a></td>
        </tr>
        <tr>
            <td style="text-align: "><a href="https://en.wikichip.org/wiki/Property:l1i$_size" target="_blank" rel="noopener noreferrer">l1i$ size</a></td>
            <td style="text-align: ">0.5 MiB (512 KiB, 524,288 B, 4.882812e-4 GiB) <a href="https://en.wikichip.org/wiki/Special:SearchByProperty/:l1i-24-20size/0.5-20MiB" target="_blank" rel="noopener noreferrer">+</a> and 0.25 MiB (256 KiB, 262,144 B, 2.441406e-4 GiB) <a href="https://en.wikichip.org/wiki/Special:SearchByProperty/:l1i-24-20size/0.25-20MiB" target="_blank" rel="noopener noreferrer">+</a></td>
        </tr>
        <tr>
            <td style="text-align: "><a href="https://en.wikichip.org/wiki/Property:l2$_size" target="_blank" rel="noopener noreferrer">l2$ size</a></td>
            <td style="text-align: ">4 MiB (4,096 KiB, 4,194,304 B, 0.00391 GiB) <a href="https://en.wikichip.org/wiki/Special:SearchByProperty/:l2-24-20size/4-20MiB" target="_blank" rel="noopener noreferrer">+</a> and 10 MiB (10,240 KiB, 10,485,760 B, 0.00977 GiB) <a href="https://en.wikichip.org/wiki/Special:SearchByProperty/:l2-24-20size/10-20MiB" target="_blank" rel="noopener noreferrer">+</a> 共14Mb</td>
        </tr>
        <tr>
            <td style="text-align: "><a href="https://en.wikichip.org/wiki/Property:l3$_size" target="_blank" rel="noopener noreferrer">l3$ size</a></td>
            <td style="text-align: ">6 MiB (6,144 KiB, 6,291,456 B, 0.00586 GiB) <a href="https://en.wikichip.org/wiki/Special:SearchByProperty/:l3-24-20size/6-20MiB" target="_blank" rel="noopener noreferrer">+</a> and 24 MiB (24,576 KiB, 25,165,824 B, 0.0234 GiB) <a href="https://en.wikichip.org/wiki/Special:SearchByProperty/:l3-24-20size/24-20MiB" target="_blank" rel="noopener noreferrer">+</a> 共30Mb</td>
        </tr>
        <tr>
            <td style="text-align: ">TDP</td>
            <td style="text-align: ">125 W</td>
        </tr>
    </tbody>
  </table>
</div>
<p>从下面的芯片分布图来看，绿色部分是8个高性能物理core，每个2 thread，绿色其右边的蓝色E Cores是8个低频节能core，没开超线程，所以24个threads就是2*8PCPU+8ECPU。真正打起仗来从蓝色部分的面积占比来看基本可以忽略，重点得靠绿色的PCPU。</p>
<p><img class="tw-inline" loading="lazy" src=https://cdn.jsdelivr.net/gh/plantegg/plantegg.github.io/images/951413iMgBlog/arch2_small.jpg   alt="img"  ></p>
<h2 id="性能比较" class="headerLink">
    <a href="#%e6%80%a7%e8%83%bd%e6%af%94%e8%be%83" class="header-mark"></a>性能比较</h2><p>从上面分析来看 I9-12900K和M1 Pro的比较最终回到了各自8个PCPU的较量。Intel/X86的超线程在大部分场景下可以提升单核计算能力的1.5倍左右，所以这里就是Intel的12core打M1 Pro的，另外Intel主频也比M1 Pro要高，如果比较单core的计算能力Intel能睿频到5GHz以上，所以不考虑视频、图片、矩阵等简单计算场景，Intel的性能应该还是要强很多的。但是如果作为笔记本来说一定要考虑功耗，125W VS 45W，我的建议是买Apple（M1的软件兼容性也是个问题）。如果是当服务器工作站使用还是建议买I9. 价钱就不好比较了M1 Pro不单独卖没法估计价格。</p>
<p>I9弱在内存还是DDR4，而M1 Pro是DDR5了，另外就是M1 Pro的L2要大。当然I9也有DDR5的内存的。</p>
<p>笔记本领域M1整体来看应该优势明显，尤其是经过几年的生态发展能够把软件生态补上的话。</p>
<h2 id="购买建议" class="headerLink">
    <a href="#%e8%b4%ad%e4%b9%b0%e5%bb%ba%e8%ae%ae" class="header-mark"></a>购买建议</h2><p>如果想买苹果，推荐买这款：</p>
<p><img class="tw-inline" loading="lazy" src=https://cdn.jsdelivr.net/gh/plantegg/plantegg.github.io/images/951413iMgBlog/image-20220402103153047-8874337.png   alt="image-20220402103153047"  ></p>
<p>这种<a href="https://ata.alibaba-inc.com/articles/211563" target="_blank" rel="noopener noreferrer">非标8核的M1（就是10核关闭了2核），便宜了2500，特别值</a>。苹果从来没有发布过8核的M1 Pro芯片，但是这款售卖的CPU号称是M1 Pro，比正常的M1 Pro少了两个CPU core和两个GPU。这点差异是不会重新设计一个新的芯片多搞一条生产线的，一般是正常的M1 Pro生产线下来检测发现坏了个别的core，扔了太浪费，于是关掉坏core当低配的M1 Pro在卖，价钱便宜了快一半了，实际性能其实差得不多。</p>
<p>如果是买Intel i9的话，从性价比上来看如果能买到i5-12600K也是非常不错的，实际就是i9关掉(坏掉)了2个PCPU和4个ECPU，价钱是i9的一半不到，PCPU少了但是Base主频反而高了，因为总核少了，发热就能控制，所以单核能跑到的频率更高一些。</p>
<p><img class="tw-inline" loading="lazy" src=https://cdn.jsdelivr.net/gh/plantegg/plantegg.github.io/images/951413iMgBlog/image_19.jpg   alt="image 19"  ></p>
<p>其实I9、I7、I5都是同一条生产线、同样的工艺下制造出来的，差别在于帮I9分摊成本，比如你看看<a href="https://en.wikichip.org/wiki/intel/core_i5/i5-12600k" target="_blank" rel="noopener noreferrer">i5-12600k的参数</a>和i9-12900K基本是一样的，重点在215.25 mm² 的 Die Size：</p>

<div class="table-wrapper">
  <table>
    <thead>
        <tr>
            <th style="text-align: ">ISA</th>
            <th style="text-align: ">x86-64 (x86)</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td style="text-align: ">Microarchitecture</td>
            <td style="text-align: "><a href="https://en.wikichip.org/wiki/intel/microarchitectures/alder_lake" target="_blank" rel="noopener noreferrer">Alder Lake</a>, <a href="https://en.wikichip.org/wiki/intel/microarchitectures/golden_cove" target="_blank" rel="noopener noreferrer">Golden Cove</a>, <a href="https://en.wikichip.org/wiki/intel/microarchitectures/gracemont" target="_blank" rel="noopener noreferrer">Gracemont</a></td>
        </tr>
        <tr>
            <td style="text-align: ">Process</td>
            <td style="text-align: "><a href="https://en.wikichip.org/w/index.php?title=Intel_7_process&amp;action=edit&amp;redlink=1" target="_blank" rel="noopener noreferrer">Intel 7</a></td>
        </tr>
        <tr>
            <td style="text-align: ">Die</td>
            <td style="text-align: ">215.25 mm² 20.5 mm × 10.5 mm</td>
        </tr>
        <tr>
            <td style="text-align: ">Cores</td>
            <td style="text-align: ">10</td>
        </tr>
        <tr>
            <td style="text-align: ">Threads</td>
            <td style="text-align: ">16</td>
        </tr>
    </tbody>
  </table>
</div>
<p>即使把 <a href="https://www.techpowerup.com/review/intel-core-i5-12600k-alder-lake-12th-gen/2.html" target="_blank" rel="noopener noreferrer">i5-12600k拆开</a>用放大镜看也是和i9-12900K 一样的：</p>
<p><img class="tw-inline" loading="lazy" src=https://cdn.jsdelivr.net/gh/plantegg/plantegg.github.io/images/951413iMgBlog/arch1_small.jpg   alt="img"  ></p>
<h2 id="总结" class="headerLink">
    <a href="#%e6%80%bb%e7%bb%93" class="header-mark"></a>总结</h2><ul>
<li>笔记本建议买M1 Pro</li>
<li>M1和M1 Pro如果看重性能的话肯定要买M1 Pro了</li>
<li>M1 Pro 建议买8 core的，买到就是赚到</li>
<li>集团内M1 Pro想要轻便就选14寸的，综合考虑我还是推荐14寸的</li>
<li>I9的笔记本建议买I7、I5，平时使用性能差得不多</li>
<li>性能还是I9强，做服务器更合适</li>
</ul>
<p>最后我手里头既没有I9也没有M1，结论靠键盘 :)，买错了别找我。</p>
<h2 id="参考资料" class="headerLink">
    <a href="#%e5%8f%82%e8%80%83%e8%b5%84%e6%96%99" class="header-mark"></a>参考资料</h2><p><a href="https://ata.alibaba-inc.com/articles/211563" target="_blank" rel="noopener noreferrer">CPU的生产和概念</a></p>
]]></description>
</item><item>
    <title>Intel、海光、鲲鹏920、飞腾2500 CPU性能对比</title>
    <link>http://localhost:1313/posts/%E5%87%A0%E6%AC%BEcpu%E6%80%A7%E8%83%BD%E5%AF%B9%E6%AF%94/</link>
    <pubDate>Fri, 18 Jun 2021 17:30:03 &#43;0000</pubDate><author>
        <name>作者</name>
    </author><guid>http://localhost:1313/posts/%E5%87%A0%E6%AC%BEcpu%E6%80%A7%E8%83%BD%E5%AF%B9%E6%AF%94/</guid>
    <description><![CDATA[<h1 id="intel-海光-鲲鹏920-飞腾2500-cpu性能对比" class="headerLink">
    <a href="#intel-%e6%b5%b7%e5%85%89-%e9%b2%b2%e9%b9%8f920-%e9%a3%9e%e8%85%be2500-cpu%e6%80%a7%e8%83%bd%e5%af%b9%e6%af%94" class="header-mark"></a>Intel 海光 鲲鹏920 飞腾2500 CPU性能对比</h1><p>为了让程序能快点，特意了解了CPU的各种原理，比如多核、超线程、NUMA、睿频、功耗、GPU、大小核再到分支预测、cache_line失效、加锁代价、IPC等各种指标（都有对应的代码和测试数据）都会在这系列文章中得到答案。当然一定会有程序员最关心的分支预测案例、Disruptor无锁案例、cache_line伪共享案例等等。</p>
<p>这次让我们从最底层的沙子开始用8篇文章来回答各种疑问以及大量的实验对比案例和测试数据。</p>
<p>大的方面主要是从这几个疑问来写这些文章：</p>
<ul>
<li>同样程序为什么CPU跑到800%还不如CPU跑到200%快？</li>
<li>IPC背后的原理和和程序效率的关系？</li>
<li>为什么数据库领域都爱把NUMA关了，这对吗？</li>
<li>几个国产芯片的性能到底怎么样？</li>
</ul>
<h2 id="系列文章" class="headerLink">
    <a href="#%e7%b3%bb%e5%88%97%e6%96%87%e7%ab%a0" class="header-mark"></a>系列文章</h2><p><a href="/2021/06/01/CPU%e7%9a%84%e5%88%b6%e9%80%a0%e5%92%8c%e6%a6%82%e5%bf%b5/" rel="">CPU的制造和概念</a></p>
<p>[Perf IPC以及CPU性能](/2021/05/16/Perf IPC以及CPU利用率/)</p>
<p><a href="https://plantegg.github.io/2021/07/19/CPU%e6%80%a7%e8%83%bd%e5%92%8cCACHE/" target="_blank" rel="noopener noreferrer">CPU性能和CACHE</a></p>
<p>[CPU 性能和Cache Line](/2021/05/16/CPU Cache Line 和性能/)</p>
<p><a href="/2021/05/14/%e5%8d%81%e5%b9%b4%e5%90%8e%e6%95%b0%e6%8d%ae%e5%ba%93%e8%bf%98%e6%98%af%e4%b8%8d%e6%95%a2%e6%8b%a5%e6%8a%b1NUMA/" rel="">十年后数据库还是不敢拥抱NUMA？</a></p>
<p>[Intel PAUSE指令变化是如何影响自旋锁以及MySQL的性能的](/2019/12/16/Intel PAUSE指令变化是如何影响自旋锁以及MySQL的性能的/)</p>
<p><a href="/2021/06/18/%e5%87%a0%e6%ac%beCPU%e6%80%a7%e8%83%bd%e5%af%b9%e6%af%94/" rel="">Intel、海光、鲲鹏920、飞腾2500 CPU性能对比</a></p>
<p><a href="/2021/03/07/%e4%b8%80%e6%ac%a1%e6%b5%b7%e5%85%89%e7%89%a9%e7%90%86%e6%9c%ba%e8%b5%84%e6%ba%90%e7%ab%9e%e4%ba%89%e5%8e%8b%e6%b5%8b%e7%9a%84%e8%ae%b0%e5%bd%95/" rel="">一次海光物理机资源竞争压测的记录</a></p>
<p><a href="/2021/05/15/%e9%a3%9e%e8%85%beARM%e8%8a%af%e7%89%87-FT2500%e7%9a%84%e6%80%a7%e8%83%bd%e6%b5%8b%e8%af%95/" rel="">飞腾ARM芯片(FT2500)的性能测试</a></p>
<p>本篇是收尾篇，横向对比一下x86和ARM芯片，以及不同方案权衡下的性能比较</p>
<h2 id="cpu基本信息" class="headerLink">
    <a href="#cpu%e5%9f%ba%e6%9c%ac%e4%bf%a1%e6%81%af" class="header-mark"></a>CPU基本信息</h2><p><img class="tw-inline" loading="lazy" src=https://cdn.jsdelivr.net/gh/plantegg/plantegg.github.io/images/951413iMgBlog/image-20210723161314138.png   alt="image-20210723161314138"  ></p>
<h3 id="海光" class="headerLink">
    <a href="#%e6%b5%b7%e5%85%89" class="header-mark"></a>海光</h3><div class="code-block highlight is-open show-line-numbers  tw-group tw-my-2">
  <div class="
    code-block-title 
    
    tw-flex 
    tw-flex-row 
    tw-justify-between 
    tw-w-full tw-bg-bgColor-secondary
    ">      
    <button 
      class="
        tw-select-none 
        tw-mx-2 
        tw-block
        group-[.is-open]:tw-rotate-90
        tw-transition-[transform] 
        tw-duration-500 
        tw-ease-in-out
        print:!tw-hidden"
      disabled
      aria-hidden="true"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M285.476 272.971L91.132 467.314c-9.373 9.373-24.569 9.373-33.941 0l-22.667-22.667c-9.357-9.357-9.375-24.522-.04-33.901L188.505 256 34.484 101.255c-9.335-9.379-9.317-24.544.04-33.901l22.667-22.667c9.373-9.373 24.569-9.373 33.941 0L285.475 239.03c9.373 9.372 9.373 24.568.001 33.941z"/></svg></button>

    <div class="code-block-title-bar tw-w-full">
      <p class="tw-select-none !tw-my-1">text</p>
    </div>
    <div class="tw-flex">
      <button 
        class="
          line-number-button
          tw-select-none 
          tw-mx-2 
          tw-hidden 
          group-[.is-open]:tw-block 
          group-[.show-line-numbers]:tw-text-fgColor-link 
          print:!tw-hidden" 
        title="Toggle line numbers"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M61.77 401l17.5-20.15a19.92 19.92 0 0 0 5.07-14.19v-3.31C84.34 356 80.5 352 73 352H16a8 8 0 0 0-8 8v16a8 8 0 0 0 8 8h22.83a157.41 157.41 0 0 0-11 12.31l-5.61 7c-4 5.07-5.25 10.13-2.8 14.88l1.05 1.93c3 5.76 6.29 7.88 12.25 7.88h4.73c10.33 0 15.94 2.44 15.94 9.09 0 4.72-4.2 8.22-14.36 8.22a41.54 41.54 0 0 1-15.47-3.12c-6.49-3.88-11.74-3.5-15.6 3.12l-5.59 9.31c-3.72 6.13-3.19 11.72 2.63 15.94 7.71 4.69 20.38 9.44 37 9.44 34.16 0 48.5-22.75 48.5-44.12-.03-14.38-9.12-29.76-28.73-34.88zM496 224H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zm0-160H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16V80a16 16 0 0 0-16-16zm0 320H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zM16 160h64a8 8 0 0 0 8-8v-16a8 8 0 0 0-8-8H64V40a8 8 0 0 0-8-8H32a8 8 0 0 0-7.14 4.42l-8 16A8 8 0 0 0 24 64h8v64H16a8 8 0 0 0-8 8v16a8 8 0 0 0 8 8zm-3.91 160H80a8 8 0 0 0 8-8v-16a8 8 0 0 0-8-8H41.32c3.29-10.29 48.34-18.68 48.34-56.44 0-29.06-25-39.56-44.47-39.56-21.36 0-33.8 10-40.46 18.75-4.37 5.59-3 10.84 2.8 15.37l8.58 6.88c5.61 4.56 11 2.47 16.12-2.44a13.44 13.44 0 0 1 9.46-3.84c3.33 0 9.28 1.56 9.28 8.75C51 248.19 0 257.31 0 304.59v4C0 316 5.08 320 12.09 320z"/></svg></button>

      <button 
        class="
          wrap-code-button
          tw-select-none 
          tw-mx-2 
          tw-hidden 
          group-[.is-open]:tw-block 
          group-[.is-wrap]:tw-text-fgColor-link 
          print:!tw-hidden" 
        title="Toggle code wrap"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M16 132h416c8.837 0 16-7.163 16-16V76c0-8.837-7.163-16-16-16H16C7.163 60 0 67.163 0 76v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16z"/></svg></button>
      
      <button 
        class="
          copy-code-button
          tw-select-none
          tw-mx-2 
          tw-hidden
          group-[.is-open]:tw-block
          hover:tw-text-fgColor-link 
          print:!tw-hidden"
        title="Copy code">
          <span class="copy-icon tw-block"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M433.941 65.941l-51.882-51.882A48 48 0 0 0 348.118 0H176c-26.51 0-48 21.49-48 48v48H48c-26.51 0-48 21.49-48 48v320c0 26.51 21.49 48 48 48h224c26.51 0 48-21.49 48-48v-48h80c26.51 0 48-21.49 48-48V99.882a48 48 0 0 0-14.059-33.941zM266 464H54a6 6 0 0 1-6-6V150a6 6 0 0 1 6-6h74v224c0 26.51 21.49 48 48 48h96v42a6 6 0 0 1-6 6zm128-96H182a6 6 0 0 1-6-6V54a6 6 0 0 1 6-6h106v88c0 13.255 10.745 24 24 24h88v202a6 6 0 0 1-6 6zm6-256h-64V48h9.632c1.591 0 3.117.632 4.243 1.757l48.368 48.368a6 6 0 0 1 1.757 4.243V112z"/></svg></span>
          <span class="check-icon tw-hidden"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M173.898 439.404l-166.4-166.4c-9.997-9.997-9.997-26.206 0-36.204l36.203-36.204c9.997-9.998 26.207-9.998 36.204 0L192 312.69 432.095 72.596c9.997-9.997 26.207-9.997 36.204 0l36.203 36.204c9.997 9.997 9.997 26.206 0 36.204l-294.4 294.401c-9.998 9.997-26.207 9.997-36.204-.001z"/></svg></span>
      </button>
        
      <button 
        class="
          tw-select-none 
          tw-mx-2 
          tw-block 
          group-[.is-open]:tw-hidden 
          print:!tw-hidden" 
        disabled
        aria-hidden="true"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M328 256c0 39.8-32.2 72-72 72s-72-32.2-72-72 32.2-72 72-72 72 32.2 72 72zm104-72c-39.8 0-72 32.2-72 72s32.2 72 72 72 72-32.2 72-72-32.2-72-72-72zm-352 0c-39.8 0-72 32.2-72 72s32.2 72 72 72 72-32.2 72-72-32.2-72-72-72z"/></svg></button>
    </div>
  </div>
  <pre style="counter-reset: codeblock;" class="tw-block tw-m-0 tw-p-0"><code 
    id="codeblock-id-1" 
    class="
      chroma 
      !tw-block 
      tw-p-0
      tw-m-0
      tw-transition-[max-height] 
      tw-duration-500 
      tw-ease-in-out 
      group-[.is-closed]:!tw-max-h-0 
      group-[.is-wrap]:tw-text-wrap
      tw-overflow-y-hidden
      tw-overflow-x-auto
      tw-scrollbar-thin
      "><span class="line"><span class="cl"><span class="c1">#lscpu</span>
</span></span><span class="line"><span class="cl"><span class="n">Architecture</span><span class="p">:</span>          <span class="n">x86_64</span>
</span></span><span class="line"><span class="cl"><span class="n">CPU</span> <span class="n">op</span><span class="o">-</span><span class="n">mode</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>        <span class="mi">32</span><span class="o">-</span><span class="n">bit</span><span class="p">,</span> <span class="mi">64</span><span class="o">-</span><span class="n">bit</span>
</span></span><span class="line"><span class="cl"><span class="n">Byte</span> <span class="n">Order</span><span class="p">:</span>            <span class="n">Little</span> <span class="n">Endian</span>
</span></span><span class="line"><span class="cl"><span class="n">CPU</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>                <span class="mi">64</span>
</span></span><span class="line"><span class="cl"><span class="n">On</span><span class="o">-</span><span class="n">line</span> <span class="n">CPU</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="n">list</span><span class="p">:</span>   <span class="mi">0</span><span class="o">-</span><span class="mi">63</span>
</span></span><span class="line"><span class="cl"><span class="ne">Thread</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="n">per</span> <span class="n">core</span><span class="p">:</span>    <span class="mi">2</span>      <span class="o">//</span><span class="err">每个物理</span><span class="n">core有两个超线程</span>
</span></span><span class="line"><span class="cl"><span class="n">Core</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="n">per</span> <span class="n">socket</span><span class="p">:</span>    <span class="mi">16</span>     <span class="o">//</span><span class="err">每路</span><span class="mi">16</span><span class="err">个物理</span><span class="n">core</span>
</span></span><span class="line"><span class="cl"><span class="n">Socket</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>             <span class="mi">2</span>      <span class="o">//</span><span class="mi">2</span><span class="err">路</span>
</span></span><span class="line"><span class="cl"><span class="n">NUMA</span> <span class="n">node</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>          <span class="mi">4</span>
</span></span><span class="line"><span class="cl"><span class="n">Vendor</span> <span class="n">ID</span><span class="p">:</span>             <span class="n">HygonGenuine</span>
</span></span><span class="line"><span class="cl"><span class="n">CPU</span> <span class="n">family</span><span class="p">:</span>            <span class="mi">24</span>
</span></span><span class="line"><span class="cl"><span class="n">Model</span><span class="p">:</span>                 <span class="mi">1</span>
</span></span><span class="line"><span class="cl"><span class="n">Model</span> <span class="n">name</span><span class="p">:</span>            <span class="n">Hygon</span> <span class="n">C86</span> <span class="mi">5280</span> <span class="mi">16</span><span class="o">-</span><span class="n">core</span> <span class="n">Processor</span>
</span></span><span class="line"><span class="cl"><span class="n">Stepping</span><span class="p">:</span>              <span class="mi">1</span>
</span></span><span class="line"><span class="cl"><span class="n">CPU</span> <span class="n">MHz</span><span class="p">:</span>               <span class="mf">2455.552</span>
</span></span><span class="line"><span class="cl"><span class="n">CPU</span> <span class="nb">max</span> <span class="n">MHz</span><span class="p">:</span>           <span class="mf">2500.0000</span>
</span></span><span class="line"><span class="cl"><span class="n">CPU</span> <span class="nb">min</span> <span class="n">MHz</span><span class="p">:</span>           <span class="mf">1600.0000</span>
</span></span><span class="line"><span class="cl"><span class="n">BogoMIPS</span><span class="p">:</span>              <span class="mf">4999.26</span>
</span></span><span class="line"><span class="cl"><span class="n">Virtualization</span><span class="p">:</span>        <span class="n">AMD</span><span class="o">-</span><span class="n">V</span>
</span></span><span class="line"><span class="cl"><span class="n">L1d</span> <span class="n">cache</span><span class="p">:</span>             <span class="mi">32</span><span class="n">K</span>
</span></span><span class="line"><span class="cl"><span class="n">L1i</span> <span class="n">cache</span><span class="p">:</span>             <span class="mi">64</span><span class="n">K</span>
</span></span><span class="line"><span class="cl"><span class="n">L2</span> <span class="n">cache</span><span class="p">:</span>              <span class="mi">512</span><span class="n">K</span>
</span></span><span class="line"><span class="cl"><span class="n">L3</span> <span class="n">cache</span><span class="p">:</span>              <span class="mi">8192</span><span class="n">K</span>
</span></span><span class="line"><span class="cl"><span class="n">NUMA</span> <span class="n">node0</span> <span class="n">CPU</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>     <span class="mi">0</span><span class="o">-</span><span class="mi">7</span><span class="p">,</span><span class="mi">32</span><span class="o">-</span><span class="mi">39</span>
</span></span><span class="line"><span class="cl"><span class="n">NUMA</span> <span class="n">node1</span> <span class="n">CPU</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>     <span class="mi">8</span><span class="o">-</span><span class="mi">15</span><span class="p">,</span><span class="mi">40</span><span class="o">-</span><span class="mi">47</span>
</span></span><span class="line"><span class="cl"><span class="n">NUMA</span> <span class="n">node2</span> <span class="n">CPU</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>     <span class="mi">16</span><span class="o">-</span><span class="mi">23</span><span class="p">,</span><span class="mi">48</span><span class="o">-</span><span class="mi">55</span>
</span></span><span class="line"><span class="cl"><span class="n">NUMA</span> <span class="n">node3</span> <span class="n">CPU</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>     <span class="mi">24</span><span class="o">-</span><span class="mi">31</span><span class="p">,</span><span class="mi">56</span><span class="o">-</span><span class="mi">63</span>
</span></span><span class="line"><span class="cl"><span class="n">Flags</span><span class="p">:</span>                 <span class="n">fpu</span> <span class="n">vme</span> <span class="n">de</span> <span class="n">pse</span> <span class="n">tsc</span> <span class="n">msr</span> <span class="n">pae</span> <span class="n">mce</span> <span class="n">cx8</span> <span class="n">apic</span> <span class="n">sep</span> <span class="n">mtrr</span> <span class="n">pge</span> <span class="n">mca</span> <span class="n">cmov</span> <span class="n">pat</span> <span class="n">pse36</span> <span class="n">clflush</span> <span class="n">mmx</span> <span class="n">fxsr</span> <span class="n">sse</span> <span class="n">sse2</span> <span class="n">ht</span> <span class="n">syscall</span> <span class="n">nx</span> <span class="n">mmxext</span> <span class="n">fxsr_opt</span> <span class="n">pdpe1gb</span> <span class="n">rdtscp</span> <span class="n">lm</span> <span class="n">constant_tsc</span> <span class="n">rep_good</span> <span class="n">nopl</span> <span class="n">nonstop_tsc</span> <span class="n">cpuid</span> <span class="n">extd_apicid</span> <span class="n">amd_dcm</span> <span class="n">aperfmperf</span> <span class="n">pni</span> <span class="n">pclmulqdq</span> <span class="n">monitor</span> <span class="n">ssse3</span> <span class="n">fma</span> <span class="n">cx16</span> <span class="n">sse4_1</span> <span class="n">sse4_2</span> <span class="n">movbe</span> <span class="n">popcnt</span> <span class="n">xsave</span> <span class="n">avx</span> <span class="n">f16c</span> <span class="n">rdrand</span> <span class="n">lahf_lm</span> <span class="n">cmp_legacy</span> <span class="n">svm</span> <span class="n">extapic</span> <span class="n">cr8_legacy</span> <span class="n">abm</span> <span class="n">sse4a</span> <span class="n">misalignsse</span> <span class="mi">3</span><span class="n">dnowprefetch</span> <span class="n">osvw</span> <span class="n">skinit</span> <span class="n">wdt</span> <span class="n">tce</span> <span class="n">topoext</span> <span class="n">perfctr_core</span> <span class="n">perfctr_nb</span> <span class="n">bpext</span> <span class="n">perfctr_llc</span> <span class="n">mwaitx</span> <span class="n">cpb</span> <span class="n">hw_pstate</span> <span class="n">sme</span> <span class="n">ssbd</span> <span class="n">sev</span> <span class="n">ibpb</span> <span class="n">vmmcall</span> <span class="n">fsgsbase</span> <span class="n">bmi1</span> <span class="n">avx2</span> <span class="n">smep</span> <span class="n">bmi2</span> <span class="n">MySQLeed</span> <span class="n">adx</span> <span class="n">smap</span> <span class="n">clflushopt</span> <span class="n">sha_ni</span> <span class="n">xsaveopt</span> <span class="n">xsavec</span> <span class="n">xgetbv1</span> <span class="n">xsaves</span> <span class="n">clzero</span> <span class="n">irperf</span> <span class="n">xsaveerptr</span> <span class="n">arat</span> <span class="n">npt</span> <span class="n">lbrv</span> <span class="n">svm_lock</span> <span class="n">nrip_save</span> <span class="n">tsc_scale</span> <span class="n">vmcb_clean</span> <span class="n">flushbyasid</span> <span class="n">decodeassists</span> <span class="n">pausefilter</span> <span class="n">pfthreshold</span> <span class="n">avic</span> <span class="n">v_vmsave_vmload</span> <span class="n">vgif</span> <span class="n">overflow_recov</span> <span class="n">succor</span> <span class="n">smca</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#numactl -H</span>
</span></span><span class="line"><span class="cl"><span class="n">available</span><span class="p">:</span> <span class="mi">4</span> <span class="n">nodes</span> <span class="p">(</span><span class="mi">0</span><span class="o">-</span><span class="mi">3</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">node</span> <span class="mi">0</span> <span class="n">cpus</span><span class="p">:</span> <span class="mi">0</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span> <span class="mi">6</span> <span class="mi">7</span> <span class="mi">32</span> <span class="mi">33</span> <span class="mi">34</span> <span class="mi">35</span> <span class="mi">36</span> <span class="mi">37</span> <span class="mi">38</span> <span class="mi">39</span>
</span></span><span class="line"><span class="cl"><span class="n">node</span> <span class="mi">0</span> <span class="n">size</span><span class="p">:</span> <span class="mi">128854</span> <span class="n">MB</span>
</span></span><span class="line"><span class="cl"><span class="n">node</span> <span class="mi">0</span> <span class="n">free</span><span class="p">:</span> <span class="mi">89350</span> <span class="n">MB</span>
</span></span><span class="line"><span class="cl"><span class="n">node</span> <span class="mi">1</span> <span class="n">cpus</span><span class="p">:</span> <span class="mi">8</span> <span class="mi">9</span> <span class="mi">10</span> <span class="mi">11</span> <span class="mi">12</span> <span class="mi">13</span> <span class="mi">14</span> <span class="mi">15</span> <span class="mi">40</span> <span class="mi">41</span> <span class="mi">42</span> <span class="mi">43</span> <span class="mi">44</span> <span class="mi">45</span> <span class="mi">46</span> <span class="mi">47</span>
</span></span><span class="line"><span class="cl"><span class="n">node</span> <span class="mi">1</span> <span class="n">size</span><span class="p">:</span> <span class="mi">129019</span> <span class="n">MB</span>
</span></span><span class="line"><span class="cl"><span class="n">node</span> <span class="mi">1</span> <span class="n">free</span><span class="p">:</span> <span class="mi">89326</span> <span class="n">MB</span>
</span></span><span class="line"><span class="cl"><span class="n">node</span> <span class="mi">2</span> <span class="n">cpus</span><span class="p">:</span> <span class="mi">16</span> <span class="mi">17</span> <span class="mi">18</span> <span class="mi">19</span> <span class="mi">20</span> <span class="mi">21</span> <span class="mi">22</span> <span class="mi">23</span> <span class="mi">48</span> <span class="mi">49</span> <span class="mi">50</span> <span class="mi">51</span> <span class="mi">52</span> <span class="mi">53</span> <span class="mi">54</span> <span class="mi">55</span>
</span></span><span class="line"><span class="cl"><span class="n">node</span> <span class="mi">2</span> <span class="n">size</span><span class="p">:</span> <span class="mi">128965</span> <span class="n">MB</span>
</span></span><span class="line"><span class="cl"><span class="n">node</span> <span class="mi">2</span> <span class="n">free</span><span class="p">:</span> <span class="mi">86542</span> <span class="n">MB</span>
</span></span><span class="line"><span class="cl"><span class="n">node</span> <span class="mi">3</span> <span class="n">cpus</span><span class="p">:</span> <span class="mi">24</span> <span class="mi">25</span> <span class="mi">26</span> <span class="mi">27</span> <span class="mi">28</span> <span class="mi">29</span> <span class="mi">30</span> <span class="mi">31</span> <span class="mi">56</span> <span class="mi">57</span> <span class="mi">58</span> <span class="mi">59</span> <span class="mi">60</span> <span class="mi">61</span> <span class="mi">62</span> <span class="mi">63</span>
</span></span><span class="line"><span class="cl"><span class="n">node</span> <span class="mi">3</span> <span class="n">size</span><span class="p">:</span> <span class="mi">129020</span> <span class="n">MB</span>
</span></span><span class="line"><span class="cl"><span class="n">node</span> <span class="mi">3</span> <span class="n">free</span><span class="p">:</span> <span class="mi">98227</span> <span class="n">MB</span>
</span></span><span class="line"><span class="cl"><span class="n">node</span> <span class="n">distances</span><span class="p">:</span>
</span></span><span class="line"><span class="cl"><span class="n">node</span>   <span class="mi">0</span>   <span class="mi">1</span>   <span class="mi">2</span>   <span class="mi">3</span>
</span></span><span class="line"><span class="cl">  <span class="mi">0</span><span class="p">:</span>  <span class="mi">10</span>  <span class="mi">16</span>  <span class="mi">28</span>  <span class="mi">22</span>
</span></span><span class="line"><span class="cl">  <span class="mi">1</span><span class="p">:</span>  <span class="mi">16</span>  <span class="mi">10</span>  <span class="mi">22</span>  <span class="mi">28</span>
</span></span><span class="line"><span class="cl">  <span class="mi">2</span><span class="p">:</span>  <span class="mi">28</span>  <span class="mi">22</span>  <span class="mi">10</span>  <span class="mi">16</span>
</span></span><span class="line"><span class="cl">  <span class="mi">3</span><span class="p">:</span>  <span class="mi">22</span>  <span class="mi">28</span>  <span class="mi">16</span>  <span class="mi">10</span></span></span></code></pre>
</div>
<p>这CPU据说是胶水核，也就是把两个die拼一块封装成一块CPU，所以一块CPU内跨die之间延迟还是很高的。</p>
<h4 id="64-个-core-的分配策略" class="headerLink">
    <a href="#64-%e4%b8%aa-core-%e7%9a%84%e5%88%86%e9%85%8d%e7%ad%96%e7%95%a5" class="header-mark"></a>64 个 core 的分配策略</h4><div class="code-block highlight is-open show-line-numbers  tw-group tw-my-2">
  <div class="
    code-block-title 
    
    tw-flex 
    tw-flex-row 
    tw-justify-between 
    tw-w-full tw-bg-bgColor-secondary
    ">      
    <button 
      class="
        tw-select-none 
        tw-mx-2 
        tw-block
        group-[.is-open]:tw-rotate-90
        tw-transition-[transform] 
        tw-duration-500 
        tw-ease-in-out
        print:!tw-hidden"
      disabled
      aria-hidden="true"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M285.476 272.971L91.132 467.314c-9.373 9.373-24.569 9.373-33.941 0l-22.667-22.667c-9.357-9.357-9.375-24.522-.04-33.901L188.505 256 34.484 101.255c-9.335-9.379-9.317-24.544.04-33.901l22.667-22.667c9.373-9.373 24.569-9.373 33.941 0L285.475 239.03c9.373 9.372 9.373 24.568.001 33.941z"/></svg></button>

    <div class="code-block-title-bar tw-w-full">
      <p class="tw-select-none !tw-my-1">text</p>
    </div>
    <div class="tw-flex">
      <button 
        class="
          line-number-button
          tw-select-none 
          tw-mx-2 
          tw-hidden 
          group-[.is-open]:tw-block 
          group-[.show-line-numbers]:tw-text-fgColor-link 
          print:!tw-hidden" 
        title="Toggle line numbers"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M61.77 401l17.5-20.15a19.92 19.92 0 0 0 5.07-14.19v-3.31C84.34 356 80.5 352 73 352H16a8 8 0 0 0-8 8v16a8 8 0 0 0 8 8h22.83a157.41 157.41 0 0 0-11 12.31l-5.61 7c-4 5.07-5.25 10.13-2.8 14.88l1.05 1.93c3 5.76 6.29 7.88 12.25 7.88h4.73c10.33 0 15.94 2.44 15.94 9.09 0 4.72-4.2 8.22-14.36 8.22a41.54 41.54 0 0 1-15.47-3.12c-6.49-3.88-11.74-3.5-15.6 3.12l-5.59 9.31c-3.72 6.13-3.19 11.72 2.63 15.94 7.71 4.69 20.38 9.44 37 9.44 34.16 0 48.5-22.75 48.5-44.12-.03-14.38-9.12-29.76-28.73-34.88zM496 224H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zm0-160H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16V80a16 16 0 0 0-16-16zm0 320H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zM16 160h64a8 8 0 0 0 8-8v-16a8 8 0 0 0-8-8H64V40a8 8 0 0 0-8-8H32a8 8 0 0 0-7.14 4.42l-8 16A8 8 0 0 0 24 64h8v64H16a8 8 0 0 0-8 8v16a8 8 0 0 0 8 8zm-3.91 160H80a8 8 0 0 0 8-8v-16a8 8 0 0 0-8-8H41.32c3.29-10.29 48.34-18.68 48.34-56.44 0-29.06-25-39.56-44.47-39.56-21.36 0-33.8 10-40.46 18.75-4.37 5.59-3 10.84 2.8 15.37l8.58 6.88c5.61 4.56 11 2.47 16.12-2.44a13.44 13.44 0 0 1 9.46-3.84c3.33 0 9.28 1.56 9.28 8.75C51 248.19 0 257.31 0 304.59v4C0 316 5.08 320 12.09 320z"/></svg></button>

      <button 
        class="
          wrap-code-button
          tw-select-none 
          tw-mx-2 
          tw-hidden 
          group-[.is-open]:tw-block 
          group-[.is-wrap]:tw-text-fgColor-link 
          print:!tw-hidden" 
        title="Toggle code wrap"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M16 132h416c8.837 0 16-7.163 16-16V76c0-8.837-7.163-16-16-16H16C7.163 60 0 67.163 0 76v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16z"/></svg></button>
      
      <button 
        class="
          copy-code-button
          tw-select-none
          tw-mx-2 
          tw-hidden
          group-[.is-open]:tw-block
          hover:tw-text-fgColor-link 
          print:!tw-hidden"
        title="Copy code">
          <span class="copy-icon tw-block"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M433.941 65.941l-51.882-51.882A48 48 0 0 0 348.118 0H176c-26.51 0-48 21.49-48 48v48H48c-26.51 0-48 21.49-48 48v320c0 26.51 21.49 48 48 48h224c26.51 0 48-21.49 48-48v-48h80c26.51 0 48-21.49 48-48V99.882a48 48 0 0 0-14.059-33.941zM266 464H54a6 6 0 0 1-6-6V150a6 6 0 0 1 6-6h74v224c0 26.51 21.49 48 48 48h96v42a6 6 0 0 1-6 6zm128-96H182a6 6 0 0 1-6-6V54a6 6 0 0 1 6-6h106v88c0 13.255 10.745 24 24 24h88v202a6 6 0 0 1-6 6zm6-256h-64V48h9.632c1.591 0 3.117.632 4.243 1.757l48.368 48.368a6 6 0 0 1 1.757 4.243V112z"/></svg></span>
          <span class="check-icon tw-hidden"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M173.898 439.404l-166.4-166.4c-9.997-9.997-9.997-26.206 0-36.204l36.203-36.204c9.997-9.998 26.207-9.998 36.204 0L192 312.69 432.095 72.596c9.997-9.997 26.207-9.997 36.204 0l36.203 36.204c9.997 9.997 9.997 26.206 0 36.204l-294.4 294.401c-9.998 9.997-26.207 9.997-36.204-.001z"/></svg></span>
      </button>
        
      <button 
        class="
          tw-select-none 
          tw-mx-2 
          tw-block 
          group-[.is-open]:tw-hidden 
          print:!tw-hidden" 
        disabled
        aria-hidden="true"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M328 256c0 39.8-32.2 72-72 72s-72-32.2-72-72 32.2-72 72-72 72 32.2 72 72zm104-72c-39.8 0-72 32.2-72 72s32.2 72 72 72 72-32.2 72-72-32.2-72-72-72zm-352 0c-39.8 0-72 32.2-72 72s32.2 72 72 72 72-32.2 72-72-32.2-72-72-72z"/></svg></button>
    </div>
  </div>
  <pre style="counter-reset: codeblock;" class="tw-block tw-m-0 tw-p-0"><code 
    id="codeblock-id-2" 
    class="
      chroma 
      !tw-block 
      tw-p-0
      tw-m-0
      tw-transition-[max-height] 
      tw-duration-500 
      tw-ease-in-out 
      group-[.is-closed]:!tw-max-h-0 
      group-[.is-wrap]:tw-text-wrap
      tw-overflow-y-hidden
      tw-overflow-x-auto
      tw-scrollbar-thin
      "><span class="line"><span class="cl">physical         core      processor
</span></span><span class="line"><span class="cl">0                0~15         0~15
</span></span><span class="line"><span class="cl">1                0~15         16~31
</span></span><span class="line"><span class="cl">0                0~15         32~47
</span></span><span class="line"><span class="cl">1                0~15         48~63</span></span></code></pre>
</div>
<p><img class="tw-inline" loading="lazy" src=https://cdn.jsdelivr.net/gh/plantegg/plantegg.github.io/images/951413iMgBlog/image-20210805085715353.png   alt="image-20210805085715353"  ></p>
<h3 id="intel-cpu" class="headerLink">
    <a href="#intel-cpu" class="header-mark"></a>Intel CPU</h3><p><img class="tw-inline" loading="lazy" src=https://cdn.jsdelivr.net/gh/plantegg/plantegg.github.io/images/951413iMgBlog/750px-cascade_lake_naming_scheme.svg.png   alt="cascade lake naming scheme.svg"  ></p>
<p>Cascade Lake架构相对Broadwell L1没变，L2从256K增加到1M增加了4倍，L3从2.5下降到1.38M每core</p>
<div class="code-block highlight is-open show-line-numbers  tw-group tw-my-2">
  <div class="
    code-block-title 
    
    tw-flex 
    tw-flex-row 
    tw-justify-between 
    tw-w-full tw-bg-bgColor-secondary
    ">      
    <button 
      class="
        tw-select-none 
        tw-mx-2 
        tw-block
        group-[.is-open]:tw-rotate-90
        tw-transition-[transform] 
        tw-duration-500 
        tw-ease-in-out
        print:!tw-hidden"
      disabled
      aria-hidden="true"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M285.476 272.971L91.132 467.314c-9.373 9.373-24.569 9.373-33.941 0l-22.667-22.667c-9.357-9.357-9.375-24.522-.04-33.901L188.505 256 34.484 101.255c-9.335-9.379-9.317-24.544.04-33.901l22.667-22.667c9.373-9.373 24.569-9.373 33.941 0L285.475 239.03c9.373 9.372 9.373 24.568.001 33.941z"/></svg></button>

    <div class="code-block-title-bar tw-w-full">
      <p class="tw-select-none !tw-my-1">text</p>
    </div>
    <div class="tw-flex">
      <button 
        class="
          line-number-button
          tw-select-none 
          tw-mx-2 
          tw-hidden 
          group-[.is-open]:tw-block 
          group-[.show-line-numbers]:tw-text-fgColor-link 
          print:!tw-hidden" 
        title="Toggle line numbers"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M61.77 401l17.5-20.15a19.92 19.92 0 0 0 5.07-14.19v-3.31C84.34 356 80.5 352 73 352H16a8 8 0 0 0-8 8v16a8 8 0 0 0 8 8h22.83a157.41 157.41 0 0 0-11 12.31l-5.61 7c-4 5.07-5.25 10.13-2.8 14.88l1.05 1.93c3 5.76 6.29 7.88 12.25 7.88h4.73c10.33 0 15.94 2.44 15.94 9.09 0 4.72-4.2 8.22-14.36 8.22a41.54 41.54 0 0 1-15.47-3.12c-6.49-3.88-11.74-3.5-15.6 3.12l-5.59 9.31c-3.72 6.13-3.19 11.72 2.63 15.94 7.71 4.69 20.38 9.44 37 9.44 34.16 0 48.5-22.75 48.5-44.12-.03-14.38-9.12-29.76-28.73-34.88zM496 224H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zm0-160H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16V80a16 16 0 0 0-16-16zm0 320H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zM16 160h64a8 8 0 0 0 8-8v-16a8 8 0 0 0-8-8H64V40a8 8 0 0 0-8-8H32a8 8 0 0 0-7.14 4.42l-8 16A8 8 0 0 0 24 64h8v64H16a8 8 0 0 0-8 8v16a8 8 0 0 0 8 8zm-3.91 160H80a8 8 0 0 0 8-8v-16a8 8 0 0 0-8-8H41.32c3.29-10.29 48.34-18.68 48.34-56.44 0-29.06-25-39.56-44.47-39.56-21.36 0-33.8 10-40.46 18.75-4.37 5.59-3 10.84 2.8 15.37l8.58 6.88c5.61 4.56 11 2.47 16.12-2.44a13.44 13.44 0 0 1 9.46-3.84c3.33 0 9.28 1.56 9.28 8.75C51 248.19 0 257.31 0 304.59v4C0 316 5.08 320 12.09 320z"/></svg></button>

      <button 
        class="
          wrap-code-button
          tw-select-none 
          tw-mx-2 
          tw-hidden 
          group-[.is-open]:tw-block 
          group-[.is-wrap]:tw-text-fgColor-link 
          print:!tw-hidden" 
        title="Toggle code wrap"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M16 132h416c8.837 0 16-7.163 16-16V76c0-8.837-7.163-16-16-16H16C7.163 60 0 67.163 0 76v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16z"/></svg></button>
      
      <button 
        class="
          copy-code-button
          tw-select-none
          tw-mx-2 
          tw-hidden
          group-[.is-open]:tw-block
          hover:tw-text-fgColor-link 
          print:!tw-hidden"
        title="Copy code">
          <span class="copy-icon tw-block"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M433.941 65.941l-51.882-51.882A48 48 0 0 0 348.118 0H176c-26.51 0-48 21.49-48 48v48H48c-26.51 0-48 21.49-48 48v320c0 26.51 21.49 48 48 48h224c26.51 0 48-21.49 48-48v-48h80c26.51 0 48-21.49 48-48V99.882a48 48 0 0 0-14.059-33.941zM266 464H54a6 6 0 0 1-6-6V150a6 6 0 0 1 6-6h74v224c0 26.51 21.49 48 48 48h96v42a6 6 0 0 1-6 6zm128-96H182a6 6 0 0 1-6-6V54a6 6 0 0 1 6-6h106v88c0 13.255 10.745 24 24 24h88v202a6 6 0 0 1-6 6zm6-256h-64V48h9.632c1.591 0 3.117.632 4.243 1.757l48.368 48.368a6 6 0 0 1 1.757 4.243V112z"/></svg></span>
          <span class="check-icon tw-hidden"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M173.898 439.404l-166.4-166.4c-9.997-9.997-9.997-26.206 0-36.204l36.203-36.204c9.997-9.998 26.207-9.998 36.204 0L192 312.69 432.095 72.596c9.997-9.997 26.207-9.997 36.204 0l36.203 36.204c9.997 9.997 9.997 26.206 0 36.204l-294.4 294.401c-9.998 9.997-26.207 9.997-36.204-.001z"/></svg></span>
      </button>
        
      <button 
        class="
          tw-select-none 
          tw-mx-2 
          tw-block 
          group-[.is-open]:tw-hidden 
          print:!tw-hidden" 
        disabled
        aria-hidden="true"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M328 256c0 39.8-32.2 72-72 72s-72-32.2-72-72 32.2-72 72-72 72 32.2 72 72zm104-72c-39.8 0-72 32.2-72 72s32.2 72 72 72 72-32.2 72-72-32.2-72-72-72zm-352 0c-39.8 0-72 32.2-72 72s32.2 72 72 72 72-32.2 72-72-32.2-72-72-72z"/></svg></button>
    </div>
  </div>
  <pre style="counter-reset: codeblock;" class="tw-block tw-m-0 tw-p-0"><code 
    id="codeblock-id-3" 
    class="
      chroma 
      !tw-block 
      tw-p-0
      tw-m-0
      tw-transition-[max-height] 
      tw-duration-500 
      tw-ease-in-out 
      group-[.is-closed]:!tw-max-h-0 
      group-[.is-wrap]:tw-text-wrap
      tw-overflow-y-hidden
      tw-overflow-x-auto
      tw-scrollbar-thin
      "><span class="line"><span class="cl"><span class="c1">#lscpu</span>
</span></span><span class="line"><span class="cl"><span class="n">Architecture</span><span class="p">:</span>          <span class="n">x86_64</span>
</span></span><span class="line"><span class="cl"><span class="n">CPU</span> <span class="n">op</span><span class="o">-</span><span class="n">mode</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>        <span class="mi">32</span><span class="o">-</span><span class="n">bit</span><span class="p">,</span> <span class="mi">64</span><span class="o">-</span><span class="n">bit</span>
</span></span><span class="line"><span class="cl"><span class="n">Byte</span> <span class="n">Order</span><span class="p">:</span>            <span class="n">Little</span> <span class="n">Endian</span>
</span></span><span class="line"><span class="cl"><span class="n">CPU</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>                <span class="mi">104</span>
</span></span><span class="line"><span class="cl"><span class="n">On</span><span class="o">-</span><span class="n">line</span> <span class="n">CPU</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="n">list</span><span class="p">:</span>   <span class="mi">0</span><span class="o">-</span><span class="mi">103</span>
</span></span><span class="line"><span class="cl"><span class="ne">Thread</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="n">per</span> <span class="n">core</span><span class="p">:</span>    <span class="mi">2</span>
</span></span><span class="line"><span class="cl"><span class="n">Core</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="n">per</span> <span class="n">socket</span><span class="p">:</span>    <span class="mi">26</span>
</span></span><span class="line"><span class="cl"><span class="err">座：</span>                 <span class="mi">2</span>
</span></span><span class="line"><span class="cl"><span class="n">NUMA</span> <span class="err">节点：</span>         <span class="mi">1</span>
</span></span><span class="line"><span class="cl"><span class="err">厂商</span> <span class="n">ID</span><span class="err">：</span>           <span class="n">GenuineIntel</span>
</span></span><span class="line"><span class="cl"><span class="n">CPU</span> <span class="err">系列：</span>          <span class="mi">6</span>
</span></span><span class="line"><span class="cl"><span class="err">型号：</span>              <span class="mi">85</span>
</span></span><span class="line"><span class="cl"><span class="err">型号名称：</span>        <span class="n">Intel</span><span class="p">(</span><span class="n">R</span><span class="p">)</span> <span class="n">Xeon</span><span class="p">(</span><span class="n">R</span><span class="p">)</span> <span class="n">Platinum</span> <span class="mi">8269</span><span class="n">CY</span> <span class="n">CPU</span> <span class="err">@</span> <span class="mf">2.50</span><span class="n">GHz</span>
</span></span><span class="line"><span class="cl"><span class="err">步进：</span>              <span class="mi">7</span>
</span></span><span class="line"><span class="cl"><span class="n">CPU</span> <span class="n">MHz</span><span class="err">：</span>             <span class="mf">1200.000</span>
</span></span><span class="line"><span class="cl"><span class="n">CPU</span> <span class="nb">max</span> <span class="n">MHz</span><span class="p">:</span>           <span class="mf">2501.0000</span>
</span></span><span class="line"><span class="cl"><span class="n">CPU</span> <span class="nb">min</span> <span class="n">MHz</span><span class="p">:</span>           <span class="mf">1200.0000</span>
</span></span><span class="line"><span class="cl"><span class="n">BogoMIPS</span><span class="err">：</span>            <span class="mf">5000.00</span>
</span></span><span class="line"><span class="cl"><span class="err">虚拟化：</span>           <span class="n">VT</span><span class="o">-</span><span class="n">x</span>
</span></span><span class="line"><span class="cl"><span class="n">L1d</span> <span class="err">缓存：</span>          <span class="mi">32</span><span class="n">K</span>
</span></span><span class="line"><span class="cl"><span class="n">L1i</span> <span class="err">缓存：</span>          <span class="mi">32</span><span class="n">K</span>
</span></span><span class="line"><span class="cl"><span class="n">L2</span> <span class="err">缓存：</span>           <span class="mi">1024</span><span class="n">K</span>
</span></span><span class="line"><span class="cl"><span class="n">L3</span> <span class="err">缓存：</span>           <span class="mi">36608</span><span class="n">K</span>
</span></span><span class="line"><span class="cl"><span class="n">NUMA</span> <span class="err">节点</span><span class="mi">0</span> <span class="n">CPU</span><span class="err">：</span>    <span class="mi">0</span><span class="o">-</span><span class="mi">103</span>
</span></span><span class="line"><span class="cl"><span class="n">Flags</span><span class="p">:</span>                 <span class="n">fpu</span> <span class="n">vme</span> <span class="n">de</span> <span class="n">pse</span> <span class="n">tsc</span> <span class="n">msr</span> <span class="n">pae</span> <span class="n">mce</span> <span class="n">cx8</span> <span class="n">apic</span> <span class="n">sep</span> <span class="n">mtrr</span> <span class="n">pge</span> <span class="n">mca</span> <span class="n">cmov</span> <span class="n">pat</span> <span class="n">pse36</span> <span class="n">clflush</span> <span class="n">dts</span> <span class="n">acpi</span> <span class="n">mmx</span> <span class="n">fxsr</span> <span class="n">sse</span> <span class="n">sse2</span> <span class="n">ss</span> <span class="n">ht</span> <span class="n">tm</span> <span class="n">pbe</span> <span class="n">syscall</span> <span class="n">nx</span> <span class="n">pdpe1gb</span> <span class="n">rdtscp</span> <span class="n">lm</span> <span class="n">constant_tsc</span> <span class="n">art</span> <span class="n">arch_perfmon</span> <span class="n">pebs</span> <span class="n">bts</span> <span class="n">rep_good</span> <span class="n">nopl</span> <span class="n">xtopology</span> <span class="n">nonstop_tsc</span> <span class="n">aperfmperf</span> <span class="n">eagerfpu</span> <span class="n">pni</span> <span class="n">pclmulqdq</span> <span class="n">dtes64</span> <span class="n">monitor</span> <span class="n">ds_cpl</span> <span class="n">vmx</span> <span class="n">smx</span> <span class="n">est</span> <span class="n">tm2</span> <span class="n">ssse3</span> <span class="n">sdbg</span> <span class="n">fma</span> <span class="n">cx16</span> <span class="n">xtpr</span> <span class="n">pdcm</span> <span class="n">pcid</span> <span class="n">dca</span> <span class="n">sse4_1</span> <span class="n">sse4_2</span> <span class="n">x2apic</span> <span class="n">movbe</span> <span class="n">popcnt</span> <span class="n">tsc_deadline_timer</span> <span class="n">aes</span> <span class="n">xsave</span> <span class="n">avx</span> <span class="n">f16c</span> <span class="n">rdrand</span> <span class="n">lahf_lm</span> <span class="n">abm</span> <span class="mi">3</span><span class="n">dnowprefetch</span> <span class="n">epb</span> <span class="n">cat_l3</span> <span class="n">cdp_l3</span> <span class="n">intel_ppin</span> <span class="n">intel_pt</span> <span class="n">ssbd</span> <span class="n">mba</span> <span class="n">ibrs</span> <span class="n">ibpb</span> <span class="n">stibp</span> <span class="n">ibrs_enhanced</span> <span class="n">tpr_shadow</span> <span class="n">vnmi</span> <span class="n">flexpriority</span> <span class="n">ept</span> <span class="n">vpid</span> <span class="n">fsgsbase</span> <span class="n">tsc_adjust</span> <span class="n">bmi1</span> <span class="n">hle</span> <span class="n">avx2</span> <span class="n">smep</span> <span class="n">bmi2</span> <span class="n">erms</span> <span class="n">invpcid</span> <span class="n">rtm</span> <span class="n">cqm</span> <span class="n">mpx</span> <span class="n">rdt_a</span> <span class="n">avx512f</span> <span class="n">avx512dq</span> <span class="n">rdseed</span> <span class="n">adx</span> <span class="n">smap</span> <span class="n">clflushopt</span> <span class="n">clwb</span> <span class="n">avx512cd</span> <span class="n">avx512bw</span> <span class="n">avx512vl</span> <span class="n">xsaveopt</span> <span class="n">xsavec</span> <span class="n">xgetbv1</span> <span class="n">cqm_llc</span> <span class="n">cqm_occup_llc</span> <span class="n">cqm_mbm_total</span> <span class="n">cqm_mbm_local</span> <span class="n">dtherm</span> <span class="n">ida</span> <span class="n">arat</span> <span class="n">pln</span> <span class="n">pts</span> <span class="n">pku</span> <span class="n">ospke</span> <span class="n">avx512_vnni</span> <span class="n">spec_ctrl</span> <span class="n">intel_stibp</span> <span class="n">flush_l1d</span> <span class="n">arch_capabilities</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># numactl -H</span>
</span></span><span class="line"><span class="cl"><span class="n">available</span><span class="p">:</span> <span class="mi">1</span> <span class="n">nodes</span> <span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">node</span> <span class="mi">0</span> <span class="n">cpus</span><span class="p">:</span> <span class="mi">0</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span> <span class="mi">6</span> <span class="mi">7</span> <span class="mi">8</span> <span class="mi">9</span> <span class="mi">10</span> <span class="mi">11</span> <span class="mi">12</span> <span class="mi">13</span> <span class="mi">14</span> <span class="mi">15</span> <span class="mi">16</span> <span class="mi">17</span> <span class="mi">18</span> <span class="mi">19</span> <span class="mi">20</span> <span class="mi">21</span> <span class="mi">22</span> <span class="mi">23</span> <span class="mi">24</span> <span class="mi">25</span> <span class="mi">26</span> <span class="mi">27</span> <span class="mi">28</span> <span class="mi">29</span> <span class="mi">30</span> <span class="mi">31</span> <span class="mi">32</span> <span class="mi">33</span> <span class="mi">34</span> <span class="mi">35</span> <span class="mi">36</span> <span class="mi">37</span> <span class="mi">38</span> <span class="mi">39</span> <span class="mi">40</span> <span class="mi">41</span> <span class="mi">42</span> <span class="mi">43</span> <span class="mi">44</span> <span class="mi">45</span> <span class="mi">46</span> <span class="mi">47</span> <span class="mi">48</span> <span class="mi">49</span> <span class="mi">50</span> <span class="mi">51</span> <span class="mi">52</span> <span class="mi">53</span> <span class="mi">54</span> <span class="mi">55</span> <span class="mi">56</span> <span class="mi">57</span> <span class="mi">58</span> <span class="mi">59</span> <span class="mi">60</span> <span class="mi">61</span> <span class="mi">62</span> <span class="mi">63</span> <span class="mi">64</span> <span class="mi">65</span> <span class="mi">66</span> <span class="mi">67</span> <span class="mi">68</span> <span class="mi">69</span> <span class="mi">70</span> <span class="mi">71</span> <span class="mi">72</span> <span class="mi">73</span> <span class="mi">74</span> <span class="mi">75</span> <span class="mi">76</span> <span class="mi">77</span> <span class="mi">78</span> <span class="mi">79</span> <span class="mi">80</span> <span class="mi">81</span> <span class="mi">82</span> <span class="mi">83</span> <span class="mi">84</span> <span class="mi">85</span> <span class="mi">86</span> <span class="mi">87</span> <span class="mi">88</span> <span class="mi">89</span> <span class="mi">90</span> <span class="mi">91</span> <span class="mi">92</span> <span class="mi">93</span> <span class="mi">94</span> <span class="mi">95</span> <span class="mi">96</span> <span class="mi">97</span> <span class="mi">98</span> <span class="mi">99</span> <span class="mi">100</span> <span class="mi">101</span> <span class="mi">102</span> <span class="mi">103</span>
</span></span><span class="line"><span class="cl"><span class="n">node</span> <span class="mi">0</span> <span class="n">size</span><span class="p">:</span> <span class="mi">785826</span> <span class="n">MB</span>
</span></span><span class="line"><span class="cl"><span class="n">node</span> <span class="mi">0</span> <span class="n">free</span><span class="p">:</span> <span class="mi">108373</span> <span class="n">MB</span>
</span></span><span class="line"><span class="cl"><span class="n">node</span> <span class="n">distances</span><span class="p">:</span>
</span></span><span class="line"><span class="cl"><span class="n">node</span>   <span class="mi">0</span>
</span></span><span class="line"><span class="cl">  <span class="mi">0</span><span class="p">:</span>  <span class="mi">10</span>  
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">//</span><span class="err">志强</span><span class="n">E5</span>
</span></span><span class="line"><span class="cl">  <span class="c1">#lscpu</span>
</span></span><span class="line"><span class="cl"><span class="n">Architecture</span><span class="p">:</span>          <span class="n">x86_64</span>
</span></span><span class="line"><span class="cl"><span class="n">CPU</span> <span class="n">op</span><span class="o">-</span><span class="n">mode</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>        <span class="mi">32</span><span class="o">-</span><span class="n">bit</span><span class="p">,</span> <span class="mi">64</span><span class="o">-</span><span class="n">bit</span>
</span></span><span class="line"><span class="cl"><span class="n">Byte</span> <span class="n">Order</span><span class="p">:</span>            <span class="n">Little</span> <span class="n">Endian</span>
</span></span><span class="line"><span class="cl"><span class="n">CPU</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>                <span class="mi">64</span>
</span></span><span class="line"><span class="cl"><span class="n">On</span><span class="o">-</span><span class="n">line</span> <span class="n">CPU</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="n">list</span><span class="p">:</span>   <span class="mi">0</span><span class="o">-</span><span class="mi">63</span>
</span></span><span class="line"><span class="cl"><span class="ne">Thread</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="n">per</span> <span class="n">core</span><span class="p">:</span>    <span class="mi">2</span>
</span></span><span class="line"><span class="cl"><span class="n">Core</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="n">per</span> <span class="n">socket</span><span class="p">:</span>    <span class="mi">16</span>
</span></span><span class="line"><span class="cl"><span class="n">Socket</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>             <span class="mi">2</span>
</span></span><span class="line"><span class="cl"><span class="n">NUMA</span> <span class="n">node</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>          <span class="mi">2</span>
</span></span><span class="line"><span class="cl"><span class="n">Vendor</span> <span class="n">ID</span><span class="p">:</span>             <span class="n">GenuineIntel</span>
</span></span><span class="line"><span class="cl"><span class="n">CPU</span> <span class="n">family</span><span class="p">:</span>            <span class="mi">6</span>
</span></span><span class="line"><span class="cl"><span class="n">Model</span><span class="p">:</span>                 <span class="mi">79</span>
</span></span><span class="line"><span class="cl"><span class="n">Model</span> <span class="n">name</span><span class="p">:</span>            <span class="n">Intel</span><span class="p">(</span><span class="n">R</span><span class="p">)</span> <span class="n">Xeon</span><span class="p">(</span><span class="n">R</span><span class="p">)</span> <span class="n">CPU</span> <span class="n">E5</span><span class="o">-</span><span class="mi">2682</span> <span class="n">v4</span> <span class="err">@</span> <span class="mf">2.50</span><span class="n">GHz</span>
</span></span><span class="line"><span class="cl"><span class="n">Stepping</span><span class="p">:</span>              <span class="mi">1</span>
</span></span><span class="line"><span class="cl"><span class="n">CPU</span> <span class="n">MHz</span><span class="p">:</span>               <span class="mf">2500.000</span>
</span></span><span class="line"><span class="cl"><span class="n">CPU</span> <span class="nb">max</span> <span class="n">MHz</span><span class="p">:</span>           <span class="mf">3000.0000</span>
</span></span><span class="line"><span class="cl"><span class="n">CPU</span> <span class="nb">min</span> <span class="n">MHz</span><span class="p">:</span>           <span class="mf">1200.0000</span>
</span></span><span class="line"><span class="cl"><span class="n">BogoMIPS</span><span class="p">:</span>              <span class="mf">5000.06</span>
</span></span><span class="line"><span class="cl"><span class="n">Virtualization</span><span class="p">:</span>        <span class="n">VT</span><span class="o">-</span><span class="n">x</span>
</span></span><span class="line"><span class="cl"><span class="n">L1d</span> <span class="n">cache</span><span class="p">:</span>             <span class="mi">32</span><span class="n">K</span>
</span></span><span class="line"><span class="cl"><span class="n">L1i</span> <span class="n">cache</span><span class="p">:</span>             <span class="mi">32</span><span class="n">K</span>
</span></span><span class="line"><span class="cl"><span class="n">L2</span> <span class="n">cache</span><span class="p">:</span>              <span class="mi">256</span><span class="n">K</span>
</span></span><span class="line"><span class="cl"><span class="n">L3</span> <span class="n">cache</span><span class="p">:</span>              <span class="mi">40960</span><span class="n">K</span>
</span></span><span class="line"><span class="cl"><span class="n">NUMA</span> <span class="n">node0</span> <span class="n">CPU</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>     <span class="mi">0</span><span class="o">-</span><span class="mi">15</span><span class="p">,</span><span class="mi">32</span><span class="o">-</span><span class="mi">47</span>
</span></span><span class="line"><span class="cl"><span class="n">NUMA</span> <span class="n">node1</span> <span class="n">CPU</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>     <span class="mi">16</span><span class="o">-</span><span class="mi">31</span><span class="p">,</span><span class="mi">48</span><span class="o">-</span><span class="mi">63</span>
</span></span><span class="line"><span class="cl"><span class="n">Flags</span><span class="p">:</span>                 <span class="n">fpu</span> <span class="n">vme</span> <span class="n">de</span> <span class="n">pse</span> <span class="n">tsc</span> <span class="n">msr</span> <span class="n">pae</span> <span class="n">mce</span> <span class="n">cx8</span> <span class="n">apic</span> <span class="n">sep</span> <span class="n">mtrr</span> <span class="n">pge</span> <span class="n">mca</span> <span class="n">cmov</span> <span class="n">pat</span> <span class="n">pse36</span> <span class="n">clflush</span> <span class="n">dts</span> <span class="n">acpi</span> <span class="n">mmx</span> <span class="n">fxsr</span> <span class="n">sse</span> <span class="n">sse2</span> <span class="n">ss</span> <span class="n">ht</span> <span class="n">tm</span> <span class="n">pbe</span> <span class="n">syscall</span> <span class="n">nx</span> <span class="n">pdpe1gb</span> <span class="n">rdtscp</span> <span class="n">lm</span> <span class="n">constant_tsc</span> <span class="n">arch_perfmon</span> <span class="n">pebs</span> <span class="n">bts</span> <span class="n">rep_good</span> <span class="n">nopl</span> <span class="n">xtopology</span> <span class="n">nonstop_tsc</span> <span class="n">aperfmperf</span> <span class="n">eagerfpu</span> <span class="n">pni</span> <span class="n">pclmulqdq</span> <span class="n">dtes64</span> <span class="n">ds_cpl</span> <span class="n">vmx</span> <span class="n">smx</span> <span class="n">est</span> <span class="n">tm2</span> <span class="n">ssse3</span> <span class="n">fma</span> <span class="n">cx16</span> <span class="n">xtpr</span> <span class="n">pdcm</span> <span class="n">pcid</span> <span class="n">dca</span> <span class="n">sse4_1</span> <span class="n">sse4_2</span> <span class="n">x2apic</span> <span class="n">movbe</span> <span class="n">popcnt</span> <span class="n">tsc_deadline_timer</span> <span class="n">aes</span> <span class="n">xsave</span> <span class="n">avx</span> <span class="n">f16c</span> <span class="n">rdrand</span> <span class="n">lahf_lm</span> <span class="n">abm</span> <span class="mi">3</span><span class="n">dnowprefetch</span> <span class="n">ida</span> <span class="n">arat</span> <span class="n">epb</span> <span class="n">invpcid_single</span> <span class="n">pln</span> <span class="n">pts</span> <span class="n">dtherm</span> <span class="n">spec_ctrl</span> <span class="n">ibpb_support</span> <span class="n">tpr_shadow</span> <span class="n">vnmi</span> <span class="n">flexpriority</span> <span class="n">ept</span> <span class="n">vpid</span> <span class="n">fsgsbase</span> <span class="n">tsc_adjust</span> <span class="n">bmi1</span> <span class="n">hle</span> <span class="n">avx2</span> <span class="n">smep</span> <span class="n">bmi2</span> <span class="n">erms</span> <span class="n">invpcid</span> <span class="n">rtm</span> <span class="n">cqm</span> <span class="n">rdt</span> <span class="n">rdseed</span> <span class="n">adx</span> <span class="n">smap</span> <span class="n">xsaveopt</span> <span class="n">cqm_llc</span> <span class="n">cqm_occup_llc</span> <span class="n">cqm_mbm_total</span> <span class="n">cqm_mbm_local</span> <span class="n">cat_l3</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#numactl -H</span>
</span></span><span class="line"><span class="cl"><span class="n">available</span><span class="p">:</span> <span class="mi">2</span> <span class="n">nodes</span> <span class="p">(</span><span class="mi">0</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">node</span> <span class="mi">0</span> <span class="n">cpus</span><span class="p">:</span> <span class="mi">0</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span> <span class="mi">6</span> <span class="mi">7</span> <span class="mi">8</span> <span class="mi">9</span> <span class="mi">10</span> <span class="mi">11</span> <span class="mi">12</span> <span class="mi">13</span> <span class="mi">14</span> <span class="mi">15</span> <span class="mi">32</span> <span class="mi">33</span> <span class="mi">34</span> <span class="mi">35</span> <span class="mi">36</span> <span class="mi">37</span> <span class="mi">38</span> <span class="mi">39</span> <span class="mi">40</span> <span class="mi">41</span> <span class="mi">42</span> <span class="mi">43</span> <span class="mi">44</span> <span class="mi">45</span> <span class="mi">46</span> <span class="mi">47</span>
</span></span><span class="line"><span class="cl"><span class="n">node</span> <span class="mi">0</span> <span class="n">size</span><span class="p">:</span> <span class="mi">262008</span> <span class="n">MB</span>
</span></span><span class="line"><span class="cl"><span class="n">node</span> <span class="mi">0</span> <span class="n">free</span><span class="p">:</span> <span class="mi">240846</span> <span class="n">MB</span>
</span></span><span class="line"><span class="cl"><span class="n">node</span> <span class="mi">1</span> <span class="n">cpus</span><span class="p">:</span> <span class="mi">16</span> <span class="mi">17</span> <span class="mi">18</span> <span class="mi">19</span> <span class="mi">20</span> <span class="mi">21</span> <span class="mi">22</span> <span class="mi">23</span> <span class="mi">24</span> <span class="mi">25</span> <span class="mi">26</span> <span class="mi">27</span> <span class="mi">28</span> <span class="mi">29</span> <span class="mi">30</span> <span class="mi">31</span> <span class="mi">48</span> <span class="mi">49</span> <span class="mi">50</span> <span class="mi">51</span> <span class="mi">52</span> <span class="mi">53</span> <span class="mi">54</span> <span class="mi">55</span> <span class="mi">56</span> <span class="mi">57</span> <span class="mi">58</span> <span class="mi">59</span> <span class="mi">60</span> <span class="mi">61</span> <span class="mi">62</span> <span class="mi">63</span>
</span></span><span class="line"><span class="cl"><span class="n">node</span> <span class="mi">1</span> <span class="n">size</span><span class="p">:</span> <span class="mi">262144</span> <span class="n">MB</span>
</span></span><span class="line"><span class="cl"><span class="n">node</span> <span class="mi">1</span> <span class="n">free</span><span class="p">:</span> <span class="mi">242774</span> <span class="n">MB</span>
</span></span><span class="line"><span class="cl"><span class="n">node</span> <span class="n">distances</span><span class="p">:</span>
</span></span><span class="line"><span class="cl"><span class="n">node</span>   <span class="mi">0</span>   <span class="mi">1</span>
</span></span><span class="line"><span class="cl">  <span class="mi">0</span><span class="p">:</span>  <span class="mi">10</span>  <span class="mi">21</span>
</span></span><span class="line"><span class="cl">  <span class="mi">1</span><span class="p">:</span>  <span class="mi">21</span>  <span class="mi">10</span></span></span></code></pre>
</div>
<h3 id="鲲鹏920" class="headerLink">
    <a href="#%e9%b2%b2%e9%b9%8f920" class="header-mark"></a>鲲鹏920</h3><p>鲲鹏920-4826的L1比8269C 大一倍，但是L2小一倍。L3鲲鹏为1M/core  8269为1.38M/core(物理core）</p>
<div class="code-block highlight is-open show-line-numbers  tw-group tw-my-2">
  <div class="
    code-block-title 
    
    tw-flex 
    tw-flex-row 
    tw-justify-between 
    tw-w-full tw-bg-bgColor-secondary
    ">      
    <button 
      class="
        tw-select-none 
        tw-mx-2 
        tw-block
        group-[.is-open]:tw-rotate-90
        tw-transition-[transform] 
        tw-duration-500 
        tw-ease-in-out
        print:!tw-hidden"
      disabled
      aria-hidden="true"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M285.476 272.971L91.132 467.314c-9.373 9.373-24.569 9.373-33.941 0l-22.667-22.667c-9.357-9.357-9.375-24.522-.04-33.901L188.505 256 34.484 101.255c-9.335-9.379-9.317-24.544.04-33.901l22.667-22.667c9.373-9.373 24.569-9.373 33.941 0L285.475 239.03c9.373 9.372 9.373 24.568.001 33.941z"/></svg></button>

    <div class="code-block-title-bar tw-w-full">
      <p class="tw-select-none !tw-my-1">text</p>
    </div>
    <div class="tw-flex">
      <button 
        class="
          line-number-button
          tw-select-none 
          tw-mx-2 
          tw-hidden 
          group-[.is-open]:tw-block 
          group-[.show-line-numbers]:tw-text-fgColor-link 
          print:!tw-hidden" 
        title="Toggle line numbers"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M61.77 401l17.5-20.15a19.92 19.92 0 0 0 5.07-14.19v-3.31C84.34 356 80.5 352 73 352H16a8 8 0 0 0-8 8v16a8 8 0 0 0 8 8h22.83a157.41 157.41 0 0 0-11 12.31l-5.61 7c-4 5.07-5.25 10.13-2.8 14.88l1.05 1.93c3 5.76 6.29 7.88 12.25 7.88h4.73c10.33 0 15.94 2.44 15.94 9.09 0 4.72-4.2 8.22-14.36 8.22a41.54 41.54 0 0 1-15.47-3.12c-6.49-3.88-11.74-3.5-15.6 3.12l-5.59 9.31c-3.72 6.13-3.19 11.72 2.63 15.94 7.71 4.69 20.38 9.44 37 9.44 34.16 0 48.5-22.75 48.5-44.12-.03-14.38-9.12-29.76-28.73-34.88zM496 224H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zm0-160H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16V80a16 16 0 0 0-16-16zm0 320H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zM16 160h64a8 8 0 0 0 8-8v-16a8 8 0 0 0-8-8H64V40a8 8 0 0 0-8-8H32a8 8 0 0 0-7.14 4.42l-8 16A8 8 0 0 0 24 64h8v64H16a8 8 0 0 0-8 8v16a8 8 0 0 0 8 8zm-3.91 160H80a8 8 0 0 0 8-8v-16a8 8 0 0 0-8-8H41.32c3.29-10.29 48.34-18.68 48.34-56.44 0-29.06-25-39.56-44.47-39.56-21.36 0-33.8 10-40.46 18.75-4.37 5.59-3 10.84 2.8 15.37l8.58 6.88c5.61 4.56 11 2.47 16.12-2.44a13.44 13.44 0 0 1 9.46-3.84c3.33 0 9.28 1.56 9.28 8.75C51 248.19 0 257.31 0 304.59v4C0 316 5.08 320 12.09 320z"/></svg></button>

      <button 
        class="
          wrap-code-button
          tw-select-none 
          tw-mx-2 
          tw-hidden 
          group-[.is-open]:tw-block 
          group-[.is-wrap]:tw-text-fgColor-link 
          print:!tw-hidden" 
        title="Toggle code wrap"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M16 132h416c8.837 0 16-7.163 16-16V76c0-8.837-7.163-16-16-16H16C7.163 60 0 67.163 0 76v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16z"/></svg></button>
      
      <button 
        class="
          copy-code-button
          tw-select-none
          tw-mx-2 
          tw-hidden
          group-[.is-open]:tw-block
          hover:tw-text-fgColor-link 
          print:!tw-hidden"
        title="Copy code">
          <span class="copy-icon tw-block"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M433.941 65.941l-51.882-51.882A48 48 0 0 0 348.118 0H176c-26.51 0-48 21.49-48 48v48H48c-26.51 0-48 21.49-48 48v320c0 26.51 21.49 48 48 48h224c26.51 0 48-21.49 48-48v-48h80c26.51 0 48-21.49 48-48V99.882a48 48 0 0 0-14.059-33.941zM266 464H54a6 6 0 0 1-6-6V150a6 6 0 0 1 6-6h74v224c0 26.51 21.49 48 48 48h96v42a6 6 0 0 1-6 6zm128-96H182a6 6 0 0 1-6-6V54a6 6 0 0 1 6-6h106v88c0 13.255 10.745 24 24 24h88v202a6 6 0 0 1-6 6zm6-256h-64V48h9.632c1.591 0 3.117.632 4.243 1.757l48.368 48.368a6 6 0 0 1 1.757 4.243V112z"/></svg></span>
          <span class="check-icon tw-hidden"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M173.898 439.404l-166.4-166.4c-9.997-9.997-9.997-26.206 0-36.204l36.203-36.204c9.997-9.998 26.207-9.998 36.204 0L192 312.69 432.095 72.596c9.997-9.997 26.207-9.997 36.204 0l36.203 36.204c9.997 9.997 9.997 26.206 0 36.204l-294.4 294.401c-9.998 9.997-26.207 9.997-36.204-.001z"/></svg></span>
      </button>
        
      <button 
        class="
          tw-select-none 
          tw-mx-2 
          tw-block 
          group-[.is-open]:tw-hidden 
          print:!tw-hidden" 
        disabled
        aria-hidden="true"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M328 256c0 39.8-32.2 72-72 72s-72-32.2-72-72 32.2-72 72-72 72 32.2 72 72zm104-72c-39.8 0-72 32.2-72 72s32.2 72 72 72 72-32.2 72-72-32.2-72-72-72zm-352 0c-39.8 0-72 32.2-72 72s32.2 72 72 72 72-32.2 72-72-32.2-72-72-72z"/></svg></button>
    </div>
  </div>
  <pre style="counter-reset: codeblock;" class="tw-block tw-m-0 tw-p-0"><code 
    id="codeblock-id-4" 
    class="
      chroma 
      !tw-block 
      tw-p-0
      tw-m-0
      tw-transition-[max-height] 
      tw-duration-500 
      tw-ease-in-out 
      group-[.is-closed]:!tw-max-h-0 
      group-[.is-wrap]:tw-text-wrap
      tw-overflow-y-hidden
      tw-overflow-x-auto
      tw-scrollbar-thin
      "><span class="line"><span class="cl">#lscpu
</span></span><span class="line"><span class="cl">Architecture:          aarch64
</span></span><span class="line"><span class="cl">Byte Order:            Little Endian
</span></span><span class="line"><span class="cl">CPU(s):                96
</span></span><span class="line"><span class="cl">On-line CPU(s) list:   0-95
</span></span><span class="line"><span class="cl">Thread(s) per core:    1
</span></span><span class="line"><span class="cl">Core(s) per socket:    48
</span></span><span class="line"><span class="cl">Socket(s):             2
</span></span><span class="line"><span class="cl">NUMA node(s):          1
</span></span><span class="line"><span class="cl">Model:                 0
</span></span><span class="line"><span class="cl">CPU max MHz:           2600.0000
</span></span><span class="line"><span class="cl">CPU min MHz:           200.0000
</span></span><span class="line"><span class="cl">BogoMIPS:              200.00
</span></span><span class="line"><span class="cl">L1d cache:             64K
</span></span><span class="line"><span class="cl">L1i cache:             64K
</span></span><span class="line"><span class="cl">L2 cache:              512K
</span></span><span class="line"><span class="cl">L3 cache:              49152K
</span></span><span class="line"><span class="cl">NUMA node0 CPU(s):     0-95
</span></span><span class="line"><span class="cl">Flags:                 fp asimd evtstrm aes pmull sha1 sha2 crc32 atomics fphp asimdhp cpuid asimdrdm jscvt fcma dcpop asimddp asimdfhm
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">#numactl -H
</span></span><span class="line"><span class="cl">available: 4 nodes (0-3)
</span></span><span class="line"><span class="cl">node 0 cpus: 0 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23
</span></span><span class="line"><span class="cl">node 0 size: 192832 MB
</span></span><span class="line"><span class="cl">node 0 free: 187693 MB
</span></span><span class="line"><span class="cl">node 1 cpus: 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47
</span></span><span class="line"><span class="cl">node 1 size: 193533 MB
</span></span><span class="line"><span class="cl">node 1 free: 191827 MB
</span></span><span class="line"><span class="cl">node 2 cpus: 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71
</span></span><span class="line"><span class="cl">node 2 size: 193533 MB
</span></span><span class="line"><span class="cl">node 2 free: 192422 MB
</span></span><span class="line"><span class="cl">node 3 cpus: 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95
</span></span><span class="line"><span class="cl">node 3 size: 193532 MB
</span></span><span class="line"><span class="cl">node 3 free: 193139 MB
</span></span><span class="line"><span class="cl">node distances:
</span></span><span class="line"><span class="cl">node   0   1   2   3
</span></span><span class="line"><span class="cl">  0:  10  12  20  22
</span></span><span class="line"><span class="cl">  1:  12  10  22  24
</span></span><span class="line"><span class="cl">  2:  20  22  10  12
</span></span><span class="line"><span class="cl">  3:  22  24  12  10
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">#dmidecode -t processor | grep Version
</span></span><span class="line"><span class="cl">    Version: Kunpeng 920-4826
</span></span><span class="line"><span class="cl">    Version: Kunpeng 920-4826  
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">以上四个鲲鹏920的四个NUMA node之间的距离描述如下：
</span></span><span class="line"><span class="cl">node 0 &lt;------------ socket distance ------------&gt; node 2
</span></span><span class="line"><span class="cl">    | (die distance)                                  | (die distance)
</span></span><span class="line"><span class="cl">node 1                                             node 3    
</span></span><span class="line"><span class="cl">要注意node1到node3比node0到node3要大，猜测Socket之间的UPI只接上了node1和node2</span></span></code></pre>
</div>
<p><a href="https://fuse.wikichip.org/news/2274/huawei-expands-kunpeng-server-cpus-plans-smt-sve-for-next-gen/" target="_blank" rel="noopener noreferrer">鲲鹏920架构参考这里</a></p>
<p><img class="tw-inline" loading="lazy" src=https://cdn.jsdelivr.net/gh/plantegg/plantegg.github.io/images/951413iMgBlog/taishan-v110-soc-block-diagram.png   alt="img"  ></p>
<p>Though Huawei has been keeping a tight lip on the chip design itself, the Hi1620 is actually a multi-chip design. Actually, we believe are three dies. The chip itself comprise two compute dies called the <strong>Super CPU cluster</strong> (SCCL), each one packing 32 cores. It’s also possible the SCCL only have 24 cores, in which case there are three such dies with a theoretical maximum core count of 72 cores possible but are not offered for yield reasons. Regardless of this, there are at least two SCCL dies for sure. Additionally, there is also an I/O die called the <strong>Super IO Cluster</strong> (SICL) which contains all the high-speed SerDes and low-speed I/Os.</p>
<p>下图是6426型号，我测试用的是4826型号，也就是一个CPU内是48core，一个CPU封装3个Die，两个Die是 core，还有一个是Super IO Cluster</p>
<p><img class="tw-inline" loading="lazy" src=https://cdn.jsdelivr.net/gh/plantegg/plantegg.github.io/images/951413iMgBlog/700px-taishan_v110_soc_details.svg.png   alt="taishan v110 soc details.svg"  ></p>
<p>鲲鹏命令规范：</p>
<p><img class="tw-inline" loading="lazy" src=https://cdn.jsdelivr.net/gh/plantegg/plantegg.github.io/images/951413iMgBlog/kunpeng-naming-scheme.png   alt="img"  ></p>
<p>鲲鹏 RoadMap</p>
<p><img class="tw-inline" loading="lazy" src=https://cdn.jsdelivr.net/gh/plantegg/plantegg.github.io/images/951413iMgBlog/kunpeng-future-roadmap-1024x512.png   alt="img"  ></p>
<h4 id="鲲鹏-kunpeng-920-4826-跨numa性能比较" class="headerLink">
    <a href="#%e9%b2%b2%e9%b9%8f-kunpeng-920-4826-%e8%b7%a8numa%e6%80%a7%e8%83%bd%e6%af%94%e8%be%83" class="header-mark"></a>鲲鹏 Kunpeng 920-4826 跨numa性能比较</h4><p>绑24core，跨numa0、numa3，是numactl -H看到的比较远距离。两分钟的 Current tpmC: 69660</p>
<div class="code-block highlight is-open show-line-numbers  tw-group tw-my-2">
  <div class="
    code-block-title 
    
    tw-flex 
    tw-flex-row 
    tw-justify-between 
    tw-w-full tw-bg-bgColor-secondary
    ">      
    <button 
      class="
        tw-select-none 
        tw-mx-2 
        tw-block
        group-[.is-open]:tw-rotate-90
        tw-transition-[transform] 
        tw-duration-500 
        tw-ease-in-out
        print:!tw-hidden"
      disabled
      aria-hidden="true"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M285.476 272.971L91.132 467.314c-9.373 9.373-24.569 9.373-33.941 0l-22.667-22.667c-9.357-9.357-9.375-24.522-.04-33.901L188.505 256 34.484 101.255c-9.335-9.379-9.317-24.544.04-33.901l22.667-22.667c9.373-9.373 24.569-9.373 33.941 0L285.475 239.03c9.373 9.372 9.373 24.568.001 33.941z"/></svg></button>

    <div class="code-block-title-bar tw-w-full">
      <p class="tw-select-none !tw-my-1">text</p>
    </div>
    <div class="tw-flex">
      <button 
        class="
          line-number-button
          tw-select-none 
          tw-mx-2 
          tw-hidden 
          group-[.is-open]:tw-block 
          group-[.show-line-numbers]:tw-text-fgColor-link 
          print:!tw-hidden" 
        title="Toggle line numbers"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M61.77 401l17.5-20.15a19.92 19.92 0 0 0 5.07-14.19v-3.31C84.34 356 80.5 352 73 352H16a8 8 0 0 0-8 8v16a8 8 0 0 0 8 8h22.83a157.41 157.41 0 0 0-11 12.31l-5.61 7c-4 5.07-5.25 10.13-2.8 14.88l1.05 1.93c3 5.76 6.29 7.88 12.25 7.88h4.73c10.33 0 15.94 2.44 15.94 9.09 0 4.72-4.2 8.22-14.36 8.22a41.54 41.54 0 0 1-15.47-3.12c-6.49-3.88-11.74-3.5-15.6 3.12l-5.59 9.31c-3.72 6.13-3.19 11.72 2.63 15.94 7.71 4.69 20.38 9.44 37 9.44 34.16 0 48.5-22.75 48.5-44.12-.03-14.38-9.12-29.76-28.73-34.88zM496 224H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zm0-160H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16V80a16 16 0 0 0-16-16zm0 320H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zM16 160h64a8 8 0 0 0 8-8v-16a8 8 0 0 0-8-8H64V40a8 8 0 0 0-8-8H32a8 8 0 0 0-7.14 4.42l-8 16A8 8 0 0 0 24 64h8v64H16a8 8 0 0 0-8 8v16a8 8 0 0 0 8 8zm-3.91 160H80a8 8 0 0 0 8-8v-16a8 8 0 0 0-8-8H41.32c3.29-10.29 48.34-18.68 48.34-56.44 0-29.06-25-39.56-44.47-39.56-21.36 0-33.8 10-40.46 18.75-4.37 5.59-3 10.84 2.8 15.37l8.58 6.88c5.61 4.56 11 2.47 16.12-2.44a13.44 13.44 0 0 1 9.46-3.84c3.33 0 9.28 1.56 9.28 8.75C51 248.19 0 257.31 0 304.59v4C0 316 5.08 320 12.09 320z"/></svg></button>

      <button 
        class="
          wrap-code-button
          tw-select-none 
          tw-mx-2 
          tw-hidden 
          group-[.is-open]:tw-block 
          group-[.is-wrap]:tw-text-fgColor-link 
          print:!tw-hidden" 
        title="Toggle code wrap"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M16 132h416c8.837 0 16-7.163 16-16V76c0-8.837-7.163-16-16-16H16C7.163 60 0 67.163 0 76v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16z"/></svg></button>
      
      <button 
        class="
          copy-code-button
          tw-select-none
          tw-mx-2 
          tw-hidden
          group-[.is-open]:tw-block
          hover:tw-text-fgColor-link 
          print:!tw-hidden"
        title="Copy code">
          <span class="copy-icon tw-block"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M433.941 65.941l-51.882-51.882A48 48 0 0 0 348.118 0H176c-26.51 0-48 21.49-48 48v48H48c-26.51 0-48 21.49-48 48v320c0 26.51 21.49 48 48 48h224c26.51 0 48-21.49 48-48v-48h80c26.51 0 48-21.49 48-48V99.882a48 48 0 0 0-14.059-33.941zM266 464H54a6 6 0 0 1-6-6V150a6 6 0 0 1 6-6h74v224c0 26.51 21.49 48 48 48h96v42a6 6 0 0 1-6 6zm128-96H182a6 6 0 0 1-6-6V54a6 6 0 0 1 6-6h106v88c0 13.255 10.745 24 24 24h88v202a6 6 0 0 1-6 6zm6-256h-64V48h9.632c1.591 0 3.117.632 4.243 1.757l48.368 48.368a6 6 0 0 1 1.757 4.243V112z"/></svg></span>
          <span class="check-icon tw-hidden"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M173.898 439.404l-166.4-166.4c-9.997-9.997-9.997-26.206 0-36.204l36.203-36.204c9.997-9.998 26.207-9.998 36.204 0L192 312.69 432.095 72.596c9.997-9.997 26.207-9.997 36.204 0l36.203 36.204c9.997 9.997 9.997 26.206 0 36.204l-294.4 294.401c-9.998 9.997-26.207 9.997-36.204-.001z"/></svg></span>
      </button>
        
      <button 
        class="
          tw-select-none 
          tw-mx-2 
          tw-block 
          group-[.is-open]:tw-hidden 
          print:!tw-hidden" 
        disabled
        aria-hidden="true"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M328 256c0 39.8-32.2 72-72 72s-72-32.2-72-72 32.2-72 72-72 72 32.2 72 72zm104-72c-39.8 0-72 32.2-72 72s32.2 72 72 72 72-32.2 72-72-32.2-72-72-72zm-352 0c-39.8 0-72 32.2-72 72s32.2 72 72 72 72-32.2 72-72-32.2-72-72-72z"/></svg></button>
    </div>
  </div>
  <pre style="counter-reset: codeblock;" class="tw-block tw-m-0 tw-p-0"><code 
    id="codeblock-id-5" 
    class="
      chroma 
      !tw-block 
      tw-p-0
      tw-m-0
      tw-transition-[max-height] 
      tw-duration-500 
      tw-ease-in-out 
      group-[.is-closed]:!tw-max-h-0 
      group-[.is-wrap]:tw-text-wrap
      tw-overflow-y-hidden
      tw-overflow-x-auto
      tw-scrollbar-thin
      "><span class="line"><span class="cl"><span class="c1">#taskset -a -cp  12-23,72-83 20799</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#perf stat -e branch-misses,bus-cycles,cache-misses,cache-references,cpu-cycles,instructions,stalled-cycles-backend,stalled-cycles-frontend,L1-dcache-load-misses,L1-dcache-loads,L1-dcache-store-misses,L1-dcache-stores,L1-icache-load-misses,L1-icache-loads,branch-load-misses,branch-loads,dTLB-load-misses,dTLB-loads,iTLB-load-misses,iTLB-loads,cpu-migrations -p 20799</span>
</span></span><span class="line"><span class="cl"><span class="o">^</span><span class="n">C</span>
</span></span><span class="line"><span class="cl"> <span class="ne">Performance</span> <span class="n">counter</span> <span class="n">stats</span> <span class="k">for</span> <span class="n">process</span> <span class="n">id</span> <span class="s1">&#39;20799&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">     <span class="mi">2</span><span class="p">,</span><span class="mi">866</span><span class="p">,</span><span class="mi">418</span><span class="p">,</span><span class="mi">154</span>      <span class="n">branch</span><span class="o">-</span><span class="n">misses</span>                                                 <span class="p">(</span><span class="mf">59.84</span><span class="o">%</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">   <span class="mi">549</span><span class="p">,</span><span class="mi">673</span><span class="p">,</span><span class="mi">215</span><span class="p">,</span><span class="mi">827</span>      <span class="n">bus</span><span class="o">-</span><span class="n">cycles</span>                                                    <span class="p">(</span><span class="mf">59.89</span><span class="o">%</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">     <span class="mi">2</span><span class="p">,</span><span class="mi">179</span><span class="p">,</span><span class="mi">816</span><span class="p">,</span><span class="mi">578</span>      <span class="n">cache</span><span class="o">-</span><span class="n">misses</span>              <span class="c1">#    2.360 % of all cache refs      (59.93%)</span>
</span></span><span class="line"><span class="cl">    <span class="mi">92</span><span class="p">,</span><span class="mi">377</span><span class="p">,</span><span class="mi">674</span><span class="p">,</span><span class="mi">343</span>      <span class="n">cache</span><span class="o">-</span><span class="n">references</span>                                              <span class="p">(</span><span class="mf">60.04</span><span class="o">%</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">   <span class="mi">549</span><span class="p">,</span><span class="mi">605</span><span class="p">,</span><span class="mi">057</span><span class="p">,</span><span class="mi">475</span>      <span class="n">cpu</span><span class="o">-</span><span class="n">cycles</span>                                                    <span class="p">(</span><span class="mf">65.05</span><span class="o">%</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">   <span class="mi">229</span><span class="p">,</span><span class="mi">958</span><span class="p">,</span><span class="mi">980</span><span class="p">,</span><span class="mi">614</span>      <span class="n">instructions</span>              <span class="c1">#    0.42  insn per cycle</span>
</span></span><span class="line"><span class="cl">                                                  <span class="c1">#    1.31  stalled cycles per insn  (65.05%)</span>
</span></span><span class="line"><span class="cl">   <span class="mi">146</span><span class="p">,</span><span class="mi">201</span><span class="p">,</span><span class="mi">062</span><span class="p">,</span><span class="mi">116</span>      <span class="n">stalled</span><span class="o">-</span><span class="n">cycles</span><span class="o">-</span><span class="n">backend</span>    <span class="c1">#   26.60% backend cycles idle      (65.08%)</span>
</span></span><span class="line"><span class="cl">   <span class="mi">301</span><span class="p">,</span><span class="mi">814</span><span class="p">,</span><span class="mi">831</span><span class="p">,</span><span class="mi">043</span>      <span class="n">stalled</span><span class="o">-</span><span class="n">cycles</span><span class="o">-</span><span class="n">frontend</span>   <span class="c1">#   54.91% frontend cycles idle     (65.08%)</span>
</span></span><span class="line"><span class="cl">     <span class="mi">2</span><span class="p">,</span><span class="mi">177</span><span class="p">,</span><span class="mi">062</span><span class="p">,</span><span class="mi">319</span>      <span class="n">L1</span><span class="o">-</span><span class="n">dcache</span><span class="o">-</span><span class="nb">load</span><span class="o">-</span><span class="n">misses</span>     <span class="c1">#    2.35% of all L1-dcache hits    (65.04%)</span>
</span></span><span class="line"><span class="cl">    <span class="mi">92</span><span class="p">,</span><span class="mi">481</span><span class="p">,</span><span class="mi">797</span><span class="p">,</span><span class="mi">426</span>      <span class="n">L1</span><span class="o">-</span><span class="n">dcache</span><span class="o">-</span><span class="n">loads</span>                                               <span class="p">(</span><span class="mf">65.11</span><span class="o">%</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">     <span class="mi">2</span><span class="p">,</span><span class="mi">175</span><span class="p">,</span><span class="mi">030</span><span class="p">,</span><span class="mi">428</span>      <span class="n">L1</span><span class="o">-</span><span class="n">dcache</span><span class="o">-</span><span class="n">store</span><span class="o">-</span><span class="n">misses</span>                                        <span class="p">(</span><span class="mf">65.15</span><span class="o">%</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="mi">92</span><span class="p">,</span><span class="mi">507</span><span class="p">,</span><span class="mi">474</span><span class="p">,</span><span class="mi">710</span>      <span class="n">L1</span><span class="o">-</span><span class="n">dcache</span><span class="o">-</span><span class="n">stores</span>                                              <span class="p">(</span><span class="mf">65.14</span><span class="o">%</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">     <span class="mi">9</span><span class="p">,</span><span class="mi">299</span><span class="p">,</span><span class="mi">812</span><span class="p">,</span><span class="mi">249</span>      <span class="n">L1</span><span class="o">-</span><span class="n">icache</span><span class="o">-</span><span class="nb">load</span><span class="o">-</span><span class="n">misses</span>     <span class="c1">#   12.47% of all L1-icache hits    (65.20%)</span>
</span></span><span class="line"><span class="cl">    <span class="mi">74</span><span class="p">,</span><span class="mi">579</span><span class="p">,</span><span class="mi">909</span><span class="p">,</span><span class="mi">037</span>      <span class="n">L1</span><span class="o">-</span><span class="n">icache</span><span class="o">-</span><span class="n">loads</span>                                               <span class="p">(</span><span class="mf">65.16</span><span class="o">%</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">     <span class="mi">2</span><span class="p">,</span><span class="mi">862</span><span class="p">,</span><span class="mi">664</span><span class="p">,</span><span class="mi">443</span>      <span class="n">branch</span><span class="o">-</span><span class="nb">load</span><span class="o">-</span><span class="n">misses</span>                                            <span class="p">(</span><span class="mf">65.08</span><span class="o">%</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="mi">52</span><span class="p">,</span><span class="mi">826</span><span class="p">,</span><span class="mi">930</span><span class="p">,</span><span class="mi">842</span>      <span class="n">branch</span><span class="o">-</span><span class="n">loads</span>                                                  <span class="p">(</span><span class="mf">65.04</span><span class="o">%</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">     <span class="mi">3</span><span class="p">,</span><span class="mi">729</span><span class="p">,</span><span class="mi">265</span><span class="p">,</span><span class="mi">130</span>      <span class="n">dTLB</span><span class="o">-</span><span class="nb">load</span><span class="o">-</span><span class="n">misses</span>          <span class="c1">#    3.11% of all dTLB cache hits   (64.95%)</span>
</span></span><span class="line"><span class="cl">   <span class="mi">119</span><span class="p">,</span><span class="mi">896</span><span class="p">,</span><span class="mi">014</span><span class="p">,</span><span class="mi">498</span>      <span class="n">dTLB</span><span class="o">-</span><span class="n">loads</span>                                                    <span class="p">(</span><span class="mf">59.90</span><span class="o">%</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">     <span class="mi">1</span><span class="p">,</span><span class="mi">350</span><span class="p">,</span><span class="mi">782</span><span class="p">,</span><span class="mi">047</span>      <span class="n">iTLB</span><span class="o">-</span><span class="nb">load</span><span class="o">-</span><span class="n">misses</span>          <span class="c1">#    1.83% of all iTLB cache hits   (59.84%)</span>
</span></span><span class="line"><span class="cl">    <span class="mi">74</span><span class="p">,</span><span class="mi">005</span><span class="p">,</span><span class="mi">620</span><span class="p">,</span><span class="mi">378</span>      <span class="n">iTLB</span><span class="o">-</span><span class="n">loads</span>                                                    <span class="p">(</span><span class="mf">59.82</span><span class="o">%</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">               <span class="mi">510</span>      <span class="n">cpu</span><span class="o">-</span><span class="n">migrations</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">       <span class="mf">9.483137760</span> <span class="n">seconds</span> <span class="n">time</span> <span class="n">elapsed</span></span></span></code></pre>
</div>
<p>绑72-95core，在同一个numa下，但是没有重启进程，导致有一半内存仍然在numa0上，2分钟的Current tpmC: 75900</p>
<div class="code-block highlight is-open show-line-numbers  tw-group tw-my-2">
  <div class="
    code-block-title 
    
    tw-flex 
    tw-flex-row 
    tw-justify-between 
    tw-w-full tw-bg-bgColor-secondary
    ">      
    <button 
      class="
        tw-select-none 
        tw-mx-2 
        tw-block
        group-[.is-open]:tw-rotate-90
        tw-transition-[transform] 
        tw-duration-500 
        tw-ease-in-out
        print:!tw-hidden"
      disabled
      aria-hidden="true"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M285.476 272.971L91.132 467.314c-9.373 9.373-24.569 9.373-33.941 0l-22.667-22.667c-9.357-9.357-9.375-24.522-.04-33.901L188.505 256 34.484 101.255c-9.335-9.379-9.317-24.544.04-33.901l22.667-22.667c9.373-9.373 24.569-9.373 33.941 0L285.475 239.03c9.373 9.372 9.373 24.568.001 33.941z"/></svg></button>

    <div class="code-block-title-bar tw-w-full">
      <p class="tw-select-none !tw-my-1">text</p>
    </div>
    <div class="tw-flex">
      <button 
        class="
          line-number-button
          tw-select-none 
          tw-mx-2 
          tw-hidden 
          group-[.is-open]:tw-block 
          group-[.show-line-numbers]:tw-text-fgColor-link 
          print:!tw-hidden" 
        title="Toggle line numbers"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M61.77 401l17.5-20.15a19.92 19.92 0 0 0 5.07-14.19v-3.31C84.34 356 80.5 352 73 352H16a8 8 0 0 0-8 8v16a8 8 0 0 0 8 8h22.83a157.41 157.41 0 0 0-11 12.31l-5.61 7c-4 5.07-5.25 10.13-2.8 14.88l1.05 1.93c3 5.76 6.29 7.88 12.25 7.88h4.73c10.33 0 15.94 2.44 15.94 9.09 0 4.72-4.2 8.22-14.36 8.22a41.54 41.54 0 0 1-15.47-3.12c-6.49-3.88-11.74-3.5-15.6 3.12l-5.59 9.31c-3.72 6.13-3.19 11.72 2.63 15.94 7.71 4.69 20.38 9.44 37 9.44 34.16 0 48.5-22.75 48.5-44.12-.03-14.38-9.12-29.76-28.73-34.88zM496 224H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zm0-160H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16V80a16 16 0 0 0-16-16zm0 320H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zM16 160h64a8 8 0 0 0 8-8v-16a8 8 0 0 0-8-8H64V40a8 8 0 0 0-8-8H32a8 8 0 0 0-7.14 4.42l-8 16A8 8 0 0 0 24 64h8v64H16a8 8 0 0 0-8 8v16a8 8 0 0 0 8 8zm-3.91 160H80a8 8 0 0 0 8-8v-16a8 8 0 0 0-8-8H41.32c3.29-10.29 48.34-18.68 48.34-56.44 0-29.06-25-39.56-44.47-39.56-21.36 0-33.8 10-40.46 18.75-4.37 5.59-3 10.84 2.8 15.37l8.58 6.88c5.61 4.56 11 2.47 16.12-2.44a13.44 13.44 0 0 1 9.46-3.84c3.33 0 9.28 1.56 9.28 8.75C51 248.19 0 257.31 0 304.59v4C0 316 5.08 320 12.09 320z"/></svg></button>

      <button 
        class="
          wrap-code-button
          tw-select-none 
          tw-mx-2 
          tw-hidden 
          group-[.is-open]:tw-block 
          group-[.is-wrap]:tw-text-fgColor-link 
          print:!tw-hidden" 
        title="Toggle code wrap"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M16 132h416c8.837 0 16-7.163 16-16V76c0-8.837-7.163-16-16-16H16C7.163 60 0 67.163 0 76v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16z"/></svg></button>
      
      <button 
        class="
          copy-code-button
          tw-select-none
          tw-mx-2 
          tw-hidden
          group-[.is-open]:tw-block
          hover:tw-text-fgColor-link 
          print:!tw-hidden"
        title="Copy code">
          <span class="copy-icon tw-block"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M433.941 65.941l-51.882-51.882A48 48 0 0 0 348.118 0H176c-26.51 0-48 21.49-48 48v48H48c-26.51 0-48 21.49-48 48v320c0 26.51 21.49 48 48 48h224c26.51 0 48-21.49 48-48v-48h80c26.51 0 48-21.49 48-48V99.882a48 48 0 0 0-14.059-33.941zM266 464H54a6 6 0 0 1-6-6V150a6 6 0 0 1 6-6h74v224c0 26.51 21.49 48 48 48h96v42a6 6 0 0 1-6 6zm128-96H182a6 6 0 0 1-6-6V54a6 6 0 0 1 6-6h106v88c0 13.255 10.745 24 24 24h88v202a6 6 0 0 1-6 6zm6-256h-64V48h9.632c1.591 0 3.117.632 4.243 1.757l48.368 48.368a6 6 0 0 1 1.757 4.243V112z"/></svg></span>
          <span class="check-icon tw-hidden"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M173.898 439.404l-166.4-166.4c-9.997-9.997-9.997-26.206 0-36.204l36.203-36.204c9.997-9.998 26.207-9.998 36.204 0L192 312.69 432.095 72.596c9.997-9.997 26.207-9.997 36.204 0l36.203 36.204c9.997 9.997 9.997 26.206 0 36.204l-294.4 294.401c-9.998 9.997-26.207 9.997-36.204-.001z"/></svg></span>
      </button>
        
      <button 
        class="
          tw-select-none 
          tw-mx-2 
          tw-block 
          group-[.is-open]:tw-hidden 
          print:!tw-hidden" 
        disabled
        aria-hidden="true"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M328 256c0 39.8-32.2 72-72 72s-72-32.2-72-72 32.2-72 72-72 72 32.2 72 72zm104-72c-39.8 0-72 32.2-72 72s32.2 72 72 72 72-32.2 72-72-32.2-72-72-72zm-352 0c-39.8 0-72 32.2-72 72s32.2 72 72 72 72-32.2 72-72-32.2-72-72-72z"/></svg></button>
    </div>
  </div>
  <pre style="counter-reset: codeblock;" class="tw-block tw-m-0 tw-p-0"><code 
    id="codeblock-id-6" 
    class="
      chroma 
      !tw-block 
      tw-p-0
      tw-m-0
      tw-transition-[max-height] 
      tw-duration-500 
      tw-ease-in-out 
      group-[.is-closed]:!tw-max-h-0 
      group-[.is-wrap]:tw-text-wrap
      tw-overflow-y-hidden
      tw-overflow-x-auto
      tw-scrollbar-thin
      "><span class="line"><span class="cl"><span class="c1">#taskset -a -cp  72-95 20799</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#perf stat -e branch-misses,bus-cycles,cache-misses,cache-references,cpu-cycles,instructions,stalled-cycles-backend,stalled-cycles-frontend,L1-dcache-load-misses,L1-dcache-loads,L1-dcache-store-misses,L1-dcache-stores,L1-icache-load-misses,L1-icache-loads,branch-load-misses,branch-loads,dTLB-load-misses,dTLB-loads,iTLB-load-misses,iTLB-loads,cpu-migrations -p 20799</span>
</span></span><span class="line"><span class="cl"><span class="o">^</span><span class="n">C</span>
</span></span><span class="line"><span class="cl"> <span class="ne">Performance</span> <span class="n">counter</span> <span class="n">stats</span> <span class="k">for</span> <span class="n">process</span> <span class="n">id</span> <span class="s1">&#39;20799&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">     <span class="mi">2</span><span class="p">,</span><span class="mi">665</span><span class="p">,</span><span class="mi">583</span><span class="p">,</span><span class="mi">722</span>      <span class="n">branch</span><span class="o">-</span><span class="n">misses</span>                                                 <span class="p">(</span><span class="mf">59.90</span><span class="o">%</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">   <span class="mi">500</span><span class="p">,</span><span class="mi">184</span><span class="p">,</span><span class="mi">789</span><span class="p">,</span><span class="mi">050</span>      <span class="n">bus</span><span class="o">-</span><span class="n">cycles</span>                                                    <span class="p">(</span><span class="mf">59.95</span><span class="o">%</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">     <span class="mi">1</span><span class="p">,</span><span class="mi">997</span><span class="p">,</span><span class="mi">726</span><span class="p">,</span><span class="mi">097</span>      <span class="n">cache</span><span class="o">-</span><span class="n">misses</span>              <span class="c1">#    2.254 % of all cache refs      (59.94%)</span>
</span></span><span class="line"><span class="cl">    <span class="mi">88</span><span class="p">,</span><span class="mi">628</span><span class="p">,</span><span class="mi">013</span><span class="p">,</span><span class="mi">529</span>      <span class="n">cache</span><span class="o">-</span><span class="n">references</span>                                              <span class="p">(</span><span class="mf">59.93</span><span class="o">%</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">   <span class="mi">500</span><span class="p">,</span><span class="mi">111</span><span class="p">,</span><span class="mi">712</span><span class="p">,</span><span class="mi">450</span>      <span class="n">cpu</span><span class="o">-</span><span class="n">cycles</span>                                                    <span class="p">(</span><span class="mf">64.98</span><span class="o">%</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">   <span class="mi">221</span><span class="p">,</span><span class="mi">098</span><span class="p">,</span><span class="mi">464</span><span class="p">,</span><span class="mi">920</span>      <span class="n">instructions</span>              <span class="c1">#    0.44  insn per cycle</span>
</span></span><span class="line"><span class="cl">                                                  <span class="c1">#    1.35  stalled cycles per insn  (65.02%)</span>
</span></span><span class="line"><span class="cl">   <span class="mi">105</span><span class="p">,</span><span class="mi">957</span><span class="p">,</span><span class="mi">124</span><span class="p">,</span><span class="mi">479</span>      <span class="n">stalled</span><span class="o">-</span><span class="n">cycles</span><span class="o">-</span><span class="n">backend</span>    <span class="c1">#   21.19% backend cycles idle      (65.02%)</span>
</span></span><span class="line"><span class="cl">   <span class="mi">298</span><span class="p">,</span><span class="mi">186</span><span class="p">,</span><span class="mi">439</span><span class="p">,</span><span class="mi">955</span>      <span class="n">stalled</span><span class="o">-</span><span class="n">cycles</span><span class="o">-</span><span class="n">frontend</span>   <span class="c1">#   59.62% frontend cycles idle     (65.02%)</span>
</span></span><span class="line"><span class="cl">     <span class="mi">1</span><span class="p">,</span><span class="mi">996</span><span class="p">,</span><span class="mi">313</span><span class="p">,</span><span class="mi">908</span>      <span class="n">L1</span><span class="o">-</span><span class="n">dcache</span><span class="o">-</span><span class="nb">load</span><span class="o">-</span><span class="n">misses</span>     <span class="c1">#    2.25% of all L1-dcache hits    (65.04%)</span>
</span></span><span class="line"><span class="cl">    <span class="mi">88</span><span class="p">,</span><span class="mi">701</span><span class="p">,</span><span class="mi">699</span><span class="p">,</span><span class="mi">646</span>      <span class="n">L1</span><span class="o">-</span><span class="n">dcache</span><span class="o">-</span><span class="n">loads</span>                                               <span class="p">(</span><span class="mf">65.09</span><span class="o">%</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">     <span class="mi">1</span><span class="p">,</span><span class="mi">997</span><span class="p">,</span><span class="mi">851</span><span class="p">,</span><span class="mi">364</span>      <span class="n">L1</span><span class="o">-</span><span class="n">dcache</span><span class="o">-</span><span class="n">store</span><span class="o">-</span><span class="n">misses</span>                                        <span class="p">(</span><span class="mf">65.10</span><span class="o">%</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="mi">88</span><span class="p">,</span><span class="mi">614</span><span class="p">,</span><span class="mi">658</span><span class="p">,</span><span class="mi">960</span>      <span class="n">L1</span><span class="o">-</span><span class="n">dcache</span><span class="o">-</span><span class="n">stores</span>                                              <span class="p">(</span><span class="mf">65.10</span><span class="o">%</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">     <span class="mi">8</span><span class="p">,</span><span class="mi">635</span><span class="p">,</span><span class="mi">807</span><span class="p">,</span><span class="mi">737</span>      <span class="n">L1</span><span class="o">-</span><span class="n">icache</span><span class="o">-</span><span class="nb">load</span><span class="o">-</span><span class="n">misses</span>     <span class="c1">#   12.30% of all L1-icache hits    (65.13%)</span>
</span></span><span class="line"><span class="cl">    <span class="mi">70</span><span class="p">,</span><span class="mi">233</span><span class="p">,</span><span class="mi">323</span><span class="p">,</span><span class="mi">630</span>      <span class="n">L1</span><span class="o">-</span><span class="n">icache</span><span class="o">-</span><span class="n">loads</span>                                               <span class="p">(</span><span class="mf">65.16</span><span class="o">%</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">     <span class="mi">2</span><span class="p">,</span><span class="mi">665</span><span class="p">,</span><span class="mi">567</span><span class="p">,</span><span class="mi">783</span>      <span class="n">branch</span><span class="o">-</span><span class="nb">load</span><span class="o">-</span><span class="n">misses</span>                                            <span class="p">(</span><span class="mf">65.10</span><span class="o">%</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="mi">50</span><span class="p">,</span><span class="mi">482</span><span class="p">,</span><span class="mi">936</span><span class="p">,</span><span class="mi">168</span>      <span class="n">branch</span><span class="o">-</span><span class="n">loads</span>                                                  <span class="p">(</span><span class="mf">65.09</span><span class="o">%</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">     <span class="mi">3</span><span class="p">,</span><span class="mi">614</span><span class="p">,</span><span class="mi">564</span><span class="p">,</span><span class="mi">473</span>      <span class="n">dTLB</span><span class="o">-</span><span class="nb">load</span><span class="o">-</span><span class="n">misses</span>          <span class="c1">#    3.15% of all dTLB cache hits   (65.04%)</span>
</span></span><span class="line"><span class="cl">   <span class="mi">114</span><span class="p">,</span><span class="mi">619</span><span class="p">,</span><span class="mi">822</span><span class="p">,</span><span class="mi">486</span>      <span class="n">dTLB</span><span class="o">-</span><span class="n">loads</span>                                                    <span class="p">(</span><span class="mf">59.96</span><span class="o">%</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">     <span class="mi">1</span><span class="p">,</span><span class="mi">270</span><span class="p">,</span><span class="mi">926</span><span class="p">,</span><span class="mi">362</span>      <span class="n">iTLB</span><span class="o">-</span><span class="nb">load</span><span class="o">-</span><span class="n">misses</span>          <span class="c1">#    1.81% of all iTLB cache hits   (59.97%)</span>
</span></span><span class="line"><span class="cl">    <span class="mi">70</span><span class="p">,</span><span class="mi">248</span><span class="p">,</span><span class="mi">645</span><span class="p">,</span><span class="mi">721</span>      <span class="n">iTLB</span><span class="o">-</span><span class="n">loads</span>                                                    <span class="p">(</span><span class="mf">59.94</span><span class="o">%</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">               <span class="mi">128</span>      <span class="n">cpu</span><span class="o">-</span><span class="n">migrations</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">       <span class="mf">8.610934700</span> <span class="n">seconds</span> <span class="n">time</span> <span class="n">elapsed</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#/root/numa-maps-summary.pl &lt;/proc/20799/numa_maps</span>
</span></span><span class="line"><span class="cl"><span class="n">N0</span>        <span class="p">:</span>      <span class="mi">8220658</span> <span class="p">(</span> <span class="mf">31.36</span> <span class="n">GB</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">N1</span>        <span class="p">:</span>        <span class="mi">38620</span> <span class="p">(</span>  <span class="mf">0.15</span> <span class="n">GB</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">N2</span>        <span class="p">:</span>       <span class="mi">480619</span> <span class="p">(</span>  <span class="mf">1.83</span> <span class="n">GB</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">N3</span>        <span class="p">:</span>      <span class="mi">8281759</span> <span class="p">(</span> <span class="mf">31.59</span> <span class="n">GB</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">active</span>    <span class="p">:</span>        <span class="mi">28797</span> <span class="p">(</span>  <span class="mf">0.11</span> <span class="n">GB</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">anon</span>      <span class="p">:</span>     <span class="mi">17015902</span> <span class="p">(</span> <span class="mf">64.91</span> <span class="n">GB</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">dirty</span>     <span class="p">:</span>     <span class="mi">16990615</span> <span class="p">(</span> <span class="mf">64.81</span> <span class="n">GB</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">kernelpagesize_kB</span><span class="p">:</span>         <span class="mi">9076</span> <span class="p">(</span>  <span class="mf">0.03</span> <span class="n">GB</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">mapmax</span>    <span class="p">:</span>          <span class="mi">760</span> <span class="p">(</span>  <span class="mf">0.00</span> <span class="n">GB</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">mapped</span>    <span class="p">:</span>         <span class="mi">5754</span> <span class="p">(</span>  <span class="mf">0.02</span> <span class="n">GB</span><span class="p">)</span></span></span></code></pre>
</div>
<p>重启进程后继续绑72-95core，在同一个numa下，先进成充分热身，然后2分钟的 Current tpmC: 77880</p>
<div class="code-block highlight is-open show-line-numbers  tw-group tw-my-2">
  <div class="
    code-block-title 
    
    tw-flex 
    tw-flex-row 
    tw-justify-between 
    tw-w-full tw-bg-bgColor-secondary
    ">      
    <button 
      class="
        tw-select-none 
        tw-mx-2 
        tw-block
        group-[.is-open]:tw-rotate-90
        tw-transition-[transform] 
        tw-duration-500 
        tw-ease-in-out
        print:!tw-hidden"
      disabled
      aria-hidden="true"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M285.476 272.971L91.132 467.314c-9.373 9.373-24.569 9.373-33.941 0l-22.667-22.667c-9.357-9.357-9.375-24.522-.04-33.901L188.505 256 34.484 101.255c-9.335-9.379-9.317-24.544.04-33.901l22.667-22.667c9.373-9.373 24.569-9.373 33.941 0L285.475 239.03c9.373 9.372 9.373 24.568.001 33.941z"/></svg></button>

    <div class="code-block-title-bar tw-w-full">
      <p class="tw-select-none !tw-my-1">text</p>
    </div>
    <div class="tw-flex">
      <button 
        class="
          line-number-button
          tw-select-none 
          tw-mx-2 
          tw-hidden 
          group-[.is-open]:tw-block 
          group-[.show-line-numbers]:tw-text-fgColor-link 
          print:!tw-hidden" 
        title="Toggle line numbers"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M61.77 401l17.5-20.15a19.92 19.92 0 0 0 5.07-14.19v-3.31C84.34 356 80.5 352 73 352H16a8 8 0 0 0-8 8v16a8 8 0 0 0 8 8h22.83a157.41 157.41 0 0 0-11 12.31l-5.61 7c-4 5.07-5.25 10.13-2.8 14.88l1.05 1.93c3 5.76 6.29 7.88 12.25 7.88h4.73c10.33 0 15.94 2.44 15.94 9.09 0 4.72-4.2 8.22-14.36 8.22a41.54 41.54 0 0 1-15.47-3.12c-6.49-3.88-11.74-3.5-15.6 3.12l-5.59 9.31c-3.72 6.13-3.19 11.72 2.63 15.94 7.71 4.69 20.38 9.44 37 9.44 34.16 0 48.5-22.75 48.5-44.12-.03-14.38-9.12-29.76-28.73-34.88zM496 224H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zm0-160H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16V80a16 16 0 0 0-16-16zm0 320H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zM16 160h64a8 8 0 0 0 8-8v-16a8 8 0 0 0-8-8H64V40a8 8 0 0 0-8-8H32a8 8 0 0 0-7.14 4.42l-8 16A8 8 0 0 0 24 64h8v64H16a8 8 0 0 0-8 8v16a8 8 0 0 0 8 8zm-3.91 160H80a8 8 0 0 0 8-8v-16a8 8 0 0 0-8-8H41.32c3.29-10.29 48.34-18.68 48.34-56.44 0-29.06-25-39.56-44.47-39.56-21.36 0-33.8 10-40.46 18.75-4.37 5.59-3 10.84 2.8 15.37l8.58 6.88c5.61 4.56 11 2.47 16.12-2.44a13.44 13.44 0 0 1 9.46-3.84c3.33 0 9.28 1.56 9.28 8.75C51 248.19 0 257.31 0 304.59v4C0 316 5.08 320 12.09 320z"/></svg></button>

      <button 
        class="
          wrap-code-button
          tw-select-none 
          tw-mx-2 
          tw-hidden 
          group-[.is-open]:tw-block 
          group-[.is-wrap]:tw-text-fgColor-link 
          print:!tw-hidden" 
        title="Toggle code wrap"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M16 132h416c8.837 0 16-7.163 16-16V76c0-8.837-7.163-16-16-16H16C7.163 60 0 67.163 0 76v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16z"/></svg></button>
      
      <button 
        class="
          copy-code-button
          tw-select-none
          tw-mx-2 
          tw-hidden
          group-[.is-open]:tw-block
          hover:tw-text-fgColor-link 
          print:!tw-hidden"
        title="Copy code">
          <span class="copy-icon tw-block"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M433.941 65.941l-51.882-51.882A48 48 0 0 0 348.118 0H176c-26.51 0-48 21.49-48 48v48H48c-26.51 0-48 21.49-48 48v320c0 26.51 21.49 48 48 48h224c26.51 0 48-21.49 48-48v-48h80c26.51 0 48-21.49 48-48V99.882a48 48 0 0 0-14.059-33.941zM266 464H54a6 6 0 0 1-6-6V150a6 6 0 0 1 6-6h74v224c0 26.51 21.49 48 48 48h96v42a6 6 0 0 1-6 6zm128-96H182a6 6 0 0 1-6-6V54a6 6 0 0 1 6-6h106v88c0 13.255 10.745 24 24 24h88v202a6 6 0 0 1-6 6zm6-256h-64V48h9.632c1.591 0 3.117.632 4.243 1.757l48.368 48.368a6 6 0 0 1 1.757 4.243V112z"/></svg></span>
          <span class="check-icon tw-hidden"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M173.898 439.404l-166.4-166.4c-9.997-9.997-9.997-26.206 0-36.204l36.203-36.204c9.997-9.998 26.207-9.998 36.204 0L192 312.69 432.095 72.596c9.997-9.997 26.207-9.997 36.204 0l36.203 36.204c9.997 9.997 9.997 26.206 0 36.204l-294.4 294.401c-9.998 9.997-26.207 9.997-36.204-.001z"/></svg></span>
      </button>
        
      <button 
        class="
          tw-select-none 
          tw-mx-2 
          tw-block 
          group-[.is-open]:tw-hidden 
          print:!tw-hidden" 
        disabled
        aria-hidden="true"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M328 256c0 39.8-32.2 72-72 72s-72-32.2-72-72 32.2-72 72-72 72 32.2 72 72zm104-72c-39.8 0-72 32.2-72 72s32.2 72 72 72 72-32.2 72-72-32.2-72-72-72zm-352 0c-39.8 0-72 32.2-72 72s32.2 72 72 72 72-32.2 72-72-32.2-72-72-72z"/></svg></button>
    </div>
  </div>
  <pre style="counter-reset: codeblock;" class="tw-block tw-m-0 tw-p-0"><code 
    id="codeblock-id-7" 
    class="
      chroma 
      !tw-block 
      tw-p-0
      tw-m-0
      tw-transition-[max-height] 
      tw-duration-500 
      tw-ease-in-out 
      group-[.is-closed]:!tw-max-h-0 
      group-[.is-wrap]:tw-text-wrap
      tw-overflow-y-hidden
      tw-overflow-x-auto
      tw-scrollbar-thin
      "><span class="line"><span class="cl"><span class="c1">#perf stat -e branch-misses,bus-cycles,cache-misses,cache-references,cpu-cycles,instructions,stalled-cycles-backend,stalled-cycles-frontend,L1-dcache-load-misses,L1-dcache-loads,L1-dcache-store-misses,L1-dcache-stores,L1-icache-load-misses,L1-icache-loads,branch-load-misses,branch-loads,dTLB-load-misses,dTLB-loads,iTLB-load-misses,iTLB-loads,cpu-migrations -p 49512</span>
</span></span><span class="line"><span class="cl"><span class="o">^</span><span class="n">C</span>
</span></span><span class="line"><span class="cl"> <span class="ne">Performance</span> <span class="n">counter</span> <span class="n">stats</span> <span class="k">for</span> <span class="n">process</span> <span class="n">id</span> <span class="s1">&#39;49512&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">     <span class="mi">1</span><span class="p">,</span><span class="mi">849</span><span class="p">,</span><span class="mi">313</span><span class="p">,</span><span class="mi">199</span>      <span class="n">branch</span><span class="o">-</span><span class="n">misses</span>                                                 <span class="p">(</span><span class="mf">59.99</span><span class="o">%</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">   <span class="mi">319</span><span class="p">,</span><span class="mi">122</span><span class="p">,</span><span class="mi">053</span><span class="p">,</span><span class="mi">367</span>      <span class="n">bus</span><span class="o">-</span><span class="n">cycles</span>                                                    <span class="p">(</span><span class="mf">60.02</span><span class="o">%</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">     <span class="mi">1</span><span class="p">,</span><span class="mi">319</span><span class="p">,</span><span class="mi">212</span><span class="p">,</span><span class="mi">546</span>      <span class="n">cache</span><span class="o">-</span><span class="n">misses</span>              <span class="c1">#    2.238 % of all cache refs      (59.95%)</span>
</span></span><span class="line"><span class="cl">    <span class="mi">58</span><span class="p">,</span><span class="mi">950</span><span class="p">,</span><span class="mi">581</span><span class="p">,</span><span class="mi">370</span>      <span class="n">cache</span><span class="o">-</span><span class="n">references</span>                                              <span class="p">(</span><span class="mf">60.02</span><span class="o">%</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">   <span class="mi">319</span><span class="p">,</span><span class="mi">088</span><span class="p">,</span><span class="mi">767</span><span class="p">,</span><span class="mi">311</span>      <span class="n">cpu</span><span class="o">-</span><span class="n">cycles</span>                                                    <span class="p">(</span><span class="mf">65.01</span><span class="o">%</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">   <span class="mi">146</span><span class="p">,</span><span class="mi">580</span><span class="p">,</span><span class="mi">891</span><span class="p">,</span><span class="mi">374</span>      <span class="n">instructions</span>              <span class="c1">#    0.46  insn per cycle</span>
</span></span><span class="line"><span class="cl">                                                  <span class="c1">#    1.32  stalled cycles per insn  (65.01%)</span>
</span></span><span class="line"><span class="cl">    <span class="mi">61</span><span class="p">,</span><span class="mi">109</span><span class="p">,</span><span class="mi">919</span><span class="p">,</span><span class="mi">226</span>      <span class="n">stalled</span><span class="o">-</span><span class="n">cycles</span><span class="o">-</span><span class="n">backend</span>    <span class="c1">#   19.15% backend cycles idle      (65.04%)</span>
</span></span><span class="line"><span class="cl">   <span class="mi">193</span><span class="p">,</span><span class="mi">963</span><span class="p">,</span><span class="mi">590</span><span class="p">,</span><span class="mi">196</span>      <span class="n">stalled</span><span class="o">-</span><span class="n">cycles</span><span class="o">-</span><span class="n">frontend</span>   <span class="c1">#   60.79% frontend cycles idle     (65.06%)</span>
</span></span><span class="line"><span class="cl">     <span class="mi">1</span><span class="p">,</span><span class="mi">319</span><span class="p">,</span><span class="mi">593</span><span class="p">,</span><span class="mi">051</span>      <span class="n">L1</span><span class="o">-</span><span class="n">dcache</span><span class="o">-</span><span class="nb">load</span><span class="o">-</span><span class="n">misses</span>     <span class="c1">#    2.24% of all L1-dcache hits    (65.03%)</span>
</span></span><span class="line"><span class="cl">    <span class="mi">58</span><span class="p">,</span><span class="mi">967</span><span class="p">,</span><span class="mi">303</span><span class="p">,</span><span class="mi">454</span>      <span class="n">L1</span><span class="o">-</span><span class="n">dcache</span><span class="o">-</span><span class="n">loads</span>                                               <span class="p">(</span><span class="mf">65.04</span><span class="o">%</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">     <span class="mi">1</span><span class="p">,</span><span class="mi">318</span><span class="p">,</span><span class="mi">842</span><span class="p">,</span><span class="mi">690</span>      <span class="n">L1</span><span class="o">-</span><span class="n">dcache</span><span class="o">-</span><span class="n">store</span><span class="o">-</span><span class="n">misses</span>                                        <span class="p">(</span><span class="mf">65.13</span><span class="o">%</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="mi">58</span><span class="p">,</span><span class="mi">988</span><span class="p">,</span><span class="mi">059</span><span class="p">,</span><span class="mi">583</span>      <span class="n">L1</span><span class="o">-</span><span class="n">dcache</span><span class="o">-</span><span class="n">stores</span>                                              <span class="p">(</span><span class="mf">65.07</span><span class="o">%</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">     <span class="mi">5</span><span class="p">,</span><span class="mi">769</span><span class="p">,</span><span class="mi">871</span><span class="p">,</span><span class="mi">870</span>      <span class="n">L1</span><span class="o">-</span><span class="n">icache</span><span class="o">-</span><span class="nb">load</span><span class="o">-</span><span class="n">misses</span>     <span class="c1">#   12.25% of all L1-icache hits    (65.12%)</span>
</span></span><span class="line"><span class="cl">    <span class="mi">47</span><span class="p">,</span><span class="mi">085</span><span class="p">,</span><span class="mi">299</span><span class="p">,</span><span class="mi">316</span>      <span class="n">L1</span><span class="o">-</span><span class="n">icache</span><span class="o">-</span><span class="n">loads</span>                                               <span class="p">(</span><span class="mf">65.10</span><span class="o">%</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">     <span class="mi">1</span><span class="p">,</span><span class="mi">850</span><span class="p">,</span><span class="mi">419</span><span class="p">,</span><span class="mi">802</span>      <span class="n">branch</span><span class="o">-</span><span class="nb">load</span><span class="o">-</span><span class="n">misses</span>                                            <span class="p">(</span><span class="mf">65.03</span><span class="o">%</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="mi">33</span><span class="p">,</span><span class="mi">687</span><span class="p">,</span><span class="mi">548</span><span class="p">,</span><span class="mi">636</span>      <span class="n">branch</span><span class="o">-</span><span class="n">loads</span>                                                  <span class="p">(</span><span class="mf">65.08</span><span class="o">%</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">     <span class="mi">2</span><span class="p">,</span><span class="mi">375</span><span class="p">,</span><span class="mi">028</span><span class="p">,</span><span class="mi">039</span>      <span class="n">dTLB</span><span class="o">-</span><span class="nb">load</span><span class="o">-</span><span class="n">misses</span>          <span class="c1">#    3.12% of all dTLB cache hits   (65.08%)</span>
</span></span><span class="line"><span class="cl">    <span class="mi">76</span><span class="p">,</span><span class="mi">113</span><span class="p">,</span><span class="mi">084</span><span class="p">,</span><span class="mi">244</span>      <span class="n">dTLB</span><span class="o">-</span><span class="n">loads</span>                                                    <span class="p">(</span><span class="mf">60.01</span><span class="o">%</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">       <span class="mi">825</span><span class="p">,</span><span class="mi">388</span><span class="p">,</span><span class="mi">210</span>      <span class="n">iTLB</span><span class="o">-</span><span class="nb">load</span><span class="o">-</span><span class="n">misses</span>          <span class="c1">#    1.75% of all iTLB cache hits   (59.99%)</span>
</span></span><span class="line"><span class="cl">    <span class="mi">47</span><span class="p">,</span><span class="mi">092</span><span class="p">,</span><span class="mi">738</span><span class="p">,</span><span class="mi">092</span>      <span class="n">iTLB</span><span class="o">-</span><span class="n">loads</span>                                                    <span class="p">(</span><span class="mf">59.95</span><span class="o">%</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="mi">49</span>      <span class="n">cpu</span><span class="o">-</span><span class="n">migrations</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#/root/numa-maps-summary.pl &lt;/proc/49512/numa_maps</span>
</span></span><span class="line"><span class="cl"><span class="n">N0</span>        <span class="p">:</span>         <span class="mi">5765</span> <span class="p">(</span>  <span class="mf">0.02</span> <span class="n">GB</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">N1</span>        <span class="p">:</span>        <span class="mi">41599</span> <span class="p">(</span>  <span class="mf">0.16</span> <span class="n">GB</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">N2</span>        <span class="p">:</span>          <span class="mi">566</span> <span class="p">(</span>  <span class="mf">0.00</span> <span class="n">GB</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">N3</span>        <span class="p">:</span>     <span class="mi">16955491</span> <span class="p">(</span> <span class="mf">64.68</span> <span class="n">GB</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">active</span>    <span class="p">:</span>        <span class="mi">30430</span> <span class="p">(</span>  <span class="mf">0.12</span> <span class="n">GB</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">anon</span>      <span class="p">:</span>     <span class="mi">16997663</span> <span class="p">(</span> <span class="mf">64.84</span> <span class="n">GB</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">dirty</span>     <span class="p">:</span>     <span class="mi">16989252</span> <span class="p">(</span> <span class="mf">64.81</span> <span class="n">GB</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">kernelpagesize_kB</span><span class="p">:</span>         <span class="mi">9020</span> <span class="p">(</span>  <span class="mf">0.03</span> <span class="n">GB</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">mapmax</span>    <span class="p">:</span>          <span class="mi">745</span> <span class="p">(</span>  <span class="mf">0.00</span> <span class="n">GB</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">mapped</span>    <span class="p">:</span>         <span class="mi">5758</span> <span class="p">(</span>  <span class="mf">0.02</span> <span class="n">GB</span><span class="p">)</span> </span></span></code></pre>
</div>
<p>IPC从0.42到0.44再到0.46，tpmC也不断增加，整体压力都不大只压了25%的CPU，所以跨NUMA大概有10%的性能差异. IPC也是0.42 VS 0.46 。测试场景是DRDS Server服务。</p>
<p>如果跨4core绑定core的话最好和最差绑法性能会下降25-30%，四个core绑不同numa的性能比较</p>

<div class="table-wrapper">
  <table>
    <thead>
        <tr>
            <th style="text-align: ">被压进程绑定的core id</th>
            <th style="text-align: ">tpmC</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td style="text-align: ">72,73,74,75</td>
            <td style="text-align: ">14460</td>
        </tr>
        <tr>
            <td style="text-align: ">48,49,72,73</td>
            <td style="text-align: ">13800</td>
        </tr>
        <tr>
            <td style="text-align: ">24,25,72,73</td>
            <td style="text-align: ">11760</td>
        </tr>
        <tr>
            <td style="text-align: ">0,1,72,73</td>
            <td style="text-align: ">11940</td>
        </tr>
        <tr>
            <td style="text-align: ">0,24,48,72</td>
            <td style="text-align: ">10800</td>
        </tr>
    </tbody>
  </table>
</div>
<h3 id="飞腾2500" class="headerLink">
    <a href="#%e9%a3%9e%e8%85%be2500" class="header-mark"></a>飞腾2500</h3><div class="code-block highlight is-open show-line-numbers  tw-group tw-my-2">
  <div class="
    code-block-title 
    
    tw-flex 
    tw-flex-row 
    tw-justify-between 
    tw-w-full tw-bg-bgColor-secondary
    ">      
    <button 
      class="
        tw-select-none 
        tw-mx-2 
        tw-block
        group-[.is-open]:tw-rotate-90
        tw-transition-[transform] 
        tw-duration-500 
        tw-ease-in-out
        print:!tw-hidden"
      disabled
      aria-hidden="true"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M285.476 272.971L91.132 467.314c-9.373 9.373-24.569 9.373-33.941 0l-22.667-22.667c-9.357-9.357-9.375-24.522-.04-33.901L188.505 256 34.484 101.255c-9.335-9.379-9.317-24.544.04-33.901l22.667-22.667c9.373-9.373 24.569-9.373 33.941 0L285.475 239.03c9.373 9.372 9.373 24.568.001 33.941z"/></svg></button>

    <div class="code-block-title-bar tw-w-full">
      <p class="tw-select-none !tw-my-1">text</p>
    </div>
    <div class="tw-flex">
      <button 
        class="
          line-number-button
          tw-select-none 
          tw-mx-2 
          tw-hidden 
          group-[.is-open]:tw-block 
          group-[.show-line-numbers]:tw-text-fgColor-link 
          print:!tw-hidden" 
        title="Toggle line numbers"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M61.77 401l17.5-20.15a19.92 19.92 0 0 0 5.07-14.19v-3.31C84.34 356 80.5 352 73 352H16a8 8 0 0 0-8 8v16a8 8 0 0 0 8 8h22.83a157.41 157.41 0 0 0-11 12.31l-5.61 7c-4 5.07-5.25 10.13-2.8 14.88l1.05 1.93c3 5.76 6.29 7.88 12.25 7.88h4.73c10.33 0 15.94 2.44 15.94 9.09 0 4.72-4.2 8.22-14.36 8.22a41.54 41.54 0 0 1-15.47-3.12c-6.49-3.88-11.74-3.5-15.6 3.12l-5.59 9.31c-3.72 6.13-3.19 11.72 2.63 15.94 7.71 4.69 20.38 9.44 37 9.44 34.16 0 48.5-22.75 48.5-44.12-.03-14.38-9.12-29.76-28.73-34.88zM496 224H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zm0-160H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16V80a16 16 0 0 0-16-16zm0 320H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zM16 160h64a8 8 0 0 0 8-8v-16a8 8 0 0 0-8-8H64V40a8 8 0 0 0-8-8H32a8 8 0 0 0-7.14 4.42l-8 16A8 8 0 0 0 24 64h8v64H16a8 8 0 0 0-8 8v16a8 8 0 0 0 8 8zm-3.91 160H80a8 8 0 0 0 8-8v-16a8 8 0 0 0-8-8H41.32c3.29-10.29 48.34-18.68 48.34-56.44 0-29.06-25-39.56-44.47-39.56-21.36 0-33.8 10-40.46 18.75-4.37 5.59-3 10.84 2.8 15.37l8.58 6.88c5.61 4.56 11 2.47 16.12-2.44a13.44 13.44 0 0 1 9.46-3.84c3.33 0 9.28 1.56 9.28 8.75C51 248.19 0 257.31 0 304.59v4C0 316 5.08 320 12.09 320z"/></svg></button>

      <button 
        class="
          wrap-code-button
          tw-select-none 
          tw-mx-2 
          tw-hidden 
          group-[.is-open]:tw-block 
          group-[.is-wrap]:tw-text-fgColor-link 
          print:!tw-hidden" 
        title="Toggle code wrap"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M16 132h416c8.837 0 16-7.163 16-16V76c0-8.837-7.163-16-16-16H16C7.163 60 0 67.163 0 76v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16z"/></svg></button>
      
      <button 
        class="
          copy-code-button
          tw-select-none
          tw-mx-2 
          tw-hidden
          group-[.is-open]:tw-block
          hover:tw-text-fgColor-link 
          print:!tw-hidden"
        title="Copy code">
          <span class="copy-icon tw-block"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M433.941 65.941l-51.882-51.882A48 48 0 0 0 348.118 0H176c-26.51 0-48 21.49-48 48v48H48c-26.51 0-48 21.49-48 48v320c0 26.51 21.49 48 48 48h224c26.51 0 48-21.49 48-48v-48h80c26.51 0 48-21.49 48-48V99.882a48 48 0 0 0-14.059-33.941zM266 464H54a6 6 0 0 1-6-6V150a6 6 0 0 1 6-6h74v224c0 26.51 21.49 48 48 48h96v42a6 6 0 0 1-6 6zm128-96H182a6 6 0 0 1-6-6V54a6 6 0 0 1 6-6h106v88c0 13.255 10.745 24 24 24h88v202a6 6 0 0 1-6 6zm6-256h-64V48h9.632c1.591 0 3.117.632 4.243 1.757l48.368 48.368a6 6 0 0 1 1.757 4.243V112z"/></svg></span>
          <span class="check-icon tw-hidden"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M173.898 439.404l-166.4-166.4c-9.997-9.997-9.997-26.206 0-36.204l36.203-36.204c9.997-9.998 26.207-9.998 36.204 0L192 312.69 432.095 72.596c9.997-9.997 26.207-9.997 36.204 0l36.203 36.204c9.997 9.997 9.997 26.206 0 36.204l-294.4 294.401c-9.998 9.997-26.207 9.997-36.204-.001z"/></svg></span>
      </button>
        
      <button 
        class="
          tw-select-none 
          tw-mx-2 
          tw-block 
          group-[.is-open]:tw-hidden 
          print:!tw-hidden" 
        disabled
        aria-hidden="true"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M328 256c0 39.8-32.2 72-72 72s-72-32.2-72-72 32.2-72 72-72 72 32.2 72 72zm104-72c-39.8 0-72 32.2-72 72s32.2 72 72 72 72-32.2 72-72-32.2-72-72-72zm-352 0c-39.8 0-72 32.2-72 72s32.2 72 72 72 72-32.2 72-72-32.2-72-72-72z"/></svg></button>
    </div>
  </div>
  <pre style="counter-reset: codeblock;" class="tw-block tw-m-0 tw-p-0"><code 
    id="codeblock-id-8" 
    class="
      chroma 
      !tw-block 
      tw-p-0
      tw-m-0
      tw-transition-[max-height] 
      tw-duration-500 
      tw-ease-in-out 
      group-[.is-closed]:!tw-max-h-0 
      group-[.is-wrap]:tw-text-wrap
      tw-overflow-y-hidden
      tw-overflow-x-auto
      tw-scrollbar-thin
      "><span class="line"><span class="cl">#lscpu
</span></span><span class="line"><span class="cl">Architecture:          aarch64
</span></span><span class="line"><span class="cl">Byte Order:            Little Endian
</span></span><span class="line"><span class="cl">CPU(s):                128
</span></span><span class="line"><span class="cl">On-line CPU(s) list:   0-127
</span></span><span class="line"><span class="cl">Thread(s) per core:    1
</span></span><span class="line"><span class="cl">Core(s) per socket:    64
</span></span><span class="line"><span class="cl">Socket(s):             2
</span></span><span class="line"><span class="cl">NUMA node(s):          16
</span></span><span class="line"><span class="cl">Model:                 3
</span></span><span class="line"><span class="cl">BogoMIPS:              100.00
</span></span><span class="line"><span class="cl">L1d cache:             32K
</span></span><span class="line"><span class="cl">L1i cache:             32K
</span></span><span class="line"><span class="cl">L2 cache:              2048K
</span></span><span class="line"><span class="cl">L3 cache:              65536K
</span></span><span class="line"><span class="cl">NUMA node0 CPU(s):     0-7
</span></span><span class="line"><span class="cl">NUMA node1 CPU(s):     8-15
</span></span><span class="line"><span class="cl">NUMA node2 CPU(s):     16-23
</span></span><span class="line"><span class="cl">NUMA node3 CPU(s):     24-31
</span></span><span class="line"><span class="cl">NUMA node4 CPU(s):     32-39
</span></span><span class="line"><span class="cl">NUMA node5 CPU(s):     40-47
</span></span><span class="line"><span class="cl">NUMA node6 CPU(s):     48-55
</span></span><span class="line"><span class="cl">NUMA node7 CPU(s):     56-63
</span></span><span class="line"><span class="cl">NUMA node8 CPU(s):     64-71
</span></span><span class="line"><span class="cl">NUMA node9 CPU(s):     72-79
</span></span><span class="line"><span class="cl">NUMA node10 CPU(s):    80-87
</span></span><span class="line"><span class="cl">NUMA node11 CPU(s):    88-95
</span></span><span class="line"><span class="cl">NUMA node12 CPU(s):    96-103
</span></span><span class="line"><span class="cl">NUMA node13 CPU(s):    104-111
</span></span><span class="line"><span class="cl">NUMA node14 CPU(s):    112-119
</span></span><span class="line"><span class="cl">NUMA node15 CPU(s):    120-127
</span></span><span class="line"><span class="cl">Flags:                 fp asimd evtstrm aes pmull sha1 sha2 crc32 cpuid
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">node distances:
</span></span><span class="line"><span class="cl">node   0   1   2   3   4   5   6   7   8   9  10  11  12  13  14  15
</span></span><span class="line"><span class="cl">  0:  10  20  40  30  20  30  50  40  100  100  100  100  100  100  100  100
</span></span><span class="line"><span class="cl">  1:  20  10  30  40  50  20  40  50  100  100  100  100  100  100  100  100
</span></span><span class="line"><span class="cl">  2:  40  30  10  20  40  50  20  30  100  100  100  100  100  100  100  100
</span></span><span class="line"><span class="cl">  3:  30  40  20  10  30  20  40  50  100  100  100  100  100  100  100  100
</span></span><span class="line"><span class="cl">  4:  20  50  40  30  10  50  30  20  100  100  100  100  100  100  100  100
</span></span><span class="line"><span class="cl">  5:  30  20  50  20  50  10  50  40  100  100  100  100  100  100  100  100
</span></span><span class="line"><span class="cl">  6:  50  40  20  40  30  50  10  30  100  100  100  100  100  100  100  100
</span></span><span class="line"><span class="cl">  7:  40  50  30  50  20  40  30  10  100  100  100  100  100  100  100  100
</span></span><span class="line"><span class="cl">  8:  100  100  100  100  100  100  100  100  10  20  40  30  20  30  50  40
</span></span><span class="line"><span class="cl">  9:  100  100  100  100  100  100  100  100  20  10  30  40  50  20  40  50
</span></span><span class="line"><span class="cl"> 10:  100  100  100  100  100  100  100  100  40  30  10  20  40  50  20  30
</span></span><span class="line"><span class="cl"> 11:  100  100  100  100  100  100  100  100  30  40  20  10  30  20  40  50
</span></span><span class="line"><span class="cl"> 12:  100  100  100  100  100  100  100  100  20  50  40  30  10  50  30  20
</span></span><span class="line"><span class="cl"> 13:  100  100  100  100  100  100  100  100  30  20  50  20  50  10  50  40
</span></span><span class="line"><span class="cl"> 14:  100  100  100  100  100  100  100  100  50  40  20  40  30  50  10  30
</span></span><span class="line"><span class="cl"> 15:  100  100  100  100  100  100  100  100  40  50  30  50  20  40  30  10
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">#dmidecode -t processor
</span></span><span class="line"><span class="cl"># dmidecode 3.0
</span></span><span class="line"><span class="cl">Getting SMBIOS data from sysfs.
</span></span><span class="line"><span class="cl">SMBIOS 3.2.0 present.
</span></span><span class="line"><span class="cl"># SMBIOS implementations newer than version 3.0 are not
</span></span><span class="line"><span class="cl"># fully supported by this version of dmidecode.
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Handle 0x0004, DMI type 4, 48 bytes
</span></span><span class="line"><span class="cl">Processor Information
</span></span><span class="line"><span class="cl">    Socket Designation: BGA3576
</span></span><span class="line"><span class="cl">    Type: Central Processor
</span></span><span class="line"><span class="cl">    Family: &lt;OUT OF SPEC&gt;
</span></span><span class="line"><span class="cl">    Manufacturer: PHYTIUM
</span></span><span class="line"><span class="cl">    ID: 00 00 00 00 70 1F 66 22
</span></span><span class="line"><span class="cl">    Version: FT2500
</span></span><span class="line"><span class="cl">    Voltage: 0.8 V
</span></span><span class="line"><span class="cl">    External Clock: 50 MHz
</span></span><span class="line"><span class="cl">    Max Speed: 2100 MHz
</span></span><span class="line"><span class="cl">    Current Speed: 2100 MHz
</span></span><span class="line"><span class="cl">    Status: Populated, Enabled
</span></span><span class="line"><span class="cl">    Upgrade: Other
</span></span><span class="line"><span class="cl">    L1 Cache Handle: 0x0005
</span></span><span class="line"><span class="cl">    L2 Cache Handle: 0x0007
</span></span><span class="line"><span class="cl">    L3 Cache Handle: 0x0008
</span></span><span class="line"><span class="cl">    Serial Number: 1234567
</span></span><span class="line"><span class="cl">    Asset Tag: No Asset Tag
</span></span><span class="line"><span class="cl">    Part Number: NULL
</span></span><span class="line"><span class="cl">    Core Count: 64
</span></span><span class="line"><span class="cl">    Core Enabled: 64
</span></span><span class="line"><span class="cl">    Thread Count: 64
</span></span><span class="line"><span class="cl">    Characteristics:
</span></span><span class="line"><span class="cl">        64-bit capable
</span></span><span class="line"><span class="cl">        Multi-Core
</span></span><span class="line"><span class="cl">        Hardware Thread
</span></span><span class="line"><span class="cl">        Execute Protection
</span></span><span class="line"><span class="cl">        Enhanced Virtualization
</span></span><span class="line"><span class="cl">        Power/Performance Control</span></span></code></pre>
</div>
<h3 id="申威3231" class="headerLink">
    <a href="#%e7%94%b3%e5%a8%813231" class="header-mark"></a>申威3231</h3><p>申威系列微处理器的开发主要是被<a href="https://zh.wikipedia.org/wiki/%e4%b8%ad%e5%8d%8e%e4%ba%ba%e6%b0%91%e5%85%b1%e5%92%8c%e5%9b%bd" target="_blank" rel="noopener noreferrer">中华人民共和国</a>用于军事方面[<a href="https://zh.wikipedia.org/wiki/Wikipedia:%e5%88%97%e6%98%8e%e6%9d%a5%e6%ba%90" target="_blank" rel="noopener noreferrer">来源请求]</a>。根据部分公开信息表明，此系列的微体系架构基于<a href="https://zh.wikipedia.org/wiki/DEC_Alpha" target="_blank" rel="noopener noreferrer">DEC Alpha</a>派生而来。[<a href="https://zh.wikipedia.org/wiki/%e7%94%b3%e5%a8%81%e5%a4%84%e7%90%86%e5%99%a8#cite_note-gen123-1" target="_blank" rel="noopener noreferrer">1]</a>[<a href="https://zh.wikipedia.org/wiki/%e7%94%b3%e5%a8%81%e5%a4%84%e7%90%86%e5%99%a8#cite_note-linkedin-chengang-2" target="_blank" rel="noopener noreferrer">2]</a>而SW-3/SW1600处理器则是基于Alpha 21164。[<a href="https://zh.wikipedia.org/wiki/%e7%94%b3%e5%a8%81%e5%a4%84%e7%90%86%e5%99%a8#cite_note-3" target="_blank" rel="noopener noreferrer">3]</a></p>
<p>不过申威系列最新的SW26010处理器，目前没有详细的信息表明它是基于DEC Alpha微架构的派生品。[<a href="https://zh.wikipedia.org/wiki/%e7%94%b3%e5%a8%81%e5%a4%84%e7%90%86%e5%99%a8#cite_note-dongarra2016-4" target="_blank" rel="noopener noreferrer">4]</a>[<a href="https://zh.wikipedia.org/wiki/%e7%94%b3%e5%a8%81%e5%a4%84%e7%90%86%e5%99%a8#cite_note-next-platform-5" target="_blank" rel="noopener noreferrer">5]</a>不过处理器的处理器核心结构布局，则是类似于基于POWER指令集架构的<a href="https://zh.wikipedia.org/wiki/Cell_%28%e5%be%ae%e8%99%95%e7%90%86%e5%99%a8%29" target="_blank" rel="noopener noreferrer">Cell微架构</a>。</p>
<p>申威 3231处理器是基于第三代“申威 64” 二次优化版核心（C3B）的国产高性能多核处理器。3231的内核与1621属于同一代，采用新一代工艺，最高主频2.5Ghz，32核心，3231基本上可以视为1621换工艺后的32核版本，主要面向高性能计算和高端服务器应用。</p>
<p>申威 3231采用“申威64”自主指令系统；</p>
<p>基于第三代“申威 64”二次优化版核心（C3B）的32核64位通用处理器;</p>
<p>采用CC-NUMA多核结构和SoC技术，片内包含8路DDR4存储控制器接口以及40lane的PCI-E 4.0标准I/O接口；</p>
<p>集成3路直连接口，可构建2路或4路服务器系统；</p>
<p>计算性能：双精度浮点性能可达1280GFlops，整数性能可达880Gops；</p>
<p>访存性能：最大传输率为3200Mbps，最大总存储器容量2TB；</p>
<p>I/O性能：双向聚合有效带宽可达到160GB/s，支持I/O虚拟化。</p>
<p><img class="tw-inline" loading="lazy" src=https://cdn.jsdelivr.net/gh/plantegg/plantegg.github.io/images/951413iMgBlog/641.png   alt="img"  ></p>
<p>3232推出的时间会比3231迟一些，采用新一代CPU核，IPC会非常惊人，保底10/G，争取12/G，考虑倒申威团队一向严谨，以及过去基本没有让大家失望过，因而对3232的IPC，可以采用就高原则。</p>
<p>申威 3231架构</p>
<p><img class="tw-inline" loading="lazy" src=https://cdn.jsdelivr.net/gh/plantegg/plantegg.github.io/images/951413iMgBlog/1604285554727-f6a30266-c4be-42b4-ad77-2fabbf066070.png   alt="image.png"  ></p>
<p>申威 6B 芯片结构的主要特点如下：</p>
<ul>
<li>
<p>全芯片集成 32 个物理核心，每个物理核心支持 1 个线程，软件可见 32 个逻辑核心；</p>
</li>
<li>
<p>每个物理核心集成 32KB L1 指令 Cache（ICache）、32KB L1 数据 Cache（DCache）和 512KB 的 L2 Cache（SCache），核心内的所有 Cache 为核心私有 Cache；</p>
</li>
<li>
<p>全芯片集成 64MB 的 L3 Cache（TCache），本芯片内所有核心分布共享，TCache 由16 个体组成，每个体跟2 个物理核心及其对应的管理部件（LCPM）一起组成一个核组，连接在环网节点上，核心访问不同 TCache 体中的副本延迟略有不同；</p>
</li>
<li>
<p>存储器接口：全芯片集成 8 个 DDR4 存储器通道，每个通道数据宽度为 72bit（含 8 位 ECC），支持 UDIMM、RDIMM 和 LRDIMM，单通道内存容量最大支持 256GB 容量，单通道带宽可达 25.6GB/s（DDR4-3200）；每4 个存储器通道对应一个主存代理部件（GCPM），所有核心和 IO 设备都可访问；</p>
</li>
<li>
<p>PCIe 接口：全芯片集成 40 Lane 的 PCIe 4.0 链路，支持 x4、x8 和 x16 灵活配置，最大支持 6 个 RC；</p>
</li>
<li>
<p>直连接口：全芯片集成 3 路直连接口，可构建 2 路或 4 路服务器系统，每路直连接口为9 个lane的serdes 接口，接口速率为28Gbps；</p>
</li>
<li>
<p>维护调试测试接口：维护控制部件实现芯片配置、初始引导以及提供各种维护和调试支持。维护控制部件支持芯片的上电初始化、配置加载、存储器读写或 IO 读写、维护中断以及内部状态的扫描观测等。支持外部维护通过 Jtag 接口进行初始引导；支持通过 SPI Master 接口从 SPI Flash中进行自举引导；</p>
</li>
<li>
<p>集成三套 I2C 接口、一套 Uart、GPIO 和 LPC 低速接口。</p>
</li>
</ul>
<p>申威1621处理器是基于第三代“申威64”核心（增强版）的国产高性能多核处理器，主要面向高性能计算和中高端服务器应用。目前，该处理器已经实现量产。</p>
<p><img class="tw-inline" loading="lazy" src=https://cdn.jsdelivr.net/gh/plantegg/plantegg.github.io/images/951413iMgBlog/20170829092439580.png   alt="img"  >    申威1621采用对称多核结构和SoC技术，单芯片集成了16个64位RISC结构的申威处理器核心，目标设计主频为2GHz。芯片还集成八路DDR3存储控制器和双路PCI-E3.0标准I/O接口。</p>
<div class="code-block highlight is-open show-line-numbers  tw-group tw-my-2">
  <div class="
    code-block-title 
    
    tw-flex 
    tw-flex-row 
    tw-justify-between 
    tw-w-full tw-bg-bgColor-secondary
    ">      
    <button 
      class="
        tw-select-none 
        tw-mx-2 
        tw-block
        group-[.is-open]:tw-rotate-90
        tw-transition-[transform] 
        tw-duration-500 
        tw-ease-in-out
        print:!tw-hidden"
      disabled
      aria-hidden="true"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M285.476 272.971L91.132 467.314c-9.373 9.373-24.569 9.373-33.941 0l-22.667-22.667c-9.357-9.357-9.375-24.522-.04-33.901L188.505 256 34.484 101.255c-9.335-9.379-9.317-24.544.04-33.901l22.667-22.667c9.373-9.373 24.569-9.373 33.941 0L285.475 239.03c9.373 9.372 9.373 24.568.001 33.941z"/></svg></button>

    <div class="code-block-title-bar tw-w-full">
      <p class="tw-select-none !tw-my-1">text</p>
    </div>
    <div class="tw-flex">
      <button 
        class="
          line-number-button
          tw-select-none 
          tw-mx-2 
          tw-hidden 
          group-[.is-open]:tw-block 
          group-[.show-line-numbers]:tw-text-fgColor-link 
          print:!tw-hidden" 
        title="Toggle line numbers"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M61.77 401l17.5-20.15a19.92 19.92 0 0 0 5.07-14.19v-3.31C84.34 356 80.5 352 73 352H16a8 8 0 0 0-8 8v16a8 8 0 0 0 8 8h22.83a157.41 157.41 0 0 0-11 12.31l-5.61 7c-4 5.07-5.25 10.13-2.8 14.88l1.05 1.93c3 5.76 6.29 7.88 12.25 7.88h4.73c10.33 0 15.94 2.44 15.94 9.09 0 4.72-4.2 8.22-14.36 8.22a41.54 41.54 0 0 1-15.47-3.12c-6.49-3.88-11.74-3.5-15.6 3.12l-5.59 9.31c-3.72 6.13-3.19 11.72 2.63 15.94 7.71 4.69 20.38 9.44 37 9.44 34.16 0 48.5-22.75 48.5-44.12-.03-14.38-9.12-29.76-28.73-34.88zM496 224H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zm0-160H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16V80a16 16 0 0 0-16-16zm0 320H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zM16 160h64a8 8 0 0 0 8-8v-16a8 8 0 0 0-8-8H64V40a8 8 0 0 0-8-8H32a8 8 0 0 0-7.14 4.42l-8 16A8 8 0 0 0 24 64h8v64H16a8 8 0 0 0-8 8v16a8 8 0 0 0 8 8zm-3.91 160H80a8 8 0 0 0 8-8v-16a8 8 0 0 0-8-8H41.32c3.29-10.29 48.34-18.68 48.34-56.44 0-29.06-25-39.56-44.47-39.56-21.36 0-33.8 10-40.46 18.75-4.37 5.59-3 10.84 2.8 15.37l8.58 6.88c5.61 4.56 11 2.47 16.12-2.44a13.44 13.44 0 0 1 9.46-3.84c3.33 0 9.28 1.56 9.28 8.75C51 248.19 0 257.31 0 304.59v4C0 316 5.08 320 12.09 320z"/></svg></button>

      <button 
        class="
          wrap-code-button
          tw-select-none 
          tw-mx-2 
          tw-hidden 
          group-[.is-open]:tw-block 
          group-[.is-wrap]:tw-text-fgColor-link 
          print:!tw-hidden" 
        title="Toggle code wrap"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M16 132h416c8.837 0 16-7.163 16-16V76c0-8.837-7.163-16-16-16H16C7.163 60 0 67.163 0 76v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16z"/></svg></button>
      
      <button 
        class="
          copy-code-button
          tw-select-none
          tw-mx-2 
          tw-hidden
          group-[.is-open]:tw-block
          hover:tw-text-fgColor-link 
          print:!tw-hidden"
        title="Copy code">
          <span class="copy-icon tw-block"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M433.941 65.941l-51.882-51.882A48 48 0 0 0 348.118 0H176c-26.51 0-48 21.49-48 48v48H48c-26.51 0-48 21.49-48 48v320c0 26.51 21.49 48 48 48h224c26.51 0 48-21.49 48-48v-48h80c26.51 0 48-21.49 48-48V99.882a48 48 0 0 0-14.059-33.941zM266 464H54a6 6 0 0 1-6-6V150a6 6 0 0 1 6-6h74v224c0 26.51 21.49 48 48 48h96v42a6 6 0 0 1-6 6zm128-96H182a6 6 0 0 1-6-6V54a6 6 0 0 1 6-6h106v88c0 13.255 10.745 24 24 24h88v202a6 6 0 0 1-6 6zm6-256h-64V48h9.632c1.591 0 3.117.632 4.243 1.757l48.368 48.368a6 6 0 0 1 1.757 4.243V112z"/></svg></span>
          <span class="check-icon tw-hidden"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M173.898 439.404l-166.4-166.4c-9.997-9.997-9.997-26.206 0-36.204l36.203-36.204c9.997-9.998 26.207-9.998 36.204 0L192 312.69 432.095 72.596c9.997-9.997 26.207-9.997 36.204 0l36.203 36.204c9.997 9.997 9.997 26.206 0 36.204l-294.4 294.401c-9.998 9.997-26.207 9.997-36.204-.001z"/></svg></span>
      </button>
        
      <button 
        class="
          tw-select-none 
          tw-mx-2 
          tw-block 
          group-[.is-open]:tw-hidden 
          print:!tw-hidden" 
        disabled
        aria-hidden="true"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M328 256c0 39.8-32.2 72-72 72s-72-32.2-72-72 32.2-72 72-72 72 32.2 72 72zm104-72c-39.8 0-72 32.2-72 72s32.2 72 72 72 72-32.2 72-72-32.2-72-72-72zm-352 0c-39.8 0-72 32.2-72 72s32.2 72 72 72 72-32.2 72-72-32.2-72-72-72z"/></svg></button>
    </div>
  </div>
  <pre style="counter-reset: codeblock;" class="tw-block tw-m-0 tw-p-0"><code 
    id="codeblock-id-9" 
    class="
      chroma 
      !tw-block 
      tw-p-0
      tw-m-0
      tw-transition-[max-height] 
      tw-duration-500 
      tw-ease-in-out 
      group-[.is-closed]:!tw-max-h-0 
      group-[.is-wrap]:tw-text-wrap
      tw-overflow-y-hidden
      tw-overflow-x-auto
      tw-scrollbar-thin
      "><span class="line"><span class="cl">#dmidecode -t processor
</span></span><span class="line"><span class="cl"># dmidecode 3.0
</span></span><span class="line"><span class="cl">Getting SMBIOS data from sysfs.
</span></span><span class="line"><span class="cl">SMBIOS 3.2.0 present.
</span></span><span class="line"><span class="cl"># SMBIOS implementations newer than version 3.0 are not
</span></span><span class="line"><span class="cl"># fully supported by this version of dmidecode.
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Handle 0x0022, DMI type 4, 48 bytes
</span></span><span class="line"><span class="cl">Processor Information
</span></span><span class="line"><span class="cl">        Socket Designation: CPU 0
</span></span><span class="line"><span class="cl">        Type: Central Processor
</span></span><span class="line"><span class="cl">        Family: Other
</span></span><span class="line"><span class="cl">        Manufacturer: SW3231
</span></span><span class="line"><span class="cl">        ID: 28 00 C8 80 01 00 00 00
</span></span><span class="line"><span class="cl">        Version: Product
</span></span><span class="line"><span class="cl">        Voltage: 3.3 V
</span></span><span class="line"><span class="cl">        External Clock: 200 MHz
</span></span><span class="line"><span class="cl">        Max Speed: 2400 MHz
</span></span><span class="line"><span class="cl">        Current Speed: 2400 MHz
</span></span><span class="line"><span class="cl">        Status: Unpopulated
</span></span><span class="line"><span class="cl">        Upgrade: Other
</span></span><span class="line"><span class="cl">        L1 Cache Handle: 0x2000
</span></span><span class="line"><span class="cl">        L2 Cache Handle: 0x2002
</span></span><span class="line"><span class="cl">        L3 Cache Handle: 0x2003
</span></span><span class="line"><span class="cl">        Serial Number: .......
</span></span><span class="line"><span class="cl">        Asset Tag: Asset Tag#To Be Filled By O.E.M.
</span></span><span class="line"><span class="cl">        Part Number: Part Number#To Be Filled By O.E.M.
</span></span><span class="line"><span class="cl">        Core Count: 32
</span></span><span class="line"><span class="cl">        Core Enabled: 32
</span></span><span class="line"><span class="cl">        Thread Count: 0
</span></span><span class="line"><span class="cl">        Characteristics:
</span></span><span class="line"><span class="cl">                64-bit capable
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Handle 0x0023, DMI type 4, 48 bytes
</span></span><span class="line"><span class="cl">Processor Information
</span></span><span class="line"><span class="cl">        Socket Designation: CPU 1
</span></span><span class="line"><span class="cl">        Type: Central Processor
</span></span><span class="line"><span class="cl">        Family: Other
</span></span><span class="line"><span class="cl">        Manufacturer: SW3231
</span></span><span class="line"><span class="cl">        ID: 28 00 C8 80 01 00 00 00
</span></span><span class="line"><span class="cl">        Version: Product
</span></span><span class="line"><span class="cl">        Voltage: 3.3 V
</span></span><span class="line"><span class="cl">        External Clock: 200 MHz
</span></span><span class="line"><span class="cl">        Max Speed: 2400 MHz
</span></span><span class="line"><span class="cl">        Current Speed: 2400 MHz
</span></span><span class="line"><span class="cl">        Status: Unpopulated
</span></span><span class="line"><span class="cl">        Upgrade: Other
</span></span><span class="line"><span class="cl">        L1 Cache Handle: 0x2000
</span></span><span class="line"><span class="cl">        L2 Cache Handle: 0x2002
</span></span><span class="line"><span class="cl">        L3 Cache Handle: 0x2003
</span></span><span class="line"><span class="cl">        Serial Number: .......
</span></span><span class="line"><span class="cl">        Asset Tag: Asset Tag#To Be Filled By O.E.M.
</span></span><span class="line"><span class="cl">        Part Number: Part Number#To Be Filled By O.E.M.
</span></span><span class="line"><span class="cl">        Core Count: 32
</span></span><span class="line"><span class="cl">        Core Enabled: 32
</span></span><span class="line"><span class="cl">        Thread Count: 0
</span></span><span class="line"><span class="cl">        Characteristics:
</span></span><span class="line"><span class="cl">                64-bit capable
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">[root@d22b04001.cloud.b04.amtest11 /root] 193E_OPS1
</span></span><span class="line"><span class="cl">#numactl -H
</span></span><span class="line"><span class="cl">available: 2 nodes (0-1)
</span></span><span class="line"><span class="cl">node 0 cpus: 0 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31
</span></span><span class="line"><span class="cl">node 0 size: 259482 MB
</span></span><span class="line"><span class="cl">node 0 free: 121171 MB
</span></span><span class="line"><span class="cl">node 1 cpus: 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63
</span></span><span class="line"><span class="cl">node 1 size: 260091 MB
</span></span><span class="line"><span class="cl">node 1 free: 88564 MB
</span></span><span class="line"><span class="cl">node distances:
</span></span><span class="line"><span class="cl">node   0   1
</span></span><span class="line"><span class="cl">  0:  10  20
</span></span><span class="line"><span class="cl">  1:  20  10
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">#lscpu
</span></span><span class="line"><span class="cl">Architecture:          sw_64
</span></span><span class="line"><span class="cl">CPU op-mode(s):        64-bit
</span></span><span class="line"><span class="cl">Byte Order:            Little Endian
</span></span><span class="line"><span class="cl">CPU(s):                64
</span></span><span class="line"><span class="cl">On-line CPU(s) list:   0-63
</span></span><span class="line"><span class="cl">Thread(s) per core:    1
</span></span><span class="line"><span class="cl">Core(s) per socket:    32
</span></span><span class="line"><span class="cl">Socket(s):             2
</span></span><span class="line"><span class="cl">NUMA node(s):          2
</span></span><span class="line"><span class="cl">Vendor ID:             sw
</span></span><span class="line"><span class="cl">CPU family:            6
</span></span><span class="line"><span class="cl">Model:                 6
</span></span><span class="line"><span class="cl">Model name:            sw
</span></span><span class="line"><span class="cl">CPU MHz:               2400.00
</span></span><span class="line"><span class="cl">BogoMIPS:              4800.00
</span></span><span class="line"><span class="cl">NUMA node0 CPU(s):     0-31
</span></span><span class="line"><span class="cl">NUMA node1 CPU(s):     32-63  </span></span></code></pre>
</div>
<h2 id="openssl-speed-aes-256-ige性能比较" class="headerLink">
    <a href="#openssl-speed-aes-256-ige%e6%80%a7%e8%83%bd%e6%af%94%e8%be%83" class="header-mark"></a>openssl speed aes-256-ige性能比较</h2><p>测试脚本</p>
<blockquote>
  <p>openssl speed aes-256-ige -multi 1</p>

</blockquote><p>单核能力</p>

<div class="table-wrapper">
  <table>
    <thead>
        <tr>
            <th style="text-align: ">Intel (52物理core)</th>
            <th style="text-align: ">aes-256 ige      89602.86k    97498.37k    98271.49k    98399.91k    89101.65k</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td style="text-align: ">海光（32物理core）</td>
            <td style="text-align: ">aes-256 ige      76919.66k    77935.81k    79201.88k    79529.30k    79555.24k</td>
        </tr>
        <tr>
            <td style="text-align: ">鲲鹏920（96物理core)</td>
            <td style="text-align: ">aes-256 ige     133174.89k   140578.99k   142156.46k   142663.34k   143196.16k</td>
        </tr>
    </tbody>
  </table>
</div>
<p>测试32个线程并行</p>

<div class="table-wrapper">
  <table>
    <thead>
        <tr>
            <th style="text-align: ">Intel (52物理core)</th>
            <th style="text-align: ">aes-256 ige    2642742.25k  2690638.98k  2703860.74k  2734114.82k  2680422.40</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td style="text-align: ">海光（32物理core）</td>
            <td style="text-align: ">aes-256 ige    2464568.75k  2499381.80k  2528665.34k  2544845.14k  2550723.93k</td>
        </tr>
        <tr>
            <td style="text-align: ">鲲鹏920（96物理core)</td>
            <td style="text-align: ">aes-256 ige    4261589.92k  4501245.55k  4552731.56k  4570456.75k  4584330.58k</td>
        </tr>
    </tbody>
  </table>
</div>
<p>将所有核跑满包括HT</p>

<div class="table-wrapper">
  <table>
    <thead>
        <tr>
            <th style="text-align: ">Intel (52物理core)</th>
            <th style="text-align: ">aes-256 ige    4869950.82k  5179884.71k  5135412.14k  5211367.08k  5247858.60k</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td style="text-align: ">海光（32物理core）</td>
            <td style="text-align: ">aes-256 ige    2730195.74k  2836759.53k  2865252.35k  2857900.71k  2884302.17k</td>
        </tr>
        <tr>
            <td style="text-align: ">鲲鹏920（96物理core)</td>
            <td style="text-align: ">aes-256 ige   12788358.79k 13502288.53k 13657385.98k 13710908.76k 13751432.53k</td>
        </tr>
    </tbody>
  </table>
</div>
<h2 id="单核计算-7999999-的性能对比" class="headerLink">
    <a href="#%e5%8d%95%e6%a0%b8%e8%ae%a1%e7%ae%97-7999999-%e7%9a%84%e6%80%a7%e8%83%bd%e5%af%b9%e6%af%94" class="header-mark"></a>单核计算 7^999999&quot; 的性能对比</h2><p>测试命令：bash -c &rsquo;echo &ldquo;7^999999&rdquo; | bc &gt; /dev/null'</p>

<div class="table-wrapper">
  <table>
    <thead>
        <tr>
            <th style="text-align: "></th>
            <th style="text-align: ">执行时间(秒)</th>
            <th style="text-align: ">IPC</th>
            <th style="text-align: ">主频</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td style="text-align: ">海光</td>
            <td style="text-align: ">26.729972414</td>
            <td style="text-align: ">0.92</td>
            <td style="text-align: ">2.5G</td>
        </tr>
        <tr>
            <td style="text-align: ">鲲鹏920</td>
            <td style="text-align: ">24.604603640</td>
            <td style="text-align: ">1.84</td>
            <td style="text-align: ">2.6G</td>
        </tr>
        <tr>
            <td style="text-align: ">飞腾2500</td>
            <td style="text-align: ">39.654819568</td>
            <td style="text-align: ">0.43</td>
            <td style="text-align: ">2.1G</td>
        </tr>
        <tr>
            <td style="text-align: ">Intel</td>
            <td style="text-align: ">18.603323495</td>
            <td style="text-align: ">2.19</td>
            <td style="text-align: ">2.5G</td>
        </tr>
        <tr>
            <td style="text-align: ">710</td>
            <td style="text-align: ">15.832394912</td>
            <td style="text-align: ">2.64</td>
            <td style="text-align: ">2.75G</td>
        </tr>
    </tbody>
  </table>
</div>
<p>当然也可以通过计算pi值来测试</p>
<blockquote>
  <p>bash -c &rsquo; echo &ldquo;scale=5000; 4*a(1)&rdquo; | bc -l -q &gt;/dev/null '</p>

</blockquote>
<div class="table-wrapper">
  <table>
    <thead>
        <tr>
            <th style="text-align: "></th>
            <th style="text-align: ">执行时间(秒)</th>
            <th style="text-align: ">主频</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td style="text-align: ">海光</td>
            <td style="text-align: ">31.061s</td>
            <td style="text-align: ">2.5G</td>
        </tr>
        <tr>
            <td style="text-align: ">鲲鹏920</td>
            <td style="text-align: ">23.521s</td>
            <td style="text-align: ">2.6G</td>
        </tr>
        <tr>
            <td style="text-align: ">飞腾2500</td>
            <td style="text-align: "></td>
            <td style="text-align: ">2.1G</td>
        </tr>
        <tr>
            <td style="text-align: ">Intel</td>
            <td style="text-align: ">22.979s(8163)</td>
            <td style="text-align: ">2.5G</td>
        </tr>
        <tr>
            <td style="text-align: ">710</td>
            <td style="text-align: ">15.570s</td>
            <td style="text-align: ">2.75G</td>
        </tr>
    </tbody>
  </table>
</div>
<p>多核一起跑的话可以这样:</p>
<blockquote>
  <p>for i in {0..95}; do time echo &ldquo;scale=5000; 4*a(1)&rdquo; | bc -l -q &gt;/dev/null &amp; done</p>
<p>perf stat -e branch-misses,bus-cycles,cache-misses,cache-references,cpu-cycles,instructions,stalled-cycles-backend,stalled-cycles-frontend,L1-dcache-load-misses,L1-dcache-loads,L1-dcache-store-misses,L1-dcache-stores,L1-icache-load-misses,L1-icache-loads,branch-load-misses,branch-loads,dTLB-load-misses,dTLB-loads,iTLB-load-misses,iTLB-loads &ndash;</p>

</blockquote><h3 id="710" class="headerLink">
    <a href="#710" class="header-mark"></a>710</h3><p>耗时15.83秒，ipc 2.64</p>
<div class="code-block highlight is-open show-line-numbers  tw-group tw-my-2">
  <div class="
    code-block-title 
    
    tw-flex 
    tw-flex-row 
    tw-justify-between 
    tw-w-full tw-bg-bgColor-secondary
    ">      
    <button 
      class="
        tw-select-none 
        tw-mx-2 
        tw-block
        group-[.is-open]:tw-rotate-90
        tw-transition-[transform] 
        tw-duration-500 
        tw-ease-in-out
        print:!tw-hidden"
      disabled
      aria-hidden="true"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M285.476 272.971L91.132 467.314c-9.373 9.373-24.569 9.373-33.941 0l-22.667-22.667c-9.357-9.357-9.375-24.522-.04-33.901L188.505 256 34.484 101.255c-9.335-9.379-9.317-24.544.04-33.901l22.667-22.667c9.373-9.373 24.569-9.373 33.941 0L285.475 239.03c9.373 9.372 9.373 24.568.001 33.941z"/></svg></button>

    <div class="code-block-title-bar tw-w-full">
      <p class="tw-select-none !tw-my-1">text</p>
    </div>
    <div class="tw-flex">
      <button 
        class="
          line-number-button
          tw-select-none 
          tw-mx-2 
          tw-hidden 
          group-[.is-open]:tw-block 
          group-[.show-line-numbers]:tw-text-fgColor-link 
          print:!tw-hidden" 
        title="Toggle line numbers"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M61.77 401l17.5-20.15a19.92 19.92 0 0 0 5.07-14.19v-3.31C84.34 356 80.5 352 73 352H16a8 8 0 0 0-8 8v16a8 8 0 0 0 8 8h22.83a157.41 157.41 0 0 0-11 12.31l-5.61 7c-4 5.07-5.25 10.13-2.8 14.88l1.05 1.93c3 5.76 6.29 7.88 12.25 7.88h4.73c10.33 0 15.94 2.44 15.94 9.09 0 4.72-4.2 8.22-14.36 8.22a41.54 41.54 0 0 1-15.47-3.12c-6.49-3.88-11.74-3.5-15.6 3.12l-5.59 9.31c-3.72 6.13-3.19 11.72 2.63 15.94 7.71 4.69 20.38 9.44 37 9.44 34.16 0 48.5-22.75 48.5-44.12-.03-14.38-9.12-29.76-28.73-34.88zM496 224H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zm0-160H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16V80a16 16 0 0 0-16-16zm0 320H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zM16 160h64a8 8 0 0 0 8-8v-16a8 8 0 0 0-8-8H64V40a8 8 0 0 0-8-8H32a8 8 0 0 0-7.14 4.42l-8 16A8 8 0 0 0 24 64h8v64H16a8 8 0 0 0-8 8v16a8 8 0 0 0 8 8zm-3.91 160H80a8 8 0 0 0 8-8v-16a8 8 0 0 0-8-8H41.32c3.29-10.29 48.34-18.68 48.34-56.44 0-29.06-25-39.56-44.47-39.56-21.36 0-33.8 10-40.46 18.75-4.37 5.59-3 10.84 2.8 15.37l8.58 6.88c5.61 4.56 11 2.47 16.12-2.44a13.44 13.44 0 0 1 9.46-3.84c3.33 0 9.28 1.56 9.28 8.75C51 248.19 0 257.31 0 304.59v4C0 316 5.08 320 12.09 320z"/></svg></button>

      <button 
        class="
          wrap-code-button
          tw-select-none 
          tw-mx-2 
          tw-hidden 
          group-[.is-open]:tw-block 
          group-[.is-wrap]:tw-text-fgColor-link 
          print:!tw-hidden" 
        title="Toggle code wrap"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M16 132h416c8.837 0 16-7.163 16-16V76c0-8.837-7.163-16-16-16H16C7.163 60 0 67.163 0 76v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16z"/></svg></button>
      
      <button 
        class="
          copy-code-button
          tw-select-none
          tw-mx-2 
          tw-hidden
          group-[.is-open]:tw-block
          hover:tw-text-fgColor-link 
          print:!tw-hidden"
        title="Copy code">
          <span class="copy-icon tw-block"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M433.941 65.941l-51.882-51.882A48 48 0 0 0 348.118 0H176c-26.51 0-48 21.49-48 48v48H48c-26.51 0-48 21.49-48 48v320c0 26.51 21.49 48 48 48h224c26.51 0 48-21.49 48-48v-48h80c26.51 0 48-21.49 48-48V99.882a48 48 0 0 0-14.059-33.941zM266 464H54a6 6 0 0 1-6-6V150a6 6 0 0 1 6-6h74v224c0 26.51 21.49 48 48 48h96v42a6 6 0 0 1-6 6zm128-96H182a6 6 0 0 1-6-6V54a6 6 0 0 1 6-6h106v88c0 13.255 10.745 24 24 24h88v202a6 6 0 0 1-6 6zm6-256h-64V48h9.632c1.591 0 3.117.632 4.243 1.757l48.368 48.368a6 6 0 0 1 1.757 4.243V112z"/></svg></span>
          <span class="check-icon tw-hidden"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M173.898 439.404l-166.4-166.4c-9.997-9.997-9.997-26.206 0-36.204l36.203-36.204c9.997-9.998 26.207-9.998 36.204 0L192 312.69 432.095 72.596c9.997-9.997 26.207-9.997 36.204 0l36.203 36.204c9.997 9.997 9.997 26.206 0 36.204l-294.4 294.401c-9.998 9.997-26.207 9.997-36.204-.001z"/></svg></span>
      </button>
        
      <button 
        class="
          tw-select-none 
          tw-mx-2 
          tw-block 
          group-[.is-open]:tw-hidden 
          print:!tw-hidden" 
        disabled
        aria-hidden="true"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M328 256c0 39.8-32.2 72-72 72s-72-32.2-72-72 32.2-72 72-72 72 32.2 72 72zm104-72c-39.8 0-72 32.2-72 72s32.2 72 72 72 72-32.2 72-72-32.2-72-72-72zm-352 0c-39.8 0-72 32.2-72 72s32.2 72 72 72 72-32.2 72-72-32.2-72-72-72z"/></svg></button>
    </div>
  </div>
  <pre style="counter-reset: codeblock;" class="tw-block tw-m-0 tw-p-0"><code 
    id="codeblock-id-10" 
    class="
      chroma 
      !tw-block 
      tw-p-0
      tw-m-0
      tw-transition-[max-height] 
      tw-duration-500 
      tw-ease-in-out 
      group-[.is-closed]:!tw-max-h-0 
      group-[.is-wrap]:tw-text-wrap
      tw-overflow-y-hidden
      tw-overflow-x-auto
      tw-scrollbar-thin
      "><span class="line"><span class="cl"><span class="n">perf</span> <span class="n">stat</span> <span class="o">-</span><span class="n">e</span> <span class="n">branch</span><span class="o">-</span><span class="n">misses</span><span class="p">,</span><span class="n">bus</span><span class="o">-</span><span class="n">cycles</span><span class="p">,</span><span class="n">cache</span><span class="o">-</span><span class="n">misses</span><span class="p">,</span><span class="n">cache</span><span class="o">-</span><span class="n">references</span><span class="p">,</span><span class="n">cpu</span><span class="o">-</span><span class="n">cycles</span><span class="p">,</span><span class="n">instructions</span><span class="p">,</span><span class="n">stalled</span><span class="o">-</span><span class="n">cycles</span><span class="o">-</span><span class="n">backend</span><span class="p">,</span><span class="n">stalled</span><span class="o">-</span><span class="n">cycles</span><span class="o">-</span><span class="n">frontend</span><span class="p">,</span><span class="n">alignment</span><span class="o">-</span><span class="n">faults</span><span class="p">,</span><span class="n">bpf</span><span class="o">-</span><span class="n">output</span><span class="p">,</span><span class="n">context</span><span class="o">-</span><span class="n">switches</span><span class="p">,</span><span class="n">cpu</span><span class="o">-</span><span class="n">clock</span><span class="p">,</span><span class="n">cpu</span><span class="o">-</span><span class="n">migrations</span><span class="p">,</span><span class="n">dummy</span><span class="p">,</span><span class="n">emulation</span><span class="o">-</span><span class="n">faults</span><span class="p">,</span><span class="n">major</span><span class="o">-</span><span class="n">faults</span><span class="p">,</span><span class="n">minor</span><span class="o">-</span><span class="n">faults</span><span class="p">,</span><span class="n">page</span><span class="o">-</span><span class="n">faults</span><span class="p">,</span><span class="n">task</span><span class="o">-</span><span class="n">clock</span><span class="p">,</span><span class="n">L1</span><span class="o">-</span><span class="n">dcache</span><span class="o">-</span><span class="nb">load</span><span class="o">-</span><span class="n">misses</span><span class="p">,</span><span class="n">L1</span><span class="o">-</span><span class="n">dcache</span><span class="o">-</span><span class="n">loads</span><span class="p">,</span><span class="n">L1</span><span class="o">-</span><span class="n">icache</span><span class="o">-</span><span class="nb">load</span><span class="o">-</span><span class="n">misses</span><span class="p">,</span><span class="n">L1</span><span class="o">-</span><span class="n">icache</span><span class="o">-</span><span class="n">loads</span><span class="p">,</span><span class="n">LLC</span><span class="o">-</span><span class="nb">load</span><span class="o">-</span><span class="n">misses</span><span class="p">,</span><span class="n">LLC</span><span class="o">-</span><span class="n">loads</span><span class="p">,</span><span class="n">branch</span><span class="o">-</span><span class="nb">load</span><span class="o">-</span><span class="n">misses</span><span class="p">,</span><span class="n">branch</span><span class="o">-</span><span class="n">loads</span><span class="p">,</span><span class="n">dTLB</span><span class="o">-</span><span class="nb">load</span><span class="o">-</span><span class="n">misses</span><span class="p">,</span><span class="n">dTLB</span><span class="o">-</span><span class="n">loads</span><span class="p">,</span><span class="n">iTLB</span><span class="o">-</span><span class="nb">load</span><span class="o">-</span><span class="n">misses</span><span class="p">,</span><span class="n">iTLB</span><span class="o">-</span><span class="n">loads</span> <span class="o">--</span> <span class="n">bash</span> <span class="o">-</span><span class="n">c</span> <span class="s1">&#39;echo &#34;7^999999&#34; | bc &gt; /dev/null&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> <span class="ne">Performance</span> <span class="n">counter</span> <span class="n">stats</span> <span class="k">for</span> <span class="s1">&#39;bash -c echo &#34;7^999999&#34; | bc &gt; /dev/null&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">       <span class="mi">985</span><span class="p">,</span><span class="mi">496</span><span class="p">,</span><span class="mi">277</span>      <span class="n">branch</span><span class="o">-</span><span class="n">misses</span>                                                 <span class="p">(</span><span class="mf">29.97</span><span class="o">%</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="mi">43</span><span class="p">,</span><span class="mi">509</span><span class="p">,</span><span class="mi">183</span><span class="p">,</span><span class="mi">948</span>      <span class="n">bus</span><span class="o">-</span><span class="n">cycles</span>                <span class="c1"># 2748.210 M/sec                    (29.97%)</span>
</span></span><span class="line"><span class="cl">         <span class="mi">7</span><span class="p">,</span><span class="mi">068</span><span class="p">,</span><span class="mi">868</span>      <span class="n">cache</span><span class="o">-</span><span class="n">misses</span>              <span class="c1">#    0.020 % of all cache refs      (29.96%)</span>
</span></span><span class="line"><span class="cl">    <span class="mi">35</span><span class="p">,</span><span class="mi">165</span><span class="p">,</span><span class="mi">185</span><span class="p">,</span><span class="mi">942</span>      <span class="n">cache</span><span class="o">-</span><span class="n">references</span>          <span class="c1"># 2221.170 M/sec                    (29.97%)</span>
</span></span><span class="line"><span class="cl">    <span class="mi">43</span><span class="p">,</span><span class="mi">508</span><span class="p">,</span><span class="mi">579</span><span class="p">,</span><span class="mi">063</span>      <span class="n">cpu</span><span class="o">-</span><span class="n">cycles</span>                <span class="c1">#    2.748 GHz                      (34.97%)</span>
</span></span><span class="line"><span class="cl">   <span class="mi">114</span><span class="p">,</span><span class="mi">779</span><span class="p">,</span><span class="mi">081</span><span class="p">,</span><span class="mi">188</span>      <span class="n">instructions</span>              <span class="c1">#    2.64  insn per cycle</span>
</span></span><span class="line"><span class="cl">                                                  <span class="c1">#    0.04  stalled cycles per insn  (34.99%)</span>
</span></span><span class="line"><span class="cl">     <span class="mi">4</span><span class="p">,</span><span class="mi">913</span><span class="p">,</span><span class="mi">750</span><span class="p">,</span><span class="mi">141</span>      <span class="n">stalled</span><span class="o">-</span><span class="n">cycles</span><span class="o">-</span><span class="n">backend</span>    <span class="c1">#   11.29% backend cycles idle      (35.02%)</span>
</span></span><span class="line"><span class="cl">     <span class="mi">4</span><span class="p">,</span><span class="mi">255</span><span class="p">,</span><span class="mi">139</span><span class="p">,</span><span class="mi">235</span>      <span class="n">stalled</span><span class="o">-</span><span class="n">cycles</span><span class="o">-</span><span class="n">frontend</span>   <span class="c1">#    9.78% frontend cycles idle     (35.02%)</span>
</span></span><span class="line"><span class="cl">                 <span class="mi">0</span>      <span class="n">alignment</span><span class="o">-</span><span class="n">faults</span>          <span class="c1">#    0.000 K/sec</span>
</span></span><span class="line"><span class="cl">                 <span class="mi">0</span>      <span class="n">bpf</span><span class="o">-</span><span class="n">output</span>                <span class="c1">#    0.000 K/sec</span>
</span></span><span class="line"><span class="cl">                <span class="mi">24</span>      <span class="n">context</span><span class="o">-</span><span class="n">switches</span>          <span class="c1">#    0.002 K/sec</span>
</span></span><span class="line"><span class="cl">         <span class="mi">15</span><span class="p">,</span><span class="mf">831.82</span> <span class="n">msec</span> <span class="n">cpu</span><span class="o">-</span><span class="n">clock</span>                 <span class="c1">#    1.000 CPUs utilized</span></span></span></code></pre>
</div>
<h3 id="intel" class="headerLink">
    <a href="#intel" class="header-mark"></a>intel</h3><p>耗时18.60秒，ipc 2.19</p>
<div class="code-block highlight is-open show-line-numbers  tw-group tw-my-2">
  <div class="
    code-block-title 
    
    tw-flex 
    tw-flex-row 
    tw-justify-between 
    tw-w-full tw-bg-bgColor-secondary
    ">      
    <button 
      class="
        tw-select-none 
        tw-mx-2 
        tw-block
        group-[.is-open]:tw-rotate-90
        tw-transition-[transform] 
        tw-duration-500 
        tw-ease-in-out
        print:!tw-hidden"
      disabled
      aria-hidden="true"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M285.476 272.971L91.132 467.314c-9.373 9.373-24.569 9.373-33.941 0l-22.667-22.667c-9.357-9.357-9.375-24.522-.04-33.901L188.505 256 34.484 101.255c-9.335-9.379-9.317-24.544.04-33.901l22.667-22.667c9.373-9.373 24.569-9.373 33.941 0L285.475 239.03c9.373 9.372 9.373 24.568.001 33.941z"/></svg></button>

    <div class="code-block-title-bar tw-w-full">
      <p class="tw-select-none !tw-my-1">text</p>
    </div>
    <div class="tw-flex">
      <button 
        class="
          line-number-button
          tw-select-none 
          tw-mx-2 
          tw-hidden 
          group-[.is-open]:tw-block 
          group-[.show-line-numbers]:tw-text-fgColor-link 
          print:!tw-hidden" 
        title="Toggle line numbers"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M61.77 401l17.5-20.15a19.92 19.92 0 0 0 5.07-14.19v-3.31C84.34 356 80.5 352 73 352H16a8 8 0 0 0-8 8v16a8 8 0 0 0 8 8h22.83a157.41 157.41 0 0 0-11 12.31l-5.61 7c-4 5.07-5.25 10.13-2.8 14.88l1.05 1.93c3 5.76 6.29 7.88 12.25 7.88h4.73c10.33 0 15.94 2.44 15.94 9.09 0 4.72-4.2 8.22-14.36 8.22a41.54 41.54 0 0 1-15.47-3.12c-6.49-3.88-11.74-3.5-15.6 3.12l-5.59 9.31c-3.72 6.13-3.19 11.72 2.63 15.94 7.71 4.69 20.38 9.44 37 9.44 34.16 0 48.5-22.75 48.5-44.12-.03-14.38-9.12-29.76-28.73-34.88zM496 224H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zm0-160H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16V80a16 16 0 0 0-16-16zm0 320H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zM16 160h64a8 8 0 0 0 8-8v-16a8 8 0 0 0-8-8H64V40a8 8 0 0 0-8-8H32a8 8 0 0 0-7.14 4.42l-8 16A8 8 0 0 0 24 64h8v64H16a8 8 0 0 0-8 8v16a8 8 0 0 0 8 8zm-3.91 160H80a8 8 0 0 0 8-8v-16a8 8 0 0 0-8-8H41.32c3.29-10.29 48.34-18.68 48.34-56.44 0-29.06-25-39.56-44.47-39.56-21.36 0-33.8 10-40.46 18.75-4.37 5.59-3 10.84 2.8 15.37l8.58 6.88c5.61 4.56 11 2.47 16.12-2.44a13.44 13.44 0 0 1 9.46-3.84c3.33 0 9.28 1.56 9.28 8.75C51 248.19 0 257.31 0 304.59v4C0 316 5.08 320 12.09 320z"/></svg></button>

      <button 
        class="
          wrap-code-button
          tw-select-none 
          tw-mx-2 
          tw-hidden 
          group-[.is-open]:tw-block 
          group-[.is-wrap]:tw-text-fgColor-link 
          print:!tw-hidden" 
        title="Toggle code wrap"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M16 132h416c8.837 0 16-7.163 16-16V76c0-8.837-7.163-16-16-16H16C7.163 60 0 67.163 0 76v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16z"/></svg></button>
      
      <button 
        class="
          copy-code-button
          tw-select-none
          tw-mx-2 
          tw-hidden
          group-[.is-open]:tw-block
          hover:tw-text-fgColor-link 
          print:!tw-hidden"
        title="Copy code">
          <span class="copy-icon tw-block"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M433.941 65.941l-51.882-51.882A48 48 0 0 0 348.118 0H176c-26.51 0-48 21.49-48 48v48H48c-26.51 0-48 21.49-48 48v320c0 26.51 21.49 48 48 48h224c26.51 0 48-21.49 48-48v-48h80c26.51 0 48-21.49 48-48V99.882a48 48 0 0 0-14.059-33.941zM266 464H54a6 6 0 0 1-6-6V150a6 6 0 0 1 6-6h74v224c0 26.51 21.49 48 48 48h96v42a6 6 0 0 1-6 6zm128-96H182a6 6 0 0 1-6-6V54a6 6 0 0 1 6-6h106v88c0 13.255 10.745 24 24 24h88v202a6 6 0 0 1-6 6zm6-256h-64V48h9.632c1.591 0 3.117.632 4.243 1.757l48.368 48.368a6 6 0 0 1 1.757 4.243V112z"/></svg></span>
          <span class="check-icon tw-hidden"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M173.898 439.404l-166.4-166.4c-9.997-9.997-9.997-26.206 0-36.204l36.203-36.204c9.997-9.998 26.207-9.998 36.204 0L192 312.69 432.095 72.596c9.997-9.997 26.207-9.997 36.204 0l36.203 36.204c9.997 9.997 9.997 26.206 0 36.204l-294.4 294.401c-9.998 9.997-26.207 9.997-36.204-.001z"/></svg></span>
      </button>
        
      <button 
        class="
          tw-select-none 
          tw-mx-2 
          tw-block 
          group-[.is-open]:tw-hidden 
          print:!tw-hidden" 
        disabled
        aria-hidden="true"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M328 256c0 39.8-32.2 72-72 72s-72-32.2-72-72 32.2-72 72-72 72 32.2 72 72zm104-72c-39.8 0-72 32.2-72 72s32.2 72 72 72 72-32.2 72-72-32.2-72-72-72zm-352 0c-39.8 0-72 32.2-72 72s32.2 72 72 72 72-32.2 72-72-32.2-72-72-72z"/></svg></button>
    </div>
  </div>
  <pre style="counter-reset: codeblock;" class="tw-block tw-m-0 tw-p-0"><code 
    id="codeblock-id-11" 
    class="
      chroma 
      !tw-block 
      tw-p-0
      tw-m-0
      tw-transition-[max-height] 
      tw-duration-500 
      tw-ease-in-out 
      group-[.is-closed]:!tw-max-h-0 
      group-[.is-wrap]:tw-text-wrap
      tw-overflow-y-hidden
      tw-overflow-x-auto
      tw-scrollbar-thin
      "><span class="line"><span class="cl"><span class="c1"># sudo perf stat -e branch-instructions,branch-misses,bus-cycles,cache-misses,cache-references,cpu-cycles,instructions,ref-cycles,L1-dcache-load-misses,L1-dcache-loads,L1-dcache-stores,L1-icache-load-misses,LLC-load-misses,LLC-loads,LLC-store-misses,LLC-stores,branch-load-misses,branch-loads,dTLB-load-misses,dTLB-loads,dTLB-store-misses,dTLB-stores,iTLB-load-misses,iTLB-loads,node-load-misses,node-loads,node-store-misses,node-stores -- bash -c &#39;echo &#34;7^999999&#34; | bc &gt; /dev/null&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> <span class="ne">Performance</span> <span class="n">counter</span> <span class="n">stats</span> <span class="k">for</span> <span class="s1">&#39;bash -c echo &#34;7^999999&#34; | bc &gt; /dev/null&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="mi">25</span><span class="p">,</span><span class="mi">130</span><span class="p">,</span><span class="mi">886</span><span class="p">,</span><span class="mi">211</span>      <span class="n">branch</span><span class="o">-</span><span class="n">instructions</span>                                           <span class="p">(</span><span class="mf">10.72</span><span class="o">%</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">     <span class="mi">1</span><span class="p">,</span><span class="mi">200</span><span class="p">,</span><span class="mi">086</span><span class="p">,</span><span class="mi">175</span>      <span class="n">branch</span><span class="o">-</span><span class="n">misses</span>             <span class="c1">#    4.78% of all branches          (14.29%)</span>
</span></span><span class="line"><span class="cl">       <span class="mi">460</span><span class="p">,</span><span class="mi">824</span><span class="p">,</span><span class="mi">074</span>      <span class="n">bus</span><span class="o">-</span><span class="n">cycles</span>                                                    <span class="p">(</span><span class="mf">14.29</span><span class="o">%</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">         <span class="mi">1</span><span class="p">,</span><span class="mi">983</span><span class="p">,</span><span class="mi">459</span>      <span class="n">cache</span><span class="o">-</span><span class="n">misses</span>              <span class="c1">#   46.066 % of all cache refs      (14.30%)</span>
</span></span><span class="line"><span class="cl">         <span class="mi">4</span><span class="p">,</span><span class="mi">305</span><span class="p">,</span><span class="mi">730</span>      <span class="n">cache</span><span class="o">-</span><span class="n">references</span>                                              <span class="p">(</span><span class="mf">14.30</span><span class="o">%</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="mi">58</span><span class="p">,</span><span class="mi">626</span><span class="p">,</span><span class="mi">314</span><span class="p">,</span><span class="mi">801</span>      <span class="n">cpu</span><span class="o">-</span><span class="n">cycles</span>                                                    <span class="p">(</span><span class="mf">17.87</span><span class="o">%</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">   <span class="mi">128</span><span class="p">,</span><span class="mi">284</span><span class="p">,</span><span class="mi">870</span><span class="p">,</span><span class="mi">917</span>      <span class="n">instructions</span>              <span class="c1">#    2.19  insn per cycle           (21.45%)</span>
</span></span><span class="line"><span class="cl">    <span class="mi">46</span><span class="p">,</span><span class="mi">040</span><span class="p">,</span><span class="mi">656</span><span class="p">,</span><span class="mi">499</span>      <span class="n">ref</span><span class="o">-</span><span class="n">cycles</span>                                                    <span class="p">(</span><span class="mf">25.02</span><span class="o">%</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="mi">22</span><span class="p">,</span><span class="mi">821</span><span class="p">,</span><span class="mi">794</span>      <span class="n">L1</span><span class="o">-</span><span class="n">dcache</span><span class="o">-</span><span class="nb">load</span><span class="o">-</span><span class="n">misses</span>     <span class="c1">#    0.10% of all L1-dcache hits    (25.02%)</span>
</span></span><span class="line"><span class="cl">    <span class="mi">23</span><span class="p">,</span><span class="mi">041</span><span class="p">,</span><span class="mi">732</span><span class="p">,</span><span class="mi">649</span>      <span class="n">L1</span><span class="o">-</span><span class="n">dcache</span><span class="o">-</span><span class="n">loads</span>                                               <span class="p">(</span><span class="mf">25.01</span><span class="o">%</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">     <span class="mi">5</span><span class="p">,</span><span class="mi">386</span><span class="p">,</span><span class="mi">243</span><span class="p">,</span><span class="mi">625</span>      <span class="n">L1</span><span class="o">-</span><span class="n">dcache</span><span class="o">-</span><span class="n">stores</span>                                              <span class="p">(</span><span class="mf">25.00</span><span class="o">%</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="mi">12</span><span class="p">,</span><span class="mi">443</span><span class="p">,</span><span class="mi">154</span>      <span class="n">L1</span><span class="o">-</span><span class="n">icache</span><span class="o">-</span><span class="nb">load</span><span class="o">-</span><span class="n">misses</span>                                         <span class="p">(</span><span class="mf">25.00</span><span class="o">%</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">           <span class="mi">178</span><span class="p">,</span><span class="mi">790</span>      <span class="n">LLC</span><span class="o">-</span><span class="nb">load</span><span class="o">-</span><span class="n">misses</span>           <span class="c1">#   30.52% of all LL-cache hits     (14.28%)</span>
</span></span><span class="line"><span class="cl">           <span class="mi">585</span><span class="p">,</span><span class="mi">724</span>      <span class="n">LLC</span><span class="o">-</span><span class="n">loads</span>                                                     <span class="p">(</span><span class="mf">14.28</span><span class="o">%</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">           <span class="mi">469</span><span class="p">,</span><span class="mi">381</span>      <span class="n">LLC</span><span class="o">-</span><span class="n">store</span><span class="o">-</span><span class="n">misses</span>                                              <span class="p">(</span><span class="mf">7.14</span><span class="o">%</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">           <span class="mi">664</span><span class="p">,</span><span class="mi">865</span>      <span class="n">LLC</span><span class="o">-</span><span class="n">stores</span>                                                    <span class="p">(</span><span class="mf">7.14</span><span class="o">%</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">     <span class="mi">1</span><span class="p">,</span><span class="mi">201</span><span class="p">,</span><span class="mi">547</span><span class="p">,</span><span class="mi">113</span>      <span class="n">branch</span><span class="o">-</span><span class="nb">load</span><span class="o">-</span><span class="n">misses</span>                                            <span class="p">(</span><span class="mf">10.71</span><span class="o">%</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="mi">25</span><span class="p">,</span><span class="mi">139</span><span class="p">,</span><span class="mi">625</span><span class="p">,</span><span class="mi">428</span>      <span class="n">branch</span><span class="o">-</span><span class="n">loads</span>                                                  <span class="p">(</span><span class="mf">14.28</span><span class="o">%</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="mi">63</span><span class="p">,</span><span class="mi">334</span>      <span class="n">dTLB</span><span class="o">-</span><span class="nb">load</span><span class="o">-</span><span class="n">misses</span>          <span class="c1">#    0.00% of all dTLB cache hits   (14.28%)</span>
</span></span><span class="line"><span class="cl">    <span class="mi">23</span><span class="p">,</span><span class="mi">023</span><span class="p">,</span><span class="mi">969</span><span class="p">,</span><span class="mi">089</span>      <span class="n">dTLB</span><span class="o">-</span><span class="n">loads</span>                                                    <span class="p">(</span><span class="mf">14.28</span><span class="o">%</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="mi">17</span><span class="p">,</span><span class="mi">355</span>      <span class="n">dTLB</span><span class="o">-</span><span class="n">store</span><span class="o">-</span><span class="n">misses</span>                                             <span class="p">(</span><span class="mf">14.28</span><span class="o">%</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">     <span class="mi">5</span><span class="p">,</span><span class="mi">378</span><span class="p">,</span><span class="mi">496</span><span class="p">,</span><span class="mi">562</span>      <span class="n">dTLB</span><span class="o">-</span><span class="n">stores</span>                                                   <span class="p">(</span><span class="mf">14.28</span><span class="o">%</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">           <span class="mi">341</span><span class="p">,</span><span class="mi">119</span>      <span class="n">iTLB</span><span class="o">-</span><span class="nb">load</span><span class="o">-</span><span class="n">misses</span>          <span class="c1">#  119.92% of all iTLB cache hits   (14.28%)</span>
</span></span><span class="line"><span class="cl">           <span class="mi">284</span><span class="p">,</span><span class="mi">445</span>      <span class="n">iTLB</span><span class="o">-</span><span class="n">loads</span>                                                    <span class="p">(</span><span class="mf">14.28</span><span class="o">%</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">           <span class="mi">151</span><span class="p">,</span><span class="mi">608</span>      <span class="n">node</span><span class="o">-</span><span class="nb">load</span><span class="o">-</span><span class="n">misses</span>                                              <span class="p">(</span><span class="mf">14.28</span><span class="o">%</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="mi">37</span><span class="p">,</span><span class="mi">553</span>      <span class="n">node</span><span class="o">-</span><span class="n">loads</span>                                                    <span class="p">(</span><span class="mf">14.29</span><span class="o">%</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">           <span class="mi">434</span><span class="p">,</span><span class="mi">537</span>      <span class="n">node</span><span class="o">-</span><span class="n">store</span><span class="o">-</span><span class="n">misses</span>                                             <span class="p">(</span><span class="mf">7.14</span><span class="o">%</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="mi">65</span><span class="p">,</span><span class="mi">709</span>      <span class="n">node</span><span class="o">-</span><span class="n">stores</span>                                                   <span class="p">(</span><span class="mf">7.14</span><span class="o">%</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="mf">18.603323495</span> <span class="n">seconds</span> <span class="n">time</span> <span class="n">elapsed</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="mf">18.525904000</span> <span class="n">seconds</span> <span class="n">user</span>
</span></span><span class="line"><span class="cl">       <span class="mf">0.015197000</span> <span class="n">seconds</span> <span class="n">sys</span></span></span></code></pre>
</div>
<h3 id="鲲鹏920-1" class="headerLink">
    <a href="#%e9%b2%b2%e9%b9%8f920-1" class="header-mark"></a>鲲鹏920</h3><p>耗时24.6秒, IPC 1.84</p>
<div class="code-block highlight is-open show-line-numbers  tw-group tw-my-2">
  <div class="
    code-block-title 
    
    tw-flex 
    tw-flex-row 
    tw-justify-between 
    tw-w-full tw-bg-bgColor-secondary
    ">      
    <button 
      class="
        tw-select-none 
        tw-mx-2 
        tw-block
        group-[.is-open]:tw-rotate-90
        tw-transition-[transform] 
        tw-duration-500 
        tw-ease-in-out
        print:!tw-hidden"
      disabled
      aria-hidden="true"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M285.476 272.971L91.132 467.314c-9.373 9.373-24.569 9.373-33.941 0l-22.667-22.667c-9.357-9.357-9.375-24.522-.04-33.901L188.505 256 34.484 101.255c-9.335-9.379-9.317-24.544.04-33.901l22.667-22.667c9.373-9.373 24.569-9.373 33.941 0L285.475 239.03c9.373 9.372 9.373 24.568.001 33.941z"/></svg></button>

    <div class="code-block-title-bar tw-w-full">
      <p class="tw-select-none !tw-my-1">text</p>
    </div>
    <div class="tw-flex">
      <button 
        class="
          line-number-button
          tw-select-none 
          tw-mx-2 
          tw-hidden 
          group-[.is-open]:tw-block 
          group-[.show-line-numbers]:tw-text-fgColor-link 
          print:!tw-hidden" 
        title="Toggle line numbers"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M61.77 401l17.5-20.15a19.92 19.92 0 0 0 5.07-14.19v-3.31C84.34 356 80.5 352 73 352H16a8 8 0 0 0-8 8v16a8 8 0 0 0 8 8h22.83a157.41 157.41 0 0 0-11 12.31l-5.61 7c-4 5.07-5.25 10.13-2.8 14.88l1.05 1.93c3 5.76 6.29 7.88 12.25 7.88h4.73c10.33 0 15.94 2.44 15.94 9.09 0 4.72-4.2 8.22-14.36 8.22a41.54 41.54 0 0 1-15.47-3.12c-6.49-3.88-11.74-3.5-15.6 3.12l-5.59 9.31c-3.72 6.13-3.19 11.72 2.63 15.94 7.71 4.69 20.38 9.44 37 9.44 34.16 0 48.5-22.75 48.5-44.12-.03-14.38-9.12-29.76-28.73-34.88zM496 224H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zm0-160H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16V80a16 16 0 0 0-16-16zm0 320H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zM16 160h64a8 8 0 0 0 8-8v-16a8 8 0 0 0-8-8H64V40a8 8 0 0 0-8-8H32a8 8 0 0 0-7.14 4.42l-8 16A8 8 0 0 0 24 64h8v64H16a8 8 0 0 0-8 8v16a8 8 0 0 0 8 8zm-3.91 160H80a8 8 0 0 0 8-8v-16a8 8 0 0 0-8-8H41.32c3.29-10.29 48.34-18.68 48.34-56.44 0-29.06-25-39.56-44.47-39.56-21.36 0-33.8 10-40.46 18.75-4.37 5.59-3 10.84 2.8 15.37l8.58 6.88c5.61 4.56 11 2.47 16.12-2.44a13.44 13.44 0 0 1 9.46-3.84c3.33 0 9.28 1.56 9.28 8.75C51 248.19 0 257.31 0 304.59v4C0 316 5.08 320 12.09 320z"/></svg></button>

      <button 
        class="
          wrap-code-button
          tw-select-none 
          tw-mx-2 
          tw-hidden 
          group-[.is-open]:tw-block 
          group-[.is-wrap]:tw-text-fgColor-link 
          print:!tw-hidden" 
        title="Toggle code wrap"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M16 132h416c8.837 0 16-7.163 16-16V76c0-8.837-7.163-16-16-16H16C7.163 60 0 67.163 0 76v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16z"/></svg></button>
      
      <button 
        class="
          copy-code-button
          tw-select-none
          tw-mx-2 
          tw-hidden
          group-[.is-open]:tw-block
          hover:tw-text-fgColor-link 
          print:!tw-hidden"
        title="Copy code">
          <span class="copy-icon tw-block"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M433.941 65.941l-51.882-51.882A48 48 0 0 0 348.118 0H176c-26.51 0-48 21.49-48 48v48H48c-26.51 0-48 21.49-48 48v320c0 26.51 21.49 48 48 48h224c26.51 0 48-21.49 48-48v-48h80c26.51 0 48-21.49 48-48V99.882a48 48 0 0 0-14.059-33.941zM266 464H54a6 6 0 0 1-6-6V150a6 6 0 0 1 6-6h74v224c0 26.51 21.49 48 48 48h96v42a6 6 0 0 1-6 6zm128-96H182a6 6 0 0 1-6-6V54a6 6 0 0 1 6-6h106v88c0 13.255 10.745 24 24 24h88v202a6 6 0 0 1-6 6zm6-256h-64V48h9.632c1.591 0 3.117.632 4.243 1.757l48.368 48.368a6 6 0 0 1 1.757 4.243V112z"/></svg></span>
          <span class="check-icon tw-hidden"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M173.898 439.404l-166.4-166.4c-9.997-9.997-9.997-26.206 0-36.204l36.203-36.204c9.997-9.998 26.207-9.998 36.204 0L192 312.69 432.095 72.596c9.997-9.997 26.207-9.997 36.204 0l36.203 36.204c9.997 9.997 9.997 26.206 0 36.204l-294.4 294.401c-9.998 9.997-26.207 9.997-36.204-.001z"/></svg></span>
      </button>
        
      <button 
        class="
          tw-select-none 
          tw-mx-2 
          tw-block 
          group-[.is-open]:tw-hidden 
          print:!tw-hidden" 
        disabled
        aria-hidden="true"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M328 256c0 39.8-32.2 72-72 72s-72-32.2-72-72 32.2-72 72-72 72 32.2 72 72zm104-72c-39.8 0-72 32.2-72 72s32.2 72 72 72 72-32.2 72-72-32.2-72-72-72zm-352 0c-39.8 0-72 32.2-72 72s32.2 72 72 72 72-32.2 72-72-32.2-72-72-72z"/></svg></button>
    </div>
  </div>
  <pre style="counter-reset: codeblock;" class="tw-block tw-m-0 tw-p-0"><code 
    id="codeblock-id-12" 
    class="
      chroma 
      !tw-block 
      tw-p-0
      tw-m-0
      tw-transition-[max-height] 
      tw-duration-500 
      tw-ease-in-out 
      group-[.is-closed]:!tw-max-h-0 
      group-[.is-wrap]:tw-text-wrap
      tw-overflow-y-hidden
      tw-overflow-x-auto
      tw-scrollbar-thin
      "><span class="line"><span class="cl"><span class="c1">#perf stat -e branch-misses,bus-cycles,cache-misses,cache-references,cpu-cycles,instructions,stalled-cycles-backend,stalled-cycles-frontend,L1-dcache-load-misses,L1-dcache-loads,L1-dcache-store-misses,L1-dcache-stores,L1-icache-load-misses,L1-icache-loads,branch-load-misses,branch-loads,dTLB-load-misses,dTLB-loads,iTLB-load-misses,iTLB-loads -- bash -c &#39;echo &#34;7^999999&#34; | bc &gt; /dev/null&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> <span class="ne">Performance</span> <span class="n">counter</span> <span class="n">stats</span> <span class="k">for</span> <span class="s1">&#39;bash -c echo &#34;7^999999&#34; | bc &gt; /dev/null&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">     <span class="mi">1</span><span class="p">,</span><span class="mi">467</span><span class="p">,</span><span class="mi">769</span><span class="p">,</span><span class="mi">425</span>      <span class="n">branch</span><span class="o">-</span><span class="n">misses</span>                                                 <span class="p">(</span><span class="mf">59.94</span><span class="o">%</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="mi">63</span><span class="p">,</span><span class="mi">866</span><span class="p">,</span><span class="mi">536</span><span class="p">,</span><span class="mi">853</span>      <span class="n">bus</span><span class="o">-</span><span class="n">cycles</span>                                                    <span class="p">(</span><span class="mf">59.94</span><span class="o">%</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">         <span class="mi">6</span><span class="p">,</span><span class="mi">571</span><span class="p">,</span><span class="mi">273</span>      <span class="n">cache</span><span class="o">-</span><span class="n">misses</span>              <span class="c1">#    0.021 % of all cache refs      (59.94%)</span>
</span></span><span class="line"><span class="cl">    <span class="mi">30</span><span class="p">,</span><span class="mi">768</span><span class="p">,</span><span class="mi">754</span><span class="p">,</span><span class="mi">927</span>      <span class="n">cache</span><span class="o">-</span><span class="n">references</span>                                              <span class="p">(</span><span class="mf">59.96</span><span class="o">%</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="mi">63</span><span class="p">,</span><span class="mi">865</span><span class="p">,</span><span class="mi">354</span><span class="p">,</span><span class="mi">560</span>      <span class="n">cpu</span><span class="o">-</span><span class="n">cycles</span>                                                    <span class="p">(</span><span class="mf">64.97</span><span class="o">%</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">   <span class="mi">117</span><span class="p">,</span><span class="mi">790</span><span class="p">,</span><span class="mi">453</span><span class="p">,</span><span class="mi">518</span>      <span class="n">instructions</span>              <span class="c1">#    1.84  insns per cycle</span>
</span></span><span class="line"><span class="cl">                                                  <span class="c1">#    0.07  stalled cycles per insn  (64.98%)</span>
</span></span><span class="line"><span class="cl">       <span class="mi">833</span><span class="p">,</span><span class="mi">090</span><span class="p">,</span><span class="mi">930</span>      <span class="n">stalled</span><span class="o">-</span><span class="n">cycles</span><span class="o">-</span><span class="n">backend</span>    <span class="c1">#    1.30% backend  cycles idle     (65.00%)</span>
</span></span><span class="line"><span class="cl">     <span class="mi">7</span><span class="p">,</span><span class="mi">918</span><span class="p">,</span><span class="mi">227</span><span class="p">,</span><span class="mi">782</span>      <span class="n">stalled</span><span class="o">-</span><span class="n">cycles</span><span class="o">-</span><span class="n">frontend</span>   <span class="c1">#   12.40% frontend cycles idle     (65.01%)</span>
</span></span><span class="line"><span class="cl">         <span class="mi">6</span><span class="p">,</span><span class="mi">962</span><span class="p">,</span><span class="mi">902</span>      <span class="n">L1</span><span class="o">-</span><span class="n">dcache</span><span class="o">-</span><span class="nb">load</span><span class="o">-</span><span class="n">misses</span>     <span class="c1">#    0.02% of all L1-dcache hits    (65.03%)</span>
</span></span><span class="line"><span class="cl">    <span class="mi">30</span><span class="p">,</span><span class="mi">804</span><span class="p">,</span><span class="mi">266</span><span class="p">,</span><span class="mi">645</span>      <span class="n">L1</span><span class="o">-</span><span class="n">dcache</span><span class="o">-</span><span class="n">loads</span>                                               <span class="p">(</span><span class="mf">65.05</span><span class="o">%</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">         <span class="mi">6</span><span class="p">,</span><span class="mi">960</span><span class="p">,</span><span class="mi">157</span>      <span class="n">L1</span><span class="o">-</span><span class="n">dcache</span><span class="o">-</span><span class="n">store</span><span class="o">-</span><span class="n">misses</span>                                        <span class="p">(</span><span class="mf">65.06</span><span class="o">%</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="mi">30</span><span class="p">,</span><span class="mi">807</span><span class="p">,</span><span class="mi">954</span><span class="p">,</span><span class="mi">068</span>      <span class="n">L1</span><span class="o">-</span><span class="n">dcache</span><span class="o">-</span><span class="n">stores</span>                                              <span class="p">(</span><span class="mf">65.06</span><span class="o">%</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">         <span class="mi">1</span><span class="p">,</span><span class="mi">012</span><span class="p">,</span><span class="mi">171</span>      <span class="n">L1</span><span class="o">-</span><span class="n">icache</span><span class="o">-</span><span class="nb">load</span><span class="o">-</span><span class="n">misses</span>                                         <span class="p">(</span><span class="mf">65.06</span><span class="o">%</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="mi">45</span><span class="p">,</span><span class="mi">256</span><span class="p">,</span><span class="mi">066</span><span class="p">,</span><span class="mi">296</span>      <span class="n">L1</span><span class="o">-</span><span class="n">icache</span><span class="o">-</span><span class="n">loads</span>                                               <span class="p">(</span><span class="mf">65.04</span><span class="o">%</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">     <span class="mi">1</span><span class="p">,</span><span class="mi">470</span><span class="p">,</span><span class="mi">467</span><span class="p">,</span><span class="mi">198</span>      <span class="n">branch</span><span class="o">-</span><span class="nb">load</span><span class="o">-</span><span class="n">misses</span>                                            <span class="p">(</span><span class="mf">65.03</span><span class="o">%</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="mi">27</span><span class="p">,</span><span class="mi">108</span><span class="p">,</span><span class="mi">794</span><span class="p">,</span><span class="mi">972</span>      <span class="n">branch</span><span class="o">-</span><span class="n">loads</span>                                                  <span class="p">(</span><span class="mf">65.01</span><span class="o">%</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">           <span class="mi">475</span><span class="p">,</span><span class="mi">707</span>      <span class="n">dTLB</span><span class="o">-</span><span class="nb">load</span><span class="o">-</span><span class="n">misses</span>          <span class="c1">#    0.00% of all dTLB cache hits   (65.00%)</span>
</span></span><span class="line"><span class="cl">    <span class="mi">35</span><span class="p">,</span><span class="mi">159</span><span class="p">,</span><span class="mi">826</span><span class="p">,</span><span class="mi">836</span>      <span class="n">dTLB</span><span class="o">-</span><span class="n">loads</span>                                                    <span class="p">(</span><span class="mf">59.97</span><span class="o">%</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">               <span class="mi">912</span>      <span class="n">iTLB</span><span class="o">-</span><span class="nb">load</span><span class="o">-</span><span class="n">misses</span>          <span class="c1">#    0.00% of all iTLB cache hits   (59.96%)</span>
</span></span><span class="line"><span class="cl">    <span class="mi">45</span><span class="p">,</span><span class="mi">325</span><span class="p">,</span><span class="mi">885</span><span class="p">,</span><span class="mi">822</span>      <span class="n">iTLB</span><span class="o">-</span><span class="n">loads</span>                                                    <span class="p">(</span><span class="mf">59.94</span><span class="o">%</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="mf">24.604603640</span> <span class="n">seconds</span> <span class="n">time</span> <span class="n">elapsed</span></span></span></code></pre>
</div>
<h3 id="海光-1" class="headerLink">
    <a href="#%e6%b5%b7%e5%85%89-1" class="header-mark"></a>海光</h3><p>耗时 26.73秒, IPC 0.92</p>
<div class="code-block highlight is-open show-line-numbers  tw-group tw-my-2">
  <div class="
    code-block-title 
    
    tw-flex 
    tw-flex-row 
    tw-justify-between 
    tw-w-full tw-bg-bgColor-secondary
    ">      
    <button 
      class="
        tw-select-none 
        tw-mx-2 
        tw-block
        group-[.is-open]:tw-rotate-90
        tw-transition-[transform] 
        tw-duration-500 
        tw-ease-in-out
        print:!tw-hidden"
      disabled
      aria-hidden="true"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M285.476 272.971L91.132 467.314c-9.373 9.373-24.569 9.373-33.941 0l-22.667-22.667c-9.357-9.357-9.375-24.522-.04-33.901L188.505 256 34.484 101.255c-9.335-9.379-9.317-24.544.04-33.901l22.667-22.667c9.373-9.373 24.569-9.373 33.941 0L285.475 239.03c9.373 9.372 9.373 24.568.001 33.941z"/></svg></button>

    <div class="code-block-title-bar tw-w-full">
      <p class="tw-select-none !tw-my-1">text</p>
    </div>
    <div class="tw-flex">
      <button 
        class="
          line-number-button
          tw-select-none 
          tw-mx-2 
          tw-hidden 
          group-[.is-open]:tw-block 
          group-[.show-line-numbers]:tw-text-fgColor-link 
          print:!tw-hidden" 
        title="Toggle line numbers"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M61.77 401l17.5-20.15a19.92 19.92 0 0 0 5.07-14.19v-3.31C84.34 356 80.5 352 73 352H16a8 8 0 0 0-8 8v16a8 8 0 0 0 8 8h22.83a157.41 157.41 0 0 0-11 12.31l-5.61 7c-4 5.07-5.25 10.13-2.8 14.88l1.05 1.93c3 5.76 6.29 7.88 12.25 7.88h4.73c10.33 0 15.94 2.44 15.94 9.09 0 4.72-4.2 8.22-14.36 8.22a41.54 41.54 0 0 1-15.47-3.12c-6.49-3.88-11.74-3.5-15.6 3.12l-5.59 9.31c-3.72 6.13-3.19 11.72 2.63 15.94 7.71 4.69 20.38 9.44 37 9.44 34.16 0 48.5-22.75 48.5-44.12-.03-14.38-9.12-29.76-28.73-34.88zM496 224H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zm0-160H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16V80a16 16 0 0 0-16-16zm0 320H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zM16 160h64a8 8 0 0 0 8-8v-16a8 8 0 0 0-8-8H64V40a8 8 0 0 0-8-8H32a8 8 0 0 0-7.14 4.42l-8 16A8 8 0 0 0 24 64h8v64H16a8 8 0 0 0-8 8v16a8 8 0 0 0 8 8zm-3.91 160H80a8 8 0 0 0 8-8v-16a8 8 0 0 0-8-8H41.32c3.29-10.29 48.34-18.68 48.34-56.44 0-29.06-25-39.56-44.47-39.56-21.36 0-33.8 10-40.46 18.75-4.37 5.59-3 10.84 2.8 15.37l8.58 6.88c5.61 4.56 11 2.47 16.12-2.44a13.44 13.44 0 0 1 9.46-3.84c3.33 0 9.28 1.56 9.28 8.75C51 248.19 0 257.31 0 304.59v4C0 316 5.08 320 12.09 320z"/></svg></button>

      <button 
        class="
          wrap-code-button
          tw-select-none 
          tw-mx-2 
          tw-hidden 
          group-[.is-open]:tw-block 
          group-[.is-wrap]:tw-text-fgColor-link 
          print:!tw-hidden" 
        title="Toggle code wrap"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M16 132h416c8.837 0 16-7.163 16-16V76c0-8.837-7.163-16-16-16H16C7.163 60 0 67.163 0 76v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16z"/></svg></button>
      
      <button 
        class="
          copy-code-button
          tw-select-none
          tw-mx-2 
          tw-hidden
          group-[.is-open]:tw-block
          hover:tw-text-fgColor-link 
          print:!tw-hidden"
        title="Copy code">
          <span class="copy-icon tw-block"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M433.941 65.941l-51.882-51.882A48 48 0 0 0 348.118 0H176c-26.51 0-48 21.49-48 48v48H48c-26.51 0-48 21.49-48 48v320c0 26.51 21.49 48 48 48h224c26.51 0 48-21.49 48-48v-48h80c26.51 0 48-21.49 48-48V99.882a48 48 0 0 0-14.059-33.941zM266 464H54a6 6 0 0 1-6-6V150a6 6 0 0 1 6-6h74v224c0 26.51 21.49 48 48 48h96v42a6 6 0 0 1-6 6zm128-96H182a6 6 0 0 1-6-6V54a6 6 0 0 1 6-6h106v88c0 13.255 10.745 24 24 24h88v202a6 6 0 0 1-6 6zm6-256h-64V48h9.632c1.591 0 3.117.632 4.243 1.757l48.368 48.368a6 6 0 0 1 1.757 4.243V112z"/></svg></span>
          <span class="check-icon tw-hidden"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M173.898 439.404l-166.4-166.4c-9.997-9.997-9.997-26.206 0-36.204l36.203-36.204c9.997-9.998 26.207-9.998 36.204 0L192 312.69 432.095 72.596c9.997-9.997 26.207-9.997 36.204 0l36.203 36.204c9.997 9.997 9.997 26.206 0 36.204l-294.4 294.401c-9.998 9.997-26.207 9.997-36.204-.001z"/></svg></span>
      </button>
        
      <button 
        class="
          tw-select-none 
          tw-mx-2 
          tw-block 
          group-[.is-open]:tw-hidden 
          print:!tw-hidden" 
        disabled
        aria-hidden="true"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M328 256c0 39.8-32.2 72-72 72s-72-32.2-72-72 32.2-72 72-72 72 32.2 72 72zm104-72c-39.8 0-72 32.2-72 72s32.2 72 72 72 72-32.2 72-72-32.2-72-72-72zm-352 0c-39.8 0-72 32.2-72 72s32.2 72 72 72 72-32.2 72-72-32.2-72-72-72z"/></svg></button>
    </div>
  </div>
  <pre style="counter-reset: codeblock;" class="tw-block tw-m-0 tw-p-0"><code 
    id="codeblock-id-13" 
    class="
      chroma 
      !tw-block 
      tw-p-0
      tw-m-0
      tw-transition-[max-height] 
      tw-duration-500 
      tw-ease-in-out 
      group-[.is-closed]:!tw-max-h-0 
      group-[.is-wrap]:tw-text-wrap
      tw-overflow-y-hidden
      tw-overflow-x-auto
      tw-scrollbar-thin
      "><span class="line"><span class="cl"><span class="n">sudo</span> <span class="n">perf</span> <span class="n">stat</span> <span class="o">-</span><span class="n">e</span> <span class="n">branch</span><span class="o">-</span><span class="n">instructions</span><span class="p">,</span><span class="n">branch</span><span class="o">-</span><span class="n">misses</span><span class="p">,</span><span class="n">cache</span><span class="o">-</span><span class="n">references</span><span class="p">,</span><span class="n">cpu</span><span class="o">-</span><span class="n">cycles</span><span class="p">,</span><span class="n">instructions</span><span class="p">,</span><span class="n">stalled</span><span class="o">-</span><span class="n">cycles</span><span class="o">-</span><span class="n">backend</span><span class="p">,</span><span class="n">stalled</span><span class="o">-</span><span class="n">cycles</span><span class="o">-</span><span class="n">frontend</span><span class="p">,</span><span class="n">L1</span><span class="o">-</span><span class="n">dcache</span><span class="o">-</span><span class="nb">load</span><span class="o">-</span><span class="n">misses</span><span class="p">,</span><span class="n">L1</span><span class="o">-</span><span class="n">dcache</span><span class="o">-</span><span class="n">loads</span><span class="p">,</span><span class="n">L1</span><span class="o">-</span><span class="n">dcache</span><span class="o">-</span><span class="n">prefetches</span><span class="p">,</span><span class="n">L1</span><span class="o">-</span><span class="n">icache</span><span class="o">-</span><span class="nb">load</span><span class="o">-</span><span class="n">misses</span><span class="p">,</span><span class="n">L1</span><span class="o">-</span><span class="n">icache</span><span class="o">-</span><span class="n">loads</span><span class="p">,</span><span class="n">branch</span><span class="o">-</span><span class="nb">load</span><span class="o">-</span><span class="n">misses</span><span class="p">,</span><span class="n">branch</span><span class="o">-</span><span class="n">loads</span><span class="p">,</span><span class="n">dTLB</span><span class="o">-</span><span class="nb">load</span><span class="o">-</span><span class="n">misses</span><span class="p">,</span><span class="n">dTLB</span><span class="o">-</span><span class="n">loads</span><span class="p">,</span><span class="n">iTLB</span><span class="o">-</span><span class="nb">load</span><span class="o">-</span><span class="n">misses</span><span class="p">,</span><span class="n">iTLB</span><span class="o">-</span><span class="n">loads</span> <span class="o">-</span><span class="n">a</span> <span class="o">--</span> <span class="n">bash</span> <span class="o">-</span><span class="n">c</span> <span class="s1">&#39;echo &#34;7^999999&#34; | bc &gt; /dev/null&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> <span class="ne">Performance</span> <span class="n">counter</span> <span class="n">stats</span> <span class="k">for</span> <span class="s1">&#39;system wide&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="mi">57</span><span class="p">,</span><span class="mi">795</span><span class="p">,</span><span class="mi">675</span><span class="p">,</span><span class="mi">025</span>      <span class="n">branch</span><span class="o">-</span><span class="n">instructions</span>                                           <span class="p">(</span><span class="mf">27.78</span><span class="o">%</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">     <span class="mi">2</span><span class="p">,</span><span class="mi">459</span><span class="p">,</span><span class="mi">509</span><span class="p">,</span><span class="mi">459</span>      <span class="n">branch</span><span class="o">-</span><span class="n">misses</span>             <span class="c1">#    4.26% of all branches          (27.78%)</span>
</span></span><span class="line"><span class="cl">    <span class="mi">12</span><span class="p">,</span><span class="mi">171</span><span class="p">,</span><span class="mi">133</span><span class="p">,</span><span class="mi">272</span>      <span class="n">cache</span><span class="o">-</span><span class="n">references</span>                                              <span class="p">(</span><span class="mf">27.79</span><span class="o">%</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">   <span class="mi">317</span><span class="p">,</span><span class="mi">353</span><span class="p">,</span><span class="mi">262</span><span class="p">,</span><span class="mi">523</span>      <span class="n">cpu</span><span class="o">-</span><span class="n">cycles</span>                                                    <span class="p">(</span><span class="mf">27.79</span><span class="o">%</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">   <span class="mi">293</span><span class="p">,</span><span class="mi">162</span><span class="p">,</span><span class="mi">940</span><span class="p">,</span><span class="mi">548</span>      <span class="n">instructions</span>              <span class="c1">#    0.92  insn per cycle</span>
</span></span><span class="line"><span class="cl">                                                  <span class="c1">#    0.19  stalled cycles per insn  (27.79%)</span>
</span></span><span class="line"><span class="cl">    <span class="mi">55</span><span class="p">,</span><span class="mi">152</span><span class="p">,</span><span class="mi">807</span><span class="p">,</span><span class="mi">029</span>      <span class="n">stalled</span><span class="o">-</span><span class="n">cycles</span><span class="o">-</span><span class="n">backend</span>    <span class="c1">#   17.38% backend cycles idle      (27.79%)</span>
</span></span><span class="line"><span class="cl">    <span class="mi">44</span><span class="p">,</span><span class="mi">410</span><span class="p">,</span><span class="mi">732</span><span class="p">,</span><span class="mi">991</span>      <span class="n">stalled</span><span class="o">-</span><span class="n">cycles</span><span class="o">-</span><span class="n">frontend</span>   <span class="c1">#   13.99% frontend cycles idle     (27.79%)</span>
</span></span><span class="line"><span class="cl">     <span class="mi">4</span><span class="p">,</span><span class="mi">065</span><span class="p">,</span><span class="mi">273</span><span class="p">,</span><span class="mi">083</span>      <span class="n">L1</span><span class="o">-</span><span class="n">dcache</span><span class="o">-</span><span class="nb">load</span><span class="o">-</span><span class="n">misses</span>     <span class="c1">#    3.58% of all L1-dcache hits    (27.79%)</span>
</span></span><span class="line"><span class="cl">   <span class="mi">113</span><span class="p">,</span><span class="mi">699</span><span class="p">,</span><span class="mi">208</span><span class="p">,</span><span class="mi">151</span>      <span class="n">L1</span><span class="o">-</span><span class="n">dcache</span><span class="o">-</span><span class="n">loads</span>                                               <span class="p">(</span><span class="mf">27.79</span><span class="o">%</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">     <span class="mi">1</span><span class="p">,</span><span class="mi">351</span><span class="p">,</span><span class="mi">513</span><span class="p">,</span><span class="mi">191</span>      <span class="n">L1</span><span class="o">-</span><span class="n">dcache</span><span class="o">-</span><span class="n">prefetches</span>                                          <span class="p">(</span><span class="mf">27.79</span><span class="o">%</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">     <span class="mi">2</span><span class="p">,</span><span class="mi">091</span><span class="p">,</span><span class="mi">035</span><span class="p">,</span><span class="mi">340</span>      <span class="n">L1</span><span class="o">-</span><span class="n">icache</span><span class="o">-</span><span class="nb">load</span><span class="o">-</span><span class="n">misses</span>     <span class="c1">#    4.43% of all L1-icache hits    (27.79%)</span>
</span></span><span class="line"><span class="cl">    <span class="mi">47</span><span class="p">,</span><span class="mi">240</span><span class="p">,</span><span class="mi">289</span><span class="p">,</span><span class="mi">316</span>      <span class="n">L1</span><span class="o">-</span><span class="n">icache</span><span class="o">-</span><span class="n">loads</span>                                               <span class="p">(</span><span class="mf">27.79</span><span class="o">%</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">     <span class="mi">2</span><span class="p">,</span><span class="mi">459</span><span class="p">,</span><span class="mi">838</span><span class="p">,</span><span class="mi">728</span>      <span class="n">branch</span><span class="o">-</span><span class="nb">load</span><span class="o">-</span><span class="n">misses</span>                                            <span class="p">(</span><span class="mf">27.79</span><span class="o">%</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="mi">57</span><span class="p">,</span><span class="mi">855</span><span class="p">,</span><span class="mi">156</span><span class="p">,</span><span class="mi">991</span>      <span class="n">branch</span><span class="o">-</span><span class="n">loads</span>                                                  <span class="p">(</span><span class="mf">27.78</span><span class="o">%</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="mi">69</span><span class="p">,</span><span class="mi">731</span><span class="p">,</span><span class="mi">473</span>      <span class="n">dTLB</span><span class="o">-</span><span class="nb">load</span><span class="o">-</span><span class="n">misses</span>          <span class="c1">#   20.40% of all dTLB cache hits   (27.78%)</span>
</span></span><span class="line"><span class="cl">       <span class="mi">341</span><span class="p">,</span><span class="mi">773</span><span class="p">,</span><span class="mi">319</span>      <span class="n">dTLB</span><span class="o">-</span><span class="n">loads</span>                                                    <span class="p">(</span><span class="mf">27.78</span><span class="o">%</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="mi">26</span><span class="p">,</span><span class="mi">351</span><span class="p">,</span><span class="mi">132</span>      <span class="n">iTLB</span><span class="o">-</span><span class="nb">load</span><span class="o">-</span><span class="n">misses</span>          <span class="c1">#   15.91% of all iTLB cache hits   (27.78%)</span>
</span></span><span class="line"><span class="cl">       <span class="mi">165</span><span class="p">,</span><span class="mi">656</span><span class="p">,</span><span class="mi">863</span>      <span class="n">iTLB</span><span class="o">-</span><span class="n">loads</span>                                                    <span class="p">(</span><span class="mf">27.78</span><span class="o">%</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="mf">26.729972414</span> <span class="n">seconds</span> <span class="n">time</span> <span class="n">elapsed</span></span></span></code></pre>
</div>
<h3 id="飞腾" class="headerLink">
    <a href="#%e9%a3%9e%e8%85%be" class="header-mark"></a>飞腾</h3><div class="code-block highlight is-open show-line-numbers  tw-group tw-my-2">
  <div class="
    code-block-title 
    
    tw-flex 
    tw-flex-row 
    tw-justify-between 
    tw-w-full tw-bg-bgColor-secondary
    ">      
    <button 
      class="
        tw-select-none 
        tw-mx-2 
        tw-block
        group-[.is-open]:tw-rotate-90
        tw-transition-[transform] 
        tw-duration-500 
        tw-ease-in-out
        print:!tw-hidden"
      disabled
      aria-hidden="true"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M285.476 272.971L91.132 467.314c-9.373 9.373-24.569 9.373-33.941 0l-22.667-22.667c-9.357-9.357-9.375-24.522-.04-33.901L188.505 256 34.484 101.255c-9.335-9.379-9.317-24.544.04-33.901l22.667-22.667c9.373-9.373 24.569-9.373 33.941 0L285.475 239.03c9.373 9.372 9.373 24.568.001 33.941z"/></svg></button>

    <div class="code-block-title-bar tw-w-full">
      <p class="tw-select-none !tw-my-1">text</p>
    </div>
    <div class="tw-flex">
      <button 
        class="
          line-number-button
          tw-select-none 
          tw-mx-2 
          tw-hidden 
          group-[.is-open]:tw-block 
          group-[.show-line-numbers]:tw-text-fgColor-link 
          print:!tw-hidden" 
        title="Toggle line numbers"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M61.77 401l17.5-20.15a19.92 19.92 0 0 0 5.07-14.19v-3.31C84.34 356 80.5 352 73 352H16a8 8 0 0 0-8 8v16a8 8 0 0 0 8 8h22.83a157.41 157.41 0 0 0-11 12.31l-5.61 7c-4 5.07-5.25 10.13-2.8 14.88l1.05 1.93c3 5.76 6.29 7.88 12.25 7.88h4.73c10.33 0 15.94 2.44 15.94 9.09 0 4.72-4.2 8.22-14.36 8.22a41.54 41.54 0 0 1-15.47-3.12c-6.49-3.88-11.74-3.5-15.6 3.12l-5.59 9.31c-3.72 6.13-3.19 11.72 2.63 15.94 7.71 4.69 20.38 9.44 37 9.44 34.16 0 48.5-22.75 48.5-44.12-.03-14.38-9.12-29.76-28.73-34.88zM496 224H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zm0-160H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16V80a16 16 0 0 0-16-16zm0 320H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zM16 160h64a8 8 0 0 0 8-8v-16a8 8 0 0 0-8-8H64V40a8 8 0 0 0-8-8H32a8 8 0 0 0-7.14 4.42l-8 16A8 8 0 0 0 24 64h8v64H16a8 8 0 0 0-8 8v16a8 8 0 0 0 8 8zm-3.91 160H80a8 8 0 0 0 8-8v-16a8 8 0 0 0-8-8H41.32c3.29-10.29 48.34-18.68 48.34-56.44 0-29.06-25-39.56-44.47-39.56-21.36 0-33.8 10-40.46 18.75-4.37 5.59-3 10.84 2.8 15.37l8.58 6.88c5.61 4.56 11 2.47 16.12-2.44a13.44 13.44 0 0 1 9.46-3.84c3.33 0 9.28 1.56 9.28 8.75C51 248.19 0 257.31 0 304.59v4C0 316 5.08 320 12.09 320z"/></svg></button>

      <button 
        class="
          wrap-code-button
          tw-select-none 
          tw-mx-2 
          tw-hidden 
          group-[.is-open]:tw-block 
          group-[.is-wrap]:tw-text-fgColor-link 
          print:!tw-hidden" 
        title="Toggle code wrap"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M16 132h416c8.837 0 16-7.163 16-16V76c0-8.837-7.163-16-16-16H16C7.163 60 0 67.163 0 76v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16z"/></svg></button>
      
      <button 
        class="
          copy-code-button
          tw-select-none
          tw-mx-2 
          tw-hidden
          group-[.is-open]:tw-block
          hover:tw-text-fgColor-link 
          print:!tw-hidden"
        title="Copy code">
          <span class="copy-icon tw-block"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M433.941 65.941l-51.882-51.882A48 48 0 0 0 348.118 0H176c-26.51 0-48 21.49-48 48v48H48c-26.51 0-48 21.49-48 48v320c0 26.51 21.49 48 48 48h224c26.51 0 48-21.49 48-48v-48h80c26.51 0 48-21.49 48-48V99.882a48 48 0 0 0-14.059-33.941zM266 464H54a6 6 0 0 1-6-6V150a6 6 0 0 1 6-6h74v224c0 26.51 21.49 48 48 48h96v42a6 6 0 0 1-6 6zm128-96H182a6 6 0 0 1-6-6V54a6 6 0 0 1 6-6h106v88c0 13.255 10.745 24 24 24h88v202a6 6 0 0 1-6 6zm6-256h-64V48h9.632c1.591 0 3.117.632 4.243 1.757l48.368 48.368a6 6 0 0 1 1.757 4.243V112z"/></svg></span>
          <span class="check-icon tw-hidden"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M173.898 439.404l-166.4-166.4c-9.997-9.997-9.997-26.206 0-36.204l36.203-36.204c9.997-9.998 26.207-9.998 36.204 0L192 312.69 432.095 72.596c9.997-9.997 26.207-9.997 36.204 0l36.203 36.204c9.997 9.997 9.997 26.206 0 36.204l-294.4 294.401c-9.998 9.997-26.207 9.997-36.204-.001z"/></svg></span>
      </button>
        
      <button 
        class="
          tw-select-none 
          tw-mx-2 
          tw-block 
          group-[.is-open]:tw-hidden 
          print:!tw-hidden" 
        disabled
        aria-hidden="true"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M328 256c0 39.8-32.2 72-72 72s-72-32.2-72-72 32.2-72 72-72 72 32.2 72 72zm104-72c-39.8 0-72 32.2-72 72s32.2 72 72 72 72-32.2 72-72-32.2-72-72-72zm-352 0c-39.8 0-72 32.2-72 72s32.2 72 72 72 72-32.2 72-72-32.2-72-72-72z"/></svg></button>
    </div>
  </div>
  <pre style="counter-reset: codeblock;" class="tw-block tw-m-0 tw-p-0"><code 
    id="codeblock-id-14" 
    class="
      chroma 
      !tw-block 
      tw-p-0
      tw-m-0
      tw-transition-[max-height] 
      tw-duration-500 
      tw-ease-in-out 
      group-[.is-closed]:!tw-max-h-0 
      group-[.is-wrap]:tw-text-wrap
      tw-overflow-y-hidden
      tw-overflow-x-auto
      tw-scrollbar-thin
      "><span class="line"><span class="cl"><span class="n">time</span> <span class="n">perf</span> <span class="n">stat</span> <span class="o">-</span><span class="n">e</span> <span class="n">branch</span><span class="o">-</span><span class="n">misses</span><span class="p">,</span><span class="n">bus</span><span class="o">-</span><span class="n">cycles</span><span class="p">,</span><span class="n">cache</span><span class="o">-</span><span class="n">misses</span><span class="p">,</span><span class="n">cache</span><span class="o">-</span><span class="n">references</span><span class="p">,</span><span class="n">cpu</span><span class="o">-</span><span class="n">cycles</span><span class="p">,</span><span class="n">instructions</span><span class="p">,</span><span class="n">L1</span><span class="o">-</span><span class="n">dcache</span><span class="o">-</span><span class="nb">load</span><span class="o">-</span><span class="n">misses</span><span class="p">,</span><span class="n">L1</span><span class="o">-</span><span class="n">dcache</span><span class="o">-</span><span class="n">loads</span><span class="p">,</span><span class="n">L1</span><span class="o">-</span><span class="n">dcache</span><span class="o">-</span><span class="n">store</span><span class="o">-</span><span class="n">misses</span><span class="p">,</span><span class="n">L1</span><span class="o">-</span><span class="n">dcache</span><span class="o">-</span><span class="n">stores</span><span class="p">,</span><span class="n">L1</span><span class="o">-</span><span class="n">icache</span><span class="o">-</span><span class="nb">load</span><span class="o">-</span><span class="n">misses</span><span class="p">,</span><span class="n">L1</span><span class="o">-</span><span class="n">icache</span><span class="o">-</span><span class="n">loads</span><span class="p">,</span><span class="n">branch</span><span class="o">-</span><span class="nb">load</span><span class="o">-</span><span class="n">misses</span><span class="p">,</span><span class="n">branch</span><span class="o">-</span><span class="n">loads</span><span class="p">,</span><span class="n">dTLB</span><span class="o">-</span><span class="nb">load</span><span class="o">-</span><span class="n">misses</span><span class="p">,</span><span class="n">iTLB</span><span class="o">-</span><span class="nb">load</span><span class="o">-</span><span class="n">misses</span> <span class="o">-</span><span class="n">a</span> <span class="o">--</span> <span class="n">bash</span> <span class="o">-</span><span class="n">c</span> <span class="s1">&#39;echo &#34;7^999999&#34; | bc &gt; /dev/null&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> <span class="ne">Performance</span> <span class="n">counter</span> <span class="n">stats</span> <span class="k">for</span> <span class="s1">&#39;system wide&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="mi">2552812813</span>      <span class="n">branch</span><span class="o">-</span><span class="n">misses</span>                                                 <span class="p">(</span><span class="mf">38.08</span><span class="o">%</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="mi">602038279874</span>      <span class="n">bus</span><span class="o">-</span><span class="n">cycles</span>                                                    <span class="p">(</span><span class="mf">37.54</span><span class="o">%</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="mi">1742826523</span>      <span class="n">cache</span><span class="o">-</span><span class="n">misses</span>              <span class="c1">#    2.017 % of all cache refs      (37.54%)</span>
</span></span><span class="line"><span class="cl">       <span class="mi">86400294181</span>      <span class="n">cache</span><span class="o">-</span><span class="n">references</span>                                              <span class="p">(</span><span class="mf">37.55</span><span class="o">%</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="mi">612467194375</span>      <span class="n">cpu</span><span class="o">-</span><span class="n">cycles</span>                                                    <span class="p">(</span><span class="mf">43.79</span><span class="o">%</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="mi">263691445872</span>      <span class="n">instructions</span>              <span class="c1">#    0.43  insns per cycle          (43.79%)</span>
</span></span><span class="line"><span class="cl">        <span class="mi">1706247569</span>      <span class="n">L1</span><span class="o">-</span><span class="n">dcache</span><span class="o">-</span><span class="nb">load</span><span class="o">-</span><span class="n">misses</span>     <span class="c1">#    2.00% of all L1-dcache hits    (43.78%)</span>
</span></span><span class="line"><span class="cl">       <span class="mi">85122454139</span>      <span class="n">L1</span><span class="o">-</span><span class="n">dcache</span><span class="o">-</span><span class="n">loads</span>                                               <span class="p">(</span><span class="mf">43.77</span><span class="o">%</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="mi">1711243358</span>      <span class="n">L1</span><span class="o">-</span><span class="n">dcache</span><span class="o">-</span><span class="n">store</span><span class="o">-</span><span class="n">misses</span>                                        <span class="p">(</span><span class="mf">39.38</span><span class="o">%</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">       <span class="mi">86288158984</span>      <span class="n">L1</span><span class="o">-</span><span class="n">dcache</span><span class="o">-</span><span class="n">stores</span>                                              <span class="p">(</span><span class="mf">37.52</span><span class="o">%</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="mi">2006641212</span>      <span class="n">L1</span><span class="o">-</span><span class="n">icache</span><span class="o">-</span><span class="nb">load</span><span class="o">-</span><span class="n">misses</span>                                         <span class="p">(</span><span class="mf">37.51</span><span class="o">%</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="mi">146380907111</span>      <span class="n">L1</span><span class="o">-</span><span class="n">icache</span><span class="o">-</span><span class="n">loads</span>                                               <span class="p">(</span><span class="mf">37.51</span><span class="o">%</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="mi">2560208048</span>      <span class="n">branch</span><span class="o">-</span><span class="nb">load</span><span class="o">-</span><span class="n">misses</span>                                            <span class="p">(</span><span class="mf">37.52</span><span class="o">%</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">       <span class="mi">63127187342</span>      <span class="n">branch</span><span class="o">-</span><span class="n">loads</span>                                                  <span class="p">(</span><span class="mf">41.38</span><span class="o">%</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">         <span class="mi">768494735</span>      <span class="n">dTLB</span><span class="o">-</span><span class="nb">load</span><span class="o">-</span><span class="n">misses</span>                                              <span class="p">(</span><span class="mf">43.77</span><span class="o">%</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">         <span class="mi">124424415</span>      <span class="n">iTLB</span><span class="o">-</span><span class="nb">load</span><span class="o">-</span><span class="n">misses</span>                                              <span class="p">(</span><span class="mf">43.77</span><span class="o">%</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="mf">39.654819568</span> <span class="n">seconds</span> <span class="n">time</span> <span class="n">elapsed</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">real</span>    <span class="mi">0</span><span class="n">m39</span><span class="o">.</span><span class="mi">763</span><span class="n">s</span>
</span></span><span class="line"><span class="cl"><span class="n">user</span>    <span class="mi">0</span><span class="n">m39</span><span class="o">.</span><span class="mi">635</span><span class="n">s</span>
</span></span><span class="line"><span class="cl"><span class="n">sys</span>    <span class="mi">0</span><span class="n">m0</span><span class="o">.</span><span class="mi">127</span><span class="n">s</span></span></span></code></pre>
</div>
<h2 id="perf-数据对比" class="headerLink">
    <a href="#perf-%e6%95%b0%e6%8d%ae%e5%af%b9%e6%af%94" class="header-mark"></a>perf 数据对比</h2><h3 id="intel-1" class="headerLink">
    <a href="#intel-1" class="header-mark"></a>Intel</h3><p>intel的cpu随着线程的增加，ipc稳定减少，但不是线性的</p>
<p><img class="tw-inline" loading="lazy" src=http://localhost:1313/Users/ren/case/ossimg/dcb68dff74ace2cf6f9c30378acdb377.png   alt="image.png"  ></p>
<p><img class="tw-inline" loading="lazy" src=http://localhost:1313/Users/ren/case/ossimg/d0151c855011b24590efd672398bd9eb.png   alt="image.png"  ></p>
<p><img class="tw-inline" loading="lazy" src=http://localhost:1313/Users/ren/case/ossimg/175a1df9274a830d4a7157dfda96c180.png   alt="image.png"  ></p>
<p><img class="tw-inline" loading="lazy" src=http://localhost:1313/Users/ren/case/ossimg/e63a992fcd1df547568eb93f515a5c99.png   alt="image.png"  ></p>
<h3 id="海光-2" class="headerLink">
    <a href="#%e6%b5%b7%e5%85%89-2" class="header-mark"></a>海光</h3><p>如下数据可以看到在用满32个物理core之前，ipc保持稳定，超过32core后随着并发增加ipc相应减少，性能再也上不去了。</p>
<p><img class="tw-inline" loading="lazy" src=http://localhost:1313/Users/ren/case/ossimg/ded1ee0ed8d5d2fa3822e6fdfa4335f1.png   alt="image.png"  ></p>
<p><img class="tw-inline" loading="lazy" src=http://localhost:1313/Users/ren/case/ossimg/0f2410165932835a36d8c0611877ae77.png   alt="image.png"  ></p>
<p><img class="tw-inline" loading="lazy" src=http://localhost:1313/Users/ren/case/ossimg/67df9ff04209a00bd864ba21b7593477.png   alt="image.png"  ></p>
<p><img class="tw-inline" loading="lazy" src=http://localhost:1313/Users/ren/case/ossimg/1bc01f6e880c7e49672170f940ff40a0.png   alt="image.png"  ></p>
<p><img class="tw-inline" loading="lazy" src=http://localhost:1313/Users/ren/case/ossimg/307d30c2b3507d5561d774f96b13e67a.png   alt="image.png"  ></p>
<h3 id="鲲鹏920-2" class="headerLink">
    <a href="#%e9%b2%b2%e9%b9%8f920-2" class="header-mark"></a>鲲鹏920</h3><p>可以看到<strong>鲲鹏920多核跑openssl是没有什么争抢的，所以还能保证完全线性</strong></p>
<p><img class="tw-inline" loading="lazy" src=http://localhost:1313/Users/ren/case/ossimg/39720b5eb41937b462e1772854e2d832.png   alt="image.png"  ></p>
<p><img class="tw-inline" loading="lazy" src=http://localhost:1313/Users/ren/case/ossimg/a98a482a10f09bccd4a6ac49fd2850b9.png   alt="image.png"  ></p>
<h3 id="小结" class="headerLink">
    <a href="#%e5%b0%8f%e7%bb%93" class="header-mark"></a>小结</h3><p>intel的流水线适合跑高带宽应用，不适合跑密集计算应用，也就是intel的pipeline数量少，但是内存读写上面优化好，乱序优化好。跑纯计算，不是intel的强项。</p>
<p>数据库场景下鲲鹏920大概相当于X86的70%的能力</p>
<p>prime计算一般走的fpu，不走cpu</p>
<h2 id="intel-x86-cpu-bound和memory-bond数据" class="headerLink">
    <a href="#intel-x86-cpu-bound%e5%92%8cmemory-bond%e6%95%b0%e6%8d%ae" class="header-mark"></a>intel x86 cpu bound和memory bond数据</h2><p>测试代码</p>
<div class="code-block highlight is-open show-line-numbers  tw-group tw-my-2">
  <div class="
    code-block-title 
    
    tw-flex 
    tw-flex-row 
    tw-justify-between 
    tw-w-full tw-bg-bgColor-secondary
    ">      
    <button 
      class="
        tw-select-none 
        tw-mx-2 
        tw-block
        group-[.is-open]:tw-rotate-90
        tw-transition-[transform] 
        tw-duration-500 
        tw-ease-in-out
        print:!tw-hidden"
      disabled
      aria-hidden="true"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M285.476 272.971L91.132 467.314c-9.373 9.373-24.569 9.373-33.941 0l-22.667-22.667c-9.357-9.357-9.375-24.522-.04-33.901L188.505 256 34.484 101.255c-9.335-9.379-9.317-24.544.04-33.901l22.667-22.667c9.373-9.373 24.569-9.373 33.941 0L285.475 239.03c9.373 9.372 9.373 24.568.001 33.941z"/></svg></button>

    <div class="code-block-title-bar tw-w-full">
      <p class="tw-select-none !tw-my-1">c</p>
    </div>
    <div class="tw-flex">
      <button 
        class="
          line-number-button
          tw-select-none 
          tw-mx-2 
          tw-hidden 
          group-[.is-open]:tw-block 
          group-[.show-line-numbers]:tw-text-fgColor-link 
          print:!tw-hidden" 
        title="Toggle line numbers"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M61.77 401l17.5-20.15a19.92 19.92 0 0 0 5.07-14.19v-3.31C84.34 356 80.5 352 73 352H16a8 8 0 0 0-8 8v16a8 8 0 0 0 8 8h22.83a157.41 157.41 0 0 0-11 12.31l-5.61 7c-4 5.07-5.25 10.13-2.8 14.88l1.05 1.93c3 5.76 6.29 7.88 12.25 7.88h4.73c10.33 0 15.94 2.44 15.94 9.09 0 4.72-4.2 8.22-14.36 8.22a41.54 41.54 0 0 1-15.47-3.12c-6.49-3.88-11.74-3.5-15.6 3.12l-5.59 9.31c-3.72 6.13-3.19 11.72 2.63 15.94 7.71 4.69 20.38 9.44 37 9.44 34.16 0 48.5-22.75 48.5-44.12-.03-14.38-9.12-29.76-28.73-34.88zM496 224H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zm0-160H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16V80a16 16 0 0 0-16-16zm0 320H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zM16 160h64a8 8 0 0 0 8-8v-16a8 8 0 0 0-8-8H64V40a8 8 0 0 0-8-8H32a8 8 0 0 0-7.14 4.42l-8 16A8 8 0 0 0 24 64h8v64H16a8 8 0 0 0-8 8v16a8 8 0 0 0 8 8zm-3.91 160H80a8 8 0 0 0 8-8v-16a8 8 0 0 0-8-8H41.32c3.29-10.29 48.34-18.68 48.34-56.44 0-29.06-25-39.56-44.47-39.56-21.36 0-33.8 10-40.46 18.75-4.37 5.59-3 10.84 2.8 15.37l8.58 6.88c5.61 4.56 11 2.47 16.12-2.44a13.44 13.44 0 0 1 9.46-3.84c3.33 0 9.28 1.56 9.28 8.75C51 248.19 0 257.31 0 304.59v4C0 316 5.08 320 12.09 320z"/></svg></button>

      <button 
        class="
          wrap-code-button
          tw-select-none 
          tw-mx-2 
          tw-hidden 
          group-[.is-open]:tw-block 
          group-[.is-wrap]:tw-text-fgColor-link 
          print:!tw-hidden" 
        title="Toggle code wrap"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M16 132h416c8.837 0 16-7.163 16-16V76c0-8.837-7.163-16-16-16H16C7.163 60 0 67.163 0 76v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16z"/></svg></button>
      
      <button 
        class="
          copy-code-button
          tw-select-none
          tw-mx-2 
          tw-hidden
          group-[.is-open]:tw-block
          hover:tw-text-fgColor-link 
          print:!tw-hidden"
        title="Copy code">
          <span class="copy-icon tw-block"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M433.941 65.941l-51.882-51.882A48 48 0 0 0 348.118 0H176c-26.51 0-48 21.49-48 48v48H48c-26.51 0-48 21.49-48 48v320c0 26.51 21.49 48 48 48h224c26.51 0 48-21.49 48-48v-48h80c26.51 0 48-21.49 48-48V99.882a48 48 0 0 0-14.059-33.941zM266 464H54a6 6 0 0 1-6-6V150a6 6 0 0 1 6-6h74v224c0 26.51 21.49 48 48 48h96v42a6 6 0 0 1-6 6zm128-96H182a6 6 0 0 1-6-6V54a6 6 0 0 1 6-6h106v88c0 13.255 10.745 24 24 24h88v202a6 6 0 0 1-6 6zm6-256h-64V48h9.632c1.591 0 3.117.632 4.243 1.757l48.368 48.368a6 6 0 0 1 1.757 4.243V112z"/></svg></span>
          <span class="check-icon tw-hidden"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M173.898 439.404l-166.4-166.4c-9.997-9.997-9.997-26.206 0-36.204l36.203-36.204c9.997-9.998 26.207-9.998 36.204 0L192 312.69 432.095 72.596c9.997-9.997 26.207-9.997 36.204 0l36.203 36.204c9.997 9.997 9.997 26.206 0 36.204l-294.4 294.401c-9.998 9.997-26.207 9.997-36.204-.001z"/></svg></span>
      </button>
        
      <button 
        class="
          tw-select-none 
          tw-mx-2 
          tw-block 
          group-[.is-open]:tw-hidden 
          print:!tw-hidden" 
        disabled
        aria-hidden="true"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M328 256c0 39.8-32.2 72-72 72s-72-32.2-72-72 32.2-72 72-72 72 32.2 72 72zm104-72c-39.8 0-72 32.2-72 72s32.2 72 72 72 72-32.2 72-72-32.2-72-72-72zm-352 0c-39.8 0-72 32.2-72 72s32.2 72 72 72 72-32.2 72-72-32.2-72-72-72z"/></svg></button>
    </div>
  </div>
  <pre style="counter-reset: codeblock;" class="tw-block tw-m-0 tw-p-0"><code 
    id="codeblock-id-15" 
    class="
      chroma 
      !tw-block 
      tw-p-0
      tw-m-0
      tw-transition-[max-height] 
      tw-duration-500 
      tw-ease-in-out 
      group-[.is-closed]:!tw-max-h-0 
      group-[.is-wrap]:tw-text-wrap
      tw-overflow-y-hidden
      tw-overflow-x-auto
      tw-scrollbar-thin
      "><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;stdlib.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;emmintrin.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;signal.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="kt">char</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">memory_bound</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">register</span> <span class="kt">unsigned</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">register</span> <span class="kt">char</span> <span class="n">b</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="p">(</span><span class="mi">1u</span><span class="o">&lt;&lt;</span><span class="mi">24</span><span class="p">);</span><span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="c1">// evict cacheline containing a
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                 <span class="nf">_mm_clflush</span><span class="p">(</span><span class="o">&amp;</span><span class="n">a</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">                 <span class="n">b</span> <span class="o">=</span> <span class="n">a</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">cpu_bound</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">register</span> <span class="kt">unsigned</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="p">(</span><span class="mi">1u</span><span class="o">&lt;&lt;</span><span class="mi">31</span><span class="p">);</span><span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="nf">__asm__</span> <span class="p">(</span><span class="s">&#34;nop</span><span class="se">\n</span><span class="s">nop</span><span class="se">\n</span><span class="s">nop&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">          <span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="mi">10</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">                 <span class="c1">//cpu_bound();
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                 <span class="nf">memory_bound</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">          <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre>
</div>
<h3 id="测试结果" class="headerLink">
    <a href="#%e6%b5%8b%e8%af%95%e7%bb%93%e6%9e%9c" class="header-mark"></a><strong>测试结果</strong></h3><p><strong>cpu_bound部分飞腾只有intel性能的30%</strong></p>
<p>如下测试perf数据可以看到IPC的明显差异</p>
<div class="code-block highlight is-open show-line-numbers  tw-group tw-my-2">
  <div class="
    code-block-title 
    
    tw-flex 
    tw-flex-row 
    tw-justify-between 
    tw-w-full tw-bg-bgColor-secondary
    ">      
    <button 
      class="
        tw-select-none 
        tw-mx-2 
        tw-block
        group-[.is-open]:tw-rotate-90
        tw-transition-[transform] 
        tw-duration-500 
        tw-ease-in-out
        print:!tw-hidden"
      disabled
      aria-hidden="true"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M285.476 272.971L91.132 467.314c-9.373 9.373-24.569 9.373-33.941 0l-22.667-22.667c-9.357-9.357-9.375-24.522-.04-33.901L188.505 256 34.484 101.255c-9.335-9.379-9.317-24.544.04-33.901l22.667-22.667c9.373-9.373 24.569-9.373 33.941 0L285.475 239.03c9.373 9.372 9.373 24.568.001 33.941z"/></svg></button>

    <div class="code-block-title-bar tw-w-full">
      <p class="tw-select-none !tw-my-1">shell</p>
    </div>
    <div class="tw-flex">
      <button 
        class="
          line-number-button
          tw-select-none 
          tw-mx-2 
          tw-hidden 
          group-[.is-open]:tw-block 
          group-[.show-line-numbers]:tw-text-fgColor-link 
          print:!tw-hidden" 
        title="Toggle line numbers"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M61.77 401l17.5-20.15a19.92 19.92 0 0 0 5.07-14.19v-3.31C84.34 356 80.5 352 73 352H16a8 8 0 0 0-8 8v16a8 8 0 0 0 8 8h22.83a157.41 157.41 0 0 0-11 12.31l-5.61 7c-4 5.07-5.25 10.13-2.8 14.88l1.05 1.93c3 5.76 6.29 7.88 12.25 7.88h4.73c10.33 0 15.94 2.44 15.94 9.09 0 4.72-4.2 8.22-14.36 8.22a41.54 41.54 0 0 1-15.47-3.12c-6.49-3.88-11.74-3.5-15.6 3.12l-5.59 9.31c-3.72 6.13-3.19 11.72 2.63 15.94 7.71 4.69 20.38 9.44 37 9.44 34.16 0 48.5-22.75 48.5-44.12-.03-14.38-9.12-29.76-28.73-34.88zM496 224H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zm0-160H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16V80a16 16 0 0 0-16-16zm0 320H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zM16 160h64a8 8 0 0 0 8-8v-16a8 8 0 0 0-8-8H64V40a8 8 0 0 0-8-8H32a8 8 0 0 0-7.14 4.42l-8 16A8 8 0 0 0 24 64h8v64H16a8 8 0 0 0-8 8v16a8 8 0 0 0 8 8zm-3.91 160H80a8 8 0 0 0 8-8v-16a8 8 0 0 0-8-8H41.32c3.29-10.29 48.34-18.68 48.34-56.44 0-29.06-25-39.56-44.47-39.56-21.36 0-33.8 10-40.46 18.75-4.37 5.59-3 10.84 2.8 15.37l8.58 6.88c5.61 4.56 11 2.47 16.12-2.44a13.44 13.44 0 0 1 9.46-3.84c3.33 0 9.28 1.56 9.28 8.75C51 248.19 0 257.31 0 304.59v4C0 316 5.08 320 12.09 320z"/></svg></button>

      <button 
        class="
          wrap-code-button
          tw-select-none 
          tw-mx-2 
          tw-hidden 
          group-[.is-open]:tw-block 
          group-[.is-wrap]:tw-text-fgColor-link 
          print:!tw-hidden" 
        title="Toggle code wrap"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M16 132h416c8.837 0 16-7.163 16-16V76c0-8.837-7.163-16-16-16H16C7.163 60 0 67.163 0 76v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16z"/></svg></button>
      
      <button 
        class="
          copy-code-button
          tw-select-none
          tw-mx-2 
          tw-hidden
          group-[.is-open]:tw-block
          hover:tw-text-fgColor-link 
          print:!tw-hidden"
        title="Copy code">
          <span class="copy-icon tw-block"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M433.941 65.941l-51.882-51.882A48 48 0 0 0 348.118 0H176c-26.51 0-48 21.49-48 48v48H48c-26.51 0-48 21.49-48 48v320c0 26.51 21.49 48 48 48h224c26.51 0 48-21.49 48-48v-48h80c26.51 0 48-21.49 48-48V99.882a48 48 0 0 0-14.059-33.941zM266 464H54a6 6 0 0 1-6-6V150a6 6 0 0 1 6-6h74v224c0 26.51 21.49 48 48 48h96v42a6 6 0 0 1-6 6zm128-96H182a6 6 0 0 1-6-6V54a6 6 0 0 1 6-6h106v88c0 13.255 10.745 24 24 24h88v202a6 6 0 0 1-6 6zm6-256h-64V48h9.632c1.591 0 3.117.632 4.243 1.757l48.368 48.368a6 6 0 0 1 1.757 4.243V112z"/></svg></span>
          <span class="check-icon tw-hidden"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M173.898 439.404l-166.4-166.4c-9.997-9.997-9.997-26.206 0-36.204l36.203-36.204c9.997-9.998 26.207-9.998 36.204 0L192 312.69 432.095 72.596c9.997-9.997 26.207-9.997 36.204 0l36.203 36.204c9.997 9.997 9.997 26.206 0 36.204l-294.4 294.401c-9.998 9.997-26.207 9.997-36.204-.001z"/></svg></span>
      </button>
        
      <button 
        class="
          tw-select-none 
          tw-mx-2 
          tw-block 
          group-[.is-open]:tw-hidden 
          print:!tw-hidden" 
        disabled
        aria-hidden="true"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M328 256c0 39.8-32.2 72-72 72s-72-32.2-72-72 32.2-72 72-72 72 32.2 72 72zm104-72c-39.8 0-72 32.2-72 72s32.2 72 72 72 72-32.2 72-72-32.2-72-72-72zm-352 0c-39.8 0-72 32.2-72 72s32.2 72 72 72 72-32.2 72-72-32.2-72-72-72z"/></svg></button>
    </div>
  </div>
  <pre style="counter-reset: codeblock;" class="tw-block tw-m-0 tw-p-0"><code 
    id="codeblock-id-16" 
    class="
      chroma 
      !tw-block 
      tw-p-0
      tw-m-0
      tw-transition-[max-height] 
      tw-duration-500 
      tw-ease-in-out 
      group-[.is-closed]:!tw-max-h-0 
      group-[.is-wrap]:tw-text-wrap
      tw-overflow-y-hidden
      tw-overflow-x-auto
      tw-scrollbar-thin
      "><span class="line"><span class="cl"><span class="c1"># sudo perf stat -e branch-instructions,branch-misses,bus-cycles,cache-misses,cache-references,cpu-cycles,instructions,ref-cycles,L1-dcache-load-misses,L1-dcache-loads,L1-dcache-stores,L1-icache-load-misses,LLC-load-misses,LLC-loads,LLC-store-misses,LLC-stores,branch-load-misses,branch-loads,dTLB-load-misses,dTLB-loads,dTLB-store-misses,dTLB-stores,iTLB-load-misses,iTLB-loads,node-load-misses,node-loads,node-store-misses,node-stores -a ./memory_bound</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> Performance counter stats <span class="k">for</span> <span class="s1">&#39;system wide&#39;</span>:
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    36,162,872,212      branch-instructions                                           <span class="o">(</span>14.21%<span class="o">)</span>
</span></span><span class="line"><span class="cl">       586,644,153      branch-misses             <span class="c1">#    1.62% of all branches          (12.95%)</span>
</span></span><span class="line"><span class="cl">     4,632,787,085      bus-cycles                                                    <span class="o">(</span>14.40%<span class="o">)</span>
</span></span><span class="line"><span class="cl">       476,189,785      cache-misses              <span class="c1">#   17.714 % of all cache refs      (14.38%)</span>
</span></span><span class="line"><span class="cl">     2,688,284,129      cache-references                                              <span class="o">(</span>14.35%<span class="o">)</span>
</span></span><span class="line"><span class="cl">   258,946,713,506      cpu-cycles                                                    <span class="o">(</span>17.93%<span class="o">)</span>
</span></span><span class="line"><span class="cl">   181,069,328,200      instructions              <span class="c1">#    0.70  insn per cycle           (21.51%)</span>
</span></span><span class="line"><span class="cl">   456,889,428,341      ref-cycles                                                    <span class="o">(</span>22.31%<span class="o">)</span>
</span></span><span class="line"><span class="cl">     3,928,434,098      L1-dcache-load-misses     <span class="c1">#    7.46% of all L1-dcache hits    (14.21%)</span>
</span></span><span class="line"><span class="cl">    52,656,559,902      L1-dcache-loads                                               <span class="o">(</span>14.31%<span class="o">)</span>
</span></span><span class="line"><span class="cl">    26,711,751,387      L1-dcache-stores                                              <span class="o">(</span>14.30%<span class="o">)</span>
</span></span><span class="line"><span class="cl">     2,618,739,340      L1-icache-load-misses                                         <span class="o">(</span>18.05%<span class="o">)</span>
</span></span><span class="line"><span class="cl">       154,326,888      LLC-load-misses           <span class="c1">#    8.60% of all LL-cache hits     (19.84%)</span>
</span></span><span class="line"><span class="cl">     1,795,112,198      LLC-loads                                                     <span class="o">(</span>9.81%<span class="o">)</span>
</span></span><span class="line"><span class="cl">        66,802,375      LLC-store-misses                                              <span class="o">(</span>10.19%<span class="o">)</span>
</span></span><span class="line"><span class="cl">       206,810,811      LLC-stores                                                    <span class="o">(</span>11.16%<span class="o">)</span>
</span></span><span class="line"><span class="cl">       586,120,789      branch-load-misses                                            <span class="o">(</span>14.28%<span class="o">)</span>
</span></span><span class="line"><span class="cl">    36,121,237,395      branch-loads                                                  <span class="o">(</span>14.29%<span class="o">)</span>
</span></span><span class="line"><span class="cl">       114,927,298      dTLB-load-misses          <span class="c1">#    0.22% of all dTLB cache hits   (14.29%)</span>
</span></span><span class="line"><span class="cl">    52,902,163,128      dTLB-loads                                                    <span class="o">(</span>14.29%<span class="o">)</span>
</span></span><span class="line"><span class="cl">         7,010,297      dTLB-store-misses                                             <span class="o">(</span>14.29%<span class="o">)</span>
</span></span><span class="line"><span class="cl">    26,587,353,417      dTLB-stores                                                   <span class="o">(</span>18.00%<span class="o">)</span>
</span></span><span class="line"><span class="cl">       106,209,281      iTLB-load-misses          <span class="c1">#  174.17% of all iTLB cache hits   (19.33%)</span>
</span></span><span class="line"><span class="cl">        60,978,626      iTLB-loads                                                    <span class="o">(</span>21.53%<span class="o">)</span>
</span></span><span class="line"><span class="cl">       117,197,042      node-load-misses                                              <span class="o">(</span>19.71%<span class="o">)</span>
</span></span><span class="line"><span class="cl">        35,764,508      node-loads                                                    <span class="o">(</span>11.65%<span class="o">)</span>
</span></span><span class="line"><span class="cl">        57,655,994      node-store-misses                                             <span class="o">(</span>7.80%<span class="o">)</span>
</span></span><span class="line"><span class="cl">        11,563,328      node-stores                                                   <span class="o">(</span>9.45%<span class="o">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      16.700731355 seconds <span class="nb">time</span> elapsed
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># sudo perf stat -e branch-instructions,branch-misses,bus-cycles,cache-misses,cache-references,cpu-cycles,instructions,ref-cycles,L1-dcache-load-misses,L1-dcache-loads,L1-dcache-stores,L1-icache-load-misses,LLC-load-misses,LLC-loads,LLC-store-misses,LLC-stores,branch-load-misses,branch-loads,dTLB-load-misses,dTLB-loads,dTLB-store-misses,dTLB-stores,iTLB-load-misses,iTLB-loads,node-load-misses,node-loads,node-store-misses,node-stores -a ./cpu_bound</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> Performance counter stats <span class="k">for</span> <span class="s1">&#39;system wide&#39;</span>:
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    43,013,055,562      branch-instructions                                           <span class="o">(</span>14.33%<span class="o">)</span>
</span></span><span class="line"><span class="cl">       436,722,063      branch-misses             <span class="c1">#    1.02% of all branches          (11.58%)</span>
</span></span><span class="line"><span class="cl">     3,154,327,457      bus-cycles                                                    <span class="o">(</span>14.31%<span class="o">)</span>
</span></span><span class="line"><span class="cl">       306,977,772      cache-misses              <span class="c1">#   17.837 % of all cache refs      (14.42%)</span>
</span></span><span class="line"><span class="cl">     1,721,062,233      cache-references                                              <span class="o">(</span>14.39%<span class="o">)</span>
</span></span><span class="line"><span class="cl">   176,119,834,487      cpu-cycles                                                    <span class="o">(</span>17.98%<span class="o">)</span>
</span></span><span class="line"><span class="cl">   276,038,539,571      instructions              <span class="c1">#    1.57  insn per cycle           (21.55%)</span>
</span></span><span class="line"><span class="cl">   309,334,354,268      ref-cycles                                                    <span class="o">(</span>22.31%<span class="o">)</span>
</span></span><span class="line"><span class="cl">     2,551,915,790      L1-dcache-load-misses     <span class="c1">#    6.78% of all L1-dcache hits    (13.12%)</span>
</span></span><span class="line"><span class="cl">    37,638,319,334      L1-dcache-loads                                               <span class="o">(</span>14.32%<span class="o">)</span>
</span></span><span class="line"><span class="cl">    19,132,537,445      L1-dcache-stores                                              <span class="o">(</span>15.73%<span class="o">)</span>
</span></span><span class="line"><span class="cl">     1,834,976,400      L1-icache-load-misses                                         <span class="o">(</span>18.90%<span class="o">)</span>
</span></span><span class="line"><span class="cl">       131,307,343      LLC-load-misses           <span class="c1">#   11.46% of all LL-cache hits     (19.94%)</span>
</span></span><span class="line"><span class="cl">     1,145,964,874      LLC-loads                                                     <span class="o">(</span>16.60%<span class="o">)</span>
</span></span><span class="line"><span class="cl">        45,561,247      LLC-store-misses                                              <span class="o">(</span>8.11%<span class="o">)</span>
</span></span><span class="line"><span class="cl">       140,236,535      LLC-stores                                                    <span class="o">(</span>9.60%<span class="o">)</span>
</span></span><span class="line"><span class="cl">       423,294,349      branch-load-misses                                            <span class="o">(</span>14.27%<span class="o">)</span>
</span></span><span class="line"><span class="cl">    46,645,623,485      branch-loads                                                  <span class="o">(</span>14.28%<span class="o">)</span>
</span></span><span class="line"><span class="cl">        73,377,533      dTLB-load-misses          <span class="c1">#    0.19% of all dTLB cache hits   (14.28%)</span>
</span></span><span class="line"><span class="cl">    37,905,428,246      dTLB-loads                                                    <span class="o">(</span>15.69%<span class="o">)</span>
</span></span><span class="line"><span class="cl">         4,969,973      dTLB-store-misses                                             <span class="o">(</span>17.21%<span class="o">)</span>
</span></span><span class="line"><span class="cl">    18,729,947,580      dTLB-stores                                                   <span class="o">(</span>19.71%<span class="o">)</span>
</span></span><span class="line"><span class="cl">        72,073,313      iTLB-load-misses          <span class="c1">#  167.86% of all iTLB cache hits   (20.60%)</span>
</span></span><span class="line"><span class="cl">        42,935,532      iTLB-loads                                                    <span class="o">(</span>19.16%<span class="o">)</span>
</span></span><span class="line"><span class="cl">       112,306,453      node-load-misses                                              <span class="o">(</span>15.35%<span class="o">)</span>
</span></span><span class="line"><span class="cl">        37,239,267      node-loads                                                    <span class="o">(</span>7.44%<span class="o">)</span>
</span></span><span class="line"><span class="cl">        37,455,335      node-store-misses                                             <span class="o">(</span>10.00%<span class="o">)</span>
</span></span><span class="line"><span class="cl">         8,134,155      node-stores                                                   <span class="o">(</span>8.87%<span class="o">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      10.838808208 seconds <span class="nb">time</span> elapsed      </span></span></code></pre>
</div>
<h3 id="飞腾-1" class="headerLink">
    <a href="#%e9%a3%9e%e8%85%be-1" class="header-mark"></a>飞腾</h3><p>ipc 大概是intel的30%，加上主频也要差一些，</p>
<div class="code-block highlight is-open show-line-numbers  tw-group tw-my-2">
  <div class="
    code-block-title 
    
    tw-flex 
    tw-flex-row 
    tw-justify-between 
    tw-w-full tw-bg-bgColor-secondary
    ">      
    <button 
      class="
        tw-select-none 
        tw-mx-2 
        tw-block
        group-[.is-open]:tw-rotate-90
        tw-transition-[transform] 
        tw-duration-500 
        tw-ease-in-out
        print:!tw-hidden"
      disabled
      aria-hidden="true"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M285.476 272.971L91.132 467.314c-9.373 9.373-24.569 9.373-33.941 0l-22.667-22.667c-9.357-9.357-9.375-24.522-.04-33.901L188.505 256 34.484 101.255c-9.335-9.379-9.317-24.544.04-33.901l22.667-22.667c9.373-9.373 24.569-9.373 33.941 0L285.475 239.03c9.373 9.372 9.373 24.568.001 33.941z"/></svg></button>

    <div class="code-block-title-bar tw-w-full">
      <p class="tw-select-none !tw-my-1">shell</p>
    </div>
    <div class="tw-flex">
      <button 
        class="
          line-number-button
          tw-select-none 
          tw-mx-2 
          tw-hidden 
          group-[.is-open]:tw-block 
          group-[.show-line-numbers]:tw-text-fgColor-link 
          print:!tw-hidden" 
        title="Toggle line numbers"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M61.77 401l17.5-20.15a19.92 19.92 0 0 0 5.07-14.19v-3.31C84.34 356 80.5 352 73 352H16a8 8 0 0 0-8 8v16a8 8 0 0 0 8 8h22.83a157.41 157.41 0 0 0-11 12.31l-5.61 7c-4 5.07-5.25 10.13-2.8 14.88l1.05 1.93c3 5.76 6.29 7.88 12.25 7.88h4.73c10.33 0 15.94 2.44 15.94 9.09 0 4.72-4.2 8.22-14.36 8.22a41.54 41.54 0 0 1-15.47-3.12c-6.49-3.88-11.74-3.5-15.6 3.12l-5.59 9.31c-3.72 6.13-3.19 11.72 2.63 15.94 7.71 4.69 20.38 9.44 37 9.44 34.16 0 48.5-22.75 48.5-44.12-.03-14.38-9.12-29.76-28.73-34.88zM496 224H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zm0-160H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16V80a16 16 0 0 0-16-16zm0 320H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zM16 160h64a8 8 0 0 0 8-8v-16a8 8 0 0 0-8-8H64V40a8 8 0 0 0-8-8H32a8 8 0 0 0-7.14 4.42l-8 16A8 8 0 0 0 24 64h8v64H16a8 8 0 0 0-8 8v16a8 8 0 0 0 8 8zm-3.91 160H80a8 8 0 0 0 8-8v-16a8 8 0 0 0-8-8H41.32c3.29-10.29 48.34-18.68 48.34-56.44 0-29.06-25-39.56-44.47-39.56-21.36 0-33.8 10-40.46 18.75-4.37 5.59-3 10.84 2.8 15.37l8.58 6.88c5.61 4.56 11 2.47 16.12-2.44a13.44 13.44 0 0 1 9.46-3.84c3.33 0 9.28 1.56 9.28 8.75C51 248.19 0 257.31 0 304.59v4C0 316 5.08 320 12.09 320z"/></svg></button>

      <button 
        class="
          wrap-code-button
          tw-select-none 
          tw-mx-2 
          tw-hidden 
          group-[.is-open]:tw-block 
          group-[.is-wrap]:tw-text-fgColor-link 
          print:!tw-hidden" 
        title="Toggle code wrap"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M16 132h416c8.837 0 16-7.163 16-16V76c0-8.837-7.163-16-16-16H16C7.163 60 0 67.163 0 76v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16z"/></svg></button>
      
      <button 
        class="
          copy-code-button
          tw-select-none
          tw-mx-2 
          tw-hidden
          group-[.is-open]:tw-block
          hover:tw-text-fgColor-link 
          print:!tw-hidden"
        title="Copy code">
          <span class="copy-icon tw-block"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M433.941 65.941l-51.882-51.882A48 48 0 0 0 348.118 0H176c-26.51 0-48 21.49-48 48v48H48c-26.51 0-48 21.49-48 48v320c0 26.51 21.49 48 48 48h224c26.51 0 48-21.49 48-48v-48h80c26.51 0 48-21.49 48-48V99.882a48 48 0 0 0-14.059-33.941zM266 464H54a6 6 0 0 1-6-6V150a6 6 0 0 1 6-6h74v224c0 26.51 21.49 48 48 48h96v42a6 6 0 0 1-6 6zm128-96H182a6 6 0 0 1-6-6V54a6 6 0 0 1 6-6h106v88c0 13.255 10.745 24 24 24h88v202a6 6 0 0 1-6 6zm6-256h-64V48h9.632c1.591 0 3.117.632 4.243 1.757l48.368 48.368a6 6 0 0 1 1.757 4.243V112z"/></svg></span>
          <span class="check-icon tw-hidden"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M173.898 439.404l-166.4-166.4c-9.997-9.997-9.997-26.206 0-36.204l36.203-36.204c9.997-9.998 26.207-9.998 36.204 0L192 312.69 432.095 72.596c9.997-9.997 26.207-9.997 36.204 0l36.203 36.204c9.997 9.997 9.997 26.206 0 36.204l-294.4 294.401c-9.998 9.997-26.207 9.997-36.204-.001z"/></svg></span>
      </button>
        
      <button 
        class="
          tw-select-none 
          tw-mx-2 
          tw-block 
          group-[.is-open]:tw-hidden 
          print:!tw-hidden" 
        disabled
        aria-hidden="true"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M328 256c0 39.8-32.2 72-72 72s-72-32.2-72-72 32.2-72 72-72 72 32.2 72 72zm104-72c-39.8 0-72 32.2-72 72s32.2 72 72 72 72-32.2 72-72-32.2-72-72-72zm-352 0c-39.8 0-72 32.2-72 72s32.2 72 72 72 72-32.2 72-72-32.2-72-72-72z"/></svg></button>
    </div>
  </div>
  <pre style="counter-reset: codeblock;" class="tw-block tw-m-0 tw-p-0"><code 
    id="codeblock-id-17" 
    class="
      chroma 
      !tw-block 
      tw-p-0
      tw-m-0
      tw-transition-[max-height] 
      tw-duration-500 
      tw-ease-in-out 
      group-[.is-closed]:!tw-max-h-0 
      group-[.is-wrap]:tw-text-wrap
      tw-overflow-y-hidden
      tw-overflow-x-auto
      tw-scrollbar-thin
      "><span class="line"><span class="cl"><span class="c1">#time perf stat -e branch-misses,bus-cycles,cache-misses,cache-references,cpu-cycles,instructions,L1-dcache-load-misses,L1-dcache-loads,L1-dcache-store-misses,L1-dcache-stores,L1-icache-load-misses,L1-icache-loads,branch-load-misses,branch-loads,dTLB-load-misses,iTLB-load-misses -a ./cpu_bound</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> Performance counter stats <span class="k">for</span> <span class="s1">&#39;system wide&#39;</span>:
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">       <span class="m">10496356859</span>      branch-misses                                                 <span class="o">(</span>37.60%<span class="o">)</span>
</span></span><span class="line"><span class="cl">     <span class="m">2813170983911</span>      bus-cycles                                                    <span class="o">(</span>37.58%<span class="o">)</span>
</span></span><span class="line"><span class="cl">       <span class="m">17604745519</span>      cache-misses              <span class="c1">#    3.638 % of all cache refs      (37.55%)</span>
</span></span><span class="line"><span class="cl">      <span class="m">483878256161</span>      cache-references                                              <span class="o">(</span>37.54%<span class="o">)</span>
</span></span><span class="line"><span class="cl">     <span class="m">2818545529083</span>      cpu-cycles                                                    <span class="o">(</span>43.78%<span class="o">)</span>
</span></span><span class="line"><span class="cl">     <span class="m">1280497827941</span>      instructions              <span class="c1">#    0.45  insns per cycle          (43.78%)</span>
</span></span><span class="line"><span class="cl">       <span class="m">17623592806</span>      L1-dcache-load-misses     <span class="c1">#    3.65% of all L1-dcache hits    (43.78%)</span>
</span></span><span class="line"><span class="cl">      <span class="m">482429613337</span>      L1-dcache-loads                                               <span class="o">(</span>41.83%<span class="o">)</span>
</span></span><span class="line"><span class="cl">       <span class="m">17604561232</span>      L1-dcache-store-misses                                        <span class="o">(</span>37.53%<span class="o">)</span>
</span></span><span class="line"><span class="cl">      <span class="m">484126081882</span>      L1-dcache-stores                                              <span class="o">(</span>37.52%<span class="o">)</span>
</span></span><span class="line"><span class="cl">       <span class="m">17774514325</span>      L1-icache-load-misses                                         <span class="o">(</span>37.50%<span class="o">)</span>
</span></span><span class="line"><span class="cl">      <span class="m">641046300400</span>      L1-icache-loads                                               <span class="o">(</span>37.50%<span class="o">)</span>
</span></span><span class="line"><span class="cl">       <span class="m">10574973722</span>      branch-load-misses                                            <span class="o">(</span>39.45%<span class="o">)</span>
</span></span><span class="line"><span class="cl">      <span class="m">273851009656</span>      branch-loads                                                  <span class="o">(</span>43.76%<span class="o">)</span>
</span></span><span class="line"><span class="cl">        <span class="m">9457594390</span>      dTLB-load-misses                                              <span class="o">(</span>43.77%<span class="o">)</span>
</span></span><span class="line"><span class="cl">        <span class="m">1813954093</span>      iTLB-load-misses                                              <span class="o">(</span>43.77%<span class="o">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      31.172754504 seconds <span class="nb">time</span> elapsed
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">real    0m31.284s
</span></span><span class="line"><span class="cl">user    0m31.096s
</span></span><span class="line"><span class="cl">sys    0m0.165s</span></span></code></pre>
</div>
<h2 id="unixbench-513-性能对比" class="headerLink">
    <a href="#unixbench-513-%e6%80%a7%e8%83%bd%e5%af%b9%e6%af%94" class="header-mark"></a>unixBench 5.1.3 性能对比</h2><p>测试命令： ./Run -c 1 -c 4</p>

<div class="table-wrapper">
  <table>
    <thead>
        <tr>
            <th style="text-align: ">芯片</th>
            <th style="text-align: ">架构</th>
            <th style="text-align: ">逻辑核数</th>
            <th style="text-align: ">单核能力</th>
            <th style="text-align: ">4核能力</th>
            <th style="text-align: ">单核比值</th>
            <th style="text-align: ">4核比值</th>
            <th style="text-align: ">整机对比</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td style="text-align: ">Intel 4114</td>
            <td style="text-align: ">x86</td>
            <td style="text-align: ">40</td>
            <td style="text-align: ">1150</td>
            <td style="text-align: ">3095</td>
            <td style="text-align: ">100%</td>
            <td style="text-align: ">100%</td>
            <td style="text-align: ">100%</td>
        </tr>
        <tr>
            <td style="text-align: ">海光 7165</td>
            <td style="text-align: ">x86</td>
            <td style="text-align: ">48</td>
            <td style="text-align: ">1586</td>
            <td style="text-align: ">2533</td>
            <td style="text-align: ">138%</td>
            <td style="text-align: ">82%</td>
            <td style="text-align: ">98%</td>
        </tr>
        <tr>
            <td style="text-align: ">华为鲲鹏920</td>
            <td style="text-align: ">arm</td>
            <td style="text-align: ">96</td>
            <td style="text-align: ">1168</td>
            <td style="text-align: ">2066</td>
            <td style="text-align: ">102%</td>
            <td style="text-align: ">67%</td>
            <td style="text-align: ">160%</td>
        </tr>
        <tr>
            <td style="text-align: ">飞腾2000</td>
            <td style="text-align: ">arm</td>
            <td style="text-align: ">64</td>
            <td style="text-align: ">731</td>
            <td style="text-align: ">1902</td>
            <td style="text-align: ">64%</td>
            <td style="text-align: ">61%</td>
            <td style="text-align: ">98%</td>
        </tr>
        <tr>
            <td style="text-align: ">申威1621</td>
            <td style="text-align: ">alpha</td>
            <td style="text-align: ">16</td>
            <td style="text-align: ">445</td>
            <td style="text-align: ">1065</td>
            <td style="text-align: ">39%</td>
            <td style="text-align: ">34%</td>
            <td style="text-align: ">14%</td>
        </tr>
    </tbody>
  </table>
</div>
<p>以上CPU除了Intel，其它都没有HT，也就是Intel 4114实际是20个物理核。以上数据来自ata，仅供参考</p>
<h2 id="arm-和-x86的总结" class="headerLink">
    <a href="#arm-%e5%92%8c-x86%e7%9a%84%e6%80%bb%e7%bb%93" class="header-mark"></a>ARM 和 X86的总结</h2><p>对比硬件：</p>
<p>ARM：泰山ARM 双路 128核心64核心/路），2.5G，4指令/周期，8个内存通道/路，mips体系架构。
X86: intel 8163服务器 双路 48核心（24核心/路），2.5GHZ， 6指令/周期，96smt， 6个内存通道</p>
<p>用 Geabase(C++)  测试所得 ARM是X86 性能的1.36倍，接近理论值的1.4倍</p>
<p>理论值的计算公式：</p>
<blockquote>
  <p>CPU性能验证公式：频率 x 核数 x 发射数/周期 x 1.3/1.5(smt2/smt4) (smt是指超线程数量)</p>

</blockquote><p>ARM 优势的来源主要是工艺领先一代(7nm VS 14nm)</p>
<h2 id="总结" class="headerLink">
    <a href="#%e6%80%bb%e7%bb%93" class="header-mark"></a>总结</h2><ul>
<li>对纯CPU 运算场景，并发不超过物理core时，比如Prime运算，比如DRDS(CPU bound，IO在网络，可以加并发弥补)
<ul>
<li>海光的IPC能保持稳定；</li>
<li>intel的IPC有所下降，但是QPS在IPC下降后还能完美线性</li>
</ul>
</li>
<li>在openssl和MySQL oltp_read_only场景下
<ul>
<li>如果并发没超过物理core数时，海光和Intel都能随着并发的翻倍性能能增加80%</li>
<li>如果并发超过物理core数后，Intel还能随着并发的翻倍性能增加50%，海光增加就只有20%了</li>
<li>简单理解在这两个场景下Intel的HT能发挥半个物理core的作用，海光的HT就只能发挥0.2个物理core的作用了</li>
</ul>
</li>
<li>海光zen1的AMD 架构，每个core只有一个fpu，综上在多个场景下HT基本上都可以忽略</li>
<li>飞腾2500性能比较差</li>
<li>国产CPU：飞腾、鲲鹏、龙芯、申威、海光(AMD授权)、兆芯(威盛via 授权x86)</li>
<li>CPU性能验证公式：频率 x 核数 x 发射数/周期 x 1.3/1.5(smt2/smt4) (smt是指超线程数量)</li>
<li>大吞吐量计算由多核CPU数量决定，多核CPU数量由制程工艺决定，制程工艺由资本决定，制程工艺资本由主流消费电子决定, 摩尔定律仍在持续</li>
</ul>
<h2 id="系列文章-1" class="headerLink">
    <a href="#%e7%b3%bb%e5%88%97%e6%96%87%e7%ab%a0-1" class="header-mark"></a>系列文章</h2><p><a href="/2021/06/01/CPU%e7%9a%84%e5%88%b6%e9%80%a0%e5%92%8c%e6%a6%82%e5%bf%b5/" rel="">CPU的制造和概念</a></p>
<p>[CPU 性能和Cache Line](/2021/05/16/CPU Cache Line 和性能/)</p>
<p>[Perf IPC以及CPU性能](/2021/05/16/Perf IPC以及CPU利用率/)</p>
<p><a href="/2021/06/18/%e5%87%a0%e6%ac%beCPU%e6%80%a7%e8%83%bd%e5%af%b9%e6%af%94/" rel="">Intel、海光、鲲鹏920、飞腾2500 CPU性能对比</a></p>
<p><a href="/2021/05/15/%e9%a3%9e%e8%85%beARM%e8%8a%af%e7%89%87%28FT2500%29%e7%9a%84%e6%80%a7%e8%83%bd%e6%b5%8b%e8%af%95/" rel="">飞腾ARM芯片(FT2500)的性能测试</a></p>
<p><a href="/2021/05/14/%e5%8d%81%e5%b9%b4%e5%90%8e%e6%95%b0%e6%8d%ae%e5%ba%93%e8%bf%98%e6%98%af%e4%b8%8d%e6%95%a2%e6%8b%a5%e6%8a%b1NUMA/" rel="">十年后数据库还是不敢拥抱NUMA？</a></p>
<p><a href="/2021/03/07/%e4%b8%80%e6%ac%a1%e6%b5%b7%e5%85%89%e7%89%a9%e7%90%86%e6%9c%ba%e8%b5%84%e6%ba%90%e7%ab%9e%e4%ba%89%e5%8e%8b%e6%b5%8b%e7%9a%84%e8%ae%b0%e5%bd%95/" rel="">一次海光物理机资源竞争压测的记录</a></p>
<p>[Intel PAUSE指令变化是如何影响自旋锁以及MySQL的性能的](/2019/12/16/Intel PAUSE指令变化是如何影响自旋锁以及MySQL的性能的/)</p>
<h2 id="参考资料" class="headerLink">
    <a href="#%e5%8f%82%e8%80%83%e8%b5%84%e6%96%99" class="header-mark"></a>参考资料</h2><p><a href="https://plantegg.github.io/2019/12/16/Intel%20PAUSE%E6%8C%87%E4%BB%A4%E5%8F%98%E5%8C%96%E6%98%AF%E5%A6%82%E4%BD%95%E5%BD%B1%E5%93%8D%E8%87%AA%E6%97%8B%E9%94%81%E4%BB%A5%E5%8F%8AMySQL%E7%9A%84%E6%80%A7%E8%83%BD%E7%9A%84/" target="_blank" rel="noopener noreferrer">Intel PAUSE指令变化是如何影响自旋锁以及MySQL的性能的</a></p>
<p><a href="https://bbs.huaweicloud.com/blogs/146367" target="_blank" rel="noopener noreferrer">华为TaiShan服务器ARMNginx应用调优案例 大量绑核、中断、Numa等相关调优信息</a></p>
]]></description>
</item><item>
    <title>Intel PAUSE指令变化是如何影响自旋锁以及MySQL的性能的</title>
    <link>http://localhost:1313/posts/intel-pause%E6%8C%87%E4%BB%A4%E5%8F%98%E5%8C%96%E5%A6%82%E4%BD%95%E5%BD%B1%E5%93%8Dmysql%E7%9A%84%E6%80%A7%E8%83%BD/</link>
    <pubDate>Mon, 16 Dec 2019 12:30:03 &#43;0000</pubDate><author>
        <name>作者</name>
    </author><guid>http://localhost:1313/posts/intel-pause%E6%8C%87%E4%BB%A4%E5%8F%98%E5%8C%96%E5%A6%82%E4%BD%95%E5%BD%B1%E5%93%8Dmysql%E7%9A%84%E6%80%A7%E8%83%BD/</guid>
    <description><![CDATA[<h1 id="intel-pause指令变化如何影响mysql的性能" class="headerLink">
    <a href="#intel-pause%e6%8c%87%e4%bb%a4%e5%8f%98%e5%8c%96%e5%a6%82%e4%bd%95%e5%bd%b1%e5%93%8dmysql%e7%9a%84%e6%80%a7%e8%83%bd" class="header-mark"></a>Intel PAUSE指令变化如何影响MySQL的性能</h1><h2 id="导读" class="headerLink">
    <a href="#%e5%af%bc%e8%af%bb" class="header-mark"></a>导读</h2><p>x86、arm指令都很多，无论是应用程序员还是数据库内核研发大多时候都不需要对这些指令深入理解，但是 Pause 指令和数据库操作太紧密了，本文通过一次非常有趣的性能优化来引入对 Pause 指令的理解，期望可以事半功倍地搞清楚 CPU指令集是如何影响你的程序的。</p>
<p>文章分成两大部分，第一部分是 MySQL 集群的一次全表扫描性能优化过程； 第二部分是问题解决后的原理分析以及Pause指令的来龙去脉和优缺点以及应用场景分析。</p>
<h2 id="业务结构" class="headerLink">
    <a href="#%e4%b8%9a%e5%8a%a1%e7%bb%93%e6%9e%84" class="header-mark"></a>业务结构</h2><p>为理解方便做了部分简化：</p>
<p>client -&gt; Tomcat -&gt; LVS -&gt; MySQL（32 个 MySQLD实例集群，每个实例8Core）</p>
<h2 id="场景描述" class="headerLink">
    <a href="#%e5%9c%ba%e6%99%af%e6%8f%8f%e8%bf%b0" class="header-mark"></a>场景描述</h2><p>业务按照 个人分库+单位分表: 32个RDS * 8个分库   * 4张分表=1024分表， 也就是 256个分库，每个分库4张表</p>
<p>通过 client 压 Tomcat 和 MySQL 集群（对数据做分库分表），MySQL 集群是32个实例，每个业务 SQL 都需要经过 Tomcat 拆分成 256 个 SQL 发送给 32 个MySQL 实例（每个MySQL 实例上有8个分库），这 256 条下发给 MySQL 的 SQL 不是完全串行，但也不是完全并行，有一定的并行性。</p>
<p>业务 SQL 如下是一个简单的select sum求和，这个 SQL在每个MySQL上都很快（有索引）</p>
<pre><code>SELECT SUM(emp_arr_amt) FROM table_c WHERE INSUTYPE='310' AND Revs_Flag='Z' AND accrym='201910' AND emp_no='1050457';
</code></pre>
<h2 id="监控指标说明" class="headerLink">
    <a href="#%e7%9b%91%e6%8e%a7%e6%8c%87%e6%a0%87%e8%af%b4%e6%98%8e" class="header-mark"></a>监控指标说明</h2><ul>
<li>后述或者截图中的逻辑RT/QPS是指 client 上看到的Tomcat的 RT 和 QPS；</li>
<li>RT ：response time 请求响应时间，判断性能瓶颈的唯一指标;</li>
<li>物理RT/QPS是指Tomcat看到的MySQL  RT 和QPS（这里的 RT 是指到达Tomcat节点网卡的 RT ，所以还包含了网络消耗）</li>
</ul>
<h2 id="问题描述" class="headerLink">
    <a href="#%e9%97%ae%e9%a2%98%e6%8f%8f%e8%bf%b0" class="header-mark"></a>问题描述：</h2><p>通过client压一个Tomcat节点+32个MySQL，QPS大概是430，Tomcat节点CPU跑满，MySQL  RT 是0.5ms，增加一个Tomcat节点，QPS大概是700，Tomcat CPU接近跑满，MySQL  RT 是0.6ms，到这里性能基本随着扩容线性增加，是符合预期的。</p>
<p>继续增加Tomcat节点来横向扩容性能，通过client压三个Tomcat节点+32个MySQL，QPS还是700，Tomcat节点CPU跑不满，MySQL  RT 是0.8ms，这就严重不符合预期了。</p>
<p>性能压测原则：</p>
<blockquote>
  <p>加并发QPS不再上升说明到了某个瓶颈，哪个环节RT增加最多瓶颈就在哪里</p>

</blockquote><p><img class="tw-inline" loading="lazy" src=https://cdn.jsdelivr.net/gh/plantegg/plantegg.github.io/images/951413iMgBlog/image-20221026145848312.png   alt="image-20221026145848312"  ></p>
<p><strong>到这里一切都还是符合我们的经验的，看起来就是 MySQL 有瓶颈（RT 增加明显）。</strong></p>
<h2 id="排查-mysql" class="headerLink">
    <a href="#%e6%8e%92%e6%9f%a5-mysql" class="header-mark"></a>排查 MySQL</h2><p>现场DBA通过监控看到MySQL CPU不到20%，没有慢查询，并且尝试用client越过所有中间环节直接压其中一个MySQL，可以将 MySQL CPU 跑满，这时的QPS大概是38000（对应上面的场景client QPS为700的时候，单个MySQL上的QPS才跑到6000) 所以排除了MySQL的嫌疑(这个推理不够严谨为后面排查埋下了大坑)。</p>
<p>那么接下来的嫌疑在网络、LVS 等中间环节上。</p>
<h2 id="lvs和网络的嫌疑" class="headerLink">
    <a href="#lvs%e5%92%8c%e7%bd%91%e7%bb%9c%e7%9a%84%e5%ab%8c%e7%96%91" class="header-mark"></a>LVS和网络的嫌疑</h2><p>首先通过大查询排除了带宽的问题，因为这里都是小包，pps到了72万，很自然想到了网关、LVS的限流之类的</p>
<p>pps监控，这台物理机有4个MySQL实例上，pps 9万左右，9*32/4=72万
<img class="tw-inline" loading="lazy" src=http://localhost:1313/Users/ren/case/ossimg/b84245c17e213de528f2ad8090d504f6.png   alt="image.png"  ></p>
<p>…………（省略巨长的分析、拉人、扯皮过程）</p>
<p>最终所有网络因素都被排除，核心证据是：做压测的时候反复从 Tomcat 上 ping 后面的MySQL，RT 跟没有压力的时候一样，也说明了网络没有问题(请思考这个 ping 的作用)。</p>
<h2 id="问题的确认" class="headerLink">
    <a href="#%e9%97%ae%e9%a2%98%e7%9a%84%e7%a1%ae%e8%ae%a4" class="header-mark"></a>问题的确认</h2><p>尝试在Tomcat上打开日志，并将慢 SQL 阈值设置为100ms，这个时候确实能从日志中看到大量MySQL上的慢查询，因为这个SQL需要在Tomcat上做拆分成256个SQL，同时下发，一旦有一个SQL返回慢，整个请求就因为这个短板被拖累了。平均 RT  0.8ms，但是经常有超过100ms的话对整体影响还是很大的。</p>
<p>将Tomcat记录下来的慢查询（Tomcat增加了一个唯一id下发给MySQL）到MySQL日志中查找，果然发现MySQL上确实慢了，所以到这里基本确认是MySQL的问题，终于不用再纠结是否是网络问题了。</p>
<p>同时在Tomcat进行抓包，对网卡上的 RT 进行统计分析：</p>
<p><img class="tw-inline" loading="lazy" src=http://localhost:1313/Users/ren/case/ossimg/ffd66d9a6098979b555dfb00d3494255.png   alt="image.png"  ></p>
<p>上是Tomcat上抓到的每个sql的物理RT 平均值，上面是QPS 430的时候， RT  0.6ms，下面是3个server，QPS为700，但是 RT 上升到了0.9ms，基本跟Tomcat监控记录到的物理RT一致。如果MySQL上也有类似抓包计算 RT 时间的话可以快速排除网络问题。</p>
<p>网络抓包得到的 RT 数据更容易被所有人接受。尝试过在MySQL上抓包，但是因为LVS模块的原因，进出端口、ip都被修改过，所以没法分析一个流的响应时间。</p>
<h2 id="重心再次转向mysql" class="headerLink">
    <a href="#%e9%87%8d%e5%bf%83%e5%86%8d%e6%ac%a1%e8%bd%ac%e5%90%91mysql" class="header-mark"></a>重心再次转向MySQL</h2><p>这个时候因为问题点基本确认，再去查看MySQL是否有问题的重心都不一样了，不再只是看看CPU和慢查询，这个问题明显更复杂一些。</p>
<blockquote>
  <p>教训：CPU只是影响性能的一个因素，RT 才是结果，要追着 RT 跑，而不是只看 CPU</p>

</blockquote><p>通过监控发现MySQL CPU虽然一直不高，但是经常看到running thread飙到100多，很快又降下去了，看起来像是突发性的并发查询请求太多导致了排队等待，每个MySQL实例是8Core的CPU，尝试将MySQL实例扩容到16Core（只是为了验证这个问题），QPS确实可以上升到1000（没有到达理想的1400）。</p>
<p>这是Tomcat上监控到的MySQL状态：
<img class="tw-inline" loading="lazy" src=http://localhost:1313/Users/ren/case/ossimg/e73c1371a02106a52f8a13f89a9dd9ad.png   alt="image.png"  ></p>
<p>同时在MySQL机器上通过vmstat也可以看到这种飙升：
<img class="tw-inline" loading="lazy" src=http://localhost:1313/Users/ren/case/ossimg/4dbd9dff9deacec0e9911e3a7d025578.png   alt="image.png"  ></p>
<p>以上分析可以清晰看到虽然 MySQL 整体压力不大，但是似乎会偶尔来一波卡顿、running 任务飙升。</p>
<p>像这种短暂突发性的并发流量似乎监控都很难看到（基本都被平均掉了），只有一些实时性监控偶尔会采集到这种短暂突发性飙升，这也导致了一开始忽视了MySQL。</p>
<p>所以接下来的核心问题就是MySQL为什么会有这种飙升、这种飙升的影响到底是什么？</p>
<h2 id="perf-top" class="headerLink">
    <a href="#perf-top" class="header-mark"></a>perf top</h2><p>直接用 perf 看下 MySQLD 进程，发现 ut_delay 高得不符合逻辑：</p>
<p><img class="tw-inline" loading="lazy" src=http://localhost:1313/Users/ren/case/ossimg/cd145c494c074e01e9d2d1d5583a87a0.png   alt="image.png"  ></p>
<p>展开看一下，基本是在优化器中做索引命中行数的选择：</p>
<!-- raw HTML omitted -->
<p>跟直接在 MySQL 命令行中通过 show processlist看到的基本一致：</p>
<!-- raw HTML omitted -->
<p>这是 MySQL 的优化器在对索引进行统计，统计的时候要加锁，thread running 抖动的时候通过 show processlist 看到很多 thread处于 statistics 状态。也就是高并发下加锁影响了 CPU 压不上去同时 RT 剧烈增加。</p>
<p>这里ut_delay 消耗了 28% 的 CPU 肯定太不正常了，于是将 innodb_spin_wait_delay 从 30 改成 6 后性能立即上去了，继续增加 Tomcat 节点，QPS也可以线性增加。</p>
<blockquote>
  <p>耗CPU最高的调用函数栈是…<code>mutex_spin_wait</code>-&gt;<code>ut_delay</code>，属于锁等待的逻辑。InnoDB在这里用的是自旋锁，锁等待是通过调用 ut_delay 让 CPU做空循环在等锁的时候不释放CPU从而避免上下文切换，会消耗比较高的CPU。</p>

</blockquote><h2 id="最终的性能" class="headerLink">
    <a href="#%e6%9c%80%e7%bb%88%e7%9a%84%e6%80%a7%e8%83%bd" class="header-mark"></a>最终的性能</h2><p>调整参数 innodb_spin_wait_delay=6 后在4个Tomcat节点下，并发40时，QPS跑到了1700，物理RT：0.7，逻辑RT：19.6，cpu：90%，这个时候只需要继续扩容 Tomcat 节点的数量就可以增加QPS
<img class="tw-inline" loading="lazy" src=http://localhost:1313/Users/ren/case/ossimg/48c976f989747266f9892403794996c0.png   alt="image.png"  ></p>
<p>再跟调整前比较一下，innodb_spin_wait_delay=30，并发40时，QPS 500+，物理RT：2.6ms 逻辑RT：72.1ms cpu：37%
<img class="tw-inline" loading="lazy" src=http://localhost:1313/Users/ren/case/ossimg/fdb459972926cff371f5f5ab703790bb.png   alt="image.png"  ></p>
<p>再看看调整前压测的时候的vmstat和tsar &ndash;cpu，可以看到process running抖动明显
<img class="tw-inline" loading="lazy" src=http://localhost:1313/Users/ren/case/ossimg/4dbd9dff9deacec0e9911e3a7d025578.png   alt="image.png"  ></p>
<p>对比修改delay后的process running就很稳定了，即使QPS大了3倍
<img class="tw-inline" loading="lazy" src=http://localhost:1313/Users/ren/case/ossimg/ed46d35161ea28352acd4289a3e9ddad.png   alt="image.png"  ></p>
<h2 id="事后思考和分析" class="headerLink">
    <a href="#%e4%ba%8b%e5%90%8e%e6%80%9d%e8%80%83%e5%92%8c%e5%88%86%e6%9e%90" class="header-mark"></a>事后思考和分析</h2><p>到这里问题得到了完美解决，但是不禁要问为什么？ut_delay 是怎么工作的？ 和 innodb_spin_wait_delay 以及自旋锁的关系？</p>
<h2 id="原理解析" class="headerLink">
    <a href="#%e5%8e%9f%e7%90%86%e8%a7%a3%e6%9e%90" class="header-mark"></a>原理解析</h2><p>既然调整 innodb_spin_wait_delay 就能解决这个问题，那就要先分析一下 innodb_spin_wait_delay 的作用</p>
<h3 id="关于-innodb_spin_wait_delay" class="headerLink">
    <a href="#%e5%85%b3%e4%ba%8e-innodb_spin_wait_delay" class="header-mark"></a>关于 innodb_spin_wait_delay</h3><p>innodb通过大量的自旋锁(比如 <code>InnoDB</code> <a href="https://dev.mysql.com/doc/refman/5.7/en/glossary.html#glos_mutex" target="_blank" rel="noopener noreferrer">mutexes</a> and <a href="https://dev.mysql.com/doc/refman/5.7/en/glossary.html#glos_rw_lock" target="_blank" rel="noopener noreferrer">rw-locks</a>)来用高CPU消耗避免上下文切换，这是自旋锁的正确使用方式，在多核场景下，它们一起自旋抢同一个锁，容易造成<a href="https://stackoverflow.com/questions/30684974/are-cache-line-ping-pong-and-false-sharing-the-same" target="_blank" rel="noopener noreferrer">cache ping-pong</a>，进而多个CPU核之间会互相使对方缓存部分无效。所以这里<a href="https://dev.mysql.com/doc/refman/5.7/en/innodb-performance-spin_lock_polling.html" target="_blank" rel="noopener noreferrer">innodb通过增加 innodb_spin_wait_delay 和 Pause 配合来缓解cache ping-pong</a>，也就是本来通过CPU 高速自旋抢锁，换成了抢锁失败后 delay一下（Pause）但是不释放CPU，delay 时间到后继续抢锁，也就是把连续的自旋抢锁转换成了更稀疏的点状的抢锁（间隔的 delay是个随机数），这样不但避免了上下文切换也大大减少了cache ping-pong。</p>
<h3 id="自旋锁如何减少了cache-ping-pong" class="headerLink">
    <a href="#%e8%87%aa%e6%97%8b%e9%94%81%e5%a6%82%e4%bd%95%e5%87%8f%e5%b0%91%e4%ba%86cache-ping-pong" class="header-mark"></a>自旋锁如何减少了cache ping-pong</h3><p>多线程竞争锁的时候，加锁失败的线程会“忙等待”，直到它拿到锁。什么叫“忙等待”呢？它并不意味着一直执行 CAS 函数，而是会与 CPU 紧密配合 ，它通过 CPU 提供的 <code>PAUSE</code> 指令，减少循环等待时的cache ping-pong和耗电量；对于单核 CPU，忙等待并没有意义，此时它会主动把线程休眠。</p>
<h3 id="x86-pause-指令" class="headerLink">
    <a href="#x86-pause-%e6%8c%87%e4%bb%a4" class="header-mark"></a>X86 PAUSE 指令</h3><p>X86设计了Pause指令，也就是调用 Pause 指令的代码会抢着 CPU 不释放，但是CPU 会打个盹，比如 10个时钟周期，相对一次上下文切换是大几千个时钟周期。</p>
<p>这样应用一旦自旋抢锁失败可以先 Pause 一下，只是这个Pause 时间对于 MySQL 来说还不够久，所以需要增加参数 innodb_spin_wait_delay 来将休息时间放大一些。</p>
<p>在我们的这个场景下对每个 SQL的 RT 抖动非常敏感（放大256倍），所以过高的 delay 会导致部分SQL  RT  变高。</p>
<p>函数 ut_delay(ut_rnd_interval(0, srv_spin_wait_delay)) 用来执行这个delay：</p>
<pre><code>/***************************MySQL代码****************************/
/**Runs an idle loop on CPU. The argument gives the desired delay
in microseconds on 100 MHz Pentium + Visual C++.
@return dummy value */
UNIV_INTERN
ulint
ut_delay(ulint delay)  //delay 是[0,innodb_spin_wait_delay)之间的一个随机数
{
        ulint   i, j;
        UT_LOW_PRIORITY_CPU();
        j = 0;

        for (i = 0; i &lt; delay * 50; i++) {  //delay 放大50倍
                j += i;
                UT_RELAX_CPU();             //调用 CPU Pause
        }

        UT_RESUME_PRIORITY_CPU();
        return(j);
}
</code></pre>
<p>innodb_spin_wait_delay的默认值为6. spin 等待延迟是一个动态全局参数，可以在MySQL选项文件（my.cnf或my.ini）中指定该参数，或者在运行时使用SET GLOBAL 来修改。在我们的MySQL配置中默认改成了30，导致了这个问题。</p>
<h3 id="cpu-为什么要有pause" class="headerLink">
    <a href="#cpu-%e4%b8%ba%e4%bb%80%e4%b9%88%e8%a6%81%e6%9c%89pause" class="header-mark"></a>CPU 为什么要有Pause</h3><p>首先可以看到 Pause 指令的作用：</p>
<ul>
<li>避免上下文切换，应用层想要休息可能会用yield、sleep，这两操作对于CPU来说太重了(伴随上下文切换)</li>
<li>能给超线程腾出计算能力（HT共享核，但是有单独的寄存器等存储单元，CPU Pause的时候，对应的HT可以占用计算资源），比如同一个core上先跑多个Pause，同时再跑 nop 指令，这时 nop指令的 IPC基本不受Pause的影响</li>
<li>节能（CPU可以休息、但是不让出来），CPU Pause 的时候你从 top 能看到 CPU 100%，但是不耗能。</li>
</ul>
<p>所以有了 Pause 指令后能够提高超线程的利用率,节能，减少上下文切换提高自旋锁的效率。</p>
<blockquote>
  <p><a href="https://www.reddit.com/r/intel/comments/hogk2n/research_on_the_impact_of_intel_Pause_instruction/" target="_blank" rel="noopener noreferrer">The PAUSE instruction is first introduced</a> for Intel Pentium 4 processor to improve the performance of “spin-wait loop”. The PAUSE instruction is typically used with software threads executing on two logical processors located in the same processor core, waiting for a lock to be released. Such short wait loops tend to last between tens and a few hundreds of cycles. When the wait loop is expected to last for thousands of cycles or more, it is preferable to yield to the operating system by calling one of the OS synchronization API functions, such as WaitForSingleObject on Windows OS.</p>
<p>An Intel® processor suffers a severe performance penalty when exiting the loop because it detects a possible memory order violation. The PAUSE instruction provides a hint to the processor that the code sequence is a spin-wait loop. The processor uses this hint to avoid the memory order violation in most situations. The PAUSE instruction can improve the performance of the processors supporting Intel Hyper-Threading Technology when executing “spin-wait loops”. With Pause instruction, processors are able to avoid the memory order violation and pipeline flush, and reduce power consumption through pipeline stall.</p>

</blockquote><p><strong>从intel sdm手册以及实际测试验证来看，Pause 指令在执行过程中，基本不占用流水线执行资源。</strong></p>
<h3 id="skylake-架构的8163-和-broadwell架构-e5-2682-cpu型号的不同" class="headerLink">
    <a href="#skylake-%e6%9e%b6%e6%9e%84%e7%9a%848163-%e5%92%8c-broadwell%e6%9e%b6%e6%9e%84-e5-2682-cpu%e5%9e%8b%e5%8f%b7%e7%9a%84%e4%b8%8d%e5%90%8c" class="header-mark"></a>Skylake 架构的8163 和 Broadwell架构 E5-2682 CPU型号的不同</h3><p>为什么用得好好的 innodb_spin_wait_delay 参数这次就不行了呢？</p>
<p>这是因为以前业务一直使用的是 E5-2682 CPU，这次用的是新一代架构的 Skylake 8163，那这两款CPU在这里的核心差别是？</p>
<p>在Intel 64-ia-32-architectures-optimization-manual手册中提到：</p>
<blockquote>
  <p>The latency of the PAUSE instruction in prior generation microarchitectures is about 10 cycles, whereas in Skylake microarchitecture it has been extended to as many as 140 cycles.</p>
<p><a href="https://xem.github.io/minix86/manual/intel-x86-and-64-manual-vol3/o_fe12b1e2a880e0ce-302.html" target="_blank" rel="noopener noreferrer">The PAUSE instruction can improves the performance</a> of processors supporting Intel Hyper-Threading Technology when executing “spin-wait loops” and other routines where one thread is accessing a shared lock or semaphore in a tight polling loop. When executing a spin-wait loop, the processor can suffer a severe performance penalty when exiting the loop because it detects a possible memory order violation and flushes the core processor’s pipeline. The PAUSE instruction provides a hint to the processor that the code sequence is a spin-wait loop. The processor uses this hint to avoid the memory order violation and prevent the pipeline flush. In addition, the PAUSE instruction de-
pipelines the spin-wait loop to prevent it from consuming execution resources excessively and consume power needlessly. (See<a href="https://xem.github.io/minix86/manual/intel-x86-and-64-manual-vol3/o_fe12b1e2a880e0ce-305.html" target="_blank" rel="noopener noreferrer"> Section 8.10.6.1, “Use the PAUSE Instruction in Spin-Wait Loops,” for more </a>information about using the PAUSE instruction with IA-32 processors supporting Intel Hyper-Threading Technology.)</p>

</blockquote><p>也就是**Skylake架构的CPU的PAUSE指令从之前的10 cycles 改成了 140 cycles。**这可是14倍的变化呀。</p>
<p>MySQL 使用 innodb_spin_wait_delay 控制 spin lock等待时间，等待时间时间从0*50个Pause到innodb_spin_wait_delay*50个Pause。
以前 innodb_spin_wait_delay 默认配置30，对于E5-2682 CPU，等待的最长时间为：
30 * 50 * 10=15000 cycles，对于2.5GHz的CPU，等待时间为6us。
对应计算 Skylake CPU的等待时间：30 *50 *140=210000 cycles，CPU主频也是2.5GHz，等待时间84us。</p>
<p>E5-2682 CPU型号在不同的delay参数和不同并发压力下的写入性能数据：</p>
<p><img class="tw-inline" loading="lazy" src=https://cdn.jsdelivr.net/gh/plantegg/plantegg.github.io/images/951413iMgBlog/image-20221026153750159.png   alt="image-20221026153750159"  ></p>
<p>Skylake 8163 CPU型号在不同的delay参数和不同并发压力下的写入性能数据：</p>
<p><img class="tw-inline" loading="lazy" src=https://cdn.jsdelivr.net/gh/plantegg/plantegg.github.io/images/951413iMgBlog/image-20221026153813774.png   alt="image-20221026153813774"  ></p>
<p>==因为8163的cycles从10改到了140，所以可以看到delay参数对性能的影响更加陡峻。==</p>
<h2 id="总结分析" class="headerLink">
    <a href="#%e6%80%bb%e7%bb%93%e5%88%86%e6%9e%90" class="header-mark"></a>总结分析</h2><p>Intel CPU 架构不同使得 Pause 指令的CPU Cycles不同导致了 MySQL innodb_spin_wait_delay 在 spin lock 失败的时候（此时需要 Pause* innodb_spin_wait_delay*N）delay更久，使得调用方看到了MySQL更大的 RT ，进而导致 Tomcat Server上业务并发跑不起来，所以最终压力上不去。</p>
<p>在长链路的排查中，细化定位是哪个节点出了问题是最难的，要盯住 RT 而不是 CPU。</p>
<p>欲速则不达，做压测的时候还是要老老实实地从一个并发开始观察QPS、 RT ，然后一直增加压力到压不上去了，再看QPS、 RT 变化，然后确认瓶颈点。</p>
<h2 id="我想追加几个问题帮大家理解" class="headerLink">
    <a href="#%e6%88%91%e6%83%b3%e8%bf%bd%e5%8a%a0%e5%87%a0%e4%b8%aa%e9%97%ae%e9%a2%98%e5%b8%ae%e5%a4%a7%e5%ae%b6%e7%90%86%e8%a7%a3" class="header-mark"></a>我想追加几个问题帮大家理解</h2><h3 id="为什么要有自旋锁内核里面的spinlock" class="headerLink">
    <a href="#%e4%b8%ba%e4%bb%80%e4%b9%88%e8%a6%81%e6%9c%89%e8%87%aa%e6%97%8b%e9%94%81%e5%86%85%e6%a0%b8%e9%87%8c%e9%9d%a2%e7%9a%84spinlock" class="header-mark"></a>为什么要有自旋锁(内核里面的spinlock)?</h3><p>等锁的时候可以释放CPU进入等待，这叫悲观锁，代价是释放CPU必然导致上下文切换，一次上下文切换至少需要几千个时钟周期，也就是CPU需要几千个时钟周期来完成上下文切换的工作(几千个时钟周期没有产出&ndash;真浪费)</p>
<p>或者等锁的时候不释放CPU，赌很快能等到锁，这叫乐观锁，Linux OS用的是spinlock（类似大家看到的CAS），也就是CPU不释放一直不停地检查能否拿到锁，一个时钟周期检查一次太快了(想想你去银行柜台办业务，每秒钟问一次柜员轮到你了没有！)，所以CPU工程师就在想能不能提供一条指令一直占着CPU很久，这条指令就是pause，每一个spinlock就会调用pause休息几十、几百个时钟周期后再去看看能否抢到所(柜台给你提供了沙发茶水，你坐一会再去问柜员)</p>
<h3 id="执行pause指令的时候cpu真的休息了吗" class="headerLink">
    <a href="#%e6%89%a7%e8%a1%8cpause%e6%8c%87%e4%bb%a4%e7%9a%84%e6%97%b6%e5%80%99cpu%e7%9c%9f%e7%9a%84%e4%bc%91%e6%81%af%e4%ba%86%e5%90%97" class="header-mark"></a>执行Pause指令的时候CPU真的休息了吗？</h3><p>如果没有事情做的话，CPU是会停下来(省电)，如果开了超线程，如果一个核执行了Pause，那么对这个核的另一个超线程来说，白捡了100%的CPU，别人休息（Pause、stall）的时候正好给我用(这是超线程的本质)！</p>
<p>这也是为什么有些场景2个超线程能发挥2倍能力，有些场景2个超线程只能跑出1倍能力。</p>
<p>相对比上下文切换浪费的几千个时钟周期，Pause(spinlock)真是一点都没浪费。但如果你一直spinlock 几万、几十万个时钟周期都没等到锁还不释放也不对，这会导致其他线程调度不到CPU而饿死。一般自旋一段时间后都会放弃CPU转为上下文切换，所以MySQL 加了参数 innodb_spin_wait_delay 来控制spinlock的长短。</p>
<h3 id="并发高导致自旋锁效率低" class="headerLink">
    <a href="#%e5%b9%b6%e5%8f%91%e9%ab%98%e5%af%bc%e8%87%b4%e8%87%aa%e6%97%8b%e9%94%81%e6%95%88%e7%8e%87%e4%bd%8e" class="header-mark"></a>并发高导致自旋锁效率低？</h3><p>如果并发高，都抢同一个锁，这里的效率会随着并发的增加而降低，不展开了，记住这个结论，类似太多人在柜台问轮到自己没有，留给柜员办业务的时间反而少了！</p>
<h2 id="armhttpsstackoverflowcomquestions70810121why-does-hintspin-loop-use-isb-on-aarch64" class="headerLink">
    <a href="#armhttpsstackoverflowcomquestions70810121why-does-hintspin-loop-use-isb-on-aarch64" class="header-mark"></a><a href="https://stackoverflow.com/questions/70810121/why-does-hintspin-loop-use-isb-on-aarch64" target="_blank" rel="noopener noreferrer">ARM</a></h2><p>ARM 指令集中有 nop 来让流水线空转一个时钟周期，汇编里面的 yield 命令底层就是执行 nop 来达到目的，但是这还不够好，在64位的ARM 指令集里面增加了 <a href="https://developer.arm.com/documentation/ddi0596/2021-06/Base-Instructions/ISB--Instruction-Synchronization-Barrier-" target="_blank" rel="noopener noreferrer">ISB (instruction synchronization barrier)</a> 来<a href="https://github.com/rust-lang/rust/commit/c064b6560b7ce0adeb9bbf5d7dcf12b1acb0c807" target="_blank" rel="noopener noreferrer">实现类似 Pause 的作用</a> ：</p>
<blockquote>
  <p>On arm64 we have seen on several databases that ISB (instruction synchronization barrier) is better to use than yield in a spin loop. The yield instruction is a nop. The isb instruction puts the processor to sleep for some short time. isb is a good equivalent to the pause instruction on x86.</p>

</blockquote><h3 id="对比httpsgithubcomrust-langrustcommitc064b6560b7ce0adeb9bbf5d7dcf12b1acb0c807" class="headerLink">
    <a href="#%e5%af%b9%e6%af%94httpsgithubcomrust-langrustcommitc064b6560b7ce0adeb9bbf5d7dcf12b1acb0c807" class="header-mark"></a><a href="https://github.com/rust-lang/rust/commit/c064b6560b7ce0adeb9bbf5d7dcf12b1acb0c807" target="_blank" rel="noopener noreferrer">对比</a></h3><p>Below is an experiment that shows the effects of yield and isb on Arm64 and the
time of a pause instruction on x86 Intel processors.  The micro-benchmarks use
<a href="https://github.com/google/benchmark.git" target="_blank" rel="noopener noreferrer">https://github.com/google/benchmark.git</a></p>
<p>测试代码</p>
<div class="code-block highlight is-open show-line-numbers  tw-group tw-my-2">
  <div class="
    code-block-title 
    
    tw-flex 
    tw-flex-row 
    tw-justify-between 
    tw-w-full tw-bg-bgColor-secondary
    ">      
    <button 
      class="
        tw-select-none 
        tw-mx-2 
        tw-block
        group-[.is-open]:tw-rotate-90
        tw-transition-[transform] 
        tw-duration-500 
        tw-ease-in-out
        print:!tw-hidden"
      disabled
      aria-hidden="true"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M285.476 272.971L91.132 467.314c-9.373 9.373-24.569 9.373-33.941 0l-22.667-22.667c-9.357-9.357-9.375-24.522-.04-33.901L188.505 256 34.484 101.255c-9.335-9.379-9.317-24.544.04-33.901l22.667-22.667c9.373-9.373 24.569-9.373 33.941 0L285.475 239.03c9.373 9.372 9.373 24.568.001 33.941z"/></svg></button>

    <div class="code-block-title-bar tw-w-full">
      <p class="tw-select-none !tw-my-1">text</p>
    </div>
    <div class="tw-flex">
      <button 
        class="
          line-number-button
          tw-select-none 
          tw-mx-2 
          tw-hidden 
          group-[.is-open]:tw-block 
          group-[.show-line-numbers]:tw-text-fgColor-link 
          print:!tw-hidden" 
        title="Toggle line numbers"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M61.77 401l17.5-20.15a19.92 19.92 0 0 0 5.07-14.19v-3.31C84.34 356 80.5 352 73 352H16a8 8 0 0 0-8 8v16a8 8 0 0 0 8 8h22.83a157.41 157.41 0 0 0-11 12.31l-5.61 7c-4 5.07-5.25 10.13-2.8 14.88l1.05 1.93c3 5.76 6.29 7.88 12.25 7.88h4.73c10.33 0 15.94 2.44 15.94 9.09 0 4.72-4.2 8.22-14.36 8.22a41.54 41.54 0 0 1-15.47-3.12c-6.49-3.88-11.74-3.5-15.6 3.12l-5.59 9.31c-3.72 6.13-3.19 11.72 2.63 15.94 7.71 4.69 20.38 9.44 37 9.44 34.16 0 48.5-22.75 48.5-44.12-.03-14.38-9.12-29.76-28.73-34.88zM496 224H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zm0-160H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16V80a16 16 0 0 0-16-16zm0 320H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zM16 160h64a8 8 0 0 0 8-8v-16a8 8 0 0 0-8-8H64V40a8 8 0 0 0-8-8H32a8 8 0 0 0-7.14 4.42l-8 16A8 8 0 0 0 24 64h8v64H16a8 8 0 0 0-8 8v16a8 8 0 0 0 8 8zm-3.91 160H80a8 8 0 0 0 8-8v-16a8 8 0 0 0-8-8H41.32c3.29-10.29 48.34-18.68 48.34-56.44 0-29.06-25-39.56-44.47-39.56-21.36 0-33.8 10-40.46 18.75-4.37 5.59-3 10.84 2.8 15.37l8.58 6.88c5.61 4.56 11 2.47 16.12-2.44a13.44 13.44 0 0 1 9.46-3.84c3.33 0 9.28 1.56 9.28 8.75C51 248.19 0 257.31 0 304.59v4C0 316 5.08 320 12.09 320z"/></svg></button>

      <button 
        class="
          wrap-code-button
          tw-select-none 
          tw-mx-2 
          tw-hidden 
          group-[.is-open]:tw-block 
          group-[.is-wrap]:tw-text-fgColor-link 
          print:!tw-hidden" 
        title="Toggle code wrap"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M16 132h416c8.837 0 16-7.163 16-16V76c0-8.837-7.163-16-16-16H16C7.163 60 0 67.163 0 76v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16z"/></svg></button>
      
      <button 
        class="
          copy-code-button
          tw-select-none
          tw-mx-2 
          tw-hidden
          group-[.is-open]:tw-block
          hover:tw-text-fgColor-link 
          print:!tw-hidden"
        title="Copy code">
          <span class="copy-icon tw-block"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M433.941 65.941l-51.882-51.882A48 48 0 0 0 348.118 0H176c-26.51 0-48 21.49-48 48v48H48c-26.51 0-48 21.49-48 48v320c0 26.51 21.49 48 48 48h224c26.51 0 48-21.49 48-48v-48h80c26.51 0 48-21.49 48-48V99.882a48 48 0 0 0-14.059-33.941zM266 464H54a6 6 0 0 1-6-6V150a6 6 0 0 1 6-6h74v224c0 26.51 21.49 48 48 48h96v42a6 6 0 0 1-6 6zm128-96H182a6 6 0 0 1-6-6V54a6 6 0 0 1 6-6h106v88c0 13.255 10.745 24 24 24h88v202a6 6 0 0 1-6 6zm6-256h-64V48h9.632c1.591 0 3.117.632 4.243 1.757l48.368 48.368a6 6 0 0 1 1.757 4.243V112z"/></svg></span>
          <span class="check-icon tw-hidden"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M173.898 439.404l-166.4-166.4c-9.997-9.997-9.997-26.206 0-36.204l36.203-36.204c9.997-9.998 26.207-9.998 36.204 0L192 312.69 432.095 72.596c9.997-9.997 26.207-9.997 36.204 0l36.203 36.204c9.997 9.997 9.997 26.206 0 36.204l-294.4 294.401c-9.998 9.997-26.207 9.997-36.204-.001z"/></svg></span>
      </button>
        
      <button 
        class="
          tw-select-none 
          tw-mx-2 
          tw-block 
          group-[.is-open]:tw-hidden 
          print:!tw-hidden" 
        disabled
        aria-hidden="true"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M328 256c0 39.8-32.2 72-72 72s-72-32.2-72-72 32.2-72 72-72 72 32.2 72 72zm104-72c-39.8 0-72 32.2-72 72s32.2 72 72 72 72-32.2 72-72-32.2-72-72-72zm-352 0c-39.8 0-72 32.2-72 72s32.2 72 72 72 72-32.2 72-72-32.2-72-72-72z"/></svg></button>
    </div>
  </div>
  <pre style="counter-reset: codeblock;" class="tw-block tw-m-0 tw-p-0"><code 
    id="codeblock-id-1" 
    class="
      chroma 
      !tw-block 
      tw-p-0
      tw-m-0
      tw-transition-[max-height] 
      tw-duration-500 
      tw-ease-in-out 
      group-[.is-closed]:!tw-max-h-0 
      group-[.is-wrap]:tw-text-wrap
      tw-overflow-y-hidden
      tw-overflow-x-auto
      tw-scrollbar-thin
      "><span class="line"><span class="cl">$ cat a.cc
</span></span><span class="line"><span class="cl">static void BM_scalar_increment(benchmark::State&amp; state) {
</span></span><span class="line"><span class="cl">  int i = 0;
</span></span><span class="line"><span class="cl">  for (auto _ : state)
</span></span><span class="line"><span class="cl">    benchmark::DoNotOptimize(i++);
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">BENCHMARK(BM_scalar_increment);
</span></span><span class="line"><span class="cl">static void BM_yield(benchmark::State&amp; state) {
</span></span><span class="line"><span class="cl">  for (auto _ : state)
</span></span><span class="line"><span class="cl">    asm volatile(&#34;yield&#34;::);
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">BENCHMARK(BM_yield);
</span></span><span class="line"><span class="cl">static void BM_isb(benchmark::State&amp; state) {
</span></span><span class="line"><span class="cl">  for (auto _ : state)
</span></span><span class="line"><span class="cl">    asm volatile(&#34;isb&#34;::);
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">BENCHMARK(BM_isb);
</span></span><span class="line"><span class="cl">BENCHMARK_MAIN();</span></span></code></pre>
</div>
<p>测试结果</p>
<div class="code-block highlight is-open show-line-numbers  tw-group tw-my-2">
  <div class="
    code-block-title 
    
    tw-flex 
    tw-flex-row 
    tw-justify-between 
    tw-w-full tw-bg-bgColor-secondary
    ">      
    <button 
      class="
        tw-select-none 
        tw-mx-2 
        tw-block
        group-[.is-open]:tw-rotate-90
        tw-transition-[transform] 
        tw-duration-500 
        tw-ease-in-out
        print:!tw-hidden"
      disabled
      aria-hidden="true"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M285.476 272.971L91.132 467.314c-9.373 9.373-24.569 9.373-33.941 0l-22.667-22.667c-9.357-9.357-9.375-24.522-.04-33.901L188.505 256 34.484 101.255c-9.335-9.379-9.317-24.544.04-33.901l22.667-22.667c9.373-9.373 24.569-9.373 33.941 0L285.475 239.03c9.373 9.372 9.373 24.568.001 33.941z"/></svg></button>

    <div class="code-block-title-bar tw-w-full">
      <p class="tw-select-none !tw-my-1">text</p>
    </div>
    <div class="tw-flex">
      <button 
        class="
          line-number-button
          tw-select-none 
          tw-mx-2 
          tw-hidden 
          group-[.is-open]:tw-block 
          group-[.show-line-numbers]:tw-text-fgColor-link 
          print:!tw-hidden" 
        title="Toggle line numbers"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M61.77 401l17.5-20.15a19.92 19.92 0 0 0 5.07-14.19v-3.31C84.34 356 80.5 352 73 352H16a8 8 0 0 0-8 8v16a8 8 0 0 0 8 8h22.83a157.41 157.41 0 0 0-11 12.31l-5.61 7c-4 5.07-5.25 10.13-2.8 14.88l1.05 1.93c3 5.76 6.29 7.88 12.25 7.88h4.73c10.33 0 15.94 2.44 15.94 9.09 0 4.72-4.2 8.22-14.36 8.22a41.54 41.54 0 0 1-15.47-3.12c-6.49-3.88-11.74-3.5-15.6 3.12l-5.59 9.31c-3.72 6.13-3.19 11.72 2.63 15.94 7.71 4.69 20.38 9.44 37 9.44 34.16 0 48.5-22.75 48.5-44.12-.03-14.38-9.12-29.76-28.73-34.88zM496 224H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zm0-160H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16V80a16 16 0 0 0-16-16zm0 320H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zM16 160h64a8 8 0 0 0 8-8v-16a8 8 0 0 0-8-8H64V40a8 8 0 0 0-8-8H32a8 8 0 0 0-7.14 4.42l-8 16A8 8 0 0 0 24 64h8v64H16a8 8 0 0 0-8 8v16a8 8 0 0 0 8 8zm-3.91 160H80a8 8 0 0 0 8-8v-16a8 8 0 0 0-8-8H41.32c3.29-10.29 48.34-18.68 48.34-56.44 0-29.06-25-39.56-44.47-39.56-21.36 0-33.8 10-40.46 18.75-4.37 5.59-3 10.84 2.8 15.37l8.58 6.88c5.61 4.56 11 2.47 16.12-2.44a13.44 13.44 0 0 1 9.46-3.84c3.33 0 9.28 1.56 9.28 8.75C51 248.19 0 257.31 0 304.59v4C0 316 5.08 320 12.09 320z"/></svg></button>

      <button 
        class="
          wrap-code-button
          tw-select-none 
          tw-mx-2 
          tw-hidden 
          group-[.is-open]:tw-block 
          group-[.is-wrap]:tw-text-fgColor-link 
          print:!tw-hidden" 
        title="Toggle code wrap"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M16 132h416c8.837 0 16-7.163 16-16V76c0-8.837-7.163-16-16-16H16C7.163 60 0 67.163 0 76v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16z"/></svg></button>
      
      <button 
        class="
          copy-code-button
          tw-select-none
          tw-mx-2 
          tw-hidden
          group-[.is-open]:tw-block
          hover:tw-text-fgColor-link 
          print:!tw-hidden"
        title="Copy code">
          <span class="copy-icon tw-block"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M433.941 65.941l-51.882-51.882A48 48 0 0 0 348.118 0H176c-26.51 0-48 21.49-48 48v48H48c-26.51 0-48 21.49-48 48v320c0 26.51 21.49 48 48 48h224c26.51 0 48-21.49 48-48v-48h80c26.51 0 48-21.49 48-48V99.882a48 48 0 0 0-14.059-33.941zM266 464H54a6 6 0 0 1-6-6V150a6 6 0 0 1 6-6h74v224c0 26.51 21.49 48 48 48h96v42a6 6 0 0 1-6 6zm128-96H182a6 6 0 0 1-6-6V54a6 6 0 0 1 6-6h106v88c0 13.255 10.745 24 24 24h88v202a6 6 0 0 1-6 6zm6-256h-64V48h9.632c1.591 0 3.117.632 4.243 1.757l48.368 48.368a6 6 0 0 1 1.757 4.243V112z"/></svg></span>
          <span class="check-icon tw-hidden"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M173.898 439.404l-166.4-166.4c-9.997-9.997-9.997-26.206 0-36.204l36.203-36.204c9.997-9.998 26.207-9.998 36.204 0L192 312.69 432.095 72.596c9.997-9.997 26.207-9.997 36.204 0l36.203 36.204c9.997 9.997 9.997 26.206 0 36.204l-294.4 294.401c-9.998 9.997-26.207 9.997-36.204-.001z"/></svg></span>
      </button>
        
      <button 
        class="
          tw-select-none 
          tw-mx-2 
          tw-block 
          group-[.is-open]:tw-hidden 
          print:!tw-hidden" 
        disabled
        aria-hidden="true"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M328 256c0 39.8-32.2 72-72 72s-72-32.2-72-72 32.2-72 72-72 72 32.2 72 72zm104-72c-39.8 0-72 32.2-72 72s32.2 72 72 72 72-32.2 72-72-32.2-72-72-72zm-352 0c-39.8 0-72 32.2-72 72s32.2 72 72 72 72-32.2 72-72-32.2-72-72-72z"/></svg></button>
    </div>
  </div>
  <pre style="counter-reset: codeblock;" class="tw-block tw-m-0 tw-p-0"><code 
    id="codeblock-id-2" 
    class="
      chroma 
      !tw-block 
      tw-p-0
      tw-m-0
      tw-transition-[max-height] 
      tw-duration-500 
      tw-ease-in-out 
      group-[.is-closed]:!tw-max-h-0 
      group-[.is-wrap]:tw-text-wrap
      tw-overflow-y-hidden
      tw-overflow-x-auto
      tw-scrollbar-thin
      "><span class="line"><span class="cl">$ g++ -o run a.cc -O2 -lbenchmark -lpthread
</span></span><span class="line"><span class="cl">$ ./run
</span></span><span class="line"><span class="cl">--------------------------------------------------------------
</span></span><span class="line"><span class="cl">Benchmark                    Time             CPU   Iterations
</span></span><span class="line"><span class="cl">--------------------------------------------------------------
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">AWS Graviton2 (Neoverse-N1) processor:
</span></span><span class="line"><span class="cl">BM_scalar_increment      0.485 ns        0.485 ns   1000000000
</span></span><span class="line"><span class="cl">BM_yield                 0.400 ns        0.400 ns   1000000000
</span></span><span class="line"><span class="cl">BM_isb                    13.2 ns         13.2 ns     52993304
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">AWS Graviton (A-72) processor:
</span></span><span class="line"><span class="cl">BM_scalar_increment      0.897 ns        0.874 ns    801558633
</span></span><span class="line"><span class="cl">BM_yield                 0.877 ns        0.875 ns    800002377
</span></span><span class="line"><span class="cl">BM_isb                    13.0 ns         12.7 ns     55169412
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Apple Arm64 M1 processor:
</span></span><span class="line"><span class="cl">BM_scalar_increment      0.315 ns        0.315 ns   1000000000
</span></span><span class="line"><span class="cl">BM_yield                 0.313 ns        0.313 ns   1000000000
</span></span><span class="line"><span class="cl">BM_isb                    9.06 ns         9.06 ns     77259282
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">static void BM_pause(benchmark::State&amp; state) {
</span></span><span class="line"><span class="cl">  for (auto _ : state)
</span></span><span class="line"><span class="cl">    asm volatile(&#34;pause&#34;::);
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">BENCHMARK(BM_pause);
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Intel Skylake processor:
</span></span><span class="line"><span class="cl">BM_scalar_increment      0.295 ns        0.295 ns   1000000000
</span></span><span class="line"><span class="cl">BM_pause                  41.7 ns         41.7 ns     16780553
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Tested on Graviton2 aarch64-linux with `./x.py test`.</span></span></code></pre>
</div>
<p>依照如上测试结果可以看出在 ARM 指令集下一次 yield 基本耗费一个时钟周期，但是一次 isb 需要 20-30 个时钟周期，而在intel Skylate 下一次Pause 需要140个时钟周期</p>
<p>所以MySQL 的 <a href="https://bugs.mysql.com/bug.php?id=100664#:~:text=better%20user%20experience.-,isb,-%3A%0AThe%20pause%20instruction" target="_blank" rel="noopener noreferrer">aarch64 版本在2020年也终于进行了改进</a></p>
<h2 id="参考文章" class="headerLink">
    <a href="#%e5%8f%82%e8%80%83%e6%96%87%e7%ab%a0" class="header-mark"></a>参考文章</h2><p><a href="https://cloud.tencent.com/developer/article/1005284" target="_blank" rel="noopener noreferrer">https://cloud.tencent.com/developer/article/1005284</a></p>
<p><a href="https://dev.mysql.com/doc/refman/5.7/en/innodb-performance-spin_lock_polling.html" target="_blank" rel="noopener noreferrer">mysql doc</a></p>
<p><a href="http://oliveryang.net/2018/01/cache-false-sharing-debug" target="_blank" rel="noopener noreferrer">Cache Line 伪共享发现与优化</a></p>
<p><a href="https://en.wikichip.org/w/images/e/eb/intel-ref-248966-037.pdf" target="_blank" rel="noopener noreferrer">intel spec</a></p>
<p><a href="https://mp.weixin.qq.com/s/dlKC13i9Z8wjDDiU2tig6Q" target="_blank" rel="noopener noreferrer">Intel PAUSE指令变化影响到MySQL的性能，该如何解决？</a></p>
<p><a href="https://topic.atatech.org/articles/173194" target="_blank" rel="noopener noreferrer">ARM软硬件协同设计：锁优化</a>, arm不同于x86，用的是yield、ISB 来代替Pause</p>
<p><a href="http://cr.openjdk.java.net/~dchuyko/8186670/yield/spinwait.html" target="_blank" rel="noopener noreferrer">http://cr.openjdk.java.net/~dchuyko/8186670/yield/spinwait.html</a></p>
<p><a href="https://aloiskraus.wordpress.com/2018/06/16/why-skylakex-cpus-are-sometimes-50-slower-how-intel-has-broken-existing-code/" target="_blank" rel="noopener noreferrer">https://aloiskraus.wordpress.com/2018/06/16/why-skylakex-cpus-are-sometimes-50-slower-how-intel-has-broken-existing-code/</a> Windows+.NET 平台下的分析过程及修复方案</p>
]]></description>
</item><item>
    <title>Intel PAUSE指令变化是如何影响自旋锁以及MySQL的性能的</title>
    <link>http://localhost:1313/posts/intel-pause%E6%8C%87%E4%BB%A4%E5%8F%98%E5%8C%96%E6%98%AF%E5%A6%82%E4%BD%95%E5%BD%B1%E5%93%8D%E8%87%AA%E6%97%8B%E9%94%81%E4%BB%A5%E5%8F%8Amysql%E7%9A%84%E6%80%A7%E8%83%BD%E7%9A%84/</link>
    <pubDate>Mon, 16 Dec 2019 12:30:03 &#43;0000</pubDate><author>
        <name>作者</name>
    </author><guid>http://localhost:1313/posts/intel-pause%E6%8C%87%E4%BB%A4%E5%8F%98%E5%8C%96%E6%98%AF%E5%A6%82%E4%BD%95%E5%BD%B1%E5%93%8D%E8%87%AA%E6%97%8B%E9%94%81%E4%BB%A5%E5%8F%8Amysql%E7%9A%84%E6%80%A7%E8%83%BD%E7%9A%84/</guid>
    <description><![CDATA[<h1 id="intel-pause指令变化如何影响mysql的性能" class="headerLink">
    <a href="#intel-pause%e6%8c%87%e4%bb%a4%e5%8f%98%e5%8c%96%e5%a6%82%e4%bd%95%e5%bd%b1%e5%93%8dmysql%e7%9a%84%e6%80%a7%e8%83%bd" class="header-mark"></a>Intel PAUSE指令变化如何影响MySQL的性能</h1><h2 id="导读" class="headerLink">
    <a href="#%e5%af%bc%e8%af%bb" class="header-mark"></a>导读</h2><p>x86、arm指令都很多，无论是应用程序员还是数据库内核研发大多时候都不需要对这些指令深入理解，但是 Pause 指令和数据库操作太紧密了，本文通过一次非常有趣的性能优化来引入对 Pause 指令的理解，期望可以事半功倍地搞清楚 CPU指令集是如何影响你的程序的。</p>
<p>文章分成两大部分，第一部分是 MySQL 集群的一次全表扫描性能优化过程； 第二部分是问题解决后的原理分析以及Pause指令的来龙去脉和优缺点以及应用场景分析。</p>
<h2 id="业务结构" class="headerLink">
    <a href="#%e4%b8%9a%e5%8a%a1%e7%bb%93%e6%9e%84" class="header-mark"></a>业务结构</h2><p>为理解方便做了部分简化：</p>
<p>client -&gt; Tomcat -&gt; LVS -&gt; MySQL（32 个 MySQLD实例集群，每个实例8Core）</p>
<h2 id="场景描述" class="headerLink">
    <a href="#%e5%9c%ba%e6%99%af%e6%8f%8f%e8%bf%b0" class="header-mark"></a>场景描述</h2><p>通过 client 压 Tomcat 和 MySQL 集群（对数据做分库分表），MySQL 集群是32个实例，每个业务 SQL 都需要经过 Tomcat 拆分成 256 个 SQL 发送给 32 个MySQL（每个MySQL上有8个分库），这 256 条下发给 MySQL 的 SQL 不是完全串行，但也不是完全并行，有一定的并行性。</p>
<p>业务 SQL 如下是一个简单的select sum求和，这个 SQL在每个MySQL上都很快（有索引）</p>
<pre><code>SELECT SUM(emp_arr_amt) FROM table_c WHERE INSUTYPE='310' AND Revs_Flag='Z' AND accrym='201910' AND emp_no='1050457';
</code></pre>
<h2 id="监控指标说明" class="headerLink">
    <a href="#%e7%9b%91%e6%8e%a7%e6%8c%87%e6%a0%87%e8%af%b4%e6%98%8e" class="header-mark"></a>监控指标说明</h2><ul>
<li>后述或者截图中的逻辑RT/QPS是指 client 上看到的Tomcat的 RT 和 QPS；</li>
<li>RT ：response time 请求响应时间，判断性能瓶颈的唯一指标;</li>
<li>物理RT/QPS是指Tomcat看到的MySQL  RT 和QPS（这里的 RT 是指到达Tomcat节点网卡的 RT ，所以还包含了网络消耗）</li>
</ul>
<h2 id="问题描述" class="headerLink">
    <a href="#%e9%97%ae%e9%a2%98%e6%8f%8f%e8%bf%b0" class="header-mark"></a>问题描述：</h2><p>通过client压一个Tomcat节点+32个MySQL，QPS大概是430，Tomcat节点CPU跑满，MySQL  RT 是0.5ms，增加一个Tomcat节点，QPS大概是700，Tomcat CPU接近跑满，MySQL  RT 是0.6ms，到这里性能基本随着扩容线性增加，是符合预期的。</p>
<p>继续增加Tomcat节点来横向扩容性能，通过client压三个Tomcat节点+32个MySQL，QPS还是700，Tomcat节点CPU跑不满，MySQL  RT 是0.8ms，这就严重不符合预期了。</p>
<p>性能压测原则：</p>
<blockquote>
  <p>加并发QPS不再上升说明到了某个瓶颈，哪个环节RT增加最多瓶颈就在哪里</p>

</blockquote><p><img class="tw-inline" loading="lazy" src=http://localhost:1313/images/951413iMgBlog/image-20221026145848312.png   alt="image-20221026145848312"  ></p>
<p><strong>到这里一切都还是符合我们的经验的，看起来就是 MySQL 有瓶颈（RT 增加明显）。</strong></p>
<h2 id="排查-mysql" class="headerLink">
    <a href="#%e6%8e%92%e6%9f%a5-mysql" class="header-mark"></a>排查 MySQL</h2><p>现场DBA通过监控看到MySQL CPU不到20%，没有慢查询，并且尝试用client越过所有中间环节直接压其中一个MySQL，可以将 MySQL CPU 跑满，这时的QPS大概是38000（对应上面的场景client QPS为700的时候，单个MySQL上的QPS才跑到6000) 所以排除了MySQL的嫌疑(这个推理不够严谨为后面排查埋下了大坑)。</p>
<p>那么接下来的嫌疑在网络、LVS 等中间环节上。</p>
<h2 id="lvs和网络的嫌疑" class="headerLink">
    <a href="#lvs%e5%92%8c%e7%bd%91%e7%bb%9c%e7%9a%84%e5%ab%8c%e7%96%91" class="header-mark"></a>LVS和网络的嫌疑</h2><p>首先通过大查询排除了带宽的问题，因为这里都是小包，pps到了72万，很自然想到了网关、LVS的限流之类的</p>
<p>pps监控，这台物理机有4个MySQL实例上，pps 9万左右，9*32/4=72万
<img class="tw-inline" loading="lazy" src=http://localhost:1313/images/oss/b84245c17e213de528f2ad8090d504f6.png   alt="image.png"  ></p>
<p>…………（省略巨长的分析、拉人、扯皮过程）</p>
<p>最终所有网络因素都被排除，核心证据是：做压测的时候反复从 Tomcat 上 ping 后面的MySQL，RT 跟没有压力的时候一样，也说明了网络没有问题(请思考这个 ping 的作用)。</p>
<h2 id="问题的确认" class="headerLink">
    <a href="#%e9%97%ae%e9%a2%98%e7%9a%84%e7%a1%ae%e8%ae%a4" class="header-mark"></a>问题的确认</h2><p>尝试在Tomcat上打开日志，并将慢 SQL 阈值设置为100ms，这个时候确实能从日志中看到大量MySQL上的慢查询，因为这个SQL需要在Tomcat上做拆分成256个SQL，同时下发，一旦有一个SQL返回慢，整个请求就因为这个短板被拖累了。平均 RT  0.8ms，但是经常有超过100ms的话对整体影响还是很大的。</p>
<p>将Tomcat记录下来的慢查询（Tomcat增加了一个唯一id下发给MySQL）到MySQL日志中查找，果然发现MySQL上确实慢了，所以到这里基本确认是MySQL的问题，终于不用再纠结是否是网络问题了。</p>
<p>同时在Tomcat进行抓包，对网卡上的 RT 进行统计分析：</p>
<p><img class="tw-inline" loading="lazy" src=http://localhost:1313/images/oss/ffd66d9a6098979b555dfb00d3494255.png   alt="image.png"  ></p>
<p>上是Tomcat上抓到的每个sql的物理RT 平均值，上面是QPS 430的时候， RT  0.6ms，下面是3个server，QPS为700，但是 RT 上升到了0.9ms，基本跟Tomcat监控记录到的物理RT一致。如果MySQL上也有类似抓包计算 RT 时间的话可以快速排除网络问题。</p>
<p>网络抓包得到的 RT 数据更容易被所有人接受。尝试过在MySQL上抓包，但是因为LVS模块的原因，进出端口、ip都被修改过，所以没法分析一个流的响应时间。</p>
<h2 id="重心再次转向mysql" class="headerLink">
    <a href="#%e9%87%8d%e5%bf%83%e5%86%8d%e6%ac%a1%e8%bd%ac%e5%90%91mysql" class="header-mark"></a>重心再次转向MySQL</h2><p>这个时候因为问题点基本确认，再去查看MySQL是否有问题的重心都不一样了，不再只是看看CPU和慢查询，这个问题明显更复杂一些。</p>
<blockquote>
  <p>教训：CPU只是影响性能的一个因素，RT 才是结果，要追着 RT 跑，而不是只看 CPU</p>

</blockquote><p>通过监控发现MySQL CPU虽然一直不高，但是经常看到running thread飙到100多，很快又降下去了，看起来像是突发性的并发查询请求太多导致了排队等待，每个MySQL实例是8Core的CPU，尝试将MySQL实例扩容到16Core（只是为了验证这个问题），QPS确实可以上升到1000（没有到达理想的1400）。</p>
<p>这是Tomcat上监控到的MySQL状态：
<img class="tw-inline" loading="lazy" src=http://localhost:1313/images/oss/e73c1371a02106a52f8a13f89a9dd9ad.png   alt="image.png"  ></p>
<p>同时在MySQL机器上通过vmstat也可以看到这种飙升：
<img class="tw-inline" loading="lazy" src=http://localhost:1313/images/oss/4dbd9dff9deacec0e9911e3a7d025578.png   alt="image.png"  ></p>
<p>以上分析可以清晰看到虽然 MySQL 整体压力不大，但是似乎会偶尔来一波卡顿、running 任务飙升。</p>
<p>像这种短暂突发性的并发流量似乎监控都很难看到（基本都被平均掉了），只有一些实时性监控偶尔会采集到这种短暂突发性飙升，这也导致了一开始忽视了MySQL。</p>
<p>所以接下来的核心问题就是MySQL为什么会有这种飙升、这种飙升的影响到底是什么？</p>
<h2 id="perf-top" class="headerLink">
    <a href="#perf-top" class="header-mark"></a>perf top</h2><p>直接用 perf 看下 MySQLD 进程，发现 ut_delay 高得不符合逻辑：</p>
<p><img class="tw-inline" loading="lazy" src=http://localhost:1313/images/oss/cd145c494c074e01e9d2d1d5583a87a0.png   alt="image.png"  ></p>
<p>展开看一下，基本是在优化器中做索引命中行数的选择：</p>
<!-- raw HTML omitted -->
<p>跟直接在 MySQL 命令行中通过 show processlist看到的基本一致：</p>
<!-- raw HTML omitted -->
<p>这是 MySQL 的优化器在对索引进行统计，统计的时候要加锁，thread running 抖动的时候通过 show processlist 看到很多 thread处于 statistics 状态。也就是高并发下加锁影响了 CPU 压不上去同时 RT 剧烈增加。</p>
<p>这里ut_delay 消耗了 28% 的 CPU 肯定太不正常了，于是将 innodb_spin_wait_delay 从 30 改成 6 后性能立即上去了，继续增加 Tomcat 节点，QPS也可以线性增加。</p>
<blockquote>
  <p>耗CPU最高的调用函数栈是…<code>mutex_spin_wait</code>-&gt;<code>ut_delay</code>，属于锁等待的逻辑。InnoDB在这里用的是自旋锁，锁等待是通过调用 ut_delay 让 CPU做空循环在等锁的时候不释放CPU从而避免上下文切换，会消耗比较高的CPU。</p>

</blockquote><h2 id="最终的性能" class="headerLink">
    <a href="#%e6%9c%80%e7%bb%88%e7%9a%84%e6%80%a7%e8%83%bd" class="header-mark"></a>最终的性能</h2><p>调整参数 innodb_spin_wait_delay=6 后在4个Tomcat节点下，并发40时，QPS跑到了1700，物理RT：0.7，逻辑RT：19.6，cpu：90%，这个时候只需要继续扩容 Tomcat 节点的数量就可以增加QPS
<img class="tw-inline" loading="lazy" src=http://localhost:1313/images/oss/48c976f989747266f9892403794996c0.png   alt="image.png"  ></p>
<p>再跟调整前比较一下，innodb_spin_wait_delay=30，并发40时，QPS 500+，物理RT：2.6ms 逻辑RT：72.1ms cpu：37%
<img class="tw-inline" loading="lazy" src=http://localhost:1313/images/oss/fdb459972926cff371f5f5ab703790bb.png   alt="image.png"  ></p>
<p>再看看调整前压测的时候的vmstat和tsar &ndash;cpu，可以看到process running抖动明显
<img class="tw-inline" loading="lazy" src=http://localhost:1313/images/oss/4dbd9dff9deacec0e9911e3a7d025578.png   alt="image.png"  ></p>
<p>对比修改delay后的process running就很稳定了，即使QPS大了3倍
<img class="tw-inline" loading="lazy" src=http://localhost:1313/images/oss/ed46d35161ea28352acd4289a3e9ddad.png   alt="image.png"  ></p>
<h2 id="事后思考和分析" class="headerLink">
    <a href="#%e4%ba%8b%e5%90%8e%e6%80%9d%e8%80%83%e5%92%8c%e5%88%86%e6%9e%90" class="header-mark"></a>事后思考和分析</h2><p>到这里问题得到了完美解决，但是不禁要问为什么？ut_delay 是怎么工作的？ 和 innodb_spin_wait_delay 以及自旋锁的关系？</p>
<h2 id="原理解析" class="headerLink">
    <a href="#%e5%8e%9f%e7%90%86%e8%a7%a3%e6%9e%90" class="header-mark"></a>原理解析</h2><p>既然调整 innodb_spin_wait_delay 就能解决这个问题，那就要先分析一下 innodb_spin_wait_delay 的作用</p>
<h3 id="关于-innodb_spin_wait_delay" class="headerLink">
    <a href="#%e5%85%b3%e4%ba%8e-innodb_spin_wait_delay" class="header-mark"></a>关于 innodb_spin_wait_delay</h3><p>innodb通过大量的自旋锁(比如 <code>InnoDB</code> <a href="https://dev.mysql.com/doc/refman/5.7/en/glossary.html#glos_mutex" target="_blank" rel="noopener noreferrer">mutexes</a> and <a href="https://dev.mysql.com/doc/refman/5.7/en/glossary.html#glos_rw_lock" target="_blank" rel="noopener noreferrer">rw-locks</a>)来用高CPU消耗避免上下文切换，这是自旋锁的正确使用方式，在多核场景下，它们一起自旋抢同一个锁，容易造成<a href="https://stackoverflow.com/questions/30684974/are-cache-line-ping-pong-and-false-sharing-the-same" target="_blank" rel="noopener noreferrer">cache ping-pong</a>，进而多个CPU核之间会互相使对方缓存部分无效。所以这里<a href="https://dev.mysql.com/doc/refman/5.7/en/innodb-performance-spin_lock_polling.html" target="_blank" rel="noopener noreferrer">innodb通过增加 innodb_spin_wait_delay 和 Pause 配合来缓解cache ping-pong</a>，也就是本来通过CPU 高速自旋抢锁，换成了抢锁失败后 delay一下（Pause）但是不释放CPU，delay 时间到后继续抢锁，也就是把连续的自旋抢锁转换成了更稀疏的点状的抢锁（间隔的 delay是个随机数），这样不但避免了上下文切换也大大减少了cache ping-pong。</p>
<h3 id="自旋锁如何减少了cache-ping-pong" class="headerLink">
    <a href="#%e8%87%aa%e6%97%8b%e9%94%81%e5%a6%82%e4%bd%95%e5%87%8f%e5%b0%91%e4%ba%86cache-ping-pong" class="header-mark"></a>自旋锁如何减少了cache ping-pong</h3><p>多线程竞争锁的时候，加锁失败的线程会“忙等待”，直到它拿到锁。什么叫“忙等待”呢？它并不意味着一直执行 CAS 函数，而是会与 CPU 紧密配合 ，它通过 CPU 提供的 <code>PAUSE</code> 指令，减少循环等待时的cache ping-pong和耗电量；对于单核 CPU，忙等待并没有意义，此时它会主动把线程休眠。</p>
<h3 id="x86-pause-指令" class="headerLink">
    <a href="#x86-pause-%e6%8c%87%e4%bb%a4" class="header-mark"></a>X86 PAUSE 指令</h3><p>X86设计了Pause指令，也就是调用 Pause 指令的代码会抢着 CPU 不释放，但是CPU 会打个盹，比如 10个时钟周期，相对一次上下文切换是大几千个时钟周期。</p>
<p>这样应用一旦自旋抢锁失败可以先 Pause 一下，只是这个Pause 时间对于 MySQL 来说还不够久，所以需要增加参数 innodb_spin_wait_delay 来将休息时间放大一些。</p>
<p>在我们的这个场景下对每个 SQL的 RT 抖动非常敏感（放大256倍），所以过高的 delay 会导致部分SQL  RT  变高。</p>
<p>函数 ut_delay(ut_rnd_interval(0, srv_spin_wait_delay)) 用来执行这个delay：</p>
<pre><code>/***************************MySQL代码****************************//**
Runs an idle loop on CPU. The argument gives the desired delay
in microseconds on 100 MHz Pentium + Visual C++.
@return dummy value */
UNIV_INTERN
ulint
ut_delay(ulint delay)  //delay 是[0,innodb_spin_wait_delay)之间的一个随机数
{
        ulint   i, j;

        UT_LOW_PRIORITY_CPU();

        j = 0;

        for (i = 0; i &lt; delay * 50; i++) {  //delay 放大50倍
                j += i;
                UT_RELAX_CPU();             //调用 CPU Pause
        }

        UT_RESUME_PRIORITY_CPU();

        return(j);
}
</code></pre>
<p>innodb_spin_wait_delay的默认值为6. spin 等待延迟是一个动态全局参数，您可以在MySQL选项文件（my.cnf或my.ini）中指定该参数，或者在运行时使用SET GLOBAL 来修改。在我们的MySQL配置中默认改成了30，导致了这个问题。</p>
<h3 id="cpu-为什么要有pause" class="headerLink">
    <a href="#cpu-%e4%b8%ba%e4%bb%80%e4%b9%88%e8%a6%81%e6%9c%89pause" class="header-mark"></a>CPU 为什么要有Pause</h3><p>首先可以看到 Pause 指令的作用：</p>
<ul>
<li>避免上下文切换，应用层想要休息可能会用yield、sleep，这两操作对于CPU来说太重了(伴随上下文切换)</li>
<li>能给超线程腾出计算能力（HT共享核，但是有单独的寄存器等存储单元，CPU Pause的时候，对应的HT可以占用计算资源），比如同一个core上先跑多个Pause，同时再跑 nop 指令，这时 nop指令的 IPC基本不受Pause的影响</li>
<li>节能（CPU可以休息、但是不让出来），CPU Pause 的时候你从 top 能看到 CPU 100%，但是不耗能。</li>
</ul>
<p>所以有了 Pause 指令后能够提高超线程的利用率,节能，减少上下文切换提高自旋锁的效率。</p>
<blockquote>
  <p><a href="https://www.reddit.com/r/intel/comments/hogk2n/research_on_the_impact_of_intel_Pause_instruction/" target="_blank" rel="noopener noreferrer">The PAUSE instruction is first introduced</a> for Intel Pentium 4 processor to improve the performance of “spin-wait loop”. The PAUSE instruction is typically used with software threads executing on two logical processors located in the same processor core, waiting for a lock to be released. Such short wait loops tend to last between tens and a few hundreds of cycles. When the wait loop is expected to last for thousands of cycles or more, it is preferable to yield to the operating system by calling one of the OS synchronization API functions, such as WaitForSingleObject on Windows OS.</p>
<p>An Intel® processor suffers a severe performance penalty when exiting the loop because it detects a possible memory order violation. The PAUSE instruction provides a hint to the processor that the code sequence is a spin-wait loop. The processor uses this hint to avoid the memory order violation in most situations. The PAUSE instruction can improve the performance of the processors supporting Intel Hyper-Threading Technology when executing “spin-wait loops”. With Pause instruction, processors are able to avoid the memory order violation and pipeline flush, and reduce power consumption through pipeline stall.</p>

</blockquote><p><strong>从intel sdm手册以及实际测试验证来看，Pause 指令在执行过程中，基本不占用流水线执行资源。</strong></p>
<h3 id="skylake-架构的8163-和-broadwell架构-e5-2682-cpu型号的不同" class="headerLink">
    <a href="#skylake-%e6%9e%b6%e6%9e%84%e7%9a%848163-%e5%92%8c-broadwell%e6%9e%b6%e6%9e%84-e5-2682-cpu%e5%9e%8b%e5%8f%b7%e7%9a%84%e4%b8%8d%e5%90%8c" class="header-mark"></a>Skylake 架构的8163 和 Broadwell架构 E5-2682 CPU型号的不同</h3><p>为什么用得好好的 innodb_spin_wait_delay 参数这次就不行了呢？</p>
<p>这是因为以前业务一直使用的是 E5-2682 CPU，这次用的是新一代架构的 Skylake 8163，那这两款CPU在这里的核心差别是？</p>
<p>在Intel 64-ia-32-architectures-optimization-manual手册中提到：</p>
<blockquote>
  <p>The latency of the PAUSE instruction in prior generation microarchitectures is about 10 cycles, whereas in Skylake microarchitecture it has been extended to as many as 140 cycles.</p>
<p><a href="https://xem.github.io/minix86/manual/intel-x86-and-64-manual-vol3/o_fe12b1e2a880e0ce-302.html" target="_blank" rel="noopener noreferrer">The PAUSE instruction can improves the performance</a> of processors supporting Intel Hyper-Threading Technology when executing “spin-wait loops” and other routines where one thread is accessing a shared lock or semaphore in a tight polling loop. When executing a spin-wait loop, the processor can suffer a severe performance penalty when exiting the loop because it detects a possible memory order violation and flushes the core processor’s pipeline. The PAUSE instruction provides a hint to the processor that the code sequence is a spin-wait loop. The processor uses this hint to avoid the memory order violation and prevent the pipeline flush. In addition, the PAUSE instruction de-
pipelines the spin-wait loop to prevent it from consuming execution resources excessively and consume power needlessly. (See<a href="https://xem.github.io/minix86/manual/intel-x86-and-64-manual-vol3/o_fe12b1e2a880e0ce-305.html" target="_blank" rel="noopener noreferrer"> Section 8.10.6.1, “Use the PAUSE Instruction in Spin-Wait Loops,” for more </a>information about using the PAUSE instruction with IA-32 processors supporting Intel Hyper-Threading Technology.)</p>

</blockquote><p>也就是**Skylake架构的CPU的PAUSE指令从之前的10 cycles 改成了 140 cycles。**这可是14倍的变化呀。</p>
<p>MySQL 使用 innodb_spin_wait_delay 控制 spin lock等待时间，等待时间时间从0*50个Pause到innodb_spin_wait_delay*50个Pause。
以前 innodb_spin_wait_delay 默认配置30，对于E5-2682 CPU，等待的最长时间为：
30 * 50 * 10=15000 cycles，对于2.5GHz的CPU，等待时间为6us。
对应计算 Skylake CPU的等待时间：30 *50 *140=210000 cycles，CPU主频也是2.5GHz，等待时间84us。</p>
<p>E5-2682 CPU型号在不同的delay参数和不同并发压力下的写入性能数据：</p>
<p><img class="tw-inline" loading="lazy" src=http://localhost:1313/images/951413iMgBlog/image-20221026153750159.png   alt="image-20221026153750159"  ></p>
<p>Skylake 8163 CPU型号在不同的delay参数和不同并发压力下的写入性能数据：</p>
<p><img class="tw-inline" loading="lazy" src=http://localhost:1313/images/951413iMgBlog/image-20221026153813774.png   alt="image-20221026153813774"  ></p>
<p>==因为8163的cycles从10改到了140，所以可以看到delay参数对性能的影响更加陡峻。==</p>
<h2 id="总结分析" class="headerLink">
    <a href="#%e6%80%bb%e7%bb%93%e5%88%86%e6%9e%90" class="header-mark"></a>总结分析</h2><p>Intel CPU 架构不同使得 Pause 指令的CPU Cycles不同导致了 MySQL innodb_spin_wait_delay 在 spin lock 失败的时候（此时需要 Pause* innodb_spin_wait_delay*N）delay更久，使得调用方看到了MySQL更大的 RT ，进而导致 Tomcat Server上业务并发跑不起来，所以最终压力上不去。</p>
<p>在长链路的排查中，细化定位是哪个节点出了问题是最难的，要盯住 RT 而不是 CPU。</p>
<p>欲速则不达，做压测的时候还是要老老实实地从一个并发开始观察QPS、 RT ，然后一直增加压力到压不上去了，再看QPS、 RT 变化，然后确认瓶颈点。</p>
<h2 id="参考文章" class="headerLink">
    <a href="#%e5%8f%82%e8%80%83%e6%96%87%e7%ab%a0" class="header-mark"></a>参考文章</h2><p><a href="https://cloud.tencent.com/developer/article/1005284" target="_blank" rel="noopener noreferrer">https://cloud.tencent.com/developer/article/1005284</a></p>
<p><a href="https://dev.mysql.com/doc/refman/5.7/en/innodb-performance-spin_lock_polling.html" target="_blank" rel="noopener noreferrer">mysql doc</a></p>
<p><a href="http://oliveryang.net/2018/01/cache-false-sharing-debug" target="_blank" rel="noopener noreferrer">Cache Line 伪共享发现与优化</a></p>
<p><a href="https://en.wikichip.org/w/images/e/eb/intel-ref-248966-037.pdf" target="_blank" rel="noopener noreferrer">intel spec</a></p>
<p><a href="https://mp.weixin.qq.com/s/dlKC13i9Z8wjDDiU2tig6Q" target="_blank" rel="noopener noreferrer">Intel PAUSE指令变化影响到MySQL的性能，该如何解决？</a></p>
<p><a href="https://topic.atatech.org/articles/173194" target="_blank" rel="noopener noreferrer">ARM软硬件协同设计：锁优化</a>, arm不同于x86，用的是yield来代替Pause</p>
<p><a href="http://cr.openjdk.java.net/~dchuyko/8186670/yield/spinwait.html" target="_blank" rel="noopener noreferrer">http://cr.openjdk.java.net/~dchuyko/8186670/yield/spinwait.html</a></p>
<p><a href="https://aloiskraus.wordpress.com/2018/06/16/why-skylakex-cpus-are-sometimes-50-slower-how-intel-has-broken-existing-code/" target="_blank" rel="noopener noreferrer">https://aloiskraus.wordpress.com/2018/06/16/why-skylakex-cpus-are-sometimes-50-slower-how-intel-has-broken-existing-code/</a> Windows+.NET 平台下的分析过程及修复方案</p>
]]></description>
</item></channel>
</rss>
