<rss xmlns:atom="http://www.w3.org/2005/Atom" version="2.0">
    <channel>
        <title>Nethogs - 标签 - plantegg</title>
        <link>http://localhost:1313/tags/nethogs/</link>
        <description>Nethogs - 标签 - plantegg</description>
        <generator>Hugo -- gohugo.io</generator><language>zh-Hans</language><lastBuildDate>Thu, 07 Dec 2017 17:30:03 &#43;0000</lastBuildDate><atom:link href="http://localhost:1313/tags/nethogs/" rel="self" type="application/rss+xml" /><item>
    <title>如何追踪网络流量</title>
    <link>http://localhost:1313/posts/%E5%A6%82%E4%BD%95%E8%BF%BD%E8%B8%AA%E7%BD%91%E7%BB%9C%E6%B5%81%E9%87%8F/</link>
    <pubDate>Thu, 07 Dec 2017 17:30:03 &#43;0000</pubDate><author>
        <name>作者</name>
    </author><guid>http://localhost:1313/posts/%E5%A6%82%E4%BD%95%E8%BF%BD%E8%B8%AA%E7%BD%91%E7%BB%9C%E6%B5%81%E9%87%8F/</guid>
    <description><![CDATA[<h1 id="如何追踪网络流量" class="headerLink">
    <a href="#%e5%a6%82%e4%bd%95%e8%bf%bd%e8%b8%aa%e7%bd%91%e7%bb%9c%e6%b5%81%e9%87%8f" class="header-mark"></a>如何追踪网络流量</h1><h2 id="背景" class="headerLink">
    <a href="#%e8%83%8c%e6%99%af" class="header-mark"></a>背景</h2><p>某些场景下通过监控发现了流量比较大，不太合理，需要知道这些流量都是哪些进程访问哪些服务触发的</p>
<h2 id="方法" class="headerLink">
    <a href="#%e6%96%b9%e6%b3%95" class="header-mark"></a>方法</h2><ol>
<li>定位流量是由哪个进程触发的</li>
<li>定位流量主要是访问哪些ip导致的</li>
<li>定位具体的端口有较大的流量</li>
</ol>
<h2 id="工具" class="headerLink">
    <a href="#%e5%b7%a5%e5%85%b7" class="header-mark"></a>工具</h2><p>nethogs/iftop/tcptrack</p>
<h2 id="定位进程" class="headerLink">
    <a href="#%e5%ae%9a%e4%bd%8d%e8%bf%9b%e7%a8%8b" class="header-mark"></a>定位进程</h2><pre><code>sudo nethogs 
</code></pre>
<p><img class="tw-inline" loading="lazy" src=http://localhost:1313/Users/ren/case/ossimg/e89eaf27aa98a6192d109ee22f9c0da8.png   alt="image.png"  ></p>
<p>从上图可以看到总的流量，以及每个进程的流量大小。这里可以确认流量主要是3820的java进程消耗的</p>
<h2 id="定位ip" class="headerLink">
    <a href="#%e5%ae%9a%e4%bd%8dip" class="header-mark"></a>定位ip</h2><pre><code>sudo iftop -p -n -B
</code></pre>
<p><img class="tw-inline" loading="lazy" src=http://localhost:1313/Users/ren/case/ossimg/1f03abbebbfc173b5af3163d017fd901.png   alt="image.png"  ></p>
<p>通过上图可以看到流量主要是消耗在 10.0.48.1的ip上</p>
<h2 id="定位端口" class="headerLink">
    <a href="#%e5%ae%9a%e4%bd%8d%e7%ab%af%e5%8f%a3" class="header-mark"></a>定位端口</h2><p>10.0.48.1 有可能是一个mapping ip，需要进一步查看具体</p>
<pre><code>sudo tcptrack -r 5 -i eth0  //然后输入小写s，按流量排序
sudo tcptrack -r 5 -i eth0 host 10.0.48.1 //filter 语法和tcpdump一样
</code></pre>
<p><img class="tw-inline" loading="lazy" src=http://localhost:1313/Users/ren/case/ossimg/07f0fceb6af4c4387832561b630c00b3.png   alt="image.png"  ></p>
<p>可以看到4355/4356端口上流量相对较大</p>
<h2 id="软件安装" class="headerLink">
    <a href="#%e8%bd%af%e4%bb%b6%e5%ae%89%e8%a3%85" class="header-mark"></a>软件安装</h2><p>后续发布新镜像都会带上这三个软件的rpm安装包
目前可以手动下载这三个rpm安装包：</p>
]]></description>
</item></channel>
</rss>
