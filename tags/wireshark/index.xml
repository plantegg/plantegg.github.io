<rss xmlns:atom="http://www.w3.org/2005/Atom" version="2.0">
    <channel>
        <title>Wireshark - 标签 - plantegg</title>
        <link>http://localhost:1313/tags/wireshark/</link>
        <description>Wireshark - 标签 - plantegg</description>
        <generator>Hugo -- gohugo.io</generator><language>zh-Hans</language><lastBuildDate>Thu, 10 Oct 2024 10:30:03 &#43;0000</lastBuildDate><atom:link href="http://localhost:1313/tags/wireshark/" rel="self" type="application/rss+xml" /><item>
    <title>一次抓包分析过程——Wireshark 新手上车</title>
    <link>http://localhost:1313/posts/%E4%B8%80%E6%AC%A1%E6%8A%93%E5%8C%85%E5%88%86%E6%9E%90%E8%BF%87%E7%A8%8B/</link>
    <pubDate>Thu, 10 Oct 2024 10:30:03 &#43;0000</pubDate><author>
        <name>作者</name>
    </author><guid>http://localhost:1313/posts/%E4%B8%80%E6%AC%A1%E6%8A%93%E5%8C%85%E5%88%86%E6%9E%90%E8%BF%87%E7%A8%8B/</guid>
    <description><![CDATA[<h1 id="一次抓包分析过程wireshark-新手上车" class="headerLink">
    <a href="#%e4%b8%80%e6%ac%a1%e6%8a%93%e5%8c%85%e5%88%86%e6%9e%90%e8%bf%87%e7%a8%8bwireshark-%e6%96%b0%e6%89%8b%e4%b8%8a%e8%bd%a6" class="header-mark"></a>一次抓包分析过程——Wireshark 新手上车</h1><h2 id="问题" class="headerLink">
    <a href="#%e9%97%ae%e9%a2%98" class="header-mark"></a>问题</h2><p>网友尝试做星球第一个必做实验的时候，什么内核参数都没改，发现请求经常会停滞 100ms，这种要怎么判断是局域网的网络问题还是应用问题呢？ 服务是 python3 -m http.server 启动的，看上去没有出现什么重传、窗口也没看到什么问题</p>
<p>因为不能提供环境给我，我尝试对这个抓包进行了分析，因为只有客户端抓包，所以分析结果是没有结论的，但分析过程比较适合入门 Wireshark，适合刚加入星球的、没分析过网络包的同学可以参考，熟手请忽略</p>
<h2 id="分析" class="headerLink">
    <a href="#%e5%88%86%e6%9e%90" class="header-mark"></a>分析</h2><p>整个抓包 28MB，跨度 600 毫秒，看得出带宽很大、RTT 极小(到Wireshark 里看看前几个包的交互 RT 就知道了)</p>
<p><img class="tw-inline" loading="lazy" src=https://cdn.jsdelivr.net/gh/plantegg/plantegg.github.io/images/951413iMgBlog/image-20240715093847359.png   alt="image-20240715093847359"  ></p>
<h3 id="详细分析" class="headerLink">
    <a href="#%e8%af%a6%e7%bb%86%e5%88%86%e6%9e%90" class="header-mark"></a>详细分析</h3><p>看第一次卡 100ms 之前的抓包，在100ms 以前客户端ack 了所有Server 发出来的的tcp包(红框)，也就是说每一个发给客户端的包客户端都ack 完毕，证明客户端处理足够快，但是 8089端口不继续发包而是等了100ms再继续发，如下图：</p>
<p><img class="tw-inline" loading="lazy" src=https://cdn.jsdelivr.net/gh/plantegg/plantegg.github.io/images/951413iMgBlog/image-20240715094218182.png   alt="image-20240715094218182"  ></p>
<p>到这里的结论：</p>
<p>不是因为发送buffer、接收buffer太小导致的卡；也不是因为拥塞窗口导致的，就是Server 端没有发包。大概率是Server 进程卡了，或者Server 进程读取物理文件往OS buffer 写这些环节卡了（可以在服务端通过 strace -tt 看看进程在这 100 毫秒有没有往内核怼数据）</p>
<p>所以要继续在 Server 端来分析这个问题</p>
<p>怎么快速定位到红框、红线这里的包？</p>
<blockquote>
  <p>到 Time Sequence 图上点平台两边的点都可以自动跳转到这里，每个点代表一个网络包，横坐标代表时间</p>

</blockquote><h2 id="其它分析" class="headerLink">
    <a href="#%e5%85%b6%e5%ae%83%e5%88%86%e6%9e%90" class="header-mark"></a>其它分析</h2><p>将如下 Time Sequence 图使劲放大，从第一个包开始看，可以观察到教科书所说的慢启动</p>
<p><img class="tw-inline" loading="lazy" src=https://cdn.jsdelivr.net/gh/plantegg/plantegg.github.io/images/951413iMgBlog/image-20240715095134352.png   alt="image-20240715095134352"  ></p>
<p>整体看的话，慢启动几乎可以忽略，毕竟这个抓包是下载一个巨大的文件，如果是一个小文件这个慢启动还是影响很大的，如下图，红框部分看起来微不足道</p>
<p><img class="tw-inline" loading="lazy" src=https://cdn.jsdelivr.net/gh/plantegg/plantegg.github.io/images/951413iMgBlog/image-20240715095506381.png   alt="image-20240715095506381"  ></p>
<p>把时间范围放大，继续看，在卡之前红色箭头很长的，代表带宽、buffer有能力一次发送很多网络包，但是后面每次只发一点点网络包(绿色箭头长度)就卡了</p>
<p><img class="tw-inline" loading="lazy" src=https://cdn.jsdelivr.net/gh/plantegg/plantegg.github.io/images/951413iMgBlog/image-20240715095647702.png   alt="image-20240715095647702"  ></p>
<h2 id="重现" class="headerLink">
    <a href="#%e9%87%8d%e7%8e%b0" class="header-mark"></a>重现</h2><p>我用 python3 当服务端未能重现这个卡100ms 的现象，拉取都很丝滑</p>
<p><img class="tw-inline" loading="lazy" src=https://cdn.jsdelivr.net/gh/plantegg/plantegg.github.io/images/951413iMgBlog/image-20240715101505977.png   alt="image-20240715101505977"  ></p>
<p>非常细节地去分析的话，也是能看到一些小问题的，比如1.9ms的卡顿、比如zero_window</p>
<p><img class="tw-inline" loading="lazy" src=https://cdn.jsdelivr.net/gh/plantegg/plantegg.github.io/images/951413iMgBlog/image-20240715103928266.png   alt="image-20240715103928266"  ></p>
<p>重现的时候，有1.9ms 这样的卡顿，但是不算有规律，因为这么小在整个传输过程中影响不大</p>
<p><img class="tw-inline" loading="lazy" src=https://cdn.jsdelivr.net/gh/plantegg/plantegg.github.io/images/951413iMgBlog/image-20240715103708750.png   alt="image-20240715103708750"  ></p>
<p>我重现的时候正好抓到了 seq 回绕，seq 是个 32位的无符号整数，到了最大值就从0又开始：</p>
<p><img class="tw-inline" loading="lazy" src=https://cdn.jsdelivr.net/gh/plantegg/plantegg.github.io/images/951413iMgBlog/image-20240715115500312.png   alt="image-20240715115500312"  ></p>
<p>此时的 Time Sequence:</p>
<p><img class="tw-inline" loading="lazy" src=https://cdn.jsdelivr.net/gh/plantegg/plantegg.github.io/images/951413iMgBlog/image-20240715115655516.png   alt="image-20240715115655516"  ></p>
<h2 id="建议" class="headerLink">
    <a href="#%e5%bb%ba%e8%ae%ae" class="header-mark"></a>建议</h2><p>可以用实验1里面的一些手段debug 一下Server 为什么卡了，除了 strace -tt 还可以用 ebpf 试试看看 Server 的调度上哪里顿了 100ms</p>
<p>新手如何通过Wireshark 来看抓包？</p>
<p>首先不要纯粹为了学习去看，而是要问你的问题是什么？如果网络传输速度慢，我们就看  Time Sequence(斜率越陡速度越快)，去看为什么发送端不发包了</p>
<ul>
<li>如正文里的卡顿平台，在250ms内差不多要卡240ms 不发包，速度自然不行</li>
<li>我重现抓包中的zero Windows</li>
<li>达到网络BDP 瓶颈了，去看拥塞窗口在最大值的时候会丢包，触发降速</li>
</ul>
<p>里面可以看、要看的东西太多，所以我也说不上要看什么，而是要问你的问题是什么</p>
]]></description>
</item><item>
    <title>如何从几百万个抓包中找到一个异常的包</title>
    <link>http://localhost:1313/posts/%E5%A6%82%E4%BD%95%E4%BB%8E%E5%87%A0%E7%99%BE%E4%B8%87%E4%B8%AA%E6%8A%93%E5%8C%85%E4%B8%AD%E6%89%BE%E5%88%B0%E4%B8%80%E4%B8%AA%E5%BC%82%E5%B8%B8%E7%9A%84%E5%8C%85/</link>
    <pubDate>Wed, 23 Aug 2023 12:30:03 &#43;0000</pubDate><author>
        <name>作者</name>
    </author><guid>http://localhost:1313/posts/%E5%A6%82%E4%BD%95%E4%BB%8E%E5%87%A0%E7%99%BE%E4%B8%87%E4%B8%AA%E6%8A%93%E5%8C%85%E4%B8%AD%E6%89%BE%E5%88%B0%E4%B8%80%E4%B8%AA%E5%BC%82%E5%B8%B8%E7%9A%84%E5%8C%85/</guid>
    <description><![CDATA[<h1 id="如何从几百万个抓包中找到一个异常的包" class="headerLink">
    <a href="#%e5%a6%82%e4%bd%95%e4%bb%8e%e5%87%a0%e7%99%be%e4%b8%87%e4%b8%aa%e6%8a%93%e5%8c%85%e4%b8%ad%e6%89%be%e5%88%b0%e4%b8%80%e4%b8%aa%e5%bc%82%e5%b8%b8%e7%9a%84%e5%8c%85" class="header-mark"></a>如何从几百万个抓包中找到一个异常的包</h1><p>这篇算是对抓包定位原因在哪里的落地篇，没什么高深的技术，都是很low但是你一定可以照着操作的，算是星球内必须学会和带走的内容</p>
<h2 id="场景" class="headerLink">
    <a href="#%e5%9c%ba%e6%99%af" class="header-mark"></a>场景</h2><p><img class="tw-inline" loading="lazy" src=https://cdn.jsdelivr.net/gh/plantegg/plantegg.github.io/images/951413iMgBlog/image-20230620150119963.png   alt="image-20230620150119963"  ></p>
<h2 id="问题" class="headerLink">
    <a href="#%e9%97%ae%e9%a2%98" class="header-mark"></a>问题</h2><p>一次业务请求包含160个拖数据的SQL查询，通过160个连接，发给160个Database，但是过几分钟后总有报错。几分钟抓包文件10G左右，网络包几百万个，怎么找到报错的那个？</p>
<p>几个麻烦的地方</p>
<ul>
<li>虽然问题每次稳定重现，但是每次重现的Database不是固定的；</li>
<li>从开始拖到出现问题需要几分钟不等，抓包量巨大</li>
<li>有一个连接报错后剩下的其它连接也会断开</li>
<li>这么多端口怎么解析成MySQL协议，请看：https://t.zsxq.com/0f7nMlKax</li>
</ul>
<h3 id="问题发生条件" class="headerLink">
    <a href="#%e9%97%ae%e9%a2%98%e5%8f%91%e7%94%9f%e6%9d%a1%e4%bb%b6" class="header-mark"></a>问题发生条件</h3><ul>
<li>一个Client同时开160条连接，发160个类似的SQL去160个MySQL Database上拖数据时必现</li>
<li>如果将拖数据的SQL拖取数量改小一点就不再出现——拖取少执行更快，没达到触发bug条件</li>
<li>网络传输得慢一点、JDBC streaming 模式下发生，比如streaming流模式拖数据是几MB每秒，去掉流模式拖数据是几十MB每秒且不报错。这里可以通过设置内核 tcp rmem/加大rtt延时来模拟重现——和我们的<a href="https://wx.zsxq.com/dweb2/index/topic_detail/181428425525182" target="_blank" rel="noopener noreferrer">必做实验callback一下</a>，无时不刻不展示下我们必做实验的用途。</li>
</ul>
<h2 id="分析过程" class="headerLink">
    <a href="#%e5%88%86%e6%9e%90%e8%bf%87%e7%a8%8b" class="header-mark"></a>分析过程</h2><p>分析技巧和步骤：</p>
<ol>
<li>抓包，从握手到报错断开全抓下来，时间跨度3分多钟，抓下来10个G左右，怎么分析？</li>
<li>editcap -c 200000 把抓包切小，每个文件20万个包，保证wireshark打开不太慢（editcap 是安装wireshark附带的小命令，附带的还有tshark、capinfos等）</li>
<li>wireshark打开切小后的最后一个文件，搜reset/fin 找到<strong>第一个</strong>断开的连接(如下图)，找到9913/42909这对连接端口</li>
<li>回到10个G的抓包中，用 tshark -r ./big.pcap -Y &ldquo;tcp.port==42909&rdquo;   -w 42909.pcap 把42909这条连接所有包过滤出来，-r 读，-w 写</li>
<li>wireshark 打开42909.pcap 傻子也能看到问题在哪里了</li>
</ol>
<p>切完后的包，切完后的文件会加时间戳，时间戳可以和报错时间对应：</p>
<div class="code-block highlight is-open show-line-numbers  tw-group tw-my-2">
  <div class="
    code-block-title 
    
    tw-flex 
    tw-flex-row 
    tw-justify-between 
    tw-w-full tw-bg-bgColor-secondary
    ">      
    <button 
      class="
        tw-select-none 
        tw-mx-2 
        tw-block
        group-[.is-open]:tw-rotate-90
        tw-transition-[transform] 
        tw-duration-500 
        tw-ease-in-out
        print:!tw-hidden"
      disabled
      aria-hidden="true"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M285.476 272.971L91.132 467.314c-9.373 9.373-24.569 9.373-33.941 0l-22.667-22.667c-9.357-9.357-9.375-24.522-.04-33.901L188.505 256 34.484 101.255c-9.335-9.379-9.317-24.544.04-33.901l22.667-22.667c9.373-9.373 24.569-9.373 33.941 0L285.475 239.03c9.373 9.372 9.373 24.568.001 33.941z"/></svg></button>

    <div class="code-block-title-bar tw-w-full">
      <p class="tw-select-none !tw-my-1">text</p>
    </div>
    <div class="tw-flex">
      <button 
        class="
          line-number-button
          tw-select-none 
          tw-mx-2 
          tw-hidden 
          group-[.is-open]:tw-block 
          group-[.show-line-numbers]:tw-text-fgColor-link 
          print:!tw-hidden" 
        title="Toggle line numbers"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M61.77 401l17.5-20.15a19.92 19.92 0 0 0 5.07-14.19v-3.31C84.34 356 80.5 352 73 352H16a8 8 0 0 0-8 8v16a8 8 0 0 0 8 8h22.83a157.41 157.41 0 0 0-11 12.31l-5.61 7c-4 5.07-5.25 10.13-2.8 14.88l1.05 1.93c3 5.76 6.29 7.88 12.25 7.88h4.73c10.33 0 15.94 2.44 15.94 9.09 0 4.72-4.2 8.22-14.36 8.22a41.54 41.54 0 0 1-15.47-3.12c-6.49-3.88-11.74-3.5-15.6 3.12l-5.59 9.31c-3.72 6.13-3.19 11.72 2.63 15.94 7.71 4.69 20.38 9.44 37 9.44 34.16 0 48.5-22.75 48.5-44.12-.03-14.38-9.12-29.76-28.73-34.88zM496 224H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zm0-160H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16V80a16 16 0 0 0-16-16zm0 320H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zM16 160h64a8 8 0 0 0 8-8v-16a8 8 0 0 0-8-8H64V40a8 8 0 0 0-8-8H32a8 8 0 0 0-7.14 4.42l-8 16A8 8 0 0 0 24 64h8v64H16a8 8 0 0 0-8 8v16a8 8 0 0 0 8 8zm-3.91 160H80a8 8 0 0 0 8-8v-16a8 8 0 0 0-8-8H41.32c3.29-10.29 48.34-18.68 48.34-56.44 0-29.06-25-39.56-44.47-39.56-21.36 0-33.8 10-40.46 18.75-4.37 5.59-3 10.84 2.8 15.37l8.58 6.88c5.61 4.56 11 2.47 16.12-2.44a13.44 13.44 0 0 1 9.46-3.84c3.33 0 9.28 1.56 9.28 8.75C51 248.19 0 257.31 0 304.59v4C0 316 5.08 320 12.09 320z"/></svg></button>

      <button 
        class="
          wrap-code-button
          tw-select-none 
          tw-mx-2 
          tw-hidden 
          group-[.is-open]:tw-block 
          group-[.is-wrap]:tw-text-fgColor-link 
          print:!tw-hidden" 
        title="Toggle code wrap"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M16 132h416c8.837 0 16-7.163 16-16V76c0-8.837-7.163-16-16-16H16C7.163 60 0 67.163 0 76v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16z"/></svg></button>
      
      <button 
        class="
          copy-code-button
          tw-select-none
          tw-mx-2 
          tw-hidden
          group-[.is-open]:tw-block
          hover:tw-text-fgColor-link 
          print:!tw-hidden"
        title="Copy code">
          <span class="copy-icon tw-block"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M433.941 65.941l-51.882-51.882A48 48 0 0 0 348.118 0H176c-26.51 0-48 21.49-48 48v48H48c-26.51 0-48 21.49-48 48v320c0 26.51 21.49 48 48 48h224c26.51 0 48-21.49 48-48v-48h80c26.51 0 48-21.49 48-48V99.882a48 48 0 0 0-14.059-33.941zM266 464H54a6 6 0 0 1-6-6V150a6 6 0 0 1 6-6h74v224c0 26.51 21.49 48 48 48h96v42a6 6 0 0 1-6 6zm128-96H182a6 6 0 0 1-6-6V54a6 6 0 0 1 6-6h106v88c0 13.255 10.745 24 24 24h88v202a6 6 0 0 1-6 6zm6-256h-64V48h9.632c1.591 0 3.117.632 4.243 1.757l48.368 48.368a6 6 0 0 1 1.757 4.243V112z"/></svg></span>
          <span class="check-icon tw-hidden"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M173.898 439.404l-166.4-166.4c-9.997-9.997-9.997-26.206 0-36.204l36.203-36.204c9.997-9.998 26.207-9.998 36.204 0L192 312.69 432.095 72.596c9.997-9.997 26.207-9.997 36.204 0l36.203 36.204c9.997 9.997 9.997 26.206 0 36.204l-294.4 294.401c-9.998 9.997-26.207 9.997-36.204-.001z"/></svg></span>
      </button>
        
      <button 
        class="
          tw-select-none 
          tw-mx-2 
          tw-block 
          group-[.is-open]:tw-hidden 
          print:!tw-hidden" 
        disabled
        aria-hidden="true"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M328 256c0 39.8-32.2 72-72 72s-72-32.2-72-72 32.2-72 72-72 72 32.2 72 72zm104-72c-39.8 0-72 32.2-72 72s32.2 72 72 72 72-32.2 72-72-32.2-72-72-72zm-352 0c-39.8 0-72 32.2-72 72s32.2 72 72 72 72-32.2 72-72-32.2-72-72-72z"/></svg></button>
    </div>
  </div>
  <pre style="counter-reset: codeblock;" class="tw-block tw-m-0 tw-p-0"><code 
    id="codeblock-id-1" 
    class="
      chroma 
      !tw-block 
      tw-p-0
      tw-m-0
      tw-transition-[max-height] 
      tw-duration-500 
      tw-ease-in-out 
      group-[.is-closed]:!tw-max-h-0 
      group-[.is-wrap]:tw-text-wrap
      tw-overflow-y-hidden
      tw-overflow-x-auto
      tw-scrollbar-thin
      "><span class="line"><span class="cl">-rw-r--r--  1 root  root   329M Jun 16 17:46 big00_00000_20230616170456.pcap
</span></span><span class="line"><span class="cl">-rw-r--r--  1 root  root   1.1G Jun 16 17:46 big00_00001_20230616170524.pcap
</span></span><span class="line"><span class="cl">-rw-r--r--  1 root  root  1022M Jun 16 17:46 big00_00002_20230616170546.pcap
</span></span><span class="line"><span class="cl">-rw-r--r--  1 root  root   1.1G Jun 16 17:46 big00_00003_20230616170608.pcap
</span></span><span class="line"><span class="cl">-rw-r--r--  1 root  root  1012M Jun 16 17:46 big00_00004_20230616170630.pcap
</span></span><span class="line"><span class="cl">-rw-r--r--  1 root  root   982M Jun 16 17:46 big00_00005_20230616170652.pcap
</span></span><span class="line"><span class="cl">-rw-r--r--  1 root  root   938M Jun 16 17:46 big00_00006_20230616170714.pcap
</span></span><span class="line"><span class="cl">-rw-r--r--  1 root  root   1.1G Jun 16 17:46 big00_00007_20230616170735.pcap
</span></span><span class="line"><span class="cl">-rw-r--r--  1 root  root   661M Jun 16 17:46 big00_00008_20230616170759.pcap</span></span></code></pre>
</div>
<p>搜reset/fin 找到第一个断开的连接，第一个断开的连接才是罪魁祸首：</p>
<p><img class="tw-inline" loading="lazy" src=https://cdn.jsdelivr.net/gh/plantegg/plantegg.github.io/images/951413iMgBlog/image-20230620143248344.png   alt="image-20230620143248344"  ></p>
<h3 id="进一步分析发生问题的连接" class="headerLink">
    <a href="#%e8%bf%9b%e4%b8%80%e6%ad%a5%e5%88%86%e6%9e%90%e5%8f%91%e7%94%9f%e9%97%ae%e9%a2%98%e7%9a%84%e8%bf%9e%e6%8e%a5" class="header-mark"></a>进一步分析发生问题的连接</h3><p>知识点：</p>
<blockquote>
  <p>MySQL 协议是一来一回，也就是client发查询然后等查询结果全部返回，然后再发下一个</p>
<p>按协议在一个SQL查询的数据传输完毕前client不能再发任何请求，MySQL Server负责一直发送查询结果直到发送完毕。</p>

</blockquote><p>如下两个截图是从42909.pcap文件中过滤到的抓包从握手到断开的全过程，图1过滤条件：tcp.srcport eq 42909 and tcp.len&gt;0  (42909是客户端，9913是MySQL端口)，可以看到客户端 login（连数据库肯定得要user、password认证），然后是client查了MySQL的一堆服务端参数(下图第二行)，再然后是client设置了几个参数(set 那些)。关键的是倒数第二行client发了一个SQL给MySQL需要拉取大量数据(建立连接17.98秒的时候)，然后是数据传数据过程，第190秒的时候client发了 Quit断开连接</p>
<p><img class="tw-inline" loading="lazy" src=https://cdn.jsdelivr.net/gh/plantegg/plantegg.github.io/images/951413iMgBlog/image-20230620140921134.png   alt="image-20230620140921134"  ></p>
<p>上图因为加了过滤条件，只看client端并去掉ack后的所有包，没看到全貌，这个过程9913的MySQL 服务端又做了啥呢？因为太长前面漫长的传数据就不截图了，只看最后连接的断开。</p>
<p>但是下图红框所示的地方可以看到MySQL Server 传着传着居然带了个 fin 包在里面，表示MySQL Server要断开连接了，无奈Client只能也发送quit 断开连接。红框告诉我们一个无比有力的证据MySQL Server 在不应该断开的地方断开了连接，问题在 MySQL Server 端</p>
<p><img class="tw-inline" loading="lazy" src=https://cdn.jsdelivr.net/gh/plantegg/plantegg.github.io/images/951413iMgBlog/image-20230620141017987.png   alt="image-20230620141017987"  ></p>
<h2 id="结论" class="headerLink">
    <a href="#%e7%bb%93%e8%ae%ba" class="header-mark"></a>结论</h2><p>就抓包结论来看是 MySQL 在不应该断开的时候发送了 fin 主动断开连接，可能是MySQL的bug</p>
<p>题外话，这个包证据抓了有一周了，但是MySQL研发同学始终绕来绕去(比如我的代码没记录下这个SQL就是没收到，我的代码没问题——熟悉的味道)跟我打了一周太极(异地)，我一查发现我和他老板认识且在一层楼，赶紧面对面找他老板讲清楚这个问题，且签字画押承认是MySQL的问题，然后继续推进排查，最终结果是为啥我跟你们一起期待吧，有了结果我再来update。</p>
<h2 id="练习" class="headerLink">
    <a href="#%e7%bb%83%e4%b9%a0" class="header-mark"></a>练习</h2><p>找个MySQL，然后开始抓包，用mysql-client连一下MySQL Server随便发几个SQL，然后看看一来一回的响应</p>
<p>如果哪怕在星球一年你只要好好掌握这一篇用到的技能也能帮助你在日常工作中互相扯皮的时候快速给出精准定位和分析，值回星球票价，加油</p>
<p>比如这个案例我同时打开了5/6个wireshark分析不同的流、整体搜索等</p>
<h2 id="其它" class="headerLink">
    <a href="#%e5%85%b6%e5%ae%83" class="header-mark"></a>其它</h2><p>这些技巧不只是用在MySQL 上，其它微服务、redis等涉及网络调用场景的扯皮的地方都可以用</p>
<p><a href="https://plantegg.github.io/2019/06/21/%E5%B0%B1%E6%98%AF%E8%A6%81%E4%BD%A0%E6%87%82%E6%8A%93%E5%8C%85--WireShark%E4%B9%8B%E5%91%BD%E4%BB%A4%E8%A1%8C%E7%89%88tshark/" target="_blank" rel="noopener noreferrer">wireshark 附带的一些小工具</a></p>
<blockquote>
  <p>capinfos rsb2.cap</p>

</blockquote><blockquote>
  <p>tshark -q -n -r rsb2.cap  -z &ldquo;conv,ip&rdquo;   分析流量总况</p>

</blockquote><blockquote>
  <p>tshark -q -n -r rsb2.cap  -z &ldquo;conv,tcp&rdquo;  分析每一个连接的流量、rtt、响应时间、丢包率、重传率等等</p>

</blockquote><blockquote>
  <p>editcap -c 100000 ./rsb2.cap  rsb00.cap  //把大文件rsb2.cap按每个文件100000个package切成小文件</p>

</blockquote><p>存放在这里：</p>
<div class="code-block highlight is-open show-line-numbers  tw-group tw-my-2">
  <div class="
    code-block-title 
    
    tw-flex 
    tw-flex-row 
    tw-justify-between 
    tw-w-full tw-bg-bgColor-secondary
    ">      
    <button 
      class="
        tw-select-none 
        tw-mx-2 
        tw-block
        group-[.is-open]:tw-rotate-90
        tw-transition-[transform] 
        tw-duration-500 
        tw-ease-in-out
        print:!tw-hidden"
      disabled
      aria-hidden="true"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M285.476 272.971L91.132 467.314c-9.373 9.373-24.569 9.373-33.941 0l-22.667-22.667c-9.357-9.357-9.375-24.522-.04-33.901L188.505 256 34.484 101.255c-9.335-9.379-9.317-24.544.04-33.901l22.667-22.667c9.373-9.373 24.569-9.373 33.941 0L285.475 239.03c9.373 9.372 9.373 24.568.001 33.941z"/></svg></button>

    <div class="code-block-title-bar tw-w-full">
      <p class="tw-select-none !tw-my-1">text</p>
    </div>
    <div class="tw-flex">
      <button 
        class="
          line-number-button
          tw-select-none 
          tw-mx-2 
          tw-hidden 
          group-[.is-open]:tw-block 
          group-[.show-line-numbers]:tw-text-fgColor-link 
          print:!tw-hidden" 
        title="Toggle line numbers"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M61.77 401l17.5-20.15a19.92 19.92 0 0 0 5.07-14.19v-3.31C84.34 356 80.5 352 73 352H16a8 8 0 0 0-8 8v16a8 8 0 0 0 8 8h22.83a157.41 157.41 0 0 0-11 12.31l-5.61 7c-4 5.07-5.25 10.13-2.8 14.88l1.05 1.93c3 5.76 6.29 7.88 12.25 7.88h4.73c10.33 0 15.94 2.44 15.94 9.09 0 4.72-4.2 8.22-14.36 8.22a41.54 41.54 0 0 1-15.47-3.12c-6.49-3.88-11.74-3.5-15.6 3.12l-5.59 9.31c-3.72 6.13-3.19 11.72 2.63 15.94 7.71 4.69 20.38 9.44 37 9.44 34.16 0 48.5-22.75 48.5-44.12-.03-14.38-9.12-29.76-28.73-34.88zM496 224H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zm0-160H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16V80a16 16 0 0 0-16-16zm0 320H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zM16 160h64a8 8 0 0 0 8-8v-16a8 8 0 0 0-8-8H64V40a8 8 0 0 0-8-8H32a8 8 0 0 0-7.14 4.42l-8 16A8 8 0 0 0 24 64h8v64H16a8 8 0 0 0-8 8v16a8 8 0 0 0 8 8zm-3.91 160H80a8 8 0 0 0 8-8v-16a8 8 0 0 0-8-8H41.32c3.29-10.29 48.34-18.68 48.34-56.44 0-29.06-25-39.56-44.47-39.56-21.36 0-33.8 10-40.46 18.75-4.37 5.59-3 10.84 2.8 15.37l8.58 6.88c5.61 4.56 11 2.47 16.12-2.44a13.44 13.44 0 0 1 9.46-3.84c3.33 0 9.28 1.56 9.28 8.75C51 248.19 0 257.31 0 304.59v4C0 316 5.08 320 12.09 320z"/></svg></button>

      <button 
        class="
          wrap-code-button
          tw-select-none 
          tw-mx-2 
          tw-hidden 
          group-[.is-open]:tw-block 
          group-[.is-wrap]:tw-text-fgColor-link 
          print:!tw-hidden" 
        title="Toggle code wrap"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M16 132h416c8.837 0 16-7.163 16-16V76c0-8.837-7.163-16-16-16H16C7.163 60 0 67.163 0 76v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16z"/></svg></button>
      
      <button 
        class="
          copy-code-button
          tw-select-none
          tw-mx-2 
          tw-hidden
          group-[.is-open]:tw-block
          hover:tw-text-fgColor-link 
          print:!tw-hidden"
        title="Copy code">
          <span class="copy-icon tw-block"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M433.941 65.941l-51.882-51.882A48 48 0 0 0 348.118 0H176c-26.51 0-48 21.49-48 48v48H48c-26.51 0-48 21.49-48 48v320c0 26.51 21.49 48 48 48h224c26.51 0 48-21.49 48-48v-48h80c26.51 0 48-21.49 48-48V99.882a48 48 0 0 0-14.059-33.941zM266 464H54a6 6 0 0 1-6-6V150a6 6 0 0 1 6-6h74v224c0 26.51 21.49 48 48 48h96v42a6 6 0 0 1-6 6zm128-96H182a6 6 0 0 1-6-6V54a6 6 0 0 1 6-6h106v88c0 13.255 10.745 24 24 24h88v202a6 6 0 0 1-6 6zm6-256h-64V48h9.632c1.591 0 3.117.632 4.243 1.757l48.368 48.368a6 6 0 0 1 1.757 4.243V112z"/></svg></span>
          <span class="check-icon tw-hidden"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M173.898 439.404l-166.4-166.4c-9.997-9.997-9.997-26.206 0-36.204l36.203-36.204c9.997-9.998 26.207-9.998 36.204 0L192 312.69 432.095 72.596c9.997-9.997 26.207-9.997 36.204 0l36.203 36.204c9.997 9.997 9.997 26.206 0 36.204l-294.4 294.401c-9.998 9.997-26.207 9.997-36.204-.001z"/></svg></span>
      </button>
        
      <button 
        class="
          tw-select-none 
          tw-mx-2 
          tw-block 
          group-[.is-open]:tw-hidden 
          print:!tw-hidden" 
        disabled
        aria-hidden="true"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M328 256c0 39.8-32.2 72-72 72s-72-32.2-72-72 32.2-72 72-72 72 32.2 72 72zm104-72c-39.8 0-72 32.2-72 72s32.2 72 72 72 72-32.2 72-72-32.2-72-72-72zm-352 0c-39.8 0-72 32.2-72 72s32.2 72 72 72 72-32.2 72-72-32.2-72-72-72z"/></svg></button>
    </div>
  </div>
  <pre style="counter-reset: codeblock;" class="tw-block tw-m-0 tw-p-0"><code 
    id="codeblock-id-2" 
    class="
      chroma 
      !tw-block 
      tw-p-0
      tw-m-0
      tw-transition-[max-height] 
      tw-duration-500 
      tw-ease-in-out 
      group-[.is-closed]:!tw-max-h-0 
      group-[.is-wrap]:tw-text-wrap
      tw-overflow-y-hidden
      tw-overflow-x-auto
      tw-scrollbar-thin
      "><span class="line"><span class="cl">/usr/sbin/capinfos
</span></span><span class="line"><span class="cl">/usr/sbin/dftest
</span></span><span class="line"><span class="cl">/usr/sbin/dumpcap
</span></span><span class="line"><span class="cl">/usr/sbin/editcap
</span></span><span class="line"><span class="cl">/usr/sbin/mergecap
</span></span><span class="line"><span class="cl">/usr/sbin/randpkt
</span></span><span class="line"><span class="cl">/usr/sbin/rawshark
</span></span><span class="line"><span class="cl">/usr/sbin/reordercap
</span></span><span class="line"><span class="cl">/usr/sbin/text2pcap
</span></span><span class="line"><span class="cl">/usr/sbin/tshark</span></span></code></pre>
</div>
<h2 id="net_write_timeout-报错" class="headerLink">
    <a href="#net_write_timeout-%e6%8a%a5%e9%94%99" class="header-mark"></a>net_write_timeout 报错</h2><p>最后回答一下<a href="https://t.zsxq.com/0ftY9WNVv" target="_blank" rel="noopener noreferrer">上一篇</a>中提到的流模式下 net_write_timeout 报错</p>
<p>如下图，JDBC 在 streaming 模式下，不断读取下一行，如果这个过程只要报错抛出的异常就是 StreamingNotifiable 异常</p>
<p><img class="tw-inline" loading="lazy" src=https://cdn.jsdelivr.net/gh/plantegg/plantegg.github.io/images/951413iMgBlog/image-20230620173111706.png   alt="image-20230620173111706"  ></p>
<p>错误信息定义如下，这个报错误导太严重，从以上JDBC 代码可以看到只要读取下一行报错了就会报调大 net_write_timeout 错误，但是实际原因却是连接异常断开，和 timeout 没有一点关系，你看久经考验的 JDBC  代码也不是那么完善还得你会 Debug</p>
<div class="code-block highlight is-open show-line-numbers  tw-group tw-my-2">
  <div class="
    code-block-title 
    
    tw-flex 
    tw-flex-row 
    tw-justify-between 
    tw-w-full tw-bg-bgColor-secondary
    ">      
    <button 
      class="
        tw-select-none 
        tw-mx-2 
        tw-block
        group-[.is-open]:tw-rotate-90
        tw-transition-[transform] 
        tw-duration-500 
        tw-ease-in-out
        print:!tw-hidden"
      disabled
      aria-hidden="true"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M285.476 272.971L91.132 467.314c-9.373 9.373-24.569 9.373-33.941 0l-22.667-22.667c-9.357-9.357-9.375-24.522-.04-33.901L188.505 256 34.484 101.255c-9.335-9.379-9.317-24.544.04-33.901l22.667-22.667c9.373-9.373 24.569-9.373 33.941 0L285.475 239.03c9.373 9.372 9.373 24.568.001 33.941z"/></svg></button>

    <div class="code-block-title-bar tw-w-full">
      <p class="tw-select-none !tw-my-1">text</p>
    </div>
    <div class="tw-flex">
      <button 
        class="
          line-number-button
          tw-select-none 
          tw-mx-2 
          tw-hidden 
          group-[.is-open]:tw-block 
          group-[.show-line-numbers]:tw-text-fgColor-link 
          print:!tw-hidden" 
        title="Toggle line numbers"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M61.77 401l17.5-20.15a19.92 19.92 0 0 0 5.07-14.19v-3.31C84.34 356 80.5 352 73 352H16a8 8 0 0 0-8 8v16a8 8 0 0 0 8 8h22.83a157.41 157.41 0 0 0-11 12.31l-5.61 7c-4 5.07-5.25 10.13-2.8 14.88l1.05 1.93c3 5.76 6.29 7.88 12.25 7.88h4.73c10.33 0 15.94 2.44 15.94 9.09 0 4.72-4.2 8.22-14.36 8.22a41.54 41.54 0 0 1-15.47-3.12c-6.49-3.88-11.74-3.5-15.6 3.12l-5.59 9.31c-3.72 6.13-3.19 11.72 2.63 15.94 7.71 4.69 20.38 9.44 37 9.44 34.16 0 48.5-22.75 48.5-44.12-.03-14.38-9.12-29.76-28.73-34.88zM496 224H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zm0-160H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16V80a16 16 0 0 0-16-16zm0 320H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zM16 160h64a8 8 0 0 0 8-8v-16a8 8 0 0 0-8-8H64V40a8 8 0 0 0-8-8H32a8 8 0 0 0-7.14 4.42l-8 16A8 8 0 0 0 24 64h8v64H16a8 8 0 0 0-8 8v16a8 8 0 0 0 8 8zm-3.91 160H80a8 8 0 0 0 8-8v-16a8 8 0 0 0-8-8H41.32c3.29-10.29 48.34-18.68 48.34-56.44 0-29.06-25-39.56-44.47-39.56-21.36 0-33.8 10-40.46 18.75-4.37 5.59-3 10.84 2.8 15.37l8.58 6.88c5.61 4.56 11 2.47 16.12-2.44a13.44 13.44 0 0 1 9.46-3.84c3.33 0 9.28 1.56 9.28 8.75C51 248.19 0 257.31 0 304.59v4C0 316 5.08 320 12.09 320z"/></svg></button>

      <button 
        class="
          wrap-code-button
          tw-select-none 
          tw-mx-2 
          tw-hidden 
          group-[.is-open]:tw-block 
          group-[.is-wrap]:tw-text-fgColor-link 
          print:!tw-hidden" 
        title="Toggle code wrap"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M16 132h416c8.837 0 16-7.163 16-16V76c0-8.837-7.163-16-16-16H16C7.163 60 0 67.163 0 76v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16z"/></svg></button>
      
      <button 
        class="
          copy-code-button
          tw-select-none
          tw-mx-2 
          tw-hidden
          group-[.is-open]:tw-block
          hover:tw-text-fgColor-link 
          print:!tw-hidden"
        title="Copy code">
          <span class="copy-icon tw-block"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M433.941 65.941l-51.882-51.882A48 48 0 0 0 348.118 0H176c-26.51 0-48 21.49-48 48v48H48c-26.51 0-48 21.49-48 48v320c0 26.51 21.49 48 48 48h224c26.51 0 48-21.49 48-48v-48h80c26.51 0 48-21.49 48-48V99.882a48 48 0 0 0-14.059-33.941zM266 464H54a6 6 0 0 1-6-6V150a6 6 0 0 1 6-6h74v224c0 26.51 21.49 48 48 48h96v42a6 6 0 0 1-6 6zm128-96H182a6 6 0 0 1-6-6V54a6 6 0 0 1 6-6h106v88c0 13.255 10.745 24 24 24h88v202a6 6 0 0 1-6 6zm6-256h-64V48h9.632c1.591 0 3.117.632 4.243 1.757l48.368 48.368a6 6 0 0 1 1.757 4.243V112z"/></svg></span>
          <span class="check-icon tw-hidden"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M173.898 439.404l-166.4-166.4c-9.997-9.997-9.997-26.206 0-36.204l36.203-36.204c9.997-9.998 26.207-9.998 36.204 0L192 312.69 432.095 72.596c9.997-9.997 26.207-9.997 36.204 0l36.203 36.204c9.997 9.997 9.997 26.206 0 36.204l-294.4 294.401c-9.998 9.997-26.207 9.997-36.204-.001z"/></svg></span>
      </button>
        
      <button 
        class="
          tw-select-none 
          tw-mx-2 
          tw-block 
          group-[.is-open]:tw-hidden 
          print:!tw-hidden" 
        disabled
        aria-hidden="true"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M328 256c0 39.8-32.2 72-72 72s-72-32.2-72-72 32.2-72 72-72 72 32.2 72 72zm104-72c-39.8 0-72 32.2-72 72s32.2 72 72 72 72-32.2 72-72-32.2-72-72-72zm-352 0c-39.8 0-72 32.2-72 72s32.2 72 72 72 72-32.2 72-72-32.2-72-72-72z"/></svg></button>
    </div>
  </div>
  <pre style="counter-reset: codeblock;" class="tw-block tw-m-0 tw-p-0"><code 
    id="codeblock-id-3" 
    class="
      chroma 
      !tw-block 
      tw-p-0
      tw-m-0
      tw-transition-[max-height] 
      tw-duration-500 
      tw-ease-in-out 
      group-[.is-closed]:!tw-max-h-0 
      group-[.is-wrap]:tw-text-wrap
      tw-overflow-y-hidden
      tw-overflow-x-auto
      tw-scrollbar-thin
      "><span class="line"><span class="cl">CommunicationsException.ClientWasStreaming=Application was streaming results when the connection failed. Consider raising value of &#39;&#39;net_write_timeout&#39;&#39; on the server.</span></span></code></pre>
</div>
<p>这个报错误导了排查分析方向，不知道坑了多少人了！当然如果MySQL 因为net_write_timeout 超时断开连接当然应该报如上错误，但是 JDBC 搞不清楚MySQL 为啥断开，就瞎猜是 timeout 了，然后只要是连接异常读数据错误(包含断开)就报这个错误。希望你们不要被坑</p>
<p>记住这个坑人的报错堆栈：</p>
<div class="code-block highlight is-open show-line-numbers  tw-group tw-my-2">
  <div class="
    code-block-title 
    
    tw-flex 
    tw-flex-row 
    tw-justify-between 
    tw-w-full tw-bg-bgColor-secondary
    ">      
    <button 
      class="
        tw-select-none 
        tw-mx-2 
        tw-block
        group-[.is-open]:tw-rotate-90
        tw-transition-[transform] 
        tw-duration-500 
        tw-ease-in-out
        print:!tw-hidden"
      disabled
      aria-hidden="true"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M285.476 272.971L91.132 467.314c-9.373 9.373-24.569 9.373-33.941 0l-22.667-22.667c-9.357-9.357-9.375-24.522-.04-33.901L188.505 256 34.484 101.255c-9.335-9.379-9.317-24.544.04-33.901l22.667-22.667c9.373-9.373 24.569-9.373 33.941 0L285.475 239.03c9.373 9.372 9.373 24.568.001 33.941z"/></svg></button>

    <div class="code-block-title-bar tw-w-full">
      <p class="tw-select-none !tw-my-1">text</p>
    </div>
    <div class="tw-flex">
      <button 
        class="
          line-number-button
          tw-select-none 
          tw-mx-2 
          tw-hidden 
          group-[.is-open]:tw-block 
          group-[.show-line-numbers]:tw-text-fgColor-link 
          print:!tw-hidden" 
        title="Toggle line numbers"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M61.77 401l17.5-20.15a19.92 19.92 0 0 0 5.07-14.19v-3.31C84.34 356 80.5 352 73 352H16a8 8 0 0 0-8 8v16a8 8 0 0 0 8 8h22.83a157.41 157.41 0 0 0-11 12.31l-5.61 7c-4 5.07-5.25 10.13-2.8 14.88l1.05 1.93c3 5.76 6.29 7.88 12.25 7.88h4.73c10.33 0 15.94 2.44 15.94 9.09 0 4.72-4.2 8.22-14.36 8.22a41.54 41.54 0 0 1-15.47-3.12c-6.49-3.88-11.74-3.5-15.6 3.12l-5.59 9.31c-3.72 6.13-3.19 11.72 2.63 15.94 7.71 4.69 20.38 9.44 37 9.44 34.16 0 48.5-22.75 48.5-44.12-.03-14.38-9.12-29.76-28.73-34.88zM496 224H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zm0-160H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16V80a16 16 0 0 0-16-16zm0 320H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zM16 160h64a8 8 0 0 0 8-8v-16a8 8 0 0 0-8-8H64V40a8 8 0 0 0-8-8H32a8 8 0 0 0-7.14 4.42l-8 16A8 8 0 0 0 24 64h8v64H16a8 8 0 0 0-8 8v16a8 8 0 0 0 8 8zm-3.91 160H80a8 8 0 0 0 8-8v-16a8 8 0 0 0-8-8H41.32c3.29-10.29 48.34-18.68 48.34-56.44 0-29.06-25-39.56-44.47-39.56-21.36 0-33.8 10-40.46 18.75-4.37 5.59-3 10.84 2.8 15.37l8.58 6.88c5.61 4.56 11 2.47 16.12-2.44a13.44 13.44 0 0 1 9.46-3.84c3.33 0 9.28 1.56 9.28 8.75C51 248.19 0 257.31 0 304.59v4C0 316 5.08 320 12.09 320z"/></svg></button>

      <button 
        class="
          wrap-code-button
          tw-select-none 
          tw-mx-2 
          tw-hidden 
          group-[.is-open]:tw-block 
          group-[.is-wrap]:tw-text-fgColor-link 
          print:!tw-hidden" 
        title="Toggle code wrap"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M16 132h416c8.837 0 16-7.163 16-16V76c0-8.837-7.163-16-16-16H16C7.163 60 0 67.163 0 76v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16z"/></svg></button>
      
      <button 
        class="
          copy-code-button
          tw-select-none
          tw-mx-2 
          tw-hidden
          group-[.is-open]:tw-block
          hover:tw-text-fgColor-link 
          print:!tw-hidden"
        title="Copy code">
          <span class="copy-icon tw-block"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M433.941 65.941l-51.882-51.882A48 48 0 0 0 348.118 0H176c-26.51 0-48 21.49-48 48v48H48c-26.51 0-48 21.49-48 48v320c0 26.51 21.49 48 48 48h224c26.51 0 48-21.49 48-48v-48h80c26.51 0 48-21.49 48-48V99.882a48 48 0 0 0-14.059-33.941zM266 464H54a6 6 0 0 1-6-6V150a6 6 0 0 1 6-6h74v224c0 26.51 21.49 48 48 48h96v42a6 6 0 0 1-6 6zm128-96H182a6 6 0 0 1-6-6V54a6 6 0 0 1 6-6h106v88c0 13.255 10.745 24 24 24h88v202a6 6 0 0 1-6 6zm6-256h-64V48h9.632c1.591 0 3.117.632 4.243 1.757l48.368 48.368a6 6 0 0 1 1.757 4.243V112z"/></svg></span>
          <span class="check-icon tw-hidden"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M173.898 439.404l-166.4-166.4c-9.997-9.997-9.997-26.206 0-36.204l36.203-36.204c9.997-9.998 26.207-9.998 36.204 0L192 312.69 432.095 72.596c9.997-9.997 26.207-9.997 36.204 0l36.203 36.204c9.997 9.997 9.997 26.206 0 36.204l-294.4 294.401c-9.998 9.997-26.207 9.997-36.204-.001z"/></svg></span>
      </button>
        
      <button 
        class="
          tw-select-none 
          tw-mx-2 
          tw-block 
          group-[.is-open]:tw-hidden 
          print:!tw-hidden" 
        disabled
        aria-hidden="true"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M328 256c0 39.8-32.2 72-72 72s-72-32.2-72-72 32.2-72 72-72 72 32.2 72 72zm104-72c-39.8 0-72 32.2-72 72s32.2 72 72 72 72-32.2 72-72-32.2-72-72-72zm-352 0c-39.8 0-72 32.2-72 72s32.2 72 72 72 72-32.2 72-72-32.2-72-72-72z"/></svg></button>
    </div>
  </div>
  <pre style="counter-reset: codeblock;" class="tw-block tw-m-0 tw-p-0"><code 
    id="codeblock-id-4" 
    class="
      chroma 
      !tw-block 
      tw-p-0
      tw-m-0
      tw-transition-[max-height] 
      tw-duration-500 
      tw-ease-in-out 
      group-[.is-closed]:!tw-max-h-0 
      group-[.is-wrap]:tw-text-wrap
      tw-overflow-y-hidden
      tw-overflow-x-auto
      tw-scrollbar-thin
      "><span class="line"><span class="cl">Caused by: com.mysql.jdbc.exceptions.jdbc4.CommunicationsException: Application was streaming results when the connection failed. Consider raising value of &#39;net_write_timeout&#39; on the server.
</span></span><span class="line"><span class="cl">    at sun.reflect.GeneratedConstructorAccessor150.newInstance(Unknown Source)
</span></span><span class="line"><span class="cl">    at sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:45)
</span></span><span class="line"><span class="cl">    at java.lang.reflect.Constructor.newInstance(Constructor.java:423)
</span></span><span class="line"><span class="cl">    at com.mysql.jdbc.Util.handleNewInstance(Util.java:425)
</span></span><span class="line"><span class="cl">    at com.mysql.jdbc.SQLError.createCommunicationsException(SQLError.java:989)
</span></span><span class="line"><span class="cl">    at com.mysql.jdbc.MysqlIO.reuseAndReadPacket(MysqlIO.java:3749)
</span></span><span class="line"><span class="cl">    at com.mysql.jdbc.MysqlIO.reuseAndReadPacket(MysqlIO.java:3649)
</span></span><span class="line"><span class="cl">    at com.mysql.jdbc.MysqlIO.checkErrorPacket(MysqlIO.java:4090)
</span></span><span class="line"><span class="cl">    at com.mysql.jdbc.MysqlIO.checkErrorPacket(MysqlIO.java:972)
</span></span><span class="line"><span class="cl">    at com.mysql.jdbc.MysqlIO.nextRow(MysqlIO.java:2123)
</span></span><span class="line"><span class="cl">    at com.mysql.jdbc.RowDataDynamic.nextRecord(RowDataDynamic.java:374)
</span></span><span class="line"><span class="cl">    at com.mysql.jdbc.RowDataDynamic.next(RowDataDynamic.java:354)
</span></span><span class="line"><span class="cl">    at com.mysql.jdbc.RowDataDynamic.close(RowDataDynamic.java:155)
</span></span><span class="line"><span class="cl">    at com.mysql.jdbc.ResultSetImpl.realClose(ResultSetImpl.java:6726)
</span></span><span class="line"><span class="cl">    at com.mysql.jdbc.ResultSetImpl.close(ResultSetImpl.java:865)
</span></span><span class="line"><span class="cl">    at com.alibaba.druid.pool.DruidPooledResultSet.close(DruidPooledResultSet.java:86)</span></span></code></pre>
</div>
<p>不过你要仔细看的话，它还是有caused by，如下，但是绝大部分工程师看到这个堆栈会忽视，上面都有 net_write_timeout 我还管个屁 Can not read response from server, 不过要是结合抓包的话就能理解：at com.mysql.jdbc.MysqlIO.readFully(MysqlIO.java:3186) 这个根本的原因是 JDBC 从服务端读取数据的时候报错了</p>
<div class="code-block highlight is-open show-line-numbers  tw-group tw-my-2">
  <div class="
    code-block-title 
    
    tw-flex 
    tw-flex-row 
    tw-justify-between 
    tw-w-full tw-bg-bgColor-secondary
    ">      
    <button 
      class="
        tw-select-none 
        tw-mx-2 
        tw-block
        group-[.is-open]:tw-rotate-90
        tw-transition-[transform] 
        tw-duration-500 
        tw-ease-in-out
        print:!tw-hidden"
      disabled
      aria-hidden="true"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M285.476 272.971L91.132 467.314c-9.373 9.373-24.569 9.373-33.941 0l-22.667-22.667c-9.357-9.357-9.375-24.522-.04-33.901L188.505 256 34.484 101.255c-9.335-9.379-9.317-24.544.04-33.901l22.667-22.667c9.373-9.373 24.569-9.373 33.941 0L285.475 239.03c9.373 9.372 9.373 24.568.001 33.941z"/></svg></button>

    <div class="code-block-title-bar tw-w-full">
      <p class="tw-select-none !tw-my-1">text</p>
    </div>
    <div class="tw-flex">
      <button 
        class="
          line-number-button
          tw-select-none 
          tw-mx-2 
          tw-hidden 
          group-[.is-open]:tw-block 
          group-[.show-line-numbers]:tw-text-fgColor-link 
          print:!tw-hidden" 
        title="Toggle line numbers"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M61.77 401l17.5-20.15a19.92 19.92 0 0 0 5.07-14.19v-3.31C84.34 356 80.5 352 73 352H16a8 8 0 0 0-8 8v16a8 8 0 0 0 8 8h22.83a157.41 157.41 0 0 0-11 12.31l-5.61 7c-4 5.07-5.25 10.13-2.8 14.88l1.05 1.93c3 5.76 6.29 7.88 12.25 7.88h4.73c10.33 0 15.94 2.44 15.94 9.09 0 4.72-4.2 8.22-14.36 8.22a41.54 41.54 0 0 1-15.47-3.12c-6.49-3.88-11.74-3.5-15.6 3.12l-5.59 9.31c-3.72 6.13-3.19 11.72 2.63 15.94 7.71 4.69 20.38 9.44 37 9.44 34.16 0 48.5-22.75 48.5-44.12-.03-14.38-9.12-29.76-28.73-34.88zM496 224H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zm0-160H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16V80a16 16 0 0 0-16-16zm0 320H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zM16 160h64a8 8 0 0 0 8-8v-16a8 8 0 0 0-8-8H64V40a8 8 0 0 0-8-8H32a8 8 0 0 0-7.14 4.42l-8 16A8 8 0 0 0 24 64h8v64H16a8 8 0 0 0-8 8v16a8 8 0 0 0 8 8zm-3.91 160H80a8 8 0 0 0 8-8v-16a8 8 0 0 0-8-8H41.32c3.29-10.29 48.34-18.68 48.34-56.44 0-29.06-25-39.56-44.47-39.56-21.36 0-33.8 10-40.46 18.75-4.37 5.59-3 10.84 2.8 15.37l8.58 6.88c5.61 4.56 11 2.47 16.12-2.44a13.44 13.44 0 0 1 9.46-3.84c3.33 0 9.28 1.56 9.28 8.75C51 248.19 0 257.31 0 304.59v4C0 316 5.08 320 12.09 320z"/></svg></button>

      <button 
        class="
          wrap-code-button
          tw-select-none 
          tw-mx-2 
          tw-hidden 
          group-[.is-open]:tw-block 
          group-[.is-wrap]:tw-text-fgColor-link 
          print:!tw-hidden" 
        title="Toggle code wrap"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M16 132h416c8.837 0 16-7.163 16-16V76c0-8.837-7.163-16-16-16H16C7.163 60 0 67.163 0 76v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16z"/></svg></button>
      
      <button 
        class="
          copy-code-button
          tw-select-none
          tw-mx-2 
          tw-hidden
          group-[.is-open]:tw-block
          hover:tw-text-fgColor-link 
          print:!tw-hidden"
        title="Copy code">
          <span class="copy-icon tw-block"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M433.941 65.941l-51.882-51.882A48 48 0 0 0 348.118 0H176c-26.51 0-48 21.49-48 48v48H48c-26.51 0-48 21.49-48 48v320c0 26.51 21.49 48 48 48h224c26.51 0 48-21.49 48-48v-48h80c26.51 0 48-21.49 48-48V99.882a48 48 0 0 0-14.059-33.941zM266 464H54a6 6 0 0 1-6-6V150a6 6 0 0 1 6-6h74v224c0 26.51 21.49 48 48 48h96v42a6 6 0 0 1-6 6zm128-96H182a6 6 0 0 1-6-6V54a6 6 0 0 1 6-6h106v88c0 13.255 10.745 24 24 24h88v202a6 6 0 0 1-6 6zm6-256h-64V48h9.632c1.591 0 3.117.632 4.243 1.757l48.368 48.368a6 6 0 0 1 1.757 4.243V112z"/></svg></span>
          <span class="check-icon tw-hidden"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M173.898 439.404l-166.4-166.4c-9.997-9.997-9.997-26.206 0-36.204l36.203-36.204c9.997-9.998 26.207-9.998 36.204 0L192 312.69 432.095 72.596c9.997-9.997 26.207-9.997 36.204 0l36.203 36.204c9.997 9.997 9.997 26.206 0 36.204l-294.4 294.401c-9.998 9.997-26.207 9.997-36.204-.001z"/></svg></span>
      </button>
        
      <button 
        class="
          tw-select-none 
          tw-mx-2 
          tw-block 
          group-[.is-open]:tw-hidden 
          print:!tw-hidden" 
        disabled
        aria-hidden="true"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M328 256c0 39.8-32.2 72-72 72s-72-32.2-72-72 32.2-72 72-72 72 32.2 72 72zm104-72c-39.8 0-72 32.2-72 72s32.2 72 72 72 72-32.2 72-72-32.2-72-72-72zm-352 0c-39.8 0-72 32.2-72 72s32.2 72 72 72 72-32.2 72-72-32.2-72-72-72z"/></svg></button>
    </div>
  </div>
  <pre style="counter-reset: codeblock;" class="tw-block tw-m-0 tw-p-0"><code 
    id="codeblock-id-5" 
    class="
      chroma 
      !tw-block 
      tw-p-0
      tw-m-0
      tw-transition-[max-height] 
      tw-duration-500 
      tw-ease-in-out 
      group-[.is-closed]:!tw-max-h-0 
      group-[.is-wrap]:tw-text-wrap
      tw-overflow-y-hidden
      tw-overflow-x-auto
      tw-scrollbar-thin
      "><span class="line"><span class="cl">Caused by: java.io.EOFException: Can not read response from server. Expected to read 405 bytes, read 272 bytes before connection was unexpectedly lost.
</span></span><span class="line"><span class="cl">    at com.mysql.jdbc.MysqlIO.readFully(MysqlIO.java:3186)
</span></span><span class="line"><span class="cl">    at com.mysql.jdbc.MysqlIO.reuseAndReadPacket(MysqlIO.java:3709)
</span></span><span class="line"><span class="cl">    ... 40 common frames omitted</span></span></code></pre>
</div>
<p>最后希望你没被绕晕，再去看看<a href="https://t.zsxq.com/0ftY9WNVv" target="_blank" rel="noopener noreferrer">上一篇</a>中推荐的流模式原理，把代码和网络应用层完美地结合起来</p>
<p>完整堆栈也可以参考网络上别人碰到的：https://github.com/brettwooldridge/HikariCP/issues/1771</p>
<p>看 Google 里面对这个问题的分析基本都没入门：https://www.google.com/search?q=Caused+by%3A+com.mysql.jdbc.exceptions.jdbc4.CommunicationsException%3A+Application+was+streaming+results+when+the+connection+failed.+Consider+raising+value+of+%27net_write_timeout%27+on+the+server.&amp;hl=en&amp;sxsrf=APwXEddTwJGjFpkKuWHyXjlTvwTo2OUMhA%3A1687226872136&amp;ei=-AmRZI7gB6-C0PEPmOGbwAE&amp;ved=0ahUKEwiOvPny4dD_AhUvATQIHZjwBhgQ4dUDCBE&amp;uact=5&amp;oq=Caused+by%3A+com.mysql.jdbc.exceptions.jdbc4.CommunicationsException%3A+Application+was+streaming+results+when+the+connection+failed.+Consider+raising+value+of+%27net_write_timeout%27+on+the+server.&amp;gs_lcp=Cgxnd3Mtd2l6LXNlcnAQA0oECEEYAFAAWABgAGgAcAF4AIABAIgBAJIBAJgBAKABAqABAQ&amp;sclient=gws-wiz-serp</p>
<p>下次在你们的业务代码里如果出现查询结果太大导致JVM OOM的话你可以站出来说把拉取数据改成 流 模式会有奇效 :) , 当然随之而来的是会有 net_write_timeout 报错，嗯，你的机会来了，业务技术上按照你的指引发展，出了问题你能顶得上</p>
]]></description>
</item><item>
    <title>网络抓包常用命令</title>
    <link>http://localhost:1313/posts/%E7%BD%91%E7%BB%9C%E6%8A%93%E5%8C%85%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/</link>
    <pubDate>Sat, 01 Jan 2022 14:30:03 &#43;0000</pubDate><author>
        <name>作者</name>
    </author><guid>http://localhost:1313/posts/%E7%BD%91%E7%BB%9C%E6%8A%93%E5%8C%85%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/</guid>
    <description><![CDATA[<h1 id="网络抓包常用命令" class="headerLink">
    <a href="#%e7%bd%91%e7%bb%9c%e6%8a%93%e5%8c%85%e5%b8%b8%e7%94%a8%e5%91%bd%e4%bb%a4" class="header-mark"></a>网络抓包常用命令</h1><p>详细解析和Demo版本：<a href="https://plantegg.github.io/2019/06/21/%e5%b0%b1%e6%98%af%e8%a6%81%e4%bd%a0%e6%87%82%e6%8a%93%e5%8c%85--WireShark%e4%b9%8b%e5%91%bd%e4%bb%a4%e8%a1%8c%e7%89%88tshark/" target="_blank" rel="noopener noreferrer">就是要你懂抓包&ndash;WireShark之命令行版tshark</a></p>
<div class="code-block highlight is-closed show-line-numbers  tw-group tw-my-2">
  <div class="
    code-block-title 
    
    tw-flex 
    tw-flex-row 
    tw-justify-between 
    tw-w-full tw-bg-bgColor-secondary
    ">      
    <button 
      class="
        tw-select-none 
        tw-mx-2 
        tw-block
        group-[.is-open]:tw-rotate-90
        tw-transition-[transform] 
        tw-duration-500 
        tw-ease-in-out
        print:!tw-hidden"
      disabled
      aria-hidden="true"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M285.476 272.971L91.132 467.314c-9.373 9.373-24.569 9.373-33.941 0l-22.667-22.667c-9.357-9.357-9.375-24.522-.04-33.901L188.505 256 34.484 101.255c-9.335-9.379-9.317-24.544.04-33.901l22.667-22.667c9.373-9.373 24.569-9.373 33.941 0L285.475 239.03c9.373 9.372 9.373 24.568.001 33.941z"/></svg></button>

    <div class="code-block-title-bar tw-w-full">
      <p class="tw-select-none !tw-my-1">shell</p>
    </div>
    <div class="tw-flex">
      <button 
        class="
          line-number-button
          tw-select-none 
          tw-mx-2 
          tw-hidden 
          group-[.is-open]:tw-block 
          group-[.show-line-numbers]:tw-text-fgColor-link 
          print:!tw-hidden" 
        title="Toggle line numbers"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M61.77 401l17.5-20.15a19.92 19.92 0 0 0 5.07-14.19v-3.31C84.34 356 80.5 352 73 352H16a8 8 0 0 0-8 8v16a8 8 0 0 0 8 8h22.83a157.41 157.41 0 0 0-11 12.31l-5.61 7c-4 5.07-5.25 10.13-2.8 14.88l1.05 1.93c3 5.76 6.29 7.88 12.25 7.88h4.73c10.33 0 15.94 2.44 15.94 9.09 0 4.72-4.2 8.22-14.36 8.22a41.54 41.54 0 0 1-15.47-3.12c-6.49-3.88-11.74-3.5-15.6 3.12l-5.59 9.31c-3.72 6.13-3.19 11.72 2.63 15.94 7.71 4.69 20.38 9.44 37 9.44 34.16 0 48.5-22.75 48.5-44.12-.03-14.38-9.12-29.76-28.73-34.88zM496 224H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zm0-160H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16V80a16 16 0 0 0-16-16zm0 320H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zM16 160h64a8 8 0 0 0 8-8v-16a8 8 0 0 0-8-8H64V40a8 8 0 0 0-8-8H32a8 8 0 0 0-7.14 4.42l-8 16A8 8 0 0 0 24 64h8v64H16a8 8 0 0 0-8 8v16a8 8 0 0 0 8 8zm-3.91 160H80a8 8 0 0 0 8-8v-16a8 8 0 0 0-8-8H41.32c3.29-10.29 48.34-18.68 48.34-56.44 0-29.06-25-39.56-44.47-39.56-21.36 0-33.8 10-40.46 18.75-4.37 5.59-3 10.84 2.8 15.37l8.58 6.88c5.61 4.56 11 2.47 16.12-2.44a13.44 13.44 0 0 1 9.46-3.84c3.33 0 9.28 1.56 9.28 8.75C51 248.19 0 257.31 0 304.59v4C0 316 5.08 320 12.09 320z"/></svg></button>

      <button 
        class="
          wrap-code-button
          tw-select-none 
          tw-mx-2 
          tw-hidden 
          group-[.is-open]:tw-block 
          group-[.is-wrap]:tw-text-fgColor-link 
          print:!tw-hidden" 
        title="Toggle code wrap"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M16 132h416c8.837 0 16-7.163 16-16V76c0-8.837-7.163-16-16-16H16C7.163 60 0 67.163 0 76v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16z"/></svg></button>
      
      <button 
        class="
          copy-code-button
          tw-select-none
          tw-mx-2 
          tw-hidden
          group-[.is-open]:tw-block
          hover:tw-text-fgColor-link 
          print:!tw-hidden"
        title="Copy code">
          <span class="copy-icon tw-block"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M433.941 65.941l-51.882-51.882A48 48 0 0 0 348.118 0H176c-26.51 0-48 21.49-48 48v48H48c-26.51 0-48 21.49-48 48v320c0 26.51 21.49 48 48 48h224c26.51 0 48-21.49 48-48v-48h80c26.51 0 48-21.49 48-48V99.882a48 48 0 0 0-14.059-33.941zM266 464H54a6 6 0 0 1-6-6V150a6 6 0 0 1 6-6h74v224c0 26.51 21.49 48 48 48h96v42a6 6 0 0 1-6 6zm128-96H182a6 6 0 0 1-6-6V54a6 6 0 0 1 6-6h106v88c0 13.255 10.745 24 24 24h88v202a6 6 0 0 1-6 6zm6-256h-64V48h9.632c1.591 0 3.117.632 4.243 1.757l48.368 48.368a6 6 0 0 1 1.757 4.243V112z"/></svg></span>
          <span class="check-icon tw-hidden"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M173.898 439.404l-166.4-166.4c-9.997-9.997-9.997-26.206 0-36.204l36.203-36.204c9.997-9.998 26.207-9.998 36.204 0L192 312.69 432.095 72.596c9.997-9.997 26.207-9.997 36.204 0l36.203 36.204c9.997 9.997 9.997 26.206 0 36.204l-294.4 294.401c-9.998 9.997-26.207 9.997-36.204-.001z"/></svg></span>
      </button>
        
      <button 
        class="
          tw-select-none 
          tw-mx-2 
          tw-block 
          group-[.is-open]:tw-hidden 
          print:!tw-hidden" 
        disabled
        aria-hidden="true"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M328 256c0 39.8-32.2 72-72 72s-72-32.2-72-72 32.2-72 72-72 72 32.2 72 72zm104-72c-39.8 0-72 32.2-72 72s32.2 72 72 72 72-32.2 72-72-32.2-72-72-72zm-352 0c-39.8 0-72 32.2-72 72s32.2 72 72 72 72-32.2 72-72-32.2-72-72-72z"/></svg></button>
    </div>
  </div>
  <pre style="counter-reset: codeblock;" class="tw-block tw-m-0 tw-p-0"><code 
    id="codeblock-id-1" 
    class="
      chroma 
      !tw-block 
      tw-p-0
      tw-m-0
      tw-transition-[max-height] 
      tw-duration-500 
      tw-ease-in-out 
      group-[.is-closed]:!tw-max-h-0 
      group-[.is-wrap]:tw-text-wrap
      tw-overflow-y-hidden
      tw-overflow-x-auto
      tw-scrollbar-thin
      "><span class="line"><span class="cl">//抓取一个子网范围
</span></span><span class="line"><span class="cl">tcpdump -i bond0 port <span class="m">3001</span> and net 1.2.3.0/24 and host not 1.2.3.211 -nn -X
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">//抓取 DNAT 包，tcp options 里面的 <span class="m">246</span> 代表 DNAT
</span></span><span class="line"><span class="cl">tcpdump -nn –vvv -i eth0 tcp dst port <span class="m">3306</span> and <span class="s1">&#39;(tcp[tcpflags] &amp; (tcp-syn) != 0) and (tcp[20] =246) &#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">//在上面的基础上，抓取指定 vip：10.142.*.*
</span></span><span class="line"><span class="cl">tcpdump -nn –vvv -i eth0 tcp dst port <span class="m">3306</span> and <span class="s1">&#39;(tcp[tcpflags] &amp; (tcp-syn) != 0) and tcp[20]=246 and tcp[24]=10 and tcp[25]=142&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">//抓取 DNAT 包，tcp options 里面的 <span class="m">252</span> 代表 DNAT
</span></span><span class="line"><span class="cl">tcpdump -nn –vvv -i eth0 tcp dst port <span class="m">3306</span> and <span class="s1">&#39;(tcp[tcpflags] &amp; (tcp-ack) != 0) and (tcp[20] =252) &#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">//根据指定的VPC IP抓包，例如172.16.x.x
</span></span><span class="line"><span class="cl">tcpdump -nn –vvv -i eth0 tcp dst port <span class="m">3306</span> and <span class="s1">&#39;(tcp[tcpflags] &amp; (tcp-ack) != 0) and (tcp[32] =172) and (tcp[33] =16)&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">//根据客户端IP抓包FNAT的包，例如172.16.x.x
</span></span><span class="line"><span class="cl">tcpdump -nn –vvv -i eth0 tcp dst port <span class="m">3306</span> and <span class="s1">&#39;(tcp[tcpflags] &amp; (tcp-ack) != 0) and(tcp[20]=252) and (tcp[24]=172) and (tcp[25]=16)&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">用tcpdump抓取并保存包：
</span></span><span class="line"><span class="cl">sudo tcpdump -i eth0 port <span class="m">3306</span> -w plantegg.cap
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">抓到的包存储在plantegg.cap中，可以用作wireshark、tshark详细分析
</span></span><span class="line"><span class="cl">如果明确知道目的ip、端口等可以通过指定条件来明确只抓取某个连接的包
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">只抓本机的8080端口：
</span></span><span class="line"><span class="cl">tcpdump -i eth0 <span class="s1">&#39;(src port 8001 and src host 11.59.10.106) or (dst port 8001 and dst host 11.59.10.106)&#39;</span> -nn -X
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">//http 流量
</span></span><span class="line"><span class="cl">// -f 抓取过滤条件 tcp port <span class="m">80</span> and host 11.59.10.106
</span></span><span class="line"><span class="cl">//-Y 展示过滤条件
</span></span><span class="line"><span class="cl">tshark -i eth0 -f <span class="s1">&#39;(tcp src port 8080 and src host 11.59.10.106) or (tcp dst port 8080 and dst host 11.59.10.106)&#39;</span> -t a  -Y <span class="s2">&#34; (http.request or http.response)&#34;</span> -T fields -e frame.number -e frame.time  -e frame.time_delta_displayed  -e ip.src -e tcp.srcport -e tcp.dstport -e ip.dst -e http.request.full_uri -e http.response.code -e http.response.phrase
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">抓取详细SQL语句：
</span></span><span class="line"><span class="cl">sudo tshark -i eth0 -Y <span class="s2">&#34;mysql.command==3&#34;</span> -T fields -e mysql.query
</span></span><span class="line"><span class="cl">sudo tshark -i eth0 -R mysql.query        -T fields -e mysql.query
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">sudo tshark -i any -f <span class="s1">&#39;port 8527&#39;</span> -s <span class="m">0</span> -l -w - <span class="p">|</span>strings
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#parse 8507/4444 as mysql protocol, default only parse 3306 as mysql.</span>
</span></span><span class="line"><span class="cl">sudo tshark -i eth0 -d tcp.port<span class="o">==</span>8507,mysql -T fields -e mysql.query <span class="s1">&#39;port 8507&#39;</span>
</span></span><span class="line"><span class="cl">sudo tshark -i any -c <span class="m">50</span> -d tcp.port<span class="o">==</span>4444,mysql -Y <span class="s2">&#34; ((tcp.port eq 4444 )  )&#34;</span> -o tcp.calculate_timestamps:true -T fields -e frame.number -e frame.time_epoch  -e frame.time_delta_displayed  -e ip.src -e tcp.srcport -e tcp.dstport -e ip.dst -e tcp.time_delta -e tcp.stream -e tcp.len -e mysql.query
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">sudo tshark -i eth0 -R <span class="s2">&#34;ip.addr==11.163.182.137&#34;</span> -d tcp.port<span class="o">==</span>3306, -T fields -e mysql.query <span class="s1">&#39;port 3306&#39;</span>
</span></span><span class="line"><span class="cl">sudo tshark -i eth0 -R <span class="s2">&#34;tcp.srcport==62877&#34;</span> -d tcp.port<span class="o">==</span>3001,mysql -T fields -e tcp.srcport -e mysql.query <span class="s1">&#39;port 3001&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">//将3307端口解析成MySQL 协议分析
</span></span><span class="line"><span class="cl">tshark -i lo -d tcp.port<span class="o">==</span>3307,mysql -T fields -e frame.number -e frame.time -e frame.time_delta -e tcp.srcport -e tcp.dstport -e tcp.len -e _ws.col.Info -e mysql.query
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">如果MySQL开启了SSL，那么抓包后的内容tshark/wireshark分析不到MySQL的具体内容，可以强制关闭：connectionProperties里加上useSSL<span class="o">=</span><span class="nb">false</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">查看SQL具体内容
</span></span><span class="line"><span class="cl">sudo tshark -r gege_plantegg.cap -Y <span class="s2">&#34;mysql.query or (  tcp.stream==1)&#34;</span> -o tcp.calculate_timestamps:true -T fields -e frame.number -e frame.time_epoch  -e frame.time_delta_displayed  -e ip.src -e tcp.srcport -e tcp.dstport -e ip.dst -e tcp.time_delta -e frame.time_delta_displayed  -e tcp.stream -e tcp.len -e mysql.query 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">按mysql查询分析响应时间
</span></span><span class="line"><span class="cl">对于rt分析，要注意一个query多个response情况（response结果多，分包了），分析这种rt的时候只看query之后的第一个response，其它连续response需要忽略掉。
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">以上抓包结果文件可以用tshark进行详细分析
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">分析MySQL rt，倒数第四列基本就是rt
</span></span><span class="line"><span class="cl">tshark -r gege_plantegg.pcap -Y <span class="s2">&#34; ((tcp.srcport eq 3306 ) and tcp.len&gt;0 )&#34;</span> -o tcp.calculate_timestamps:true -T fields -e frame.number -e frame.time_epoch  -e frame.time_delta_displayed  -e ip.src -e tcp.srcport -e tcp.dstport -e ip.dst -e tcp.time_delta -e tcp.stream -e tcp.len -e tcp.analysis.ack_rtt   
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">或者排序一下
</span></span><span class="line"><span class="cl">tshark -r 213_php.cap -Y <span class="s2">&#34;mysql.query or (  tcp.srcport==3306)&#34;</span> -o tcp.calculate_timestamps:true -T fields -e frame.number -e frame.time_epoch  -e frame.time_delta_displayed  -e ip.src -e tcp.srcport -e tcp.dstport -e ip.dst -e tcp.time_delta -e tcp.stream -e tcp.len -e mysql.query <span class="p">|</span>sort -nk9 -nk1
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">MySQL响应时间直方图【第八列的含义-- Time since previous frame in this TCP stream: seconds】：
</span></span><span class="line"><span class="cl">tshark -r gege_plantegg.pcap -Y <span class="s2">&#34;mysql.query or (tcp.srcport3306 and tcp.len&gt;60)&#34;</span> -o tcp.calculate_timestamps:true -T fields -e frame.number -e frame.time_epoch  -e frame.time_delta_displayed  -e ip.src -e tcp.srcport -e tcp.dstport -e ip.dst -e tcp.time_delta -e tcp.stream -e tcp.len <span class="p">|</span> awk <span class="s1">&#39;BEGIN {sum0=0;sum3=0;sum10=0;sum30=0;sum50=0;sum100=0;sum300=0;sum500=0;sum1000=0;sumo=0;count=0;sum=0} {rt=$8; if(rt&gt;=0.000) sum=sum+rt; count=count+1; if(rt&lt;=0.000) sum0=sum0+1; else if(rt&lt;0.003) sum3=sum3+1 ; else if(rt&lt;0.01) sum10=sum10+1; else if(rt&lt;0.03) sum30=sum30+1; else if(rt&lt;0.05) sum50=sum50+1; else if(rt &lt; 0.1) sum100=sum100+1; else if(rt &lt; 0.3) sum300=sum300+1; else if(rt &lt; 0.5) sum500=sum500+1; else if(rt &lt; 1) sum1000=sum1000+1; else sum=sum+1 ;} END{printf &#34;-------------\n3ms:\t%s \n10ms:\t%s \n30ms:\t%s \n50ms:\t%s \n100ms:\t%s \n300ms:\t%s \n500ms:\t%s \n1000ms:\t%s \n&gt;1s:\t %s\n-------------\navg: %.6f \n&#34; , sum3,sum10,sum30,sum50,sum100,sum300,sum500,sum1000,sumo,sum/count;}&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">按http response分析响应时间
</span></span><span class="line"><span class="cl">tshark -nr 213_php.cap -o tcp.calculate_timestamps:true  -Y <span class="s2">&#34;http.request or http.response&#34;</span> -T fields -e frame.number -e frame.time_epoch  -e frame.time_delta_displayed  -e ip.src -e ip.dst -e tcp.stream  -e http.request.full_uri -e http.response.code -e http.response.phrase <span class="p">|</span> sort -nk6 -nk1
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">分析rtt、丢包、deplicate等等，可以得到整体网络状态
</span></span><span class="line"><span class="cl">$ tshark -r retrans.cap -q -z io,stat,1,<span class="s2">&#34;AVG(tcp.analysis.ack_rtt)tcp.analysis.ack_rtt&#34;</span>,<span class="s2">&#34;COUNT(tcp.analysis.retransmission)  tcp.analysis.retransmission&#34;</span>,<span class="s2">&#34;COUNT(tcp.analysis.fast_retransmission) tcp.analysis.fast_retransmission&#34;</span>,<span class="s2">&#34;COUNT(tcp.analysis.duplicate_ack) tcp.analysis.duplicate_ack&#34;</span>,<span class="s2">&#34;COUNT(tcp.analysis.lost_segment) tcp.analysis.lost_segment&#34;</span>,<span class="s2">&#34;MIN(tcp.window_size)tcp.window_size&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">===================================================================================</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> IO Statistics                                                                   <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span>                                                                                 <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> Duration: 89.892365 secs                                                        <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> Interval:  <span class="m">2</span> secs                                                               <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span>                                                                                 <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> Col 1: AVG<span class="o">(</span>tcp.analysis.ack_rtt<span class="o">)</span>tcp.analysis.ack_rtt                            <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span>     2: COUNT<span class="o">(</span>tcp.analysis.retransmission<span class="o">)</span>  tcp.analysis.retransmission          <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span>     3: COUNT<span class="o">(</span>tcp.analysis.fast_retransmission<span class="o">)</span> tcp.analysis.fast_retransmission <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span>     4: COUNT<span class="o">(</span>tcp.analysis.duplicate_ack<span class="o">)</span> tcp.analysis.duplicate_ack             <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span>     5: COUNT<span class="o">(</span>tcp.analysis.lost_segment<span class="o">)</span> tcp.analysis.lost_segment               <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span>     6: AVG<span class="o">(</span>tcp.window_size<span class="o">)</span>tcp.window_size                                      <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span>---------------------------------------------------------------------------------<span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span>          <span class="p">|</span><span class="m">1</span>         <span class="p">|</span><span class="m">2</span>      <span class="p">|</span><span class="m">3</span>      <span class="p">|</span><span class="m">4</span>      <span class="p">|</span><span class="m">5</span>      <span class="p">|</span><span class="m">6</span>      <span class="p">|</span>                   <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> Interval <span class="p">|</span>    AVG   <span class="p">|</span> COUNT <span class="p">|</span> COUNT <span class="p">|</span> COUNT <span class="p">|</span> COUNT <span class="p">|</span>  AVG  <span class="p">|</span>                   <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span>-------------------------------------------------------------<span class="p">|</span>                   <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span>  <span class="m">0</span> &lt;&gt;  <span class="m">2</span> <span class="p">|</span> 0.001152 <span class="p">|</span>     <span class="m">0</span> <span class="p">|</span>     <span class="m">0</span> <span class="p">|</span>     <span class="m">0</span> <span class="p">|</span>     <span class="m">0</span> <span class="p">|</span>  <span class="m">4206</span> <span class="p">|</span>                   <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span>  <span class="m">2</span> &lt;&gt;  <span class="m">4</span> <span class="p">|</span> 0.002088 <span class="p">|</span>     <span class="m">0</span> <span class="p">|</span>     <span class="m">0</span> <span class="p">|</span>     <span class="m">0</span> <span class="p">|</span>     <span class="m">1</span> <span class="p">|</span>  <span class="m">6931</span> <span class="p">|</span>                   <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span>  <span class="m">4</span> &lt;&gt;  <span class="m">6</span> <span class="p">|</span> 0.001512 <span class="p">|</span>     <span class="m">0</span> <span class="p">|</span>     <span class="m">0</span> <span class="p">|</span>     <span class="m">0</span> <span class="p">|</span>     <span class="m">0</span> <span class="p">|</span>  <span class="m">7099</span> <span class="p">|</span>                   <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span>  <span class="m">6</span> &lt;&gt;  <span class="m">8</span> <span class="p">|</span> 0.002859 <span class="p">|</span>     <span class="m">0</span> <span class="p">|</span>     <span class="m">0</span> <span class="p">|</span>     <span class="m">0</span> <span class="p">|</span>     <span class="m">0</span> <span class="p">|</span>  <span class="m">7171</span> <span class="p">|</span>                   <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span>  <span class="m">8</span> &lt;&gt; <span class="m">10</span> <span class="p">|</span> 0.001716 <span class="p">|</span>     <span class="m">0</span> <span class="p">|</span>     <span class="m">0</span> <span class="p">|</span>     <span class="m">0</span> <span class="p">|</span>     <span class="m">0</span> <span class="p">|</span>  <span class="m">6472</span> <span class="p">|</span>                   <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> <span class="m">10</span> &lt;&gt; <span class="m">12</span> <span class="p">|</span> 0.000319 <span class="p">|</span>     <span class="m">0</span> <span class="p">|</span>     <span class="m">0</span> <span class="p">|</span>     <span class="m">0</span> <span class="p">|</span>     <span class="m">2</span> <span class="p">|</span>  <span class="m">5575</span> <span class="p">|</span>                   <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> <span class="m">12</span> &lt;&gt; <span class="m">14</span> <span class="p">|</span> 0.002030 <span class="p">|</span>     <span class="m">0</span> <span class="p">|</span>     <span class="m">0</span> <span class="p">|</span>     <span class="m">0</span> <span class="p">|</span>     <span class="m">0</span> <span class="p">|</span>  <span class="m">6922</span> <span class="p">|</span>                   <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> <span class="m">14</span> &lt;&gt; <span class="m">16</span> <span class="p">|</span> 0.003371 <span class="p">|</span>     <span class="m">0</span> <span class="p">|</span>     <span class="m">0</span> <span class="p">|</span>     <span class="m">0</span> <span class="p">|</span>     <span class="m">2</span> <span class="p">|</span>  <span class="m">5884</span> <span class="p">|</span>                   <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> <span class="m">16</span> &lt;&gt; <span class="m">18</span> <span class="p">|</span> 0.000138 <span class="p">|</span>     <span class="m">0</span> <span class="p">|</span>     <span class="m">0</span> <span class="p">|</span>     <span class="m">0</span> <span class="p">|</span>     <span class="m">1</span> <span class="p">|</span>  <span class="m">3480</span> <span class="p">|</span>                   <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> <span class="m">18</span> &lt;&gt; <span class="m">20</span> <span class="p">|</span> 0.000999 <span class="p">|</span>     <span class="m">0</span> <span class="p">|</span>     <span class="m">0</span> <span class="p">|</span>     <span class="m">0</span> <span class="p">|</span>     <span class="m">4</span> <span class="p">|</span>  <span class="m">6665</span> <span class="p">|</span>                   <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> <span class="m">20</span> &lt;&gt; <span class="m">22</span> <span class="p">|</span> 0.000682 <span class="p">|</span>     <span class="m">0</span> <span class="p">|</span>     <span class="m">0</span> <span class="p">|</span>    <span class="m">41</span> <span class="p">|</span>     <span class="m">2</span> <span class="p">|</span>  <span class="m">5484</span> <span class="p">|</span>                   <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> <span class="m">22</span> &lt;&gt; <span class="m">24</span> <span class="p">|</span> 0.002302 <span class="p">|</span>     <span class="m">2</span> <span class="p">|</span>     <span class="m">0</span> <span class="p">|</span>    <span class="m">19</span> <span class="p">|</span>     <span class="m">0</span> <span class="p">|</span>  <span class="m">7127</span> <span class="p">|</span>                   <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> <span class="m">24</span> &lt;&gt; <span class="m">26</span> <span class="p">|</span> 0.000156 <span class="p">|</span>     <span class="m">1</span> <span class="p">|</span>     <span class="m">0</span> <span class="p">|</span>    <span class="m">22</span> <span class="p">|</span>     <span class="m">0</span> <span class="p">|</span>  <span class="m">3042</span> <span class="p">|</span>                   <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> <span class="m">26</span> &lt;&gt; <span class="m">28</span> <span class="p">|</span> 0.000000 <span class="p">|</span>     <span class="m">1</span> <span class="p">|</span>     <span class="m">0</span> <span class="p">|</span>    <span class="m">19</span> <span class="p">|</span>     <span class="m">1</span> <span class="p">|</span>   <span class="m">152</span> <span class="p">|</span>                   <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> <span class="m">28</span> &lt;&gt; <span class="m">30</span> <span class="p">|</span> 0.001498 <span class="p">|</span>     <span class="m">1</span> <span class="p">|</span>     <span class="m">0</span> <span class="p">|</span>    <span class="m">24</span> <span class="p">|</span>     <span class="m">0</span> <span class="p">|</span>  <span class="m">5615</span> <span class="p">|</span>                   <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> <span class="m">30</span> &lt;&gt; <span class="m">32</span> <span class="p">|</span> 0.000235 <span class="p">|</span>     <span class="m">0</span> <span class="p">|</span>     <span class="m">0</span> <span class="p">|</span>    <span class="m">44</span> <span class="p">|</span>     <span class="m">0</span> <span class="p">|</span>  <span class="m">1880</span> <span class="p">|</span>                   <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="nv">1</span>
</span></span><span class="line"><span class="cl"><span class="o">===================================================================================</span>
</span></span><span class="line"><span class="cl"><span class="m">2</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> IO Statistics                                                                   <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="m">3</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span>                                                                                 <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="m">4</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> Duration: 89.892365 secs                                                        <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="m">5</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> Interval:  <span class="m">2</span> secs                                                               <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="m">6</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span>                                                                                 <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="m">7</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> Col 1: AVG<span class="o">(</span>tcp.analysis.ack_rtt<span class="o">)</span>tcp.analysis.ack_rtt                            <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="m">8</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span>     2: COUNT<span class="o">(</span>tcp.analysis.retransmission<span class="o">)</span>  tcp.analysis.retransmission          <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="m">9</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span>     3: COUNT<span class="o">(</span>tcp.analysis.fast_retransmission<span class="o">)</span> tcp.analysis.fast_retransmission <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="m">10</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span>     4: COUNT<span class="o">(</span>tcp.analysis.duplicate_ack<span class="o">)</span> tcp.analysis.duplicate_ack             <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="m">11</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span>     5: COUNT<span class="o">(</span>tcp.analysis.lost_segment<span class="o">)</span> tcp.analysis.lost_segment               <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="m">12</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span>     6: AVG<span class="o">(</span>tcp.window_size<span class="o">)</span>tcp.window_size                                      <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="m">13</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span>---------------------------------------------------------------------------------<span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="m">14</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span>          <span class="p">|</span><span class="m">1</span>         <span class="p">|</span><span class="m">2</span>      <span class="p">|</span><span class="m">3</span>      <span class="p">|</span><span class="m">4</span>      <span class="p">|</span><span class="m">5</span>      <span class="p">|</span><span class="m">6</span>      <span class="p">|</span>                   <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="m">15</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> Interval <span class="p">|</span>    AVG   <span class="p">|</span> COUNT <span class="p">|</span> COUNT <span class="p">|</span> COUNT <span class="p">|</span> COUNT <span class="p">|</span>  AVG  <span class="p">|</span>                   <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="m">16</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span>-------------------------------------------------------------<span class="p">|</span>                   <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="m">17</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span>  <span class="m">0</span> &lt;&gt;  <span class="m">2</span> <span class="p">|</span> 0.001152 <span class="p">|</span>     <span class="m">0</span> <span class="p">|</span>     <span class="m">0</span> <span class="p">|</span>     <span class="m">0</span> <span class="p">|</span>     <span class="m">0</span> <span class="p">|</span>  <span class="m">4206</span> <span class="p">|</span>                   <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="m">18</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span>  <span class="m">2</span> &lt;&gt;  <span class="m">4</span> <span class="p">|</span> 0.002088 <span class="p">|</span>     <span class="m">0</span> <span class="p">|</span>     <span class="m">0</span> <span class="p">|</span>     <span class="m">0</span> <span class="p">|</span>     <span class="m">1</span> <span class="p">|</span>  <span class="m">6931</span> <span class="p">|</span>                   <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="m">19</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span>  <span class="m">4</span> &lt;&gt;  <span class="m">6</span> <span class="p">|</span> 0.001512 <span class="p">|</span>     <span class="m">0</span> <span class="p">|</span>     <span class="m">0</span> <span class="p">|</span>     <span class="m">0</span> <span class="p">|</span>     <span class="m">0</span> <span class="p">|</span>  <span class="m">7099</span> <span class="p">|</span>                   <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="m">20</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span>  <span class="m">6</span> &lt;&gt;  <span class="m">8</span> <span class="p">|</span> 0.002859 <span class="p">|</span>     <span class="m">0</span> <span class="p">|</span>     <span class="m">0</span> <span class="p">|</span>     <span class="m">0</span> <span class="p">|</span>     <span class="m">0</span> <span class="p">|</span>  <span class="m">7171</span> <span class="p">|</span>                   <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="m">21</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span>  <span class="m">8</span> &lt;&gt; <span class="m">10</span> <span class="p">|</span> 0.001716 <span class="p">|</span>     <span class="m">0</span> <span class="p">|</span>     <span class="m">0</span> <span class="p">|</span>     <span class="m">0</span> <span class="p">|</span>     <span class="m">0</span> <span class="p">|</span>  <span class="m">6472</span> <span class="p">|</span>                   <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="m">22</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> <span class="m">10</span> &lt;&gt; <span class="m">12</span> <span class="p">|</span> 0.000319 <span class="p">|</span>     <span class="m">0</span> <span class="p">|</span>     <span class="m">0</span> <span class="p">|</span>     <span class="m">0</span> <span class="p">|</span>     <span class="m">2</span> <span class="p">|</span>  <span class="m">5575</span> <span class="p">|</span>                   <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="m">23</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> <span class="m">12</span> &lt;&gt; <span class="m">14</span> <span class="p">|</span> 0.002030 <span class="p">|</span>     <span class="m">0</span> <span class="p">|</span>     <span class="m">0</span> <span class="p">|</span>     <span class="m">0</span> <span class="p">|</span>     <span class="m">0</span> <span class="p">|</span>  <span class="m">6922</span> <span class="p">|</span>                   <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="m">24</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> <span class="m">14</span> &lt;&gt; <span class="m">16</span> <span class="p">|</span> 0.003371 <span class="p">|</span>     <span class="m">0</span> <span class="p">|</span>     <span class="m">0</span> <span class="p">|</span>     <span class="m">0</span> <span class="p">|</span>     <span class="m">2</span> <span class="p">|</span>  <span class="m">5884</span> <span class="p">|</span>                   <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="m">25</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> <span class="m">16</span> &lt;&gt; <span class="m">18</span> <span class="p">|</span> 0.000138 <span class="p">|</span>     <span class="m">0</span> <span class="p">|</span>     <span class="m">0</span> <span class="p">|</span>     <span class="m">0</span> <span class="p">|</span>     <span class="m">1</span> <span class="p">|</span>  <span class="m">3480</span> <span class="p">|</span>                   <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="m">26</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> <span class="m">18</span> &lt;&gt; <span class="m">20</span> <span class="p">|</span> 0.000999 <span class="p">|</span>     <span class="m">0</span> <span class="p">|</span>     <span class="m">0</span> <span class="p">|</span>     <span class="m">0</span> <span class="p">|</span>     <span class="m">4</span> <span class="p">|</span>  <span class="m">6665</span> <span class="p">|</span>                   <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="m">27</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> <span class="m">20</span> &lt;&gt; <span class="m">22</span> <span class="p">|</span> 0.000682 <span class="p">|</span>     <span class="m">0</span> <span class="p">|</span>     <span class="m">0</span> <span class="p">|</span>    <span class="m">41</span> <span class="p">|</span>     <span class="m">2</span> <span class="p">|</span>  <span class="m">5484</span> <span class="p">|</span>                   <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="m">28</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> <span class="m">22</span> &lt;&gt; <span class="m">24</span> <span class="p">|</span> 0.002302 <span class="p">|</span>     <span class="m">2</span> <span class="p">|</span>     <span class="m">0</span> <span class="p">|</span>    <span class="m">19</span> <span class="p">|</span>     <span class="m">0</span> <span class="p">|</span>  <span class="m">7127</span> <span class="p">|</span>                   <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="m">29</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> <span class="m">24</span> &lt;&gt; <span class="m">26</span> <span class="p">|</span> 0.000156 <span class="p">|</span>     <span class="m">1</span> <span class="p">|</span>     <span class="m">0</span> <span class="p">|</span>    <span class="m">22</span> <span class="p">|</span>     <span class="m">0</span> <span class="p">|</span>  <span class="m">3042</span> <span class="p">|</span>                   <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="m">30</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> <span class="m">26</span> &lt;&gt; <span class="m">28</span> <span class="p">|</span> 0.000000 <span class="p">|</span>     <span class="m">1</span> <span class="p">|</span>     <span class="m">0</span> <span class="p">|</span>    <span class="m">19</span> <span class="p">|</span>     <span class="m">1</span> <span class="p">|</span>   <span class="m">152</span> <span class="p">|</span>                   <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="m">31</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> <span class="m">28</span> &lt;&gt; <span class="m">30</span> <span class="p">|</span> 0.001498 <span class="p">|</span>     <span class="m">1</span> <span class="p">|</span>     <span class="m">0</span> <span class="p">|</span>    <span class="m">24</span> <span class="p">|</span>     <span class="m">0</span> <span class="p">|</span>  <span class="m">5615</span> <span class="p">|</span>                   <span class="p">|</span>
</span></span><span class="line"><span class="cl"><span class="m">32</span>
</span></span><span class="line"><span class="cl"><span class="p">|</span> <span class="m">30</span> &lt;&gt; <span class="m">32</span> <span class="p">|</span> 0.000235 <span class="p">|</span>     <span class="m">0</span> <span class="p">|</span>     <span class="m">0</span> <span class="p">|</span>    <span class="m">44</span> <span class="p">|</span>     <span class="m">0</span> <span class="p">|</span>  <span class="m">1880</span> <span class="p">|</span>                   <span class="p">|</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#tshark</span>
</span></span><span class="line"><span class="cl">tshark -r ./mysql-compress.cap -o tcp.calculate_timestamps:true -T fields -e mysql.caps.cp -e frame.number -e frame.time_epoch  -e frame.time_delta_displayed  -e ip.src -e tcp.srcport -e tcp.dstport -e ip.dst -e tcp.time_delta -e frame.time_delta_displayed  -e tcp.stream -e tcp.len -e mysql.query 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#用tcpdump抓取并保存包：</span>
</span></span><span class="line"><span class="cl">sudo tcpdump -i eth0 port <span class="m">3306</span> -w plantegg.cap
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#每隔3秒钟生成一个新文件，总共生成5个文件后（15秒后）终止抓包，然后包名也按时间规范好了</span>
</span></span><span class="line"><span class="cl">sudo  tcpdump -t -s <span class="m">0</span> tcp port <span class="m">6379</span>  -w <span class="s1">&#39;dump_%Y-%m-%d_%H:%M:%S.pcap&#39;</span>   -G <span class="m">3</span> -W <span class="m">5</span> -Z root
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#每隔30分钟生成一个包并压缩，保留48个抓包，也就是24小的内的包</span>
</span></span><span class="line"><span class="cl">nohup sudo tcpdump -i eth0 -t -s <span class="m">0</span> tcp and port <span class="m">6379</span> -w <span class="s1">&#39;dump_%Y-%m-%d_%H:%M:%S.pcap&#39;</span> -G <span class="m">1800</span> -W <span class="m">48</span> -Z root -z gzip <span class="p">&amp;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#file size 512M  按文件大小不支持时间戳</span>
</span></span><span class="line"><span class="cl">nohup sudo tcpdump -i eth0 -t -s <span class="m">0</span> tcp and port <span class="m">3306</span> -w <span class="s2">&#34;dump_size.pcap&#34;</span>  -C <span class="m">1</span> -W <span class="m">2</span> -Z root -z gzip <span class="p">&amp;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#port range</span>
</span></span><span class="line"><span class="cl">sudo  tcpdump -i eth0 -t -s <span class="m">0</span> portrange 3000-3100  -w <span class="s1">&#39;dump_%Y-%m-%d_%H:%M:%S.pcap&#39;</span>   -G <span class="m">60</span> -W <span class="m">100</span> -Z root
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#subnet</span>
</span></span><span class="line"><span class="cl">sudo  tcpdump -i enp44s0f0 -t -s <span class="m">0</span> net 192.168.0.1/28 -w <span class="s1">&#39;dump_%Y-%m-%d_%H:%M:%S.pcap&#39;</span>   -G <span class="m">60</span> -W <span class="m">100</span> -Z root
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#抓取详细SQL语句, 快速确认client发过来的具体SQL内容：</span>
</span></span><span class="line"><span class="cl">sudo tshark -i any -f <span class="s1">&#39;port 8527&#39;</span> -s <span class="m">0</span> -l -w - <span class="p">|</span>strings
</span></span><span class="line"><span class="cl">sudo tshark -i eth0 -d tcp.port<span class="o">==</span>3306,mysql -T fields -e mysql.query <span class="s1">&#39;port 3306&#39;</span>
</span></span><span class="line"><span class="cl">sudo tshark -i eth0 -R <span class="s2">&#34;ip.addr==11.163.182.137&#34;</span> -d tcp.port<span class="o">==</span>3306,mysql -T fields -e mysql.query <span class="s1">&#39;port 3306&#39;</span>
</span></span><span class="line"><span class="cl">sudo tshark -i eth0 -R <span class="s2">&#34;tcp.srcport==62877&#34;</span> -d tcp.port<span class="o">==</span>3001,mysql -T fields -e tcp.srcport -e mysql.query <span class="s1">&#39;port 3001&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#query time</span>
</span></span><span class="line"><span class="cl">sudo tshark -i eth0 -Y <span class="s2">&#34; ((tcp.port eq 3306 ) and tcp.len&gt;0 )&#34;</span> -o tcp.calculate_timestamps:true -T fields -e frame.number -e frame.time_epoch  -e frame.time_delta_displayed  -e ip.src -e tcp.srcport -e tcp.dstport -e ip.dst -e tcp.time_delta -e tcp.stream -e tcp.len -e mysql.query
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#如果MySQL开启了SSL，那么抓包后的内容tshark/wireshark分析不到MySQL的具体内容，可以强制关闭：connectionProperties里加上useSSL=false</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">tshark -r ./manager.cap -o tcp.calculate_timestamps:true -Y <span class="s2">&#34; tcp.analysis.retransmission &#34;</span>  -T fields -e tcp.stream -e frame.number -e frame.time -e ip.src -e tcp.srcport -e tcp.dstport -e ip.dst <span class="p">|</span> sort
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#MySQL响应时间直方图【第八列的含义-- Time since previous frame in this TCP stream: seconds】：</span>
</span></span><span class="line"><span class="cl">tshark -r gege_plantegg.pcap -Y <span class="s2">&#34;mysql.query or (tcp.srcport3306 and tcp.len&gt;60)&#34;</span> -o tcp.calculate_timestamps:true -T fields -e frame.number -e frame.time_epoch  -e frame.time_delta_displayed  -e ip.src -e tcp.srcport -e tcp.dstport -e ip.dst -e tcp.time_delta -e tcp.stream -e tcp.len <span class="p">|</span> awk <span class="s1">&#39;BEGIN {sum0=0;sum3=0;sum10=0;sum30=0;sum50=0;sum100=0;sum300=0;sum500=0;sum1000=0;sumo=0;count=0;sum=0} {rt=$8; if(rt&gt;=0.000) sum=sum+rt; count=count+1; if(rt&lt;=0.000) sum0=sum0+1; else if(rt&lt;0.003) sum3=sum3+1 ; else if(rt&lt;0.01) sum10=sum10+1; else if(rt&lt;0.03) sum30=sum30+1; else if(rt&lt;0.05) sum50=sum50+1; else if(rt &lt; 0.1) sum100=sum100+1; else if(rt &lt; 0.3) sum300=sum300+1; else if(rt &lt; 0.5) sum500=sum500+1; else if(rt &lt; 1) sum1000=sum1000+1; else sum=sum+1 ;} END{printf &#34;-------------\n3ms:\t%s \n10ms:\t%s \n30ms:\t%s \n50ms:\t%s \n100ms:\t%s \n300ms:\t%s \n500ms:\t%s \n1000ms:\t%s \n&gt;1s:\t %s\n-------------\navg: %.6f \n&#34; , sum3,sum10,sum30,sum50,sum100,sum300,sum500,sum1000,sumo,sum/count;}&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#分析MySQL rt，倒数第四列基本就是rt</span>
</span></span><span class="line"><span class="cl">tshark -r gege_plantegg.pcap -Y <span class="s2">&#34; ((tcp.srcport eq 3306 ) and tcp.len&gt;0 )&#34;</span> -o tcp.calculate_timestamps:true -T fields -e frame.number -e frame.time_epoch  -e frame.time_delta_displayed  -e ip.src -e tcp.srcport -e tcp.dstport -e ip.dst -e tcp.time_delta -e tcp.stream -e tcp.len -e tcp.analysis.ack_rtt   
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#或者排序一下</span>
</span></span><span class="line"><span class="cl">tshark -r 213_php.cap -Y <span class="s2">&#34;mysql.query or (  tcp.srcport==3306)&#34;</span> -o tcp.calculate_timestamps:true -T fields -e frame.number -e frame.time_epoch  -e frame.time_delta_displayed  -e ip.src -e tcp.srcport -e tcp.dstport -e ip.dst -e tcp.time_delta -e tcp.stream -e tcp.len -e mysql.query <span class="p">|</span>sort -nk9 -nk1
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#将 tls key和抓包文件合并</span>
</span></span><span class="line"><span class="cl">editcap --inject-secrets tls,key.log in.pcap out.pcap
</span></span><span class="line"><span class="cl"><span class="c1">#把包长截掉，只保留前面54，可以脱敏包内容</span>
</span></span><span class="line"><span class="cl">editcap -s <span class="m">54</span> old.pcap new.pcap</span></span></code></pre>
</div>
<p>DNAT:</p>
<p><img class="tw-inline" loading="lazy" src=https://cdn.jsdelivr.net/gh/plantegg/plantegg.github.io/images/951413iMgBlog/format,webp-4378791.   alt="img"  ></p>
<p>FNAT:</p>
<p><img class="tw-inline" loading="lazy" src=https://cdn.jsdelivr.net/gh/plantegg/plantegg.github.io/images/951413iMgBlog/format,webp-20240823100700538   alt="img"  ></p>
]]></description>
</item><item>
    <title>就是要你懂抓包--WireShark之命令行版tshark</title>
    <link>http://localhost:1313/posts/%E5%B0%B1%E6%98%AF%E8%A6%81%E4%BD%A0%E6%87%82%E6%8A%93%E5%8C%85--wireshark%E4%B9%8B%E5%91%BD%E4%BB%A4%E8%A1%8C%E7%89%88tshark/</link>
    <pubDate>Fri, 21 Jun 2019 15:30:03 &#43;0000</pubDate><author>
        <name>作者</name>
    </author><guid>http://localhost:1313/posts/%E5%B0%B1%E6%98%AF%E8%A6%81%E4%BD%A0%E6%87%82%E6%8A%93%E5%8C%85--wireshark%E4%B9%8B%E5%91%BD%E4%BB%A4%E8%A1%8C%E7%89%88tshark/</guid>
    <description><![CDATA[<h1 id="玩转tsharkwireshark的命令行版" class="headerLink">
    <a href="#%e7%8e%a9%e8%bd%actsharkwireshark%e7%9a%84%e5%91%bd%e4%bb%a4%e8%a1%8c%e7%89%88" class="header-mark"></a>玩转TShark（Wireshark的命令行版）</h1><p>在我感叹Wireshark图形界面的强大时候，有时候也抱怨有点慢，或者感叹下要是有命令行界面版该多好啊，实际上TShark就是WireShark的命令行版，WireShark的功能基本都有，还能组合grep/awk等编程处理分析抓包文件。</p>
<p>下面让我们通过一些例子来学习TShark的常用功能，所有用到的*.cap/*.pcap等都是通过tcpdump抓到的包。请收藏好，下次碰到类似问题直接用文章中的命令跑一下。</p>
<h2 id="wireshark问题" class="headerLink">
    <a href="#wireshark%e9%97%ae%e9%a2%98" class="header-mark"></a>wireshark问题</h2><h3 id="配置文件路径" class="headerLink">
    <a href="#%e9%85%8d%e7%bd%ae%e6%96%87%e4%bb%b6%e8%b7%af%e5%be%84" class="header-mark"></a>配置文件路径</h3><p>macOS 下</p>
<div class="code-block highlight is-open show-line-numbers  tw-group tw-my-2">
  <div class="
    code-block-title 
    
    tw-flex 
    tw-flex-row 
    tw-justify-between 
    tw-w-full tw-bg-bgColor-secondary
    ">      
    <button 
      class="
        tw-select-none 
        tw-mx-2 
        tw-block
        group-[.is-open]:tw-rotate-90
        tw-transition-[transform] 
        tw-duration-500 
        tw-ease-in-out
        print:!tw-hidden"
      disabled
      aria-hidden="true"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M285.476 272.971L91.132 467.314c-9.373 9.373-24.569 9.373-33.941 0l-22.667-22.667c-9.357-9.357-9.375-24.522-.04-33.901L188.505 256 34.484 101.255c-9.335-9.379-9.317-24.544.04-33.901l22.667-22.667c9.373-9.373 24.569-9.373 33.941 0L285.475 239.03c9.373 9.372 9.373 24.568.001 33.941z"/></svg></button>

    <div class="code-block-title-bar tw-w-full">
      <p class="tw-select-none !tw-my-1">text</p>
    </div>
    <div class="tw-flex">
      <button 
        class="
          line-number-button
          tw-select-none 
          tw-mx-2 
          tw-hidden 
          group-[.is-open]:tw-block 
          group-[.show-line-numbers]:tw-text-fgColor-link 
          print:!tw-hidden" 
        title="Toggle line numbers"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M61.77 401l17.5-20.15a19.92 19.92 0 0 0 5.07-14.19v-3.31C84.34 356 80.5 352 73 352H16a8 8 0 0 0-8 8v16a8 8 0 0 0 8 8h22.83a157.41 157.41 0 0 0-11 12.31l-5.61 7c-4 5.07-5.25 10.13-2.8 14.88l1.05 1.93c3 5.76 6.29 7.88 12.25 7.88h4.73c10.33 0 15.94 2.44 15.94 9.09 0 4.72-4.2 8.22-14.36 8.22a41.54 41.54 0 0 1-15.47-3.12c-6.49-3.88-11.74-3.5-15.6 3.12l-5.59 9.31c-3.72 6.13-3.19 11.72 2.63 15.94 7.71 4.69 20.38 9.44 37 9.44 34.16 0 48.5-22.75 48.5-44.12-.03-14.38-9.12-29.76-28.73-34.88zM496 224H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zm0-160H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16V80a16 16 0 0 0-16-16zm0 320H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zM16 160h64a8 8 0 0 0 8-8v-16a8 8 0 0 0-8-8H64V40a8 8 0 0 0-8-8H32a8 8 0 0 0-7.14 4.42l-8 16A8 8 0 0 0 24 64h8v64H16a8 8 0 0 0-8 8v16a8 8 0 0 0 8 8zm-3.91 160H80a8 8 0 0 0 8-8v-16a8 8 0 0 0-8-8H41.32c3.29-10.29 48.34-18.68 48.34-56.44 0-29.06-25-39.56-44.47-39.56-21.36 0-33.8 10-40.46 18.75-4.37 5.59-3 10.84 2.8 15.37l8.58 6.88c5.61 4.56 11 2.47 16.12-2.44a13.44 13.44 0 0 1 9.46-3.84c3.33 0 9.28 1.56 9.28 8.75C51 248.19 0 257.31 0 304.59v4C0 316 5.08 320 12.09 320z"/></svg></button>

      <button 
        class="
          wrap-code-button
          tw-select-none 
          tw-mx-2 
          tw-hidden 
          group-[.is-open]:tw-block 
          group-[.is-wrap]:tw-text-fgColor-link 
          print:!tw-hidden" 
        title="Toggle code wrap"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M16 132h416c8.837 0 16-7.163 16-16V76c0-8.837-7.163-16-16-16H16C7.163 60 0 67.163 0 76v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16z"/></svg></button>
      
      <button 
        class="
          copy-code-button
          tw-select-none
          tw-mx-2 
          tw-hidden
          group-[.is-open]:tw-block
          hover:tw-text-fgColor-link 
          print:!tw-hidden"
        title="Copy code">
          <span class="copy-icon tw-block"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M433.941 65.941l-51.882-51.882A48 48 0 0 0 348.118 0H176c-26.51 0-48 21.49-48 48v48H48c-26.51 0-48 21.49-48 48v320c0 26.51 21.49 48 48 48h224c26.51 0 48-21.49 48-48v-48h80c26.51 0 48-21.49 48-48V99.882a48 48 0 0 0-14.059-33.941zM266 464H54a6 6 0 0 1-6-6V150a6 6 0 0 1 6-6h74v224c0 26.51 21.49 48 48 48h96v42a6 6 0 0 1-6 6zm128-96H182a6 6 0 0 1-6-6V54a6 6 0 0 1 6-6h106v88c0 13.255 10.745 24 24 24h88v202a6 6 0 0 1-6 6zm6-256h-64V48h9.632c1.591 0 3.117.632 4.243 1.757l48.368 48.368a6 6 0 0 1 1.757 4.243V112z"/></svg></span>
          <span class="check-icon tw-hidden"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M173.898 439.404l-166.4-166.4c-9.997-9.997-9.997-26.206 0-36.204l36.203-36.204c9.997-9.998 26.207-9.998 36.204 0L192 312.69 432.095 72.596c9.997-9.997 26.207-9.997 36.204 0l36.203 36.204c9.997 9.997 9.997 26.206 0 36.204l-294.4 294.401c-9.998 9.997-26.207 9.997-36.204-.001z"/></svg></span>
      </button>
        
      <button 
        class="
          tw-select-none 
          tw-mx-2 
          tw-block 
          group-[.is-open]:tw-hidden 
          print:!tw-hidden" 
        disabled
        aria-hidden="true"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M328 256c0 39.8-32.2 72-72 72s-72-32.2-72-72 32.2-72 72-72 72 32.2 72 72zm104-72c-39.8 0-72 32.2-72 72s32.2 72 72 72 72-32.2 72-72-32.2-72-72-72zm-352 0c-39.8 0-72 32.2-72 72s32.2 72 72 72 72-32.2 72-72-32.2-72-72-72z"/></svg></button>
    </div>
  </div>
  <pre style="counter-reset: codeblock;" class="tw-block tw-m-0 tw-p-0"><code 
    id="codeblock-id-1" 
    class="
      chroma 
      !tw-block 
      tw-p-0
      tw-m-0
      tw-transition-[max-height] 
      tw-duration-500 
      tw-ease-in-out 
      group-[.is-closed]:!tw-max-h-0 
      group-[.is-wrap]:tw-text-wrap
      tw-overflow-y-hidden
      tw-overflow-x-auto
      tw-scrollbar-thin
      "><span class="line"><span class="cl">~/.config/wireshark</span></span></code></pre>
</div>
<p>查看有哪些plugins 以及路径</p>
<p><img class="tw-inline" loading="lazy" src=https://cdn.jsdelivr.net/gh/plantegg/plantegg.github.io/images/951413iMgBlog/image-20240614105158403.png   alt="image-20240614105158403"  ></p>
<h3 id="不再展示协议内容" class="headerLink">
    <a href="#%e4%b8%8d%e5%86%8d%e5%b1%95%e7%a4%ba%e5%8d%8f%e8%ae%ae%e5%86%85%e5%ae%b9" class="header-mark"></a>不再展示协议内容</h3><p>比如，info列不再显示mysql 的request、response，但是下方的二进制解析能看到select等语句，这种一般是配置文件中 disable 了mysql协议。</p>
<p>配置文件名：C:\Users\admin\AppData\Roaming\Wireshark\disabled_protos</p>
<p>如果抓包缺失很大（比如进出走两个网卡，实际只抓了一个网卡），那么协议解析后也不会正确显示。</p>
<h3 id="io-graph图表无法展示数据" class="headerLink">
    <a href="#io-graph%e5%9b%be%e8%a1%a8%e6%97%a0%e6%b3%95%e5%b1%95%e7%a4%ba%e6%95%b0%e6%8d%ae" class="header-mark"></a>IO graph图表无法展示数据</h3><p>一般是缺数据，先把IO graph关掉再重新打开就可以了，注意图表title显示</p>
<h3 id="tcp-segment-of-a-reassembled-pdu" class="headerLink">
    <a href="#tcp-segment-of-a-reassembled-pdu" class="header-mark"></a>tcp segment of a reassembled pdu</h3><p>这个提示是指，wireshark需要将多个tcp协议包重新组合成特定协议内容（比如MySQL，HTTP），但是因为包缺失（或者每个包大小截断了）导致reassembled失败。实际上wireshark已经成功检测到该协议，只是在解析这个协议的时候缺失包导致解析不好。</p>
<p>这个时候可以试试将指定协议的reassembled属性关掉</p>
<p><img class="tw-inline" loading="lazy" src=http://localhost:1313/Users/ren/case/ossimg/1fc544dcd6e064f967481472f6688be9.png   alt="image.png"  ></p>
<p><a href="https://www.wireshark.org/docs/wsug_html_chunked/ChAdvReassemblySection.html" target="_blank" rel="noopener noreferrer">PDU：Protocol Data Unit</a></p>
<blockquote>
  <p>If the reassembly is successful, the TCP segment containing the last part of the packet will show the packet.
The reassembly might fail if some TCP segments are missing.</p>

</blockquote><p><a href="https://osqa-ask.wireshark.org/questions/58186/tcp-segment-of-a-reassembled-pdu" target="_blank" rel="noopener noreferrer">TCP segment of a reassembled PDU </a> means that:</p>
<ol>
<li>Wireshark/TShark thinks it knows what protocol is running atop TCP in that TCP segment;</li>
<li>that TCP segment doesn&rsquo;t contain all of a &ldquo;protocol data unit&rdquo; (PDU) for that higher-level protocol, i.e. a packet or protocol message for that higher-level protocol, and doesn&rsquo;t contain the last part of that PDU, so it&rsquo;s trying to reassemble the multiple TCP segments containing that higher-level PDU.</li>
</ol>
<h2 id="常用命令" class="headerLink">
    <a href="#%e5%b8%b8%e7%94%a8%e5%91%bd%e4%bb%a4" class="header-mark"></a>常用命令</h2><div class="code-block highlight is-open show-line-numbers  tw-group tw-my-2">
  <div class="
    code-block-title 
    
    tw-flex 
    tw-flex-row 
    tw-justify-between 
    tw-w-full tw-bg-bgColor-secondary
    ">      
    <button 
      class="
        tw-select-none 
        tw-mx-2 
        tw-block
        group-[.is-open]:tw-rotate-90
        tw-transition-[transform] 
        tw-duration-500 
        tw-ease-in-out
        print:!tw-hidden"
      disabled
      aria-hidden="true"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M285.476 272.971L91.132 467.314c-9.373 9.373-24.569 9.373-33.941 0l-22.667-22.667c-9.357-9.357-9.375-24.522-.04-33.901L188.505 256 34.484 101.255c-9.335-9.379-9.317-24.544.04-33.901l22.667-22.667c9.373-9.373 24.569-9.373 33.941 0L285.475 239.03c9.373 9.372 9.373 24.568.001 33.941z"/></svg></button>

    <div class="code-block-title-bar tw-w-full">
      <p class="tw-select-none !tw-my-1">text</p>
    </div>
    <div class="tw-flex">
      <button 
        class="
          line-number-button
          tw-select-none 
          tw-mx-2 
          tw-hidden 
          group-[.is-open]:tw-block 
          group-[.show-line-numbers]:tw-text-fgColor-link 
          print:!tw-hidden" 
        title="Toggle line numbers"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M61.77 401l17.5-20.15a19.92 19.92 0 0 0 5.07-14.19v-3.31C84.34 356 80.5 352 73 352H16a8 8 0 0 0-8 8v16a8 8 0 0 0 8 8h22.83a157.41 157.41 0 0 0-11 12.31l-5.61 7c-4 5.07-5.25 10.13-2.8 14.88l1.05 1.93c3 5.76 6.29 7.88 12.25 7.88h4.73c10.33 0 15.94 2.44 15.94 9.09 0 4.72-4.2 8.22-14.36 8.22a41.54 41.54 0 0 1-15.47-3.12c-6.49-3.88-11.74-3.5-15.6 3.12l-5.59 9.31c-3.72 6.13-3.19 11.72 2.63 15.94 7.71 4.69 20.38 9.44 37 9.44 34.16 0 48.5-22.75 48.5-44.12-.03-14.38-9.12-29.76-28.73-34.88zM496 224H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zm0-160H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16V80a16 16 0 0 0-16-16zm0 320H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zM16 160h64a8 8 0 0 0 8-8v-16a8 8 0 0 0-8-8H64V40a8 8 0 0 0-8-8H32a8 8 0 0 0-7.14 4.42l-8 16A8 8 0 0 0 24 64h8v64H16a8 8 0 0 0-8 8v16a8 8 0 0 0 8 8zm-3.91 160H80a8 8 0 0 0 8-8v-16a8 8 0 0 0-8-8H41.32c3.29-10.29 48.34-18.68 48.34-56.44 0-29.06-25-39.56-44.47-39.56-21.36 0-33.8 10-40.46 18.75-4.37 5.59-3 10.84 2.8 15.37l8.58 6.88c5.61 4.56 11 2.47 16.12-2.44a13.44 13.44 0 0 1 9.46-3.84c3.33 0 9.28 1.56 9.28 8.75C51 248.19 0 257.31 0 304.59v4C0 316 5.08 320 12.09 320z"/></svg></button>

      <button 
        class="
          wrap-code-button
          tw-select-none 
          tw-mx-2 
          tw-hidden 
          group-[.is-open]:tw-block 
          group-[.is-wrap]:tw-text-fgColor-link 
          print:!tw-hidden" 
        title="Toggle code wrap"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M16 132h416c8.837 0 16-7.163 16-16V76c0-8.837-7.163-16-16-16H16C7.163 60 0 67.163 0 76v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16z"/></svg></button>
      
      <button 
        class="
          copy-code-button
          tw-select-none
          tw-mx-2 
          tw-hidden
          group-[.is-open]:tw-block
          hover:tw-text-fgColor-link 
          print:!tw-hidden"
        title="Copy code">
          <span class="copy-icon tw-block"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M433.941 65.941l-51.882-51.882A48 48 0 0 0 348.118 0H176c-26.51 0-48 21.49-48 48v48H48c-26.51 0-48 21.49-48 48v320c0 26.51 21.49 48 48 48h224c26.51 0 48-21.49 48-48v-48h80c26.51 0 48-21.49 48-48V99.882a48 48 0 0 0-14.059-33.941zM266 464H54a6 6 0 0 1-6-6V150a6 6 0 0 1 6-6h74v224c0 26.51 21.49 48 48 48h96v42a6 6 0 0 1-6 6zm128-96H182a6 6 0 0 1-6-6V54a6 6 0 0 1 6-6h106v88c0 13.255 10.745 24 24 24h88v202a6 6 0 0 1-6 6zm6-256h-64V48h9.632c1.591 0 3.117.632 4.243 1.757l48.368 48.368a6 6 0 0 1 1.757 4.243V112z"/></svg></span>
          <span class="check-icon tw-hidden"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M173.898 439.404l-166.4-166.4c-9.997-9.997-9.997-26.206 0-36.204l36.203-36.204c9.997-9.998 26.207-9.998 36.204 0L192 312.69 432.095 72.596c9.997-9.997 26.207-9.997 36.204 0l36.203 36.204c9.997 9.997 9.997 26.206 0 36.204l-294.4 294.401c-9.998 9.997-26.207 9.997-36.204-.001z"/></svg></span>
      </button>
        
      <button 
        class="
          tw-select-none 
          tw-mx-2 
          tw-block 
          group-[.is-open]:tw-hidden 
          print:!tw-hidden" 
        disabled
        aria-hidden="true"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M328 256c0 39.8-32.2 72-72 72s-72-32.2-72-72 32.2-72 72-72 72 32.2 72 72zm104-72c-39.8 0-72 32.2-72 72s32.2 72 72 72 72-32.2 72-72-32.2-72-72-72zm-352 0c-39.8 0-72 32.2-72 72s32.2 72 72 72 72-32.2 72-72-32.2-72-72-72z"/></svg></button>
    </div>
  </div>
  <pre style="counter-reset: codeblock;" class="tw-block tw-m-0 tw-p-0"><code 
    id="codeblock-id-2" 
    class="
      chroma 
      !tw-block 
      tw-p-0
      tw-m-0
      tw-transition-[max-height] 
      tw-duration-500 
      tw-ease-in-out 
      group-[.is-closed]:!tw-max-h-0 
      group-[.is-wrap]:tw-text-wrap
      tw-overflow-y-hidden
      tw-overflow-x-auto
      tw-scrollbar-thin
      "><span class="line"><span class="cl">#parse 8507/4444 as mysql protocol, default only parse 3306 as mysql.
</span></span><span class="line"><span class="cl">sudo tshark -i eth0 -d tcp.port==8507,mysql -T fields -e mysql.query &#39;port 8507&#39;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">sudo tshark -i any -c 50 -d tcp.port==4444,mysql -Y &#34; ((tcp.port eq 4444 )  )&#34; -o tcp.calculate_timestamps:true -T fields -e frame.number -e frame.time_epoch  -e frame.time_delta_displayed  -e ip.src -e tcp.srcport -e tcp.dstport -e ip.dst -e tcp.time_delta -e tcp.stream -e tcp.len -e mysql.query
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">#query time
</span></span><span class="line"><span class="cl">sudo tshark -i eth0 -Y &#34; ((tcp.port eq 3306 ) and tcp.len&gt;0 )&#34; -o tcp.calculate_timestamps:true -T fields -e frame.number -e frame.time_epoch  -e frame.time_delta_displayed  -e ip.src -e tcp.srcport -e tcp.dstport -e ip.dst -e tcp.time_delta -e tcp.stream -e tcp.len -e mysql.query
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">#每隔3秒钟生成一个新文件，总共生成5个文件后（15秒后）终止抓包，然后包名也按时间规范好了
</span></span><span class="line"><span class="cl">sudo  tcpdump -t -s 0 tcp port 3306  -w &#39;dump_%Y-%m-%d_%H:%M:%S.pcap&#39;   -G 3 -W 5 -Z root
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">#每隔30分钟生成一个包并压缩
</span></span><span class="line"><span class="cl">nohup sudo tcpdump -i eth0 -t -s 0 tcp and port 3306 -w &#39;dump_%Y-%m-%d_%H:%M:%S.pcap&#39; -G 1800 -W 48 -Z root -z gzip &amp;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">#file size 1000M 
</span></span><span class="line"><span class="cl">nohup sudo tcpdump -i eth0 -t -s 0 tcp and port 3306 -w &#39;dump_&#39; -C 1000 -W 300 -Z root -z gzip &amp;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">#抓取详细SQL语句, 快速确认client发过来的具体SQL内容：
</span></span><span class="line"><span class="cl">sudo tshark -i any -f &#39;port 8527&#39; -s 0 -l -w - |strings
</span></span><span class="line"><span class="cl">sudo tshark -i eth0 -d tcp.port==3306,mysql -T fields -e mysql.query &#39;port 3306&#39;
</span></span><span class="line"><span class="cl">sudo tshark -i eth0 -R &#34;ip.addr==11.163.182.137&#34; -d tcp.port==3306,mysql -T fields -e mysql.query &#39;port 3306&#39;
</span></span><span class="line"><span class="cl">sudo tshark -i eth0 -R &#34;tcp.srcport==62877&#34; -d tcp.port==3001,mysql -T fields -e tcp.srcport -e mysql.query &#39;port 3001&#39;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">#直接展示，省掉wireshark
</span></span><span class="line"><span class="cl">$tshark -i bond0 port 3306 -T fields -e frame.number -e frame.time_delta -e col.Source -e col.Destination -e col.Protocol -e ip.len  -e col.Info -e mysql.query
</span></span><span class="line"><span class="cl">$tshark -i bond0 port 3306 -T fields -e frame.number -e frame.time_delta -e tcp.srcport -e tcp.dstport -e col.Info -e mysql.query
</span></span><span class="line"><span class="cl">$tshark -i bond0 port 3306  -T fields -E separator=, -E quote=d -e frame.number -e frame.time_delta  -e tcp.srcport -e tcp.dstport   -e col.Info
</span></span><span class="line"><span class="cl">&#34;1&#34;,&#34;0.000000000&#34;,&#34;1620&#34;,&#34;3306&#34;,&#34;faxportwinport &gt; mysql [SYN] Seq=0 Win=42340 Len=0 MSS=1460 SACK_PERM=1 WS=512&#34;
</span></span><span class="line"><span class="cl">&#34;2&#34;,&#34;0.000026993&#34;,&#34;3306&#34;,&#34;1620&#34;,&#34;mysql &gt; faxportwinport [SYN, ACK] Seq=0 Ack=1 Win=29200 Len=0 MSS=1460 SACK_PERM=1 WS=128&#34;</span></span></code></pre>
</div>
<h2 id="分析mysql的每个sql响应时间" class="headerLink">
    <a href="#%e5%88%86%e6%9e%90mysql%e7%9a%84%e6%af%8f%e4%b8%aasql%e5%93%8d%e5%ba%94%e6%97%b6%e9%97%b4" class="header-mark"></a>分析mysql的每个SQL响应时间</h2><p>应用有输出的日志显示DB慢，DB监控到的日志显示自己很快，经常扯皮，如果直接在应用机器的网卡抓包，然后分析到每个SQL的响应时间，那么DB、网络都可以甩锅了（有时候应用统计的时间包含了应用自身的时间、取连接的时间等）</p>
<pre><code>tshark -r 213_php.cap -Y &quot;mysql.query or (  tcp.srcport==3306)&quot; -o tcp.calculate_timestamps:true -T fields -e frame.number -e frame.time_epoch  -e frame.time_delta_displayed  -e ip.src -e tcp.srcport -e tcp.dstport -e ip.dst -e tcp.time_delta -e tcp.stream -e tcp.len -e mysql.query |sort -nk9 -nk1
</code></pre>
<div class="code-block highlight is-open show-line-numbers  tw-group tw-my-2">
  <div class="
    code-block-title 
    
    tw-flex 
    tw-flex-row 
    tw-justify-between 
    tw-w-full tw-bg-bgColor-secondary
    ">      
    <button 
      class="
        tw-select-none 
        tw-mx-2 
        tw-block
        group-[.is-open]:tw-rotate-90
        tw-transition-[transform] 
        tw-duration-500 
        tw-ease-in-out
        print:!tw-hidden"
      disabled
      aria-hidden="true"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M285.476 272.971L91.132 467.314c-9.373 9.373-24.569 9.373-33.941 0l-22.667-22.667c-9.357-9.357-9.375-24.522-.04-33.901L188.505 256 34.484 101.255c-9.335-9.379-9.317-24.544.04-33.901l22.667-22.667c9.373-9.373 24.569-9.373 33.941 0L285.475 239.03c9.373 9.372 9.373 24.568.001 33.941z"/></svg></button>

    <div class="code-block-title-bar tw-w-full">
      <p class="tw-select-none !tw-my-1">text</p>
    </div>
    <div class="tw-flex">
      <button 
        class="
          line-number-button
          tw-select-none 
          tw-mx-2 
          tw-hidden 
          group-[.is-open]:tw-block 
          group-[.show-line-numbers]:tw-text-fgColor-link 
          print:!tw-hidden" 
        title="Toggle line numbers"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M61.77 401l17.5-20.15a19.92 19.92 0 0 0 5.07-14.19v-3.31C84.34 356 80.5 352 73 352H16a8 8 0 0 0-8 8v16a8 8 0 0 0 8 8h22.83a157.41 157.41 0 0 0-11 12.31l-5.61 7c-4 5.07-5.25 10.13-2.8 14.88l1.05 1.93c3 5.76 6.29 7.88 12.25 7.88h4.73c10.33 0 15.94 2.44 15.94 9.09 0 4.72-4.2 8.22-14.36 8.22a41.54 41.54 0 0 1-15.47-3.12c-6.49-3.88-11.74-3.5-15.6 3.12l-5.59 9.31c-3.72 6.13-3.19 11.72 2.63 15.94 7.71 4.69 20.38 9.44 37 9.44 34.16 0 48.5-22.75 48.5-44.12-.03-14.38-9.12-29.76-28.73-34.88zM496 224H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zm0-160H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16V80a16 16 0 0 0-16-16zm0 320H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zM16 160h64a8 8 0 0 0 8-8v-16a8 8 0 0 0-8-8H64V40a8 8 0 0 0-8-8H32a8 8 0 0 0-7.14 4.42l-8 16A8 8 0 0 0 24 64h8v64H16a8 8 0 0 0-8 8v16a8 8 0 0 0 8 8zm-3.91 160H80a8 8 0 0 0 8-8v-16a8 8 0 0 0-8-8H41.32c3.29-10.29 48.34-18.68 48.34-56.44 0-29.06-25-39.56-44.47-39.56-21.36 0-33.8 10-40.46 18.75-4.37 5.59-3 10.84 2.8 15.37l8.58 6.88c5.61 4.56 11 2.47 16.12-2.44a13.44 13.44 0 0 1 9.46-3.84c3.33 0 9.28 1.56 9.28 8.75C51 248.19 0 257.31 0 304.59v4C0 316 5.08 320 12.09 320z"/></svg></button>

      <button 
        class="
          wrap-code-button
          tw-select-none 
          tw-mx-2 
          tw-hidden 
          group-[.is-open]:tw-block 
          group-[.is-wrap]:tw-text-fgColor-link 
          print:!tw-hidden" 
        title="Toggle code wrap"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M16 132h416c8.837 0 16-7.163 16-16V76c0-8.837-7.163-16-16-16H16C7.163 60 0 67.163 0 76v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16z"/></svg></button>
      
      <button 
        class="
          copy-code-button
          tw-select-none
          tw-mx-2 
          tw-hidden
          group-[.is-open]:tw-block
          hover:tw-text-fgColor-link 
          print:!tw-hidden"
        title="Copy code">
          <span class="copy-icon tw-block"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M433.941 65.941l-51.882-51.882A48 48 0 0 0 348.118 0H176c-26.51 0-48 21.49-48 48v48H48c-26.51 0-48 21.49-48 48v320c0 26.51 21.49 48 48 48h224c26.51 0 48-21.49 48-48v-48h80c26.51 0 48-21.49 48-48V99.882a48 48 0 0 0-14.059-33.941zM266 464H54a6 6 0 0 1-6-6V150a6 6 0 0 1 6-6h74v224c0 26.51 21.49 48 48 48h96v42a6 6 0 0 1-6 6zm128-96H182a6 6 0 0 1-6-6V54a6 6 0 0 1 6-6h106v88c0 13.255 10.745 24 24 24h88v202a6 6 0 0 1-6 6zm6-256h-64V48h9.632c1.591 0 3.117.632 4.243 1.757l48.368 48.368a6 6 0 0 1 1.757 4.243V112z"/></svg></span>
          <span class="check-icon tw-hidden"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M173.898 439.404l-166.4-166.4c-9.997-9.997-9.997-26.206 0-36.204l36.203-36.204c9.997-9.998 26.207-9.998 36.204 0L192 312.69 432.095 72.596c9.997-9.997 26.207-9.997 36.204 0l36.203 36.204c9.997 9.997 9.997 26.206 0 36.204l-294.4 294.401c-9.998 9.997-26.207 9.997-36.204-.001z"/></svg></span>
      </button>
        
      <button 
        class="
          tw-select-none 
          tw-mx-2 
          tw-block 
          group-[.is-open]:tw-hidden 
          print:!tw-hidden" 
        disabled
        aria-hidden="true"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M328 256c0 39.8-32.2 72-72 72s-72-32.2-72-72 32.2-72 72-72 72 32.2 72 72zm104-72c-39.8 0-72 32.2-72 72s32.2 72 72 72 72-32.2 72-72-32.2-72-72-72zm-352 0c-39.8 0-72 32.2-72 72s32.2 72 72 72 72-32.2 72-72-32.2-72-72-72z"/></svg></button>
    </div>
  </div>
  <pre style="counter-reset: codeblock;" class="tw-block tw-m-0 tw-p-0"><code 
    id="codeblock-id-3" 
    class="
      chroma 
      !tw-block 
      tw-p-0
      tw-m-0
      tw-transition-[max-height] 
      tw-duration-500 
      tw-ease-in-out 
      group-[.is-closed]:!tw-max-h-0 
      group-[.is-wrap]:tw-text-wrap
      tw-overflow-y-hidden
      tw-overflow-x-auto
      tw-scrollbar-thin
      "><span class="line"><span class="cl"><span class="mi">34143</span><span class="w">	</span><span class="mi">1475902394</span><span class="p">.</span><span class="mi">645073000</span><span class="w">	</span><span class="mi">0</span><span class="p">.</span><span class="mi">000342000</span><span class="w">	</span><span class="mi">10</span><span class="p">.</span><span class="mi">100</span><span class="p">.</span><span class="mi">53</span><span class="p">.</span><span class="mi">17</span><span class="w">	</span><span class="mi">3306</span><span class="w">	</span><span class="mi">40383</span><span class="w">	</span><span class="mi">10</span><span class="p">.</span><span class="mi">100</span><span class="p">.</span><span class="mi">10</span><span class="p">.</span><span class="mi">213</span><span class="w">	</span><span class="mi">0</span><span class="p">.</span><span class="mi">000153000</span><span class="w">	</span><span class="mi">2273</span><span class="w">	</span><span class="mi">0</span><span class="w">	
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="mi">34145</span><span class="w">	</span><span class="mi">1475902394</span><span class="p">.</span><span class="mi">645333000</span><span class="w">	</span><span class="mi">0</span><span class="p">.</span><span class="mi">000260000</span><span class="w">	</span><span class="mi">10</span><span class="p">.</span><span class="mi">100</span><span class="p">.</span><span class="mi">53</span><span class="p">.</span><span class="mi">17</span><span class="w">	</span><span class="mi">3306</span><span class="w">	</span><span class="mi">40383</span><span class="w">	</span><span class="mi">10</span><span class="p">.</span><span class="mi">100</span><span class="p">.</span><span class="mi">10</span><span class="p">.</span><span class="mi">213</span><span class="w">	</span><span class="mi">0</span><span class="p">.</span><span class="mi">000253000</span><span class="w">	</span><span class="mi">2273</span><span class="w">	</span><span class="mi">77</span><span class="w">	
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="mi">34150</span><span class="w">	</span><span class="mi">1475902394</span><span class="p">.</span><span class="mi">645537000</span><span class="w">	</span><span class="mi">0</span><span class="p">.</span><span class="mi">000204000</span><span class="w">	</span><span class="mi">10</span><span class="p">.</span><span class="mi">100</span><span class="p">.</span><span class="mi">53</span><span class="p">.</span><span class="mi">17</span><span class="w">	</span><span class="mi">3306</span><span class="w">	</span><span class="mi">40383</span><span class="w">	</span><span class="mi">10</span><span class="p">.</span><span class="mi">100</span><span class="p">.</span><span class="mi">10</span><span class="p">.</span><span class="mi">213</span><span class="w">	</span><span class="mi">0</span><span class="p">.</span><span class="mi">000146000</span><span class="w">	</span><span class="mi">2273</span><span class="w">	</span><span class="mi">0</span><span class="w">	
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="mi">34151</span><span class="w">	</span><span class="mi">1475902394</span><span class="p">.</span><span class="mi">645706000</span><span class="w">	</span><span class="mi">0</span><span class="p">.</span><span class="mi">000169000</span><span class="w">	</span><span class="mi">10</span><span class="p">.</span><span class="mi">100</span><span class="p">.</span><span class="mi">53</span><span class="p">.</span><span class="mi">17</span><span class="w">	</span><span class="mi">3306</span><span class="w">	</span><span class="mi">40383</span><span class="w">	</span><span class="mi">10</span><span class="p">.</span><span class="mi">100</span><span class="p">.</span><span class="mi">10</span><span class="p">.</span><span class="mi">213</span><span class="w">	</span><span class="mi">0</span><span class="p">.</span><span class="mi">000169000</span><span class="w">	</span><span class="mi">2273</span><span class="w">	</span><span class="mi">11</span><span class="w">	
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="mi">34153</span><span class="w">	</span><span class="mi">1475902394</span><span class="p">.</span><span class="mi">645737000</span><span class="w">	</span><span class="mi">0</span><span class="p">.</span><span class="mi">000031000</span><span class="w">	</span><span class="mi">10</span><span class="p">.</span><span class="mi">100</span><span class="p">.</span><span class="mi">10</span><span class="p">.</span><span class="mi">213</span><span class="w">	</span><span class="mi">40383</span><span class="w">	</span><span class="mi">3306</span><span class="w">	</span><span class="mi">10</span><span class="p">.</span><span class="mi">100</span><span class="p">.</span><span class="mi">53</span><span class="p">.</span><span class="mi">17</span><span class="w">	</span><span class="mi">0</span><span class="p">.</span><span class="mi">000031000</span><span class="w">	</span><span class="mi">2273</span><span class="w">	</span><span class="mi">21</span><span class="w">	</span><span class="kt">SET</span><span class="w"> </span><span class="n">NAMES</span><span class="w"> </span><span class="s1">&#39;utf8&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="mi">34161</span><span class="w">	</span><span class="mi">1475902394</span><span class="p">.</span><span class="mi">646390000</span><span class="w">	</span><span class="mi">0</span><span class="p">.</span><span class="mi">000158000</span><span class="w">	</span><span class="mi">10</span><span class="p">.</span><span class="mi">100</span><span class="p">.</span><span class="mi">53</span><span class="p">.</span><span class="mi">17</span><span class="w">	</span><span class="mi">3306</span><span class="w">	</span><span class="mi">40383</span><span class="w">	</span><span class="mi">10</span><span class="p">.</span><span class="mi">100</span><span class="p">.</span><span class="mi">10</span><span class="p">.</span><span class="mi">213</span><span class="w">	</span><span class="mi">0</span><span class="p">.</span><span class="mi">000653000</span><span class="w">	</span><span class="mi">2273</span><span class="w">	</span><span class="mi">11</span><span class="w">	
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="mi">34162</span><span class="w">	</span><span class="mi">1475902394</span><span class="p">.</span><span class="mi">646418000</span><span class="w">	</span><span class="mi">0</span><span class="p">.</span><span class="mi">000028000</span><span class="w">	</span><span class="mi">10</span><span class="p">.</span><span class="mi">100</span><span class="p">.</span><span class="mi">10</span><span class="p">.</span><span class="mi">213</span><span class="w">	</span><span class="mi">40383</span><span class="w">	</span><span class="mi">3306</span><span class="w">	</span><span class="mi">10</span><span class="p">.</span><span class="mi">100</span><span class="p">.</span><span class="mi">53</span><span class="p">.</span><span class="mi">17</span><span class="w">	</span><span class="mi">0</span><span class="p">.</span><span class="mi">000028000</span><span class="w">	</span><span class="mi">2273</span><span class="w">	</span><span class="mi">22</span><span class="w">	</span><span class="n">START</span><span class="w"> </span><span class="n">TRANSACTION</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="mi">34164</span><span class="w">	</span><span class="mi">1475902394</span><span class="p">.</span><span class="mi">646713000</span><span class="w">	</span><span class="mi">0</span><span class="p">.</span><span class="mi">000295000</span><span class="w">	</span><span class="mi">10</span><span class="p">.</span><span class="mi">100</span><span class="p">.</span><span class="mi">53</span><span class="p">.</span><span class="mi">17</span><span class="w">	</span><span class="mi">3306</span><span class="w">	</span><span class="mi">40383</span><span class="w">	</span><span class="mi">10</span><span class="p">.</span><span class="mi">100</span><span class="p">.</span><span class="mi">10</span><span class="p">.</span><span class="mi">213</span><span class="w">	</span><span class="mi">0</span><span class="p">.</span><span class="mi">000295000</span><span class="w">	</span><span class="mi">2273</span><span class="w">	</span><span class="mi">11</span><span class="w">	
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="mi">34166</span><span class="w">	</span><span class="mi">1475902394</span><span class="p">.</span><span class="mi">646776000</span><span class="w">	</span><span class="mi">0</span><span class="p">.</span><span class="mi">000063000</span><span class="w">	</span><span class="mi">10</span><span class="p">.</span><span class="mi">100</span><span class="p">.</span><span class="mi">10</span><span class="p">.</span><span class="mi">213</span><span class="w">	</span><span class="mi">40383</span><span class="w">	</span><span class="mi">3306</span><span class="w">	</span><span class="mi">10</span><span class="p">.</span><span class="mi">100</span><span class="p">.</span><span class="mi">53</span><span class="p">.</span><span class="mi">17</span><span class="w">	</span><span class="mi">0</span><span class="p">.</span><span class="mi">000063000</span><span class="w">	</span><span class="mi">2273</span><span class="w">	</span><span class="mi">46</span><span class="w">	</span><span class="k">select</span><span class="w"> </span><span class="n">AUTO_SEQ_t_order</span><span class="p">.</span><span class="n">nextval</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="k">dual</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="mi">34194</span><span class="w">	</span><span class="mi">1475902394</span><span class="p">.</span><span class="mi">651468000</span><span class="w">	</span><span class="mi">0</span><span class="p">.</span><span class="mi">000909000</span><span class="w">	</span><span class="mi">10</span><span class="p">.</span><span class="mi">100</span><span class="p">.</span><span class="mi">53</span><span class="p">.</span><span class="mi">17</span><span class="w">	</span><span class="mi">3306</span><span class="w">	</span><span class="mi">40383</span><span class="w">	</span><span class="mi">10</span><span class="p">.</span><span class="mi">100</span><span class="p">.</span><span class="mi">10</span><span class="p">.</span><span class="mi">213</span><span class="w">	</span><span class="mi">0</span><span class="p">.</span><span class="mi">004692000</span><span class="w">	</span><span class="mi">2273</span><span class="w">	</span><span class="mi">100</span><span class="w">	
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="mi">34195</span><span class="w">	</span><span class="mi">1475902394</span><span class="p">.</span><span class="mi">651782000</span><span class="w">	</span><span class="mi">0</span><span class="p">.</span><span class="mi">000314000</span><span class="w">	</span><span class="mi">10</span><span class="p">.</span><span class="mi">100</span><span class="p">.</span><span class="mi">10</span><span class="p">.</span><span class="mi">213</span><span class="w">	</span><span class="mi">40383</span><span class="w">	</span><span class="mi">3306</span><span class="w">	</span><span class="mi">10</span><span class="p">.</span><span class="mi">100</span><span class="p">.</span><span class="mi">53</span><span class="p">.</span><span class="mi">17</span><span class="w">	</span><span class="mi">0</span><span class="p">.</span><span class="mi">000314000</span><span class="w">	</span><span class="mi">2273</span><span class="w">	</span><span class="mi">576</span><span class="w">	</span><span class="k">insert</span><span class="w"> </span><span class="k">into</span><span class="w"> </span><span class="nf">t_order</span><span class="w"> </span><span class="p">(</span><span class="o">`</span><span class="n">out_order_no</span><span class="o">`</span><span class="p">,</span><span class="o">`</span><span class="n">pk_order</span><span class="o">`</span><span class="p">,</span><span class="o">`</span><span class="n">uid</span><span class="o">`</span><span class="p">,</span><span class="o">`</span><span class="n">ytid</span><span class="o">`</span><span class="p">,</span><span class="o">`</span><span class="n">platform</span><span class="o">`</span><span class="p">,</span><span class="o">`</span><span class="n">origin_price</span><span class="o">`</span><span class="p">,</span><span class="o">`</span><span class="n">price</span><span class="o">`</span><span class="p">,</span><span class="o">`</span><span class="n">partner_id</span><span class="o">`</span><span class="p">,</span><span class="o">`</span><span class="n">ip</span><span class="o">`</span><span class="p">,</span><span class="o">`</span><span class="n">sources</span><span class="o">`</span><span class="p">,</span><span class="o">`</span><span class="n">pay_state</span><span class="o">`</span><span class="p">,</span><span class="o">`</span><span class="n">type</span><span class="o">`</span><span class="p">,</span><span class="o">`</span><span class="n">product_type</span><span class="o">`</span><span class="p">,</span><span class="o">`</span><span class="n">device</span><span class="o">`</span><span class="p">,</span><span class="o">`</span><span class="n">extension</span><span class="o">`</span><span class="p">,</span><span class="o">`</span><span class="n">spm</span><span class="o">`</span><span class="p">,</span><span class="o">`</span><span class="n">ext2</span><span class="o">`</span><span class="p">,</span><span class="o">`</span><span class="n">createtime</span><span class="o">`</span><span class="p">,</span><span class="o">`</span><span class="n">pay_channel</span><span class="o">`</span><span class="p">,</span><span class="o">`</span><span class="n">use_ytid</span><span class="o">`</span><span class="p">,</span><span class="o">`</span><span class="n">updatetime</span><span class="o">`</span><span class="p">)</span><span class="w"> </span><span class="k">values</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;2016100822003361672230261573284&#39;</span><span class="p">,</span><span class="s1">&#39;261573284&#39;</span><span class="p">,</span><span class="s1">&#39;336167223&#39;</span><span class="p">,</span><span class="s1">&#39;336167223&#39;</span><span class="p">,</span><span class="s1">&#39;1&#39;</span><span class="p">,</span><span class="s1">&#39;500&#39;</span><span class="p">,</span><span class="s1">&#39;500&#39;</span><span class="p">,</span><span class="s1">&#39;100000&#39;</span><span class="p">,</span><span class="s1">&#39;42.49.141.142&#39;</span><span class="p">,</span><span class="s1">&#39;2&#39;</span><span class="p">,</span><span class="s1">&#39;1&#39;</span><span class="p">,</span><span class="s1">&#39;1&#39;</span><span class="p">,</span><span class="s1">&#39;2&#39;</span><span class="p">,</span><span class="s1">&#39;3&#39;</span><span class="p">,</span><span class="s1">&#39;{\&#34;showid\&#34;:\&#34;286083\&#34;,\&#34;play_url\&#34;:\&#34;http:\\/\\/v.youku.com\\/v_show\\/id_XMTczOTM5NjU1Mg==.html\&#34;,\&#34;permit_duration\&#34;:172800}&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39;2016-10-08 12:53:14&#39;</span><span class="p">,</span><span class="s1">&#39;201&#39;</span><span class="p">,</span><span class="s1">&#39;0&#39;</span><span class="p">,</span><span class="s1">&#39;2016-10-08 12:53:14&#39;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="mi">34196</span><span class="w">	</span><span class="mi">1475902394</span><span class="p">.</span><span class="mi">653275000</span><span class="w">	</span><span class="mi">0</span><span class="p">.</span><span class="mi">001493000</span><span class="w">	</span><span class="mi">10</span><span class="p">.</span><span class="mi">100</span><span class="p">.</span><span class="mi">53</span><span class="p">.</span><span class="mi">17</span><span class="w">	</span><span class="mi">3306</span><span class="w">	</span><span class="mi">40383</span><span class="w">	</span><span class="mi">10</span><span class="p">.</span><span class="mi">100</span><span class="p">.</span><span class="mi">10</span><span class="p">.</span><span class="mi">213</span><span class="w">	</span><span class="mi">0</span><span class="p">.</span><span class="mi">001493000</span><span class="w">	</span><span class="mi">2273</span><span class="w">	</span><span class="mi">19</span><span class="w">	
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="mi">34197</span><span class="w">	</span><span class="mi">1475902394</span><span class="p">.</span><span class="mi">653410000</span><span class="w">	</span><span class="mi">0</span><span class="p">.</span><span class="mi">000135000</span><span class="w">	</span><span class="mi">10</span><span class="p">.</span><span class="mi">100</span><span class="p">.</span><span class="mi">10</span><span class="p">.</span><span class="mi">213</span><span class="w">	</span><span class="mi">40383</span><span class="w">	</span><span class="mi">3306</span><span class="w">	</span><span class="mi">10</span><span class="p">.</span><span class="mi">100</span><span class="p">.</span><span class="mi">53</span><span class="p">.</span><span class="mi">17</span><span class="w">	</span><span class="mi">0</span><span class="p">.</span><span class="mi">000135000</span><span class="w">	</span><span class="mi">2273</span><span class="w">	</span><span class="mi">370</span><span class="w">	</span><span class="k">insert</span><span class="w"> </span><span class="k">into</span><span class="w"> </span><span class="nf">t_order_product</span><span class="w"> </span><span class="p">(</span><span class="o">`</span><span class="n">fk_order</span><span class="o">`</span><span class="p">,</span><span class="o">`</span><span class="n">product_id</span><span class="o">`</span><span class="p">,</span><span class="o">`</span><span class="n">origin_price</span><span class="o">`</span><span class="p">,</span><span class="o">`</span><span class="n">price</span><span class="o">`</span><span class="p">,</span><span class="o">`</span><span class="n">discount</span><span class="o">`</span><span class="p">,</span><span class="o">`</span><span class="n">deliver_state</span><span class="o">`</span><span class="p">,</span><span class="o">`</span><span class="n">product_url</span><span class="o">`</span><span class="p">,</span><span class="o">`</span><span class="n">product_name</span><span class="o">`</span><span class="p">,</span><span class="o">`</span><span class="n">amount</span><span class="o">`</span><span class="p">,</span><span class="o">`</span><span class="n">ytid</span><span class="o">`</span><span class="p">,</span><span class="o">`</span><span class="n">sub_product_id</span><span class="o">`</span><span class="p">,</span><span class="o">`</span><span class="n">createtime</span><span class="o">`</span><span class="p">)</span><span class="w"> </span><span class="k">values</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;2016100822003361672230261573284&#39;</span><span class="p">,</span><span class="s1">&#39;4000010000&#39;</span><span class="p">,</span><span class="s1">&#39;500&#39;</span><span class="p">,</span><span class="s1">&#39;500&#39;</span><span class="p">,</span><span class="s1">&#39;0&#39;</span><span class="p">,</span><span class="s1">&#39;1&#39;</span><span class="p">,</span><span class="s1">&#39;http://vip.youku.com&#39;</span><span class="p">,</span><span class="s1">&#39;���������������������2:���������������&#39;</span><span class="p">,</span><span class="s1">&#39;1&#39;</span><span class="p">,</span><span class="s1">&#39;336167223&#39;</span><span class="p">,</span><span class="s1">&#39;286083&#39;</span><span class="p">,</span><span class="s1">&#39;2016-10-08 12:53:14&#39;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="mi">34198</span><span class="w">	</span><span class="mi">1475902394</span><span class="p">.</span><span class="mi">658326000</span><span class="w">	</span><span class="mi">0</span><span class="p">.</span><span class="mi">004916000</span><span class="w">	</span><span class="mi">10</span><span class="p">.</span><span class="mi">100</span><span class="p">.</span><span class="mi">53</span><span class="p">.</span><span class="mi">17</span><span class="w">	</span><span class="mi">3306</span><span class="w">	</span><span class="mi">40383</span><span class="w">	</span><span class="mi">10</span><span class="p">.</span><span class="mi">100</span><span class="p">.</span><span class="mi">10</span><span class="p">.</span><span class="mi">213</span><span class="w">	</span><span class="mi">0</span><span class="p">.</span><span class="mi">004916000</span><span class="w">	</span><span class="mi">2273</span><span class="w">	</span><span class="mi">19</span><span class="w">	
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="mi">34199</span><span class="w">	</span><span class="mi">1475902394</span><span class="p">.</span><span class="mi">658407000</span><span class="w">	</span><span class="mi">0</span><span class="p">.</span><span class="mi">000081000</span><span class="w">	</span><span class="mi">10</span><span class="p">.</span><span class="mi">100</span><span class="p">.</span><span class="mi">10</span><span class="p">.</span><span class="mi">213</span><span class="w">	</span><span class="mi">40383</span><span class="w">	</span><span class="mi">3306</span><span class="w">	</span><span class="mi">10</span><span class="p">.</span><span class="mi">100</span><span class="p">.</span><span class="mi">53</span><span class="p">.</span><span class="mi">17</span><span class="w">	</span><span class="mi">0</span><span class="p">.</span><span class="mi">000081000</span><span class="w">	</span><span class="mi">2273</span><span class="w">	</span><span class="mi">11</span><span class="w">	</span><span class="n">commit</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="mi">34200</span><span class="w">	</span><span class="mi">1475902394</span><span class="p">.</span><span class="mi">659626000</span><span class="w">	</span><span class="mi">0</span><span class="p">.</span><span class="mi">001219000</span><span class="w">	</span><span class="mi">10</span><span class="p">.</span><span class="mi">100</span><span class="p">.</span><span class="mi">53</span><span class="p">.</span><span class="mi">17</span><span class="w">	</span><span class="mi">3306</span><span class="w">	</span><span class="mi">40383</span><span class="w">	</span><span class="mi">10</span><span class="p">.</span><span class="mi">100</span><span class="p">.</span><span class="mi">10</span><span class="p">.</span><span class="mi">213</span><span class="w">	</span><span class="mi">0</span><span class="p">.</span><span class="mi">001219000</span><span class="w">	</span><span class="mi">2273</span><span class="w">	</span><span class="mi">11</span><span class="w">	
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="mi">34201</span><span class="w">	</span><span class="mi">1475902394</span><span class="p">.</span><span class="mi">659811000</span><span class="w">	</span><span class="mi">0</span><span class="p">.</span><span class="mi">000185000</span><span class="w">	</span><span class="mi">10</span><span class="p">.</span><span class="mi">100</span><span class="p">.</span><span class="mi">10</span><span class="p">.</span><span class="mi">213</span><span class="w">	</span><span class="mi">40383</span><span class="w">	</span><span class="mi">3306</span><span class="w">	</span><span class="mi">10</span><span class="p">.</span><span class="mi">100</span><span class="p">.</span><span class="mi">53</span><span class="p">.</span><span class="mi">17</span><span class="w">	</span><span class="mi">0</span><span class="p">.</span><span class="mi">000185000</span><span class="w">	</span><span class="mi">2273</span><span class="w">	</span><span class="mi">22</span><span class="w">	</span><span class="n">START</span><span class="w"> </span><span class="n">TRANSACTION</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="mi">34202</span><span class="w">	</span><span class="mi">1475902394</span><span class="p">.</span><span class="mi">660054000</span><span class="w">	</span><span class="mi">0</span><span class="p">.</span><span class="mi">000243000</span><span class="w">	</span><span class="mi">10</span><span class="p">.</span><span class="mi">100</span><span class="p">.</span><span class="mi">53</span><span class="p">.</span><span class="mi">17</span><span class="w">	</span><span class="mi">3306</span><span class="w">	</span><span class="mi">40383</span><span class="w">	</span><span class="mi">10</span><span class="p">.</span><span class="mi">100</span><span class="p">.</span><span class="mi">10</span><span class="p">.</span><span class="mi">213</span><span class="w">	</span><span class="mi">0</span><span class="p">.</span><span class="mi">000243000</span><span class="w">	</span><span class="mi">2273</span><span class="w">	</span><span class="mi">11</span><span class="w">	
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="mi">34203</span><span class="w">	</span><span class="mi">1475902394</span><span class="p">.</span><span class="mi">660126000</span><span class="w">	</span><span class="mi">0</span><span class="p">.</span><span class="mi">000072000</span><span class="w">	</span><span class="mi">10</span><span class="p">.</span><span class="mi">100</span><span class="p">.</span><span class="mi">10</span><span class="p">.</span><span class="mi">213</span><span class="w">	</span><span class="mi">40383</span><span class="w">	</span><span class="mi">3306</span><span class="w">	</span><span class="mi">10</span><span class="p">.</span><span class="mi">100</span><span class="p">.</span><span class="mi">53</span><span class="p">.</span><span class="mi">17</span><span class="w">	</span><span class="mi">0</span><span class="p">.</span><span class="mi">000072000</span><span class="w">	</span><span class="mi">2273</span><span class="w">	</span><span class="mi">125</span><span class="w">	</span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w">  </span><span class="k">FROM</span><span class="w">  </span><span class="n">t_order</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">out_order_no</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;2016100822003361672230261573284&#39;</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">ytid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;336167223&#39;</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">FOR</span><span class="w"> </span><span class="k">UPDATE</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="mi">34209</span><span class="w">	</span><span class="mi">1475902394</span><span class="p">.</span><span class="mi">661970000</span><span class="w">	</span><span class="mi">0</span><span class="p">.</span><span class="mi">001844000</span><span class="w">	</span><span class="mi">10</span><span class="p">.</span><span class="mi">100</span><span class="p">.</span><span class="mi">53</span><span class="p">.</span><span class="mi">17</span><span class="w">	</span><span class="mi">3306</span><span class="w">	</span><span class="mi">40383</span><span class="w">	</span><span class="mi">10</span><span class="p">.</span><span class="mi">100</span><span class="p">.</span><span class="mi">10</span><span class="p">.</span><span class="mi">213</span><span class="w">	</span><span class="mi">0</span><span class="p">.</span><span class="mi">001844000</span><span class="w">	</span><span class="mi">2273</span><span class="w">	</span><span class="mi">2214</span><span class="w">	
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="mi">34211</span><span class="w">	</span><span class="mi">1475902394</span><span class="p">.</span><span class="mi">662069000</span><span class="w">	</span><span class="mi">0</span><span class="p">.</span><span class="mi">000099000</span><span class="w">	</span><span class="mi">10</span><span class="p">.</span><span class="mi">100</span><span class="p">.</span><span class="mi">10</span><span class="p">.</span><span class="mi">213</span><span class="w">	</span><span class="mi">40383</span><span class="w">	</span><span class="mi">3306</span><span class="w">	</span><span class="mi">10</span><span class="p">.</span><span class="mi">100</span><span class="p">.</span><span class="mi">53</span><span class="p">.</span><span class="mi">17</span><span class="w">	</span><span class="mi">0</span><span class="p">.</span><span class="mi">000089000</span><span class="w">	</span><span class="mi">2273</span><span class="w">	</span><span class="mi">122</span><span class="w">	</span><span class="k">update</span><span class="w"> </span><span class="n">t_order</span><span class="w"> </span><span class="kt">set</span><span class="w"> </span><span class="o">`</span><span class="n">pay_state</span><span class="o">`=</span><span class="s1">&#39;2&#39;</span><span class="p">,</span><span class="o">`</span><span class="n">updatetime</span><span class="o">`=</span><span class="s1">&#39;2016-10-08 12:53:14&#39;</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">pk_order</span><span class="o">=</span><span class="s1">&#39;261573284&#39;</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">ytid</span><span class="o">=</span><span class="s1">&#39;336167223&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="mi">34213</span><span class="w">	</span><span class="mi">1475902394</span><span class="p">.</span><span class="mi">662917000</span><span class="w">	</span><span class="mi">0</span><span class="p">.</span><span class="mi">000848000</span><span class="w">	</span><span class="mi">10</span><span class="p">.</span><span class="mi">100</span><span class="p">.</span><span class="mi">53</span><span class="p">.</span><span class="mi">17</span><span class="w">	</span><span class="mi">3306</span><span class="w">	</span><span class="mi">40383</span><span class="w">	</span><span class="mi">10</span><span class="p">.</span><span class="mi">100</span><span class="p">.</span><span class="mi">10</span><span class="p">.</span><span class="mi">213</span><span class="w">	</span><span class="mi">0</span><span class="p">.</span><span class="mi">000848000</span><span class="w">	</span><span class="mi">2273</span><span class="w">	</span><span class="mi">19</span><span class="w">	
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="mi">34216</span><span class="w">	</span><span class="mi">1475902394</span><span class="p">.</span><span class="mi">663049000</span><span class="w">	</span><span class="mi">0</span><span class="p">.</span><span class="mi">000088000</span><span class="w">	</span><span class="mi">10</span><span class="p">.</span><span class="mi">100</span><span class="p">.</span><span class="mi">10</span><span class="p">.</span><span class="mi">213</span><span class="w">	</span><span class="mi">40383</span><span class="w">	</span><span class="mi">3306</span><span class="w">	</span><span class="mi">10</span><span class="p">.</span><span class="mi">100</span><span class="p">.</span><span class="mi">53</span><span class="p">.</span><span class="mi">17</span><span class="w">	</span><span class="mi">0</span><span class="p">.</span><span class="mi">000132000</span><span class="w">	</span><span class="mi">2273</span><span class="w">	</span><span class="mi">11</span><span class="w">	</span><span class="n">commit</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="mi">34225</span><span class="w">	</span><span class="mi">1475902394</span><span class="p">.</span><span class="mi">664204000</span><span class="w">	</span><span class="mi">0</span><span class="p">.</span><span class="mi">000264000</span><span class="w">	</span><span class="mi">10</span><span class="p">.</span><span class="mi">100</span><span class="p">.</span><span class="mi">53</span><span class="p">.</span><span class="mi">17</span><span class="w">	</span><span class="mi">3306</span><span class="w">	</span><span class="mi">40383</span><span class="w">	</span><span class="mi">10</span><span class="p">.</span><span class="mi">100</span><span class="p">.</span><span class="mi">10</span><span class="p">.</span><span class="mi">213</span><span class="w">	</span><span class="mi">0</span><span class="p">.</span><span class="mi">001155000</span><span class="w">	</span><span class="mi">2273</span><span class="w">	</span><span class="mi">11</span><span class="w">	
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="mi">34226</span><span class="w">	</span><span class="mi">1475902394</span><span class="p">.</span><span class="mi">664269000</span><span class="w">	</span><span class="mi">0</span><span class="p">.</span><span class="mi">000065000</span><span class="w">	</span><span class="mi">10</span><span class="p">.</span><span class="mi">100</span><span class="p">.</span><span class="mi">10</span><span class="p">.</span><span class="mi">213</span><span class="w">	</span><span class="mi">40383</span><span class="w">	</span><span class="mi">3306</span><span class="w">	</span><span class="mi">10</span><span class="p">.</span><span class="mi">100</span><span class="p">.</span><span class="mi">53</span><span class="p">.</span><span class="mi">17</span><span class="w">	</span><span class="mi">0</span><span class="p">.</span><span class="mi">000065000</span><span class="w">	</span><span class="mi">2273</span><span class="w">	</span><span class="mi">115</span><span class="w">	</span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w">  </span><span class="k">FROM</span><span class="w">  </span><span class="n">t_order</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">out_order_no</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;2016100822003361672230261573284&#39;</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">ytid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;336167223&#39;</span><span class="w"> </span><span class="p">)</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="mi">34235</span><span class="w">	</span><span class="mi">1475902394</span><span class="p">.</span><span class="mi">665694000</span><span class="w">	</span><span class="mi">0</span><span class="p">.</span><span class="mi">000061000</span><span class="w">	</span><span class="mi">10</span><span class="p">.</span><span class="mi">100</span><span class="p">.</span><span class="mi">53</span><span class="p">.</span><span class="mi">17</span><span class="w">	</span><span class="mi">3306</span><span class="w">	</span><span class="mi">40383</span><span class="w">	</span><span class="mi">10</span><span class="p">.</span><span class="mi">100</span><span class="p">.</span><span class="mi">10</span><span class="p">.</span><span class="mi">213</span><span class="w">	</span><span class="mi">0</span><span class="p">.</span><span class="mi">001425000</span><span class="w">	</span><span class="mi">2273</span><span class="w">	</span><span class="mi">2214</span><span class="w">	
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="mi">34354</span><span class="w">	</span><span class="mi">1475902394</span><span class="p">.</span><span class="mi">681464000</span><span class="w">	</span><span class="mi">0</span><span class="p">.</span><span class="mi">000157000</span><span class="w">	</span><span class="mi">10</span><span class="p">.</span><span class="mi">100</span><span class="p">.</span><span class="mi">53</span><span class="p">.</span><span class="mi">17</span><span class="w">	</span><span class="mi">3306</span><span class="w">	</span><span class="mi">40383</span><span class="w">	</span><span class="mi">10</span><span class="p">.</span><span class="mi">100</span><span class="p">.</span><span class="mi">10</span><span class="p">.</span><span class="mi">213</span><span class="w">	</span><span class="mi">0</span><span class="p">.</span><span class="mi">000187000</span><span class="w">	</span><span class="mi">2273</span><span class="w">	</span><span class="mi">0</span><span class="w">	
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="mi">34174</span><span class="w">	</span><span class="mi">1475902394</span><span class="p">.</span><span class="mi">648046000</span><span class="w">	</span><span class="mi">0</span><span class="p">.</span><span class="mi">001123000</span><span class="w">	</span><span class="mi">10</span><span class="p">.</span><span class="mi">100</span><span class="p">.</span><span class="mi">53</span><span class="p">.</span><span class="mi">19</span><span class="w">	</span><span class="mi">3306</span><span class="w">	</span><span class="mi">33471</span><span class="w">	</span><span class="mi">10</span><span class="p">.</span><span class="mi">100</span><span class="p">.</span><span class="mi">10</span><span class="p">.</span><span class="mi">213</span><span class="w">	</span><span class="mi">0</span><span class="p">.</span><span class="mi">000151000</span><span class="w">	</span><span class="mi">2275</span><span class="w">	</span><span class="mi">0</span><span class="w">	
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="mi">34176</span><span class="w">	</span><span class="mi">1475902394</span><span class="p">.</span><span class="mi">648331000</span><span class="w">	</span><span class="mi">0</span><span class="p">.</span><span class="mi">000285000</span><span class="w">	</span><span class="mi">10</span><span class="p">.</span><span class="mi">100</span><span class="p">.</span><span class="mi">53</span><span class="p">.</span><span class="mi">19</span><span class="w">	</span><span class="mi">3306</span><span class="w">	</span><span class="mi">33471</span><span class="w">	</span><span class="mi">10</span><span class="p">.</span><span class="mi">100</span><span class="p">.</span><span class="mi">10</span><span class="p">.</span><span class="mi">213</span><span class="w">	</span><span class="mi">0</span><span class="p">.</span><span class="mi">000278000</span><span class="w">	</span><span class="mi">2275</span><span class="w">	</span><span class="mi">77</span><span class="w">	
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="mi">34179</span><span class="w">	</span><span class="mi">1475902394</span><span class="p">.</span><span class="mi">648482000</span><span class="w">	</span><span class="mi">0</span><span class="p">.</span><span class="mi">000151000</span><span class="w">	</span><span class="mi">10</span><span class="p">.</span><span class="mi">100</span><span class="p">.</span><span class="mi">53</span><span class="p">.</span><span class="mi">19</span><span class="w">	</span><span class="mi">3306</span><span class="w">	</span><span class="mi">33471</span><span class="w">	</span><span class="mi">10</span><span class="p">.</span><span class="mi">100</span><span class="p">.</span><span class="mi">10</span><span class="p">.</span><span class="mi">213</span><span class="w">	</span><span class="mi">0</span><span class="p">.</span><span class="mi">000127000</span><span class="w">	</span><span class="mi">2275</span><span class="w">	</span><span class="mi">0</span><span class="w">	
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="mi">34180</span><span class="w">	</span><span class="mi">1475902394</span><span class="p">.</span><span class="mi">648598000</span><span class="w">	</span><span class="mi">0</span><span class="p">.</span><span class="mi">000116000</span><span class="w">	</span><span class="mi">10</span><span class="p">.</span><span class="mi">100</span><span class="p">.</span><span class="mi">53</span><span class="p">.</span><span class="mi">19</span><span class="w">	</span><span class="mi">3306</span><span class="w">	</span><span class="mi">33471</span><span class="w">	</span><span class="mi">10</span><span class="p">.</span><span class="mi">100</span><span class="p">.</span><span class="mi">10</span><span class="p">.</span><span class="mi">213</span><span class="w">	</span><span class="mi">0</span><span class="p">.</span><span class="mi">000116000</span><span class="w">	</span><span class="mi">2275</span><span class="w">	</span><span class="mi">11</span><span class="w">	
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="mi">34181</span><span class="w">	</span><span class="mi">1475902394</span><span class="p">.</span><span class="mi">648606000</span><span class="w">	</span><span class="mi">0</span><span class="p">.</span><span class="mi">000008000</span><span class="w">	</span><span class="mi">10</span><span class="p">.</span><span class="mi">100</span><span class="p">.</span><span class="mi">10</span><span class="p">.</span><span class="mi">213</span><span class="w">	</span><span class="mi">33471</span><span class="w">	</span><span class="mi">3306</span><span class="w">	</span><span class="mi">10</span><span class="p">.</span><span class="mi">100</span><span class="p">.</span><span class="mi">53</span><span class="p">.</span><span class="mi">19</span><span class="w">	</span><span class="mi">0</span><span class="p">.</span><span class="mi">000008000</span><span class="w">	</span><span class="mi">2275</span><span class="w">	</span><span class="mi">21</span><span class="w">	</span><span class="kt">SET</span><span class="w"> </span><span class="n">NAMES</span><span class="w"> </span><span class="s1">&#39;utf8&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="mi">34182</span><span class="w">	</span><span class="mi">1475902394</span><span class="p">.</span><span class="mi">648846000</span><span class="w">	</span><span class="mi">0</span><span class="p">.</span><span class="mi">000240000</span><span class="w">	</span><span class="mi">10</span><span class="p">.</span><span class="mi">100</span><span class="p">.</span><span class="mi">53</span><span class="p">.</span><span class="mi">19</span><span class="w">	</span><span class="mi">3306</span><span class="w">	</span><span class="mi">33471</span><span class="w">	</span><span class="mi">10</span><span class="p">.</span><span class="mi">100</span><span class="p">.</span><span class="mi">10</span><span class="p">.</span><span class="mi">213</span><span class="w">	</span><span class="mi">0</span><span class="p">.</span><span class="mi">000240000</span><span class="w">	</span><span class="mi">2275</span><span class="w">	</span><span class="mi">11</span><span class="w">	
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="mi">34183</span><span class="w">	</span><span class="mi">1475902394</span><span class="p">.</span><span class="mi">648885000</span><span class="w">	</span><span class="mi">0</span><span class="p">.</span><span class="mi">000039000</span><span class="w">	</span><span class="mi">10</span><span class="p">.</span><span class="mi">100</span><span class="p">.</span><span class="mi">10</span><span class="p">.</span><span class="mi">213</span><span class="w">	</span><span class="mi">33471</span><span class="w">	</span><span class="mi">3306</span><span class="w">	</span><span class="mi">10</span><span class="p">.</span><span class="mi">100</span><span class="p">.</span><span class="mi">53</span><span class="p">.</span><span class="mi">19</span><span class="w">	</span><span class="mi">0</span><span class="p">.</span><span class="mi">000039000</span><span class="w">	</span><span class="mi">2275</span><span class="w">	</span><span class="mi">380</span><span class="w">	</span><span class="k">select</span><span class="w"> </span><span class="n">pk_auto_renew_account</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">account_id</span><span class="p">,</span><span class="n">fk_user</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">uid</span><span class="p">,</span><span class="n">platform</span><span class="p">,</span><span class="n">ytid</span><span class="p">,</span><span class="n">fk_member_conf_id</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">member_id</span><span class="p">,</span><span class="n">fk_product_id</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">product_id</span><span class="p">,</span><span class="n">price</span><span class="p">,</span><span class="n">fk_pay_channel</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">pay_channel</span><span class="p">,</span><span class="n">renew_type</span><span class="p">,</span><span class="n">fk_order</span><span class="p">,</span><span class="n">fk_auto_renew_subscribe_log</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">fk_subscribe_log</span><span class="p">,</span><span class="n">state</span><span class="p">,</span><span class="n">memo</span><span class="p">,</span><span class="n">nexttime</span><span class="p">,</span><span class="n">createtime</span><span class="p">,</span><span class="n">updatetime</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">t_auto_renew_account</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">ytid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;354295193&#39;</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">platform</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;1&#39;</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">state</span><span class="w"> </span><span class="o">&lt;&gt;</span><span class="w"> </span><span class="s1">&#39;3&#39;</span><span class="w"> </span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="mi">34184</span><span class="w">	</span><span class="mi">1475902394</span><span class="p">.</span><span class="mi">650040000</span><span class="w">	</span><span class="mi">0</span><span class="p">.</span><span class="mi">001155000</span><span class="w">	</span><span class="mi">10</span><span class="p">.</span><span class="mi">100</span><span class="p">.</span><span class="mi">53</span><span class="p">.</span><span class="mi">19</span><span class="w">	</span><span class="mi">3306</span><span class="w">	</span><span class="mi">33471</span><span class="w">	</span><span class="mi">10</span><span class="p">.</span><span class="mi">100</span><span class="p">.</span><span class="mi">10</span><span class="p">.</span><span class="mi">213</span><span class="w">	</span><span class="mi">0</span><span class="p">.</span><span class="mi">001155000</span><span class="w">	</span><span class="mi">2275</span><span class="w">	</span><span class="mi">1727</span><span class="w">	
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="mi">34189</span><span class="w">	</span><span class="mi">1475902394</span><span class="p">.</span><span class="mi">650559000</span><span class="w">	</span><span class="mi">0</span><span class="p">.</span><span class="mi">000519000</span><span class="w">	</span><span class="mi">10</span><span class="p">.</span><span class="mi">100</span><span class="p">.</span><span class="mi">53</span><span class="p">.</span><span class="mi">19</span><span class="w">	</span><span class="mi">3306</span><span class="w">	</span><span class="mi">33471</span><span class="w">	</span><span class="mi">10</span><span class="p">.</span><span class="mi">100</span><span class="p">.</span><span class="mi">10</span><span class="p">.</span><span class="mi">213</span><span class="w">	</span><span class="mi">0</span><span class="p">.</span><span class="mi">000198000</span><span class="w">	</span><span class="mi">2275</span><span class="w">	</span><span class="mi">0</span><span class="w">	</span></span></span></code></pre>
</div>
<p>或者：
tshark -r gege_drds.pcap -Y &quot; ((tcp.srcport eq 3306 ) and tcp.len&gt;0 )&quot; -o tcp.calculate_timestamps:true -T fields -e frame.number -e frame.time_epoch  -e frame.time_delta_displayed  -e ip.src -e tcp.srcport -e tcp.dstport -e ip.dst -e tcp.time_delta -e tcp.stream -e tcp.len -e tcp.analysis.ack_rtt</p>
<p>这个命令跑出来，倒数第四列基本就是rt</p>
<pre><code>967     1548148159.346612000    0.000442000     192.168.4.18    3306    44026   192.168.100.30  0.005255000     17      1576    0.005255000
969     1548148159.346826000    0.000214000     192.168.4.18    3306    44090   192.168.100.30  0.005425000     15      1576    0.005425000
973     1548148159.347428000    0.000602000     192.168.4.18    3306    44070   192.168.100.30  0.005517000     8       2500    0.005517000
979     1548148159.348640000    0.001212000     192.168.4.18    3306    44048   192.168.100.30  0.005517000     22      2462    0.005517000
981     1548148159.348751000    0.000111000     192.168.4.18    3306    44066   192.168.100.30  0.005855000     21      2692    0.005855000
983     1548148159.348844000    0.000093000     192.168.4.18    3306    44046   192.168.100.30  0.004589000     3       2692    0.004589000
985     1548148159.348981000    0.000137000     192.168.4.18    3306    44012   192.168.100.30  0.004885000     19      2443    0.004885000
990     1548148159.349293000    0.000312000     192.168.4.18    3306    44074   192.168.100.30  0.005923000     5       2692    0.005923000
994     1548148159.349671000    0.000378000     192.168.4.18    3306    44080   192.168.100.30  0.004889000     4       2730    0.004889000
1009    1548148159.350591000    0.000920000     192.168.4.18    3306    44022   192.168.100.30  0.004187000     14      1448    0.004187000
1010    1548148159.350592000    0.000001000     192.168.4.18    3306    44022   192.168.100.30  0.000001000     14      1052    
1013    1548148159.350790000    0.000198000     192.168.4.18    3306    44002   192.168.100.30  0.005998000     0       1576    0.005998000
1026    1548148159.352207000    0.001417000     192.168.4.18    3306    44026   192.168.100.30  0.005348000     17      1448    0.005348000
1027    1548148159.352217000    0.000010000     192.168.4.18    3306    44026   192.168.100.30  0.000010000     17      1052    
1036    1548148159.352973000    0.000756000     192.168.4.18    3306    44090   192.168.100.30  0.005940000     15      2500    0.005940000
1041    1548148159.353683000    0.000710000     192.168.4.18    3306    44070   192.168.100.30  0.005190000     8       2692    0.005190000
1043    1548148159.353737000    0.000054000     192.168.4.18    3306    44066   192.168.100.30  0.004635000     21      1448    0.004635000
1044    1548148159.353749000    0.000012000     192.168.4.18    3306    44066   192.168.100.30  0.000012000     21      128     
1051    1548148159.354289000    0.000540000     192.168.4.18    3306    44046   192.168.100.30  0.004911000     3       1576    0.004911000
1054    1548148159.354511000    0.000222000     192.168.4.18    3306    44080   192.168.100.30  0.004515000     4       1576    0.004515000
1055    1548148159.354530000    0.000019000     192.168.4.18    3306    44074   192.168.100.30  0.004909000     5       1576    0.004909000
1065    1548148159.355412000    0.000882000     192.168.4.18    3306    44012   192.168.100.30  0.005217000     19      2692    0.005217000
1067    1548148159.355496000    0.000084000     192.168.4.18    3306    44048   192.168.100.30  0.005231000     22      2610    0.005231000
1072    1548148159.356111000    0.000615000     192.168.4.18    3306    44052   192.168.100.30  0.005830000     24      2730    0.005830000
1076    1548148159.356545000    0.000434000     192.168.4.18    3306    44022   192.168.100.30  0.005615000     14      2692    0.005615000
1079    1548148159.357012000    0.000467000     192.168.4.18    3306    44002   192.168.100.30  0.005966000     0       2462    0.005966000
1082    1548148159.357235000    0.000223000     192.168.4.18    3306    44072   192.168.100.30  0.004817000     23      2692    0.004817000
1093    1548148159.359244000    0.002009000     192.168.4.18    3306    44070   192.168.100.30  0.005188000     8       1576    0.005188000
</code></pre>
<h4 id="mysql响应时间直方图第八列的含义---time-since-previous-frame-in-this-tcp-stream-seconds" class="headerLink">
    <a href="#mysql%e5%93%8d%e5%ba%94%e6%97%b6%e9%97%b4%e7%9b%b4%e6%96%b9%e5%9b%be%e7%ac%ac%e5%85%ab%e5%88%97%e7%9a%84%e5%90%ab%e4%b9%89---time-since-previous-frame-in-this-tcp-stream-seconds" class="header-mark"></a>MySQL响应时间直方图【第八列的含义&ndash; Time since previous frame in this TCP stream: seconds】</h4><pre><code>tshark -r gege_drds.pcap -Y &quot;mysql.query or (tcp.srcport==3306  and tcp.len&gt;60)&quot; -o tcp.calculate_timestamps:true -T fields -e frame.number -e frame.time_epoch  -e frame.time_delta_displayed  -e ip.src -e tcp.srcport -e tcp.dstport -e ip.dst -e tcp.time_delta -e tcp.stream -e tcp.len | awk 'BEGIN {sum0=0;sum3=0;sum10=0;sum30=0;sum50=0;sum100=0;sum300=0;sum500=0;sum1000=0;sumo=0;count=0;sum=0} {rt=$8; if(rt&gt;=0.000) sum=sum+rt; count=count+1; if(rt&lt;=0.000) sum0=sum0+1; else if(rt&lt;0.003) sum3=sum3+1 ; else if(rt&lt;0.01) sum10=sum10+1; else if(rt&lt;0.03) sum30=sum30+1; else if(rt&lt;0.05) sum50=sum50+1; else if(rt &lt; 0.1) sum100=sum100+1; else if(rt &lt; 0.3) sum300=sum300+1; else if(rt &lt; 0.5) sum500=sum500+1; else if(rt &lt; 1) sum1000=sum1000+1; else sum=sum+1 ;} END{printf &quot;-------------\n3ms:\t%s \n10ms:\t%s \n30ms:\t%s \n50ms:\t%s \n100ms:\t%s \n300ms:\t%s \n500ms:\t%s \n1000ms:\t%s \n&gt;1s:\t %s\n-------------\navg: %.6f \n&quot; , sum3,sum10,sum30,sum50,sum100,sum300,sum500,sum1000,sumo,sum/count;}'
 
 -------------
3ms:	145037 
10ms:	78811 
30ms:	7032 
50ms:	2172 
100ms:	1219 
300ms:	856 
500ms:	449 
1000ms:118
&gt;1s:	0
-------------
avg: 0.005937 
</code></pre>
<p><strong>对于rt分析，要注意一个query多个response情况（response结果多，分包了），分析这种rt的时候只看query之后的第一个response，其它连续response需要忽略掉。</strong></p>
<h3 id="有时候应用说修改库存的代码都加了事务但是数据库里库存对不上这锅压力好大抓个包看看应用发过来的sql是啥" class="headerLink">
    <a href="#%e6%9c%89%e6%97%b6%e5%80%99%e5%ba%94%e7%94%a8%e8%af%b4%e4%bf%ae%e6%94%b9%e5%ba%93%e5%ad%98%e7%9a%84%e4%bb%a3%e7%a0%81%e9%83%bd%e5%8a%a0%e4%ba%86%e4%ba%8b%e5%8a%a1%e4%bd%86%e6%98%af%e6%95%b0%e6%8d%ae%e5%ba%93%e9%87%8c%e5%ba%93%e5%ad%98%e5%af%b9%e4%b8%8d%e4%b8%8a%e8%bf%99%e9%94%85%e5%8e%8b%e5%8a%9b%e5%a5%bd%e5%a4%a7%e6%8a%93%e4%b8%aa%e5%8c%85%e7%9c%8b%e7%9c%8b%e5%ba%94%e7%94%a8%e5%8f%91%e8%bf%87%e6%9d%a5%e7%9a%84sql%e6%98%af%e5%95%a5" class="header-mark"></a>有时候应用说修改库存的代码都加了事务，但是数据库里库存对不上，这锅压力好大，抓个包看看应用发过来的SQL是啥</h3><p>开发测试环境上通过如下命令也可以直接用tshark抓包分析SQL语句：</p>
<pre><code>sudo tshark -i eth0 -d tcp.port==3306,mysql -T fields -e mysql.query 'port 3306'
</code></pre>
<p>这样就直接看到发出的SQL是否是autocommit=1了</p>
<h2 id="http响应时间分析" class="headerLink">
    <a href="#http%e5%93%8d%e5%ba%94%e6%97%b6%e9%97%b4%e5%88%86%e6%9e%90" class="header-mark"></a>HTTP响应时间分析</h2><div class="code-block highlight is-open show-line-numbers  tw-group tw-my-2">
  <div class="
    code-block-title 
    
    tw-flex 
    tw-flex-row 
    tw-justify-between 
    tw-w-full tw-bg-bgColor-secondary
    ">      
    <button 
      class="
        tw-select-none 
        tw-mx-2 
        tw-block
        group-[.is-open]:tw-rotate-90
        tw-transition-[transform] 
        tw-duration-500 
        tw-ease-in-out
        print:!tw-hidden"
      disabled
      aria-hidden="true"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M285.476 272.971L91.132 467.314c-9.373 9.373-24.569 9.373-33.941 0l-22.667-22.667c-9.357-9.357-9.375-24.522-.04-33.901L188.505 256 34.484 101.255c-9.335-9.379-9.317-24.544.04-33.901l22.667-22.667c9.373-9.373 24.569-9.373 33.941 0L285.475 239.03c9.373 9.372 9.373 24.568.001 33.941z"/></svg></button>

    <div class="code-block-title-bar tw-w-full">
      <p class="tw-select-none !tw-my-1">shell</p>
    </div>
    <div class="tw-flex">
      <button 
        class="
          line-number-button
          tw-select-none 
          tw-mx-2 
          tw-hidden 
          group-[.is-open]:tw-block 
          group-[.show-line-numbers]:tw-text-fgColor-link 
          print:!tw-hidden" 
        title="Toggle line numbers"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M61.77 401l17.5-20.15a19.92 19.92 0 0 0 5.07-14.19v-3.31C84.34 356 80.5 352 73 352H16a8 8 0 0 0-8 8v16a8 8 0 0 0 8 8h22.83a157.41 157.41 0 0 0-11 12.31l-5.61 7c-4 5.07-5.25 10.13-2.8 14.88l1.05 1.93c3 5.76 6.29 7.88 12.25 7.88h4.73c10.33 0 15.94 2.44 15.94 9.09 0 4.72-4.2 8.22-14.36 8.22a41.54 41.54 0 0 1-15.47-3.12c-6.49-3.88-11.74-3.5-15.6 3.12l-5.59 9.31c-3.72 6.13-3.19 11.72 2.63 15.94 7.71 4.69 20.38 9.44 37 9.44 34.16 0 48.5-22.75 48.5-44.12-.03-14.38-9.12-29.76-28.73-34.88zM496 224H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zm0-160H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16V80a16 16 0 0 0-16-16zm0 320H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zM16 160h64a8 8 0 0 0 8-8v-16a8 8 0 0 0-8-8H64V40a8 8 0 0 0-8-8H32a8 8 0 0 0-7.14 4.42l-8 16A8 8 0 0 0 24 64h8v64H16a8 8 0 0 0-8 8v16a8 8 0 0 0 8 8zm-3.91 160H80a8 8 0 0 0 8-8v-16a8 8 0 0 0-8-8H41.32c3.29-10.29 48.34-18.68 48.34-56.44 0-29.06-25-39.56-44.47-39.56-21.36 0-33.8 10-40.46 18.75-4.37 5.59-3 10.84 2.8 15.37l8.58 6.88c5.61 4.56 11 2.47 16.12-2.44a13.44 13.44 0 0 1 9.46-3.84c3.33 0 9.28 1.56 9.28 8.75C51 248.19 0 257.31 0 304.59v4C0 316 5.08 320 12.09 320z"/></svg></button>

      <button 
        class="
          wrap-code-button
          tw-select-none 
          tw-mx-2 
          tw-hidden 
          group-[.is-open]:tw-block 
          group-[.is-wrap]:tw-text-fgColor-link 
          print:!tw-hidden" 
        title="Toggle code wrap"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M16 132h416c8.837 0 16-7.163 16-16V76c0-8.837-7.163-16-16-16H16C7.163 60 0 67.163 0 76v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16z"/></svg></button>
      
      <button 
        class="
          copy-code-button
          tw-select-none
          tw-mx-2 
          tw-hidden
          group-[.is-open]:tw-block
          hover:tw-text-fgColor-link 
          print:!tw-hidden"
        title="Copy code">
          <span class="copy-icon tw-block"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M433.941 65.941l-51.882-51.882A48 48 0 0 0 348.118 0H176c-26.51 0-48 21.49-48 48v48H48c-26.51 0-48 21.49-48 48v320c0 26.51 21.49 48 48 48h224c26.51 0 48-21.49 48-48v-48h80c26.51 0 48-21.49 48-48V99.882a48 48 0 0 0-14.059-33.941zM266 464H54a6 6 0 0 1-6-6V150a6 6 0 0 1 6-6h74v224c0 26.51 21.49 48 48 48h96v42a6 6 0 0 1-6 6zm128-96H182a6 6 0 0 1-6-6V54a6 6 0 0 1 6-6h106v88c0 13.255 10.745 24 24 24h88v202a6 6 0 0 1-6 6zm6-256h-64V48h9.632c1.591 0 3.117.632 4.243 1.757l48.368 48.368a6 6 0 0 1 1.757 4.243V112z"/></svg></span>
          <span class="check-icon tw-hidden"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M173.898 439.404l-166.4-166.4c-9.997-9.997-9.997-26.206 0-36.204l36.203-36.204c9.997-9.998 26.207-9.998 36.204 0L192 312.69 432.095 72.596c9.997-9.997 26.207-9.997 36.204 0l36.203 36.204c9.997 9.997 9.997 26.206 0 36.204l-294.4 294.401c-9.998 9.997-26.207 9.997-36.204-.001z"/></svg></span>
      </button>
        
      <button 
        class="
          tw-select-none 
          tw-mx-2 
          tw-block 
          group-[.is-open]:tw-hidden 
          print:!tw-hidden" 
        disabled
        aria-hidden="true"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M328 256c0 39.8-32.2 72-72 72s-72-32.2-72-72 32.2-72 72-72 72 32.2 72 72zm104-72c-39.8 0-72 32.2-72 72s32.2 72 72 72 72-32.2 72-72-32.2-72-72-72zm-352 0c-39.8 0-72 32.2-72 72s32.2 72 72 72 72-32.2 72-72-32.2-72-72-72z"/></svg></button>
    </div>
  </div>
  <pre style="counter-reset: codeblock;" class="tw-block tw-m-0 tw-p-0"><code 
    id="codeblock-id-4" 
    class="
      chroma 
      !tw-block 
      tw-p-0
      tw-m-0
      tw-transition-[max-height] 
      tw-duration-500 
      tw-ease-in-out 
      group-[.is-closed]:!tw-max-h-0 
      group-[.is-wrap]:tw-text-wrap
      tw-overflow-y-hidden
      tw-overflow-x-auto
      tw-scrollbar-thin
      "><span class="line"><span class="cl">//按秒汇总每个http response 耗时
</span></span><span class="line"><span class="cl">tshark -r dump.pcap -Y <span class="s1">&#39;http.time&gt;0 &#39;</span> -T fields -e frame.number -e frame.time_epoch  -e frame.time_delta_displayed  -e ip.src -e ip.dst -e tcp.stream  -e http.request.full_uri -e http.response.code -e http.time  <span class="p">|</span> awk <span class="s1">&#39;{ print int($2), $8 }&#39;</span> <span class="p">|</span> awk <span class="s1">&#39;{ sum[$1]+=$2; count[$1]+=1 ;} END { for (key in count) {  printf  &#34;time= %s  \t count=%s   \t avg=%.6f \n&#34;, key,  count[key], sum[key]/count[key] } }&#39;</span> <span class="p">|</span> sort -k2n <span class="p">|</span> awk <span class="s1">&#39;{ print strftime(&#34;%c&#34;,$2), $0 }&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">//on macOS
</span></span><span class="line"><span class="cl">tshark -r dump.pcap  -Y <span class="s1">&#39;http.response_for.uri contains &#34;health&#34; &#39;</span> -T fields -e frame.number -e frame.time_epoch  -e frame.time_delta_displayed  -e ip.src -e ip.dst -e tcp.stream  -e http.request.full_uri -e http.response_for.uri  -e http.time  <span class="p">|</span> awk <span class="s1">&#39;{ print int($2/10), $8 }&#39;</span> <span class="p">|</span> awk <span class="s1">&#39;{ sum[$1]+=$2; count[$1]+=1 ;} END { for (key in count) {  printf  &#34;time= %s  \t count=%s   \t avg=%.6f \n&#34;, key,  count[key], sum[key]/count[key] } }&#39;</span> <span class="p">|</span> sort -k2n <span class="p">|</span> gawk <span class="s1">&#39;{ print strftime(&#34;%c&#34;,$2), $0 }&#39;</span></span></span></code></pre>
</div>
<h3 id="按http-response分析响应时间" class="headerLink">
    <a href="#%e6%8c%89http-response%e5%88%86%e6%9e%90%e5%93%8d%e5%ba%94%e6%97%b6%e9%97%b4" class="header-mark"></a>按http response分析响应时间</h3><p>第三列是RT，倒数第二列是stream，同一个stream是一个连接。对应http response 200的是请求响应结果的RT</p>
<div class="code-block highlight is-open show-line-numbers  tw-group tw-my-2">
  <div class="
    code-block-title 
    
    tw-flex 
    tw-flex-row 
    tw-justify-between 
    tw-w-full tw-bg-bgColor-secondary
    ">      
    <button 
      class="
        tw-select-none 
        tw-mx-2 
        tw-block
        group-[.is-open]:tw-rotate-90
        tw-transition-[transform] 
        tw-duration-500 
        tw-ease-in-out
        print:!tw-hidden"
      disabled
      aria-hidden="true"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M285.476 272.971L91.132 467.314c-9.373 9.373-24.569 9.373-33.941 0l-22.667-22.667c-9.357-9.357-9.375-24.522-.04-33.901L188.505 256 34.484 101.255c-9.335-9.379-9.317-24.544.04-33.901l22.667-22.667c9.373-9.373 24.569-9.373 33.941 0L285.475 239.03c9.373 9.372 9.373 24.568.001 33.941z"/></svg></button>

    <div class="code-block-title-bar tw-w-full">
      <p class="tw-select-none !tw-my-1">text</p>
    </div>
    <div class="tw-flex">
      <button 
        class="
          line-number-button
          tw-select-none 
          tw-mx-2 
          tw-hidden 
          group-[.is-open]:tw-block 
          group-[.show-line-numbers]:tw-text-fgColor-link 
          print:!tw-hidden" 
        title="Toggle line numbers"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M61.77 401l17.5-20.15a19.92 19.92 0 0 0 5.07-14.19v-3.31C84.34 356 80.5 352 73 352H16a8 8 0 0 0-8 8v16a8 8 0 0 0 8 8h22.83a157.41 157.41 0 0 0-11 12.31l-5.61 7c-4 5.07-5.25 10.13-2.8 14.88l1.05 1.93c3 5.76 6.29 7.88 12.25 7.88h4.73c10.33 0 15.94 2.44 15.94 9.09 0 4.72-4.2 8.22-14.36 8.22a41.54 41.54 0 0 1-15.47-3.12c-6.49-3.88-11.74-3.5-15.6 3.12l-5.59 9.31c-3.72 6.13-3.19 11.72 2.63 15.94 7.71 4.69 20.38 9.44 37 9.44 34.16 0 48.5-22.75 48.5-44.12-.03-14.38-9.12-29.76-28.73-34.88zM496 224H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zm0-160H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16V80a16 16 0 0 0-16-16zm0 320H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zM16 160h64a8 8 0 0 0 8-8v-16a8 8 0 0 0-8-8H64V40a8 8 0 0 0-8-8H32a8 8 0 0 0-7.14 4.42l-8 16A8 8 0 0 0 24 64h8v64H16a8 8 0 0 0-8 8v16a8 8 0 0 0 8 8zm-3.91 160H80a8 8 0 0 0 8-8v-16a8 8 0 0 0-8-8H41.32c3.29-10.29 48.34-18.68 48.34-56.44 0-29.06-25-39.56-44.47-39.56-21.36 0-33.8 10-40.46 18.75-4.37 5.59-3 10.84 2.8 15.37l8.58 6.88c5.61 4.56 11 2.47 16.12-2.44a13.44 13.44 0 0 1 9.46-3.84c3.33 0 9.28 1.56 9.28 8.75C51 248.19 0 257.31 0 304.59v4C0 316 5.08 320 12.09 320z"/></svg></button>

      <button 
        class="
          wrap-code-button
          tw-select-none 
          tw-mx-2 
          tw-hidden 
          group-[.is-open]:tw-block 
          group-[.is-wrap]:tw-text-fgColor-link 
          print:!tw-hidden" 
        title="Toggle code wrap"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M16 132h416c8.837 0 16-7.163 16-16V76c0-8.837-7.163-16-16-16H16C7.163 60 0 67.163 0 76v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16z"/></svg></button>
      
      <button 
        class="
          copy-code-button
          tw-select-none
          tw-mx-2 
          tw-hidden
          group-[.is-open]:tw-block
          hover:tw-text-fgColor-link 
          print:!tw-hidden"
        title="Copy code">
          <span class="copy-icon tw-block"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M433.941 65.941l-51.882-51.882A48 48 0 0 0 348.118 0H176c-26.51 0-48 21.49-48 48v48H48c-26.51 0-48 21.49-48 48v320c0 26.51 21.49 48 48 48h224c26.51 0 48-21.49 48-48v-48h80c26.51 0 48-21.49 48-48V99.882a48 48 0 0 0-14.059-33.941zM266 464H54a6 6 0 0 1-6-6V150a6 6 0 0 1 6-6h74v224c0 26.51 21.49 48 48 48h96v42a6 6 0 0 1-6 6zm128-96H182a6 6 0 0 1-6-6V54a6 6 0 0 1 6-6h106v88c0 13.255 10.745 24 24 24h88v202a6 6 0 0 1-6 6zm6-256h-64V48h9.632c1.591 0 3.117.632 4.243 1.757l48.368 48.368a6 6 0 0 1 1.757 4.243V112z"/></svg></span>
          <span class="check-icon tw-hidden"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M173.898 439.404l-166.4-166.4c-9.997-9.997-9.997-26.206 0-36.204l36.203-36.204c9.997-9.998 26.207-9.998 36.204 0L192 312.69 432.095 72.596c9.997-9.997 26.207-9.997 36.204 0l36.203 36.204c9.997 9.997 9.997 26.206 0 36.204l-294.4 294.401c-9.998 9.997-26.207 9.997-36.204-.001z"/></svg></span>
      </button>
        
      <button 
        class="
          tw-select-none 
          tw-mx-2 
          tw-block 
          group-[.is-open]:tw-hidden 
          print:!tw-hidden" 
        disabled
        aria-hidden="true"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M328 256c0 39.8-32.2 72-72 72s-72-32.2-72-72 32.2-72 72-72 72 32.2 72 72zm104-72c-39.8 0-72 32.2-72 72s32.2 72 72 72 72-32.2 72-72-32.2-72-72-72zm-352 0c-39.8 0-72 32.2-72 72s32.2 72 72 72 72-32.2 72-72-32.2-72-72-72z"/></svg></button>
    </div>
  </div>
  <pre style="counter-reset: codeblock;" class="tw-block tw-m-0 tw-p-0"><code 
    id="codeblock-id-5" 
    class="
      chroma 
      !tw-block 
      tw-p-0
      tw-m-0
      tw-transition-[max-height] 
      tw-duration-500 
      tw-ease-in-out 
      group-[.is-closed]:!tw-max-h-0 
      group-[.is-wrap]:tw-text-wrap
      tw-overflow-y-hidden
      tw-overflow-x-auto
      tw-scrollbar-thin
      "><span class="line"><span class="cl"># tshark -nr 10.cap -o tcp.calculate_timestamps:true  -Y &#34;http.request or http.response&#34; -T fields -e frame.number -e frame.time_epoch  -e tcp.time_delta  -e ip.src -e ip.dst -e tcp.stream  -e http.request.full_uri -e http.response.code -e http.response.phrase | sort -nk6 -nk1
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">82579	1631791992.105383000	0.000113000	172.26.2.13	172.26.13.107	1198	http://plantegg/ajax.sword
</span></span><span class="line"><span class="cl">83167	1631791992.261663000	0.156042000	172.26.13.107	172.26.2.13	1198		200
</span></span><span class="line"><span class="cl">84917	1631791992.775011000	0.513106000	172.26.2.13	172.26.13.107	1198	http://plantegg/ajax.sword
</span></span><span class="line"><span class="cl">86388	1631791993.188458000	0.413018000	172.26.13.107	172.26.2.13	1198		200
</span></span><span class="line"><span class="cl">87391	1631791993.465156000	0.276608000	172.26.2.13	172.26.13.107	1198	http://plantegg/ajax.sword
</span></span><span class="line"><span class="cl">88067	1631791993.645780000	0.179832000	172.26.13.107	172.26.2.13	1198		200
</span></span><span class="line"><span class="cl">89364	1631791993.994322000	0.348324000	172.26.2.13	172.26.13.107	1198	http://plantegg/ajax.sword
</span></span><span class="line"><span class="cl">89843	1631791994.140131000	0.145169000	172.26.13.107	172.26.2.13	1198		200
</span></span><span class="line"><span class="cl">91387	1631791994.605527000	0.465245000	172.26.2.13	172.26.13.107	1198	http://plantegg/ajax.sword
</span></span><span class="line"><span class="cl">92271	1631791994.920607000	0.314639000	172.26.13.107	172.26.2.13	1198		200
</span></span><span class="line"><span class="cl">93491	1631791995.323424000	0.402724000	172.26.2.13	172.26.13.107	1198	http://plantegg/ajax.sword
</span></span><span class="line"><span class="cl">93860	1631791995.403614000	0.079834000	172.26.13.107	172.26.2.13	1198		200
</span></span><span class="line"><span class="cl">97221	1631791996.347307000	0.943423000	172.26.2.13	172.26.13.107	1198	http://plantegg/ajax.sword
</span></span><span class="line"><span class="cl">97862	1631791996.544563000	0.196448000	172.26.13.107	172.26.2.13	1198		200
</span></span><span class="line"><span class="cl">99613	1631791997.065735000	0.521095000	172.26.2.13	172.26.13.107	1198	http://plantegg/ajax.sword
</span></span><span class="line"><span class="cl">82714	1631791992.141943000	0.000122000	172.26.2.13	172.26.12.147	1199	http://plantegg/ajax.sword
</span></span><span class="line"><span class="cl">83055	1631791992.235637000	0.093471000	172.26.12.147	172.26.2.13	1199		200
</span></span><span class="line"><span class="cl">84789	1631791992.739133000	0.503423000	172.26.2.13	172.26.12.147	1199	http://plantegg/ajax.sword
</span></span><span class="line"><span class="cl">85525	1631791992.946220000	0.206860000	172.26.12.147	172.26.2.13	1199		200
</span></span><span class="line"><span class="cl">88208	1631791993.677995000	0.731490000	172.26.2.13	172.26.12.147	1199	http://plantegg/ajax.sword
</span></span><span class="line"><span class="cl">88638	1631791993.800956000	0.122637000	172.26.12.147	172.26.2.13	1199		200
</span></span><span class="line"><span class="cl">91010	1631791994.476918000	0.675911000	172.26.2.13	172.26.12.147	1199	http://plantegg/ajax.sword
</span></span><span class="line"><span class="cl">92079	1631791994.874566000	0.397357000	172.26.12.147	172.26.2.13	1199		200
</span></span><span class="line"><span class="cl">94480	1631791995.581990000	0.707200000	172.26.2.13	172.26.12.147	1199	http://plantegg/ajax.sword
</span></span><span class="line"><span class="cl">94764	1631791995.665365000	0.082906000	172.26.12.147	172.26.2.13	1199		200
</span></span><span class="line"><span class="cl">96241	1631791996.090803000	0.425378000	172.26.2.13	172.26.12.147	1199	http://plantegg/ajax.sword
</span></span><span class="line"><span class="cl">96731	1631791996.215406000	0.124276000	172.26.12.147	172.26.2.13	1199		200
</span></span><span class="line"><span class="cl">98832	1631791996.818172000	0.602695000	172.26.2.13	172.26.12.147	1199	http://plantegg/ajax.sword
</span></span><span class="line"><span class="cl">99735	1631791997.105453000	0.286845000	172.26.12.147	172.26.2.13	1199		200
</span></span><span class="line"><span class="cl">83462	1631791992.351494000	0.000042000	172.26.2.13	172.26.9.77	1200	http://plantegg/ajax.sword
</span></span><span class="line"><span class="cl">84309	1631791992.558541000	0.206305000	172.26.9.77	172.26.2.13	1200		200
</span></span><span class="line"><span class="cl">86253	1631791993.152426000	0.593767000	172.26.2.13	172.26.9.77	1200	http://plantegg/ajax.sword
</span></span><span class="line"><span class="cl">86740	1631791993.270402000	0.117311000	172.26.9.77	172.26.2.13	1200		200
</span></span><span class="line"><span class="cl">89775	1631791994.112908000	0.842414000	172.26.2.13	172.26.9.77	1200	http://plantegg/ajax.sword
</span></span><span class="line"><span class="cl">90429	1631791994.312254000	0.199015000	172.26.9.77	172.26.2.13	1200		200
</span></span><span class="line"><span class="cl">92840	1631791995.086191000	0.773857000	172.26.2.13	172.26.9.77	1200	http://plantegg/ajax.sword
</span></span><span class="line"><span class="cl">93262	1631791995.257123000	0.170488000	172.26.9.77	172.26.2.13	1200		200</span></span></code></pre>
</div>
<p>改进版本，每10秒钟统计http response耗时，最后按时间排序输出：</p>
<div class="code-block highlight is-open show-line-numbers  tw-group tw-my-2">
  <div class="
    code-block-title 
    
    tw-flex 
    tw-flex-row 
    tw-justify-between 
    tw-w-full tw-bg-bgColor-secondary
    ">      
    <button 
      class="
        tw-select-none 
        tw-mx-2 
        tw-block
        group-[.is-open]:tw-rotate-90
        tw-transition-[transform] 
        tw-duration-500 
        tw-ease-in-out
        print:!tw-hidden"
      disabled
      aria-hidden="true"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M285.476 272.971L91.132 467.314c-9.373 9.373-24.569 9.373-33.941 0l-22.667-22.667c-9.357-9.357-9.375-24.522-.04-33.901L188.505 256 34.484 101.255c-9.335-9.379-9.317-24.544.04-33.901l22.667-22.667c9.373-9.373 24.569-9.373 33.941 0L285.475 239.03c9.373 9.372 9.373 24.568.001 33.941z"/></svg></button>

    <div class="code-block-title-bar tw-w-full">
      <p class="tw-select-none !tw-my-1">text</p>
    </div>
    <div class="tw-flex">
      <button 
        class="
          line-number-button
          tw-select-none 
          tw-mx-2 
          tw-hidden 
          group-[.is-open]:tw-block 
          group-[.show-line-numbers]:tw-text-fgColor-link 
          print:!tw-hidden" 
        title="Toggle line numbers"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M61.77 401l17.5-20.15a19.92 19.92 0 0 0 5.07-14.19v-3.31C84.34 356 80.5 352 73 352H16a8 8 0 0 0-8 8v16a8 8 0 0 0 8 8h22.83a157.41 157.41 0 0 0-11 12.31l-5.61 7c-4 5.07-5.25 10.13-2.8 14.88l1.05 1.93c3 5.76 6.29 7.88 12.25 7.88h4.73c10.33 0 15.94 2.44 15.94 9.09 0 4.72-4.2 8.22-14.36 8.22a41.54 41.54 0 0 1-15.47-3.12c-6.49-3.88-11.74-3.5-15.6 3.12l-5.59 9.31c-3.72 6.13-3.19 11.72 2.63 15.94 7.71 4.69 20.38 9.44 37 9.44 34.16 0 48.5-22.75 48.5-44.12-.03-14.38-9.12-29.76-28.73-34.88zM496 224H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zm0-160H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16V80a16 16 0 0 0-16-16zm0 320H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zM16 160h64a8 8 0 0 0 8-8v-16a8 8 0 0 0-8-8H64V40a8 8 0 0 0-8-8H32a8 8 0 0 0-7.14 4.42l-8 16A8 8 0 0 0 24 64h8v64H16a8 8 0 0 0-8 8v16a8 8 0 0 0 8 8zm-3.91 160H80a8 8 0 0 0 8-8v-16a8 8 0 0 0-8-8H41.32c3.29-10.29 48.34-18.68 48.34-56.44 0-29.06-25-39.56-44.47-39.56-21.36 0-33.8 10-40.46 18.75-4.37 5.59-3 10.84 2.8 15.37l8.58 6.88c5.61 4.56 11 2.47 16.12-2.44a13.44 13.44 0 0 1 9.46-3.84c3.33 0 9.28 1.56 9.28 8.75C51 248.19 0 257.31 0 304.59v4C0 316 5.08 320 12.09 320z"/></svg></button>

      <button 
        class="
          wrap-code-button
          tw-select-none 
          tw-mx-2 
          tw-hidden 
          group-[.is-open]:tw-block 
          group-[.is-wrap]:tw-text-fgColor-link 
          print:!tw-hidden" 
        title="Toggle code wrap"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M16 132h416c8.837 0 16-7.163 16-16V76c0-8.837-7.163-16-16-16H16C7.163 60 0 67.163 0 76v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16z"/></svg></button>
      
      <button 
        class="
          copy-code-button
          tw-select-none
          tw-mx-2 
          tw-hidden
          group-[.is-open]:tw-block
          hover:tw-text-fgColor-link 
          print:!tw-hidden"
        title="Copy code">
          <span class="copy-icon tw-block"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M433.941 65.941l-51.882-51.882A48 48 0 0 0 348.118 0H176c-26.51 0-48 21.49-48 48v48H48c-26.51 0-48 21.49-48 48v320c0 26.51 21.49 48 48 48h224c26.51 0 48-21.49 48-48v-48h80c26.51 0 48-21.49 48-48V99.882a48 48 0 0 0-14.059-33.941zM266 464H54a6 6 0 0 1-6-6V150a6 6 0 0 1 6-6h74v224c0 26.51 21.49 48 48 48h96v42a6 6 0 0 1-6 6zm128-96H182a6 6 0 0 1-6-6V54a6 6 0 0 1 6-6h106v88c0 13.255 10.745 24 24 24h88v202a6 6 0 0 1-6 6zm6-256h-64V48h9.632c1.591 0 3.117.632 4.243 1.757l48.368 48.368a6 6 0 0 1 1.757 4.243V112z"/></svg></span>
          <span class="check-icon tw-hidden"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M173.898 439.404l-166.4-166.4c-9.997-9.997-9.997-26.206 0-36.204l36.203-36.204c9.997-9.998 26.207-9.998 36.204 0L192 312.69 432.095 72.596c9.997-9.997 26.207-9.997 36.204 0l36.203 36.204c9.997 9.997 9.997 26.206 0 36.204l-294.4 294.401c-9.998 9.997-26.207 9.997-36.204-.001z"/></svg></span>
      </button>
        
      <button 
        class="
          tw-select-none 
          tw-mx-2 
          tw-block 
          group-[.is-open]:tw-hidden 
          print:!tw-hidden" 
        disabled
        aria-hidden="true"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M328 256c0 39.8-32.2 72-72 72s-72-32.2-72-72 32.2-72 72-72 72 32.2 72 72zm104-72c-39.8 0-72 32.2-72 72s32.2 72 72 72 72-32.2 72-72-32.2-72-72-72zm-352 0c-39.8 0-72 32.2-72 72s32.2 72 72 72 72-32.2 72-72-32.2-72-72-72z"/></svg></button>
    </div>
  </div>
  <pre style="counter-reset: codeblock;" class="tw-block tw-m-0 tw-p-0"><code 
    id="codeblock-id-6" 
    class="
      chroma 
      !tw-block 
      tw-p-0
      tw-m-0
      tw-transition-[max-height] 
      tw-duration-500 
      tw-ease-in-out 
      group-[.is-closed]:!tw-max-h-0 
      group-[.is-wrap]:tw-text-wrap
      tw-overflow-y-hidden
      tw-overflow-x-auto
      tw-scrollbar-thin
      "><span class="line"><span class="cl">tshark -r 0623.pcap -Y &#39;http.time&gt;0 &#39; -T fields -e frame.number -e frame.time_epoch  -e frame.time_delta_displayed  -e ip.src -e ip.dst -e tcp.stream  -e http.request.full_uri -e http.response_for.uri  -e http.time  | awk &#39;{ print int($2/10), $8 }&#39; | awk &#39;{ sum[$1]+=$2; count[$1]+=1 ;} END { for (key in count) {  printf  &#34;time= %s  \t count=%s   \t avg=%.6f \n&#34;, key,  count[key], sum[key]/count[key] } }&#39; | sort -k2n | gawk &#39;{ print strftime(&#34;%c&#34;,$2*10), $0 }&#39;
</span></span><span class="line"><span class="cl">四  6/23 14:17:30 2022 time= 165596505  	 count=15289   	 avg=0.012168
</span></span><span class="line"><span class="cl">四  6/23 14:17:40 2022 time= 165596506  	 count=38725   	 avg=0.013669
</span></span><span class="line"><span class="cl">四  6/23 14:17:50 2022 time= 165596507  	 count=42545   	 avg=0.014140
</span></span><span class="line"><span class="cl">四  6/23 14:18:00 2022 time= 165596508  	 count=45613   	 avg=0.016915
</span></span><span class="line"><span class="cl">四  6/23 14:18:10 2022 time= 165596509  	 count=49033   	 avg=0.018768
</span></span><span class="line"><span class="cl">四  6/23 14:18:20 2022 time= 165596510  	 count=49797   	 avg=0.025015
</span></span><span class="line"><span class="cl">四  6/23 14:18:30 2022 time= 165596511  	 count=49670   	 avg=0.034057
</span></span><span class="line"><span class="cl">四  6/23 14:18:40 2022 time= 165596512  	 count=49524   	 avg=0.040647
</span></span><span class="line"><span class="cl">四  6/23 14:18:50 2022 time= 165596513  	 count=49204   	 avg=0.034251
</span></span><span class="line"><span class="cl">四  6/23 14:19:00 2022 time= 165596514  	 count=48024   	 avg=0.037120
</span></span><span class="line"><span class="cl">四  6/23 14:19:10 2022 time= 165596515  	 count=49301   	 avg=0.041453
</span></span><span class="line"><span class="cl">四  6/23 14:19:20 2022 time= 165596516  	 count=42174   	 avg=0.049191
</span></span><span class="line"><span class="cl">四  6/23 14:19:30 2022 time= 165596517  	 count=49437   	 avg=0.050924
</span></span><span class="line"><span class="cl">四  6/23 14:19:40 2022 time= 165596518  	 count=49563   	 avg=0.050709
</span></span><span class="line"><span class="cl">四  6/23 14:19:50 2022 time= 165596519  	 count=49517   	 avg=0.047916
</span></span><span class="line"><span class="cl">四  6/23 14:20:00 2022 time= 165596520  	 count=48256   	 avg=0.057453
</span></span><span class="line"><span class="cl">四  6/23 14:20:10 2022 time= 165596521  	 count=49412   	 avg=0.053587
</span></span><span class="line"><span class="cl">四  6/23 14:20:20 2022 time= 165596522  	 count=51361   	 avg=0.053422
</span></span><span class="line"><span class="cl">四  6/23 14:20:30 2022 time= 165596523  	 count=45610   	 avg=0.067171
</span></span><span class="line"><span class="cl">四  6/23 14:20:40 2022 time= 165596524  	 count=54   	 avg=2.886536</span></span></code></pre>
</div>
<h2 id="解析已知协议与ip域名映射" class="headerLink">
    <a href="#%e8%a7%a3%e6%9e%90%e5%b7%b2%e7%9f%a5%e5%8d%8f%e8%ae%ae%e4%b8%8eip%e5%9f%9f%e5%90%8d%e6%98%a0%e5%b0%84" class="header-mark"></a>解析已知协议与IP域名映射</h2><p>以下技巧抄自：https://www.ilikejobs.com/posts/wireshark/</p>
<p><img class="tw-inline" loading="lazy" src=https://cdn.jsdelivr.net/gh/plantegg/plantegg.github.io/images/951413iMgBlog/wireshark8.png   alt="wireshark"  ></p>
<h2 id="查询当前已经解析了哪些域名" class="headerLink">
    <a href="#%e6%9f%a5%e8%af%a2%e5%bd%93%e5%89%8d%e5%b7%b2%e7%bb%8f%e8%a7%a3%e6%9e%90%e4%ba%86%e5%93%aa%e4%ba%9b%e5%9f%9f%e5%90%8d" class="header-mark"></a>查询当前已经解析了哪些域名</h2><p><img class="tw-inline" loading="lazy" src=https://cdn.jsdelivr.net/gh/plantegg/plantegg.github.io/images/951413iMgBlog/wireshark9.png   alt="wireshark"  ></p>
<h2 id="设置私有ip名称" class="headerLink">
    <a href="#%e8%ae%be%e7%bd%ae%e7%a7%81%e6%9c%89ip%e5%90%8d%e7%a7%b0" class="header-mark"></a>设置私有IP名称</h2><p>先确认下图红框选项是选上的：</p>
<!-- raw HTML omitted -->
<p><img class="tw-inline" loading="lazy" src=https://cdn.jsdelivr.net/gh/plantegg/plantegg.github.io/images/951413iMgBlog/wireshark10.png   alt="wireshark"  ></p>
<p>查看刚设置自定义的名称：</p>
<p><img class="tw-inline" loading="lazy" src=https://cdn.jsdelivr.net/gh/plantegg/plantegg.github.io/images/951413iMgBlog/wireshark11.png   alt="wireshark"  ></p>
<h2 id="保存文件含host对应名称" class="headerLink">
    <a href="#%e4%bf%9d%e5%ad%98%e6%96%87%e4%bb%b6%e5%90%abhost%e5%af%b9%e5%ba%94%e5%90%8d%e7%a7%b0" class="header-mark"></a>保存文件（含host对应名称）</h2><p><img class="tw-inline" loading="lazy" src=https://cdn.jsdelivr.net/gh/plantegg/plantegg.github.io/images/951413iMgBlog/wireshark12.png   alt="wireshark"  ></p>
<h2 id="分析包的总概览" class="headerLink">
    <a href="#%e5%88%86%e6%9e%90%e5%8c%85%e7%9a%84%e6%80%bb%e6%a6%82%e8%a7%88" class="header-mark"></a>分析包的总概览</h2><div class="code-block highlight is-open show-line-numbers  tw-group tw-my-2">
  <div class="
    code-block-title 
    
    tw-flex 
    tw-flex-row 
    tw-justify-between 
    tw-w-full tw-bg-bgColor-secondary
    ">      
    <button 
      class="
        tw-select-none 
        tw-mx-2 
        tw-block
        group-[.is-open]:tw-rotate-90
        tw-transition-[transform] 
        tw-duration-500 
        tw-ease-in-out
        print:!tw-hidden"
      disabled
      aria-hidden="true"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M285.476 272.971L91.132 467.314c-9.373 9.373-24.569 9.373-33.941 0l-22.667-22.667c-9.357-9.357-9.375-24.522-.04-33.901L188.505 256 34.484 101.255c-9.335-9.379-9.317-24.544.04-33.901l22.667-22.667c9.373-9.373 24.569-9.373 33.941 0L285.475 239.03c9.373 9.372 9.373 24.568.001 33.941z"/></svg></button>

    <div class="code-block-title-bar tw-w-full">
      <p class="tw-select-none !tw-my-1">text</p>
    </div>
    <div class="tw-flex">
      <button 
        class="
          line-number-button
          tw-select-none 
          tw-mx-2 
          tw-hidden 
          group-[.is-open]:tw-block 
          group-[.show-line-numbers]:tw-text-fgColor-link 
          print:!tw-hidden" 
        title="Toggle line numbers"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M61.77 401l17.5-20.15a19.92 19.92 0 0 0 5.07-14.19v-3.31C84.34 356 80.5 352 73 352H16a8 8 0 0 0-8 8v16a8 8 0 0 0 8 8h22.83a157.41 157.41 0 0 0-11 12.31l-5.61 7c-4 5.07-5.25 10.13-2.8 14.88l1.05 1.93c3 5.76 6.29 7.88 12.25 7.88h4.73c10.33 0 15.94 2.44 15.94 9.09 0 4.72-4.2 8.22-14.36 8.22a41.54 41.54 0 0 1-15.47-3.12c-6.49-3.88-11.74-3.5-15.6 3.12l-5.59 9.31c-3.72 6.13-3.19 11.72 2.63 15.94 7.71 4.69 20.38 9.44 37 9.44 34.16 0 48.5-22.75 48.5-44.12-.03-14.38-9.12-29.76-28.73-34.88zM496 224H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zm0-160H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16V80a16 16 0 0 0-16-16zm0 320H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zM16 160h64a8 8 0 0 0 8-8v-16a8 8 0 0 0-8-8H64V40a8 8 0 0 0-8-8H32a8 8 0 0 0-7.14 4.42l-8 16A8 8 0 0 0 24 64h8v64H16a8 8 0 0 0-8 8v16a8 8 0 0 0 8 8zm-3.91 160H80a8 8 0 0 0 8-8v-16a8 8 0 0 0-8-8H41.32c3.29-10.29 48.34-18.68 48.34-56.44 0-29.06-25-39.56-44.47-39.56-21.36 0-33.8 10-40.46 18.75-4.37 5.59-3 10.84 2.8 15.37l8.58 6.88c5.61 4.56 11 2.47 16.12-2.44a13.44 13.44 0 0 1 9.46-3.84c3.33 0 9.28 1.56 9.28 8.75C51 248.19 0 257.31 0 304.59v4C0 316 5.08 320 12.09 320z"/></svg></button>

      <button 
        class="
          wrap-code-button
          tw-select-none 
          tw-mx-2 
          tw-hidden 
          group-[.is-open]:tw-block 
          group-[.is-wrap]:tw-text-fgColor-link 
          print:!tw-hidden" 
        title="Toggle code wrap"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M16 132h416c8.837 0 16-7.163 16-16V76c0-8.837-7.163-16-16-16H16C7.163 60 0 67.163 0 76v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16z"/></svg></button>
      
      <button 
        class="
          copy-code-button
          tw-select-none
          tw-mx-2 
          tw-hidden
          group-[.is-open]:tw-block
          hover:tw-text-fgColor-link 
          print:!tw-hidden"
        title="Copy code">
          <span class="copy-icon tw-block"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M433.941 65.941l-51.882-51.882A48 48 0 0 0 348.118 0H176c-26.51 0-48 21.49-48 48v48H48c-26.51 0-48 21.49-48 48v320c0 26.51 21.49 48 48 48h224c26.51 0 48-21.49 48-48v-48h80c26.51 0 48-21.49 48-48V99.882a48 48 0 0 0-14.059-33.941zM266 464H54a6 6 0 0 1-6-6V150a6 6 0 0 1 6-6h74v224c0 26.51 21.49 48 48 48h96v42a6 6 0 0 1-6 6zm128-96H182a6 6 0 0 1-6-6V54a6 6 0 0 1 6-6h106v88c0 13.255 10.745 24 24 24h88v202a6 6 0 0 1-6 6zm6-256h-64V48h9.632c1.591 0 3.117.632 4.243 1.757l48.368 48.368a6 6 0 0 1 1.757 4.243V112z"/></svg></span>
          <span class="check-icon tw-hidden"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M173.898 439.404l-166.4-166.4c-9.997-9.997-9.997-26.206 0-36.204l36.203-36.204c9.997-9.998 26.207-9.998 36.204 0L192 312.69 432.095 72.596c9.997-9.997 26.207-9.997 36.204 0l36.203 36.204c9.997 9.997 9.997 26.206 0 36.204l-294.4 294.401c-9.998 9.997-26.207 9.997-36.204-.001z"/></svg></span>
      </button>
        
      <button 
        class="
          tw-select-none 
          tw-mx-2 
          tw-block 
          group-[.is-open]:tw-hidden 
          print:!tw-hidden" 
        disabled
        aria-hidden="true"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M328 256c0 39.8-32.2 72-72 72s-72-32.2-72-72 32.2-72 72-72 72 32.2 72 72zm104-72c-39.8 0-72 32.2-72 72s32.2 72 72 72 72-32.2 72-72-32.2-72-72-72zm-352 0c-39.8 0-72 32.2-72 72s32.2 72 72 72 72-32.2 72-72-32.2-72-72-72z"/></svg></button>
    </div>
  </div>
  <pre style="counter-reset: codeblock;" class="tw-block tw-m-0 tw-p-0"><code 
    id="codeblock-id-7" 
    class="
      chroma 
      !tw-block 
      tw-p-0
      tw-m-0
      tw-transition-[max-height] 
      tw-duration-500 
      tw-ease-in-out 
      group-[.is-closed]:!tw-max-h-0 
      group-[.is-wrap]:tw-text-wrap
      tw-overflow-y-hidden
      tw-overflow-x-auto
      tw-scrollbar-thin
      "><span class="line"><span class="cl">$ capinfos rsb2.cap 
</span></span><span class="line"><span class="cl">File name:           rsb2.cap
</span></span><span class="line"><span class="cl">File type:           Wireshark/tcpdump/... - pcap
</span></span><span class="line"><span class="cl">File encapsulation:  Ethernet
</span></span><span class="line"><span class="cl">Packet size limit:   file hdr: 65535 bytes
</span></span><span class="line"><span class="cl">Number of packets:   510 k
</span></span><span class="line"><span class="cl">File size:           143 MB
</span></span><span class="line"><span class="cl">Data size:           135 MB
</span></span><span class="line"><span class="cl">Capture duration:    34 seconds
</span></span><span class="line"><span class="cl">Start time:          Tue Jun  7 11:15:31 2016
</span></span><span class="line"><span class="cl">End time:            Tue Jun  7 11:16:05 2016
</span></span><span class="line"><span class="cl">Data byte rate:      3997 kBps
</span></span><span class="line"><span class="cl">Data bit rate:       31 Mbps
</span></span><span class="line"><span class="cl">Average packet size: 265.62 bytes
</span></span><span class="line"><span class="cl">Average packet rate: 15 kpackets/sec
</span></span><span class="line"><span class="cl">SHA1:                a8367d0d291eab6ba78732d092ae72a5305756a2
</span></span><span class="line"><span class="cl">RIPEMD160:           ec991772819f316d2f629745d4b58fb861e41fc6
</span></span><span class="line"><span class="cl">MD5:                 53975139fa49581eacdb42bd967cbd58
</span></span><span class="line"><span class="cl">Strict time order:   False</span></span></code></pre>
</div>
<h2 id="分析每两个ip之间的流量" class="headerLink">
    <a href="#%e5%88%86%e6%9e%90%e6%af%8f%e4%b8%a4%e4%b8%aaip%e4%b9%8b%e9%97%b4%e7%9a%84%e6%b5%81%e9%87%8f" class="header-mark"></a>分析每两个IP之间的流量</h2><div class="code-block highlight is-open show-line-numbers  tw-group tw-my-2">
  <div class="
    code-block-title 
    
    tw-flex 
    tw-flex-row 
    tw-justify-between 
    tw-w-full tw-bg-bgColor-secondary
    ">      
    <button 
      class="
        tw-select-none 
        tw-mx-2 
        tw-block
        group-[.is-open]:tw-rotate-90
        tw-transition-[transform] 
        tw-duration-500 
        tw-ease-in-out
        print:!tw-hidden"
      disabled
      aria-hidden="true"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M285.476 272.971L91.132 467.314c-9.373 9.373-24.569 9.373-33.941 0l-22.667-22.667c-9.357-9.357-9.375-24.522-.04-33.901L188.505 256 34.484 101.255c-9.335-9.379-9.317-24.544.04-33.901l22.667-22.667c9.373-9.373 24.569-9.373 33.941 0L285.475 239.03c9.373 9.372 9.373 24.568.001 33.941z"/></svg></button>

    <div class="code-block-title-bar tw-w-full">
      <p class="tw-select-none !tw-my-1">text</p>
    </div>
    <div class="tw-flex">
      <button 
        class="
          line-number-button
          tw-select-none 
          tw-mx-2 
          tw-hidden 
          group-[.is-open]:tw-block 
          group-[.show-line-numbers]:tw-text-fgColor-link 
          print:!tw-hidden" 
        title="Toggle line numbers"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M61.77 401l17.5-20.15a19.92 19.92 0 0 0 5.07-14.19v-3.31C84.34 356 80.5 352 73 352H16a8 8 0 0 0-8 8v16a8 8 0 0 0 8 8h22.83a157.41 157.41 0 0 0-11 12.31l-5.61 7c-4 5.07-5.25 10.13-2.8 14.88l1.05 1.93c3 5.76 6.29 7.88 12.25 7.88h4.73c10.33 0 15.94 2.44 15.94 9.09 0 4.72-4.2 8.22-14.36 8.22a41.54 41.54 0 0 1-15.47-3.12c-6.49-3.88-11.74-3.5-15.6 3.12l-5.59 9.31c-3.72 6.13-3.19 11.72 2.63 15.94 7.71 4.69 20.38 9.44 37 9.44 34.16 0 48.5-22.75 48.5-44.12-.03-14.38-9.12-29.76-28.73-34.88zM496 224H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zm0-160H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16V80a16 16 0 0 0-16-16zm0 320H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zM16 160h64a8 8 0 0 0 8-8v-16a8 8 0 0 0-8-8H64V40a8 8 0 0 0-8-8H32a8 8 0 0 0-7.14 4.42l-8 16A8 8 0 0 0 24 64h8v64H16a8 8 0 0 0-8 8v16a8 8 0 0 0 8 8zm-3.91 160H80a8 8 0 0 0 8-8v-16a8 8 0 0 0-8-8H41.32c3.29-10.29 48.34-18.68 48.34-56.44 0-29.06-25-39.56-44.47-39.56-21.36 0-33.8 10-40.46 18.75-4.37 5.59-3 10.84 2.8 15.37l8.58 6.88c5.61 4.56 11 2.47 16.12-2.44a13.44 13.44 0 0 1 9.46-3.84c3.33 0 9.28 1.56 9.28 8.75C51 248.19 0 257.31 0 304.59v4C0 316 5.08 320 12.09 320z"/></svg></button>

      <button 
        class="
          wrap-code-button
          tw-select-none 
          tw-mx-2 
          tw-hidden 
          group-[.is-open]:tw-block 
          group-[.is-wrap]:tw-text-fgColor-link 
          print:!tw-hidden" 
        title="Toggle code wrap"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M16 132h416c8.837 0 16-7.163 16-16V76c0-8.837-7.163-16-16-16H16C7.163 60 0 67.163 0 76v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16z"/></svg></button>
      
      <button 
        class="
          copy-code-button
          tw-select-none
          tw-mx-2 
          tw-hidden
          group-[.is-open]:tw-block
          hover:tw-text-fgColor-link 
          print:!tw-hidden"
        title="Copy code">
          <span class="copy-icon tw-block"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M433.941 65.941l-51.882-51.882A48 48 0 0 0 348.118 0H176c-26.51 0-48 21.49-48 48v48H48c-26.51 0-48 21.49-48 48v320c0 26.51 21.49 48 48 48h224c26.51 0 48-21.49 48-48v-48h80c26.51 0 48-21.49 48-48V99.882a48 48 0 0 0-14.059-33.941zM266 464H54a6 6 0 0 1-6-6V150a6 6 0 0 1 6-6h74v224c0 26.51 21.49 48 48 48h96v42a6 6 0 0 1-6 6zm128-96H182a6 6 0 0 1-6-6V54a6 6 0 0 1 6-6h106v88c0 13.255 10.745 24 24 24h88v202a6 6 0 0 1-6 6zm6-256h-64V48h9.632c1.591 0 3.117.632 4.243 1.757l48.368 48.368a6 6 0 0 1 1.757 4.243V112z"/></svg></span>
          <span class="check-icon tw-hidden"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M173.898 439.404l-166.4-166.4c-9.997-9.997-9.997-26.206 0-36.204l36.203-36.204c9.997-9.998 26.207-9.998 36.204 0L192 312.69 432.095 72.596c9.997-9.997 26.207-9.997 36.204 0l36.203 36.204c9.997 9.997 9.997 26.206 0 36.204l-294.4 294.401c-9.998 9.997-26.207 9.997-36.204-.001z"/></svg></span>
      </button>
        
      <button 
        class="
          tw-select-none 
          tw-mx-2 
          tw-block 
          group-[.is-open]:tw-hidden 
          print:!tw-hidden" 
        disabled
        aria-hidden="true"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M328 256c0 39.8-32.2 72-72 72s-72-32.2-72-72 32.2-72 72-72 72 32.2 72 72zm104-72c-39.8 0-72 32.2-72 72s32.2 72 72 72 72-32.2 72-72-32.2-72-72-72zm-352 0c-39.8 0-72 32.2-72 72s32.2 72 72 72 72-32.2 72-72-32.2-72-72-72z"/></svg></button>
    </div>
  </div>
  <pre style="counter-reset: codeblock;" class="tw-block tw-m-0 tw-p-0"><code 
    id="codeblock-id-8" 
    class="
      chroma 
      !tw-block 
      tw-p-0
      tw-m-0
      tw-transition-[max-height] 
      tw-duration-500 
      tw-ease-in-out 
      group-[.is-closed]:!tw-max-h-0 
      group-[.is-wrap]:tw-text-wrap
      tw-overflow-y-hidden
      tw-overflow-x-auto
      tw-scrollbar-thin
      "><span class="line"><span class="cl">$ tshark -r retrans.cap -q -z &#39;conv,ip&#39; 
</span></span><span class="line"><span class="cl">================================================================================
</span></span><span class="line"><span class="cl">IPv4 Conversations
</span></span><span class="line"><span class="cl">Filter:&lt;No Filter&gt;
</span></span><span class="line"><span class="cl">                                               |       &lt;-      | |       -&gt;      | |     Total     |    Relative    |   Duration   |
</span></span><span class="line"><span class="cl">                                               | Frames  Bytes | | Frames  Bytes | | Frames  Bytes |      Start     |              |
</span></span><span class="line"><span class="cl">100.98.50.214        &lt;-&gt; 10.117.41.213            425     60647     544    350182     969    410829     0.856983000        88.7073
</span></span><span class="line"><span class="cl">10.252.138.13        &lt;-&gt; 10.117.41.213            381    131639     451     45706     832    177345     3.649894000        79.5370
</span></span><span class="line"><span class="cl">10.168.127.178       &lt;-&gt; 10.117.41.213            335    118164     390     39069     725    157233     3.456698000        81.2639
</span></span><span class="line"><span class="cl">10.168.246.105       &lt;-&gt; 10.117.41.213            435     23490     271     14634     706     38124     0.000000000        89.7614
</span></span><span class="line"><span class="cl">10.117.49.244        &lt;-&gt; 10.117.41.213            452     24408     221     11934     673     36342     0.289990000        89.6024
</span></span><span class="line"><span class="cl">100.97.197.0         &lt;-&gt; 10.117.41.213             45      4226     107      7310     152     11536     0.538867000        88.0736
</span></span><span class="line"><span class="cl">100.97.196.0         &lt;-&gt; 10.117.41.213             48      4576     102      6960     150     11536     0.524268000        89.0840
</span></span><span class="line"><span class="cl">100.97.196.128       &lt;-&gt; 10.117.41.213             39      3462      90      6116     129      9578     0.573839000        88.0728
</span></span><span class="line"><span class="cl">100.97.197.128       &lt;-&gt; 10.117.41.213             27      1998      81      5562     108      7560     1.071232000        87.0382
</span></span><span class="line"><span class="cl">100.98.148.129       &lt;-&gt; 10.117.41.213             55      3630      37      2442      92      6072     0.571963000        86.7362
</span></span><span class="line"><span class="cl">================================================================================</span></span></code></pre>
</div>
<h2 id="分析每个会话的流量" class="headerLink">
    <a href="#%e5%88%86%e6%9e%90%e6%af%8f%e4%b8%aa%e4%bc%9a%e8%af%9d%e7%9a%84%e6%b5%81%e9%87%8f" class="header-mark"></a>分析每个会话的流量</h2><div class="code-block highlight is-open show-line-numbers  tw-group tw-my-2">
  <div class="
    code-block-title 
    
    tw-flex 
    tw-flex-row 
    tw-justify-between 
    tw-w-full tw-bg-bgColor-secondary
    ">      
    <button 
      class="
        tw-select-none 
        tw-mx-2 
        tw-block
        group-[.is-open]:tw-rotate-90
        tw-transition-[transform] 
        tw-duration-500 
        tw-ease-in-out
        print:!tw-hidden"
      disabled
      aria-hidden="true"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M285.476 272.971L91.132 467.314c-9.373 9.373-24.569 9.373-33.941 0l-22.667-22.667c-9.357-9.357-9.375-24.522-.04-33.901L188.505 256 34.484 101.255c-9.335-9.379-9.317-24.544.04-33.901l22.667-22.667c9.373-9.373 24.569-9.373 33.941 0L285.475 239.03c9.373 9.372 9.373 24.568.001 33.941z"/></svg></button>

    <div class="code-block-title-bar tw-w-full">
      <p class="tw-select-none !tw-my-1">text</p>
    </div>
    <div class="tw-flex">
      <button 
        class="
          line-number-button
          tw-select-none 
          tw-mx-2 
          tw-hidden 
          group-[.is-open]:tw-block 
          group-[.show-line-numbers]:tw-text-fgColor-link 
          print:!tw-hidden" 
        title="Toggle line numbers"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M61.77 401l17.5-20.15a19.92 19.92 0 0 0 5.07-14.19v-3.31C84.34 356 80.5 352 73 352H16a8 8 0 0 0-8 8v16a8 8 0 0 0 8 8h22.83a157.41 157.41 0 0 0-11 12.31l-5.61 7c-4 5.07-5.25 10.13-2.8 14.88l1.05 1.93c3 5.76 6.29 7.88 12.25 7.88h4.73c10.33 0 15.94 2.44 15.94 9.09 0 4.72-4.2 8.22-14.36 8.22a41.54 41.54 0 0 1-15.47-3.12c-6.49-3.88-11.74-3.5-15.6 3.12l-5.59 9.31c-3.72 6.13-3.19 11.72 2.63 15.94 7.71 4.69 20.38 9.44 37 9.44 34.16 0 48.5-22.75 48.5-44.12-.03-14.38-9.12-29.76-28.73-34.88zM496 224H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zm0-160H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16V80a16 16 0 0 0-16-16zm0 320H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zM16 160h64a8 8 0 0 0 8-8v-16a8 8 0 0 0-8-8H64V40a8 8 0 0 0-8-8H32a8 8 0 0 0-7.14 4.42l-8 16A8 8 0 0 0 24 64h8v64H16a8 8 0 0 0-8 8v16a8 8 0 0 0 8 8zm-3.91 160H80a8 8 0 0 0 8-8v-16a8 8 0 0 0-8-8H41.32c3.29-10.29 48.34-18.68 48.34-56.44 0-29.06-25-39.56-44.47-39.56-21.36 0-33.8 10-40.46 18.75-4.37 5.59-3 10.84 2.8 15.37l8.58 6.88c5.61 4.56 11 2.47 16.12-2.44a13.44 13.44 0 0 1 9.46-3.84c3.33 0 9.28 1.56 9.28 8.75C51 248.19 0 257.31 0 304.59v4C0 316 5.08 320 12.09 320z"/></svg></button>

      <button 
        class="
          wrap-code-button
          tw-select-none 
          tw-mx-2 
          tw-hidden 
          group-[.is-open]:tw-block 
          group-[.is-wrap]:tw-text-fgColor-link 
          print:!tw-hidden" 
        title="Toggle code wrap"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M16 132h416c8.837 0 16-7.163 16-16V76c0-8.837-7.163-16-16-16H16C7.163 60 0 67.163 0 76v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16z"/></svg></button>
      
      <button 
        class="
          copy-code-button
          tw-select-none
          tw-mx-2 
          tw-hidden
          group-[.is-open]:tw-block
          hover:tw-text-fgColor-link 
          print:!tw-hidden"
        title="Copy code">
          <span class="copy-icon tw-block"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M433.941 65.941l-51.882-51.882A48 48 0 0 0 348.118 0H176c-26.51 0-48 21.49-48 48v48H48c-26.51 0-48 21.49-48 48v320c0 26.51 21.49 48 48 48h224c26.51 0 48-21.49 48-48v-48h80c26.51 0 48-21.49 48-48V99.882a48 48 0 0 0-14.059-33.941zM266 464H54a6 6 0 0 1-6-6V150a6 6 0 0 1 6-6h74v224c0 26.51 21.49 48 48 48h96v42a6 6 0 0 1-6 6zm128-96H182a6 6 0 0 1-6-6V54a6 6 0 0 1 6-6h106v88c0 13.255 10.745 24 24 24h88v202a6 6 0 0 1-6 6zm6-256h-64V48h9.632c1.591 0 3.117.632 4.243 1.757l48.368 48.368a6 6 0 0 1 1.757 4.243V112z"/></svg></span>
          <span class="check-icon tw-hidden"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M173.898 439.404l-166.4-166.4c-9.997-9.997-9.997-26.206 0-36.204l36.203-36.204c9.997-9.998 26.207-9.998 36.204 0L192 312.69 432.095 72.596c9.997-9.997 26.207-9.997 36.204 0l36.203 36.204c9.997 9.997 9.997 26.206 0 36.204l-294.4 294.401c-9.998 9.997-26.207 9.997-36.204-.001z"/></svg></span>
      </button>
        
      <button 
        class="
          tw-select-none 
          tw-mx-2 
          tw-block 
          group-[.is-open]:tw-hidden 
          print:!tw-hidden" 
        disabled
        aria-hidden="true"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M328 256c0 39.8-32.2 72-72 72s-72-32.2-72-72 32.2-72 72-72 72 32.2 72 72zm104-72c-39.8 0-72 32.2-72 72s32.2 72 72 72 72-32.2 72-72-32.2-72-72-72zm-352 0c-39.8 0-72 32.2-72 72s32.2 72 72 72 72-32.2 72-72-32.2-72-72-72z"/></svg></button>
    </div>
  </div>
  <pre style="counter-reset: codeblock;" class="tw-block tw-m-0 tw-p-0"><code 
    id="codeblock-id-9" 
    class="
      chroma 
      !tw-block 
      tw-p-0
      tw-m-0
      tw-transition-[max-height] 
      tw-duration-500 
      tw-ease-in-out 
      group-[.is-closed]:!tw-max-h-0 
      group-[.is-wrap]:tw-text-wrap
      tw-overflow-y-hidden
      tw-overflow-x-auto
      tw-scrollbar-thin
      "><span class="line"><span class="cl">$ tshark -r retrans.cap -q -z &#39;conv,tcp&#39; 
</span></span><span class="line"><span class="cl">================================================================================
</span></span><span class="line"><span class="cl">TCP Conversations
</span></span><span class="line"><span class="cl">Filter:&lt;No Filter&gt;
</span></span><span class="line"><span class="cl">                                               |       &lt;-      | |       -&gt;      | |     Total     |    Relative    |   Duration   |
</span></span><span class="line"><span class="cl">                                               | Frames  Bytes | | Frames  Bytes | | Frames  Bytes |      Start     |              |
</span></span><span class="line"><span class="cl">10.117.41.213:33362  &lt;-&gt; 100.98.50.214:3306       143    107183     108     17345     251    124528     9.556973000        79.9993
</span></span><span class="line"><span class="cl">10.117.41.213:32695  &lt;-&gt; 100.98.50.214:3306       131     95816     118     17843     249    113659     3.464596000        54.7814
</span></span><span class="line"><span class="cl">10.117.41.213:33737  &lt;-&gt; 100.98.50.214:3306       107     67199      82     11842     189     79041    69.539519000        13.0781
</span></span><span class="line"><span class="cl">10.117.41.213:33736  &lt;-&gt; 100.98.50.214:3306        58     37851      31      4895      89     42746    69.539133000         8.2015
</span></span><span class="line"><span class="cl">10.117.41.213:33735  &lt;-&gt; 100.98.50.214:3306        51     37654      27      3338      78     40992    69.538573000        20.0257
</span></span><span class="line"><span class="cl">10.117.41.213:33681  &lt;-&gt; 100.98.50.214:3306        22      2367      15      2480      37      4847    58.237482000         0.0082
</span></span><span class="line"><span class="cl">10.252.138.13:17926  &lt;-&gt; 10.117.41.213:3306        13      3454      17      1917      30      5371    77.462089000         0.2816
</span></span><span class="line"><span class="cl">10.168.127.178:21250 &lt;-&gt; 10.117.41.213:3306        13      4926      17      2267      30      7193    77.442197000         0.6282
</span></span><span class="line"><span class="cl">10.252.138.13:17682  &lt;-&gt; 10.117.41.213:3306        13      5421      17      2267      30      7688    34.945805000         0.7274
</span></span><span class="line"><span class="cl">10.168.127.178:21001 &lt;-&gt; 10.117.41.213:3306        18      9872      11      1627      29     11499    21.220800000        35.0242
</span></span><span class="line"><span class="cl">10.252.138.13:17843  &lt;-&gt; 10.117.41.213:3306        13      4453      15      1510      28      5963    59.176447000        10.8169
</span></span><span class="line"><span class="cl">10.168.127.178:20927 &lt;-&gt; 10.117.41.213:3306        12      4414      15      1510      27      5924    13.686763000         0.1860
</span></span><span class="line"><span class="cl">10.252.138.13:17481  &lt;-&gt; 10.117.41.213:3306        11      4360      16      1564      27      5924     3.649894000         0.1810
</span></span><span class="line"><span class="cl">10.252.138.13:17928  &lt;-&gt; 10.117.41.213:3306        11      3077      15      1461      26      4538    77.467248000         0.6720
</span></span><span class="line"><span class="cl">10.168.127.178:21241 &lt;-&gt; 10.117.41.213:3306        11      3077      15      1461      26      4538    77.376858000         0.4669
</span></span><span class="line"><span class="cl">10.168.127.178:21201 &lt;-&gt; 10.117.41.213:3306        12      3971      14      2571      26      6542    64.890147000         5.4010
</span></span><span class="line"><span class="cl">10.168.127.178:21184 &lt;-&gt; 10.117.41.213:3306        12      6775      14      1794      26      8569    64.073021000         5.6804
</span></span><span class="line"><span class="cl">10.252.138.13:17545  &lt;-&gt; 10.117.41.213:3306        11      4379      15      1510      26      5889    13.940379000         0.1845
</span></span><span class="line"><span class="cl">10.168.127.178:20815 &lt;-&gt; 10.117.41.213:3306        11      4360      15      1510      26      5870     3.456698000         0.1901
</span></span><span class="line"><span class="cl">10.252.138.13:17864  &lt;-&gt; 10.117.41.213:3306        12      2985      12      1129      24      4114    59.855131000         9.7005
</span></span><span class="line"><span class="cl">10.252.138.13:17820  &lt;-&gt; 10.117.41.213:3306        11      5529      13      1740      24      7269    49.537379000         0.1669
</span></span><span class="line"><span class="cl">10.252.138.13:17757  &lt;-&gt; 10.117.41.213:3306        11      6006      13      1740      24      7746    45.507148000         0.7587
</span></span><span class="line"><span class="cl">10.252.138.13:17677  &lt;-&gt; 10.117.41.213:3306        11      5529      13      1740      24      7269    34.806484000         0.5017
</span></span><span class="line"><span class="cl">10.168.127.178:21063 &lt;-&gt; 10.117.41.213:3306        11      3848      13      1390      24      5238    29.902032000         0.0133
</span></span><span class="line"><span class="cl">10.252.138.13:17516  &lt;-&gt; 10.117.41.213:3306        11      5985      13      1740      24      7725    11.505585000         0.1494
</span></span><span class="line"><span class="cl">10.252.138.13:17507  &lt;-&gt; 10.117.41.213:3306        11      3570      13      1424      24      4994     9.652955000         0.0151
</span></span><span class="line"><span class="cl">10.252.138.13:17490  &lt;-&gt; 10.117.41.213:3306        11      5985      13      1740      24      7725     4.865639000         0.1275</span></span></code></pre>
</div>
<h2 id="分析每个包的response-time" class="headerLink">
    <a href="#%e5%88%86%e6%9e%90%e6%af%8f%e4%b8%aa%e5%8c%85%e7%9a%84response-time" class="header-mark"></a>分析每个包的response time</h2><blockquote>
  <p>$ tshark -r rsb2.cap  -o tcp.calculate_timestamps:true -T fields  -e frame.number -e frame.time_epoch -e ip.src -e ip.dst  -e tcp.stream  -e tcp.len   -e tcp.analysis.initial_rtt  -e tcp.time_delta</p>

</blockquote><div class="code-block highlight is-open show-line-numbers  tw-group tw-my-2">
  <div class="
    code-block-title 
    
    tw-flex 
    tw-flex-row 
    tw-justify-between 
    tw-w-full tw-bg-bgColor-secondary
    ">      
    <button 
      class="
        tw-select-none 
        tw-mx-2 
        tw-block
        group-[.is-open]:tw-rotate-90
        tw-transition-[transform] 
        tw-duration-500 
        tw-ease-in-out
        print:!tw-hidden"
      disabled
      aria-hidden="true"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M285.476 272.971L91.132 467.314c-9.373 9.373-24.569 9.373-33.941 0l-22.667-22.667c-9.357-9.357-9.375-24.522-.04-33.901L188.505 256 34.484 101.255c-9.335-9.379-9.317-24.544.04-33.901l22.667-22.667c9.373-9.373 24.569-9.373 33.941 0L285.475 239.03c9.373 9.372 9.373 24.568.001 33.941z"/></svg></button>

    <div class="code-block-title-bar tw-w-full">
      <p class="tw-select-none !tw-my-1">text</p>
    </div>
    <div class="tw-flex">
      <button 
        class="
          line-number-button
          tw-select-none 
          tw-mx-2 
          tw-hidden 
          group-[.is-open]:tw-block 
          group-[.show-line-numbers]:tw-text-fgColor-link 
          print:!tw-hidden" 
        title="Toggle line numbers"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M61.77 401l17.5-20.15a19.92 19.92 0 0 0 5.07-14.19v-3.31C84.34 356 80.5 352 73 352H16a8 8 0 0 0-8 8v16a8 8 0 0 0 8 8h22.83a157.41 157.41 0 0 0-11 12.31l-5.61 7c-4 5.07-5.25 10.13-2.8 14.88l1.05 1.93c3 5.76 6.29 7.88 12.25 7.88h4.73c10.33 0 15.94 2.44 15.94 9.09 0 4.72-4.2 8.22-14.36 8.22a41.54 41.54 0 0 1-15.47-3.12c-6.49-3.88-11.74-3.5-15.6 3.12l-5.59 9.31c-3.72 6.13-3.19 11.72 2.63 15.94 7.71 4.69 20.38 9.44 37 9.44 34.16 0 48.5-22.75 48.5-44.12-.03-14.38-9.12-29.76-28.73-34.88zM496 224H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zm0-160H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16V80a16 16 0 0 0-16-16zm0 320H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zM16 160h64a8 8 0 0 0 8-8v-16a8 8 0 0 0-8-8H64V40a8 8 0 0 0-8-8H32a8 8 0 0 0-7.14 4.42l-8 16A8 8 0 0 0 24 64h8v64H16a8 8 0 0 0-8 8v16a8 8 0 0 0 8 8zm-3.91 160H80a8 8 0 0 0 8-8v-16a8 8 0 0 0-8-8H41.32c3.29-10.29 48.34-18.68 48.34-56.44 0-29.06-25-39.56-44.47-39.56-21.36 0-33.8 10-40.46 18.75-4.37 5.59-3 10.84 2.8 15.37l8.58 6.88c5.61 4.56 11 2.47 16.12-2.44a13.44 13.44 0 0 1 9.46-3.84c3.33 0 9.28 1.56 9.28 8.75C51 248.19 0 257.31 0 304.59v4C0 316 5.08 320 12.09 320z"/></svg></button>

      <button 
        class="
          wrap-code-button
          tw-select-none 
          tw-mx-2 
          tw-hidden 
          group-[.is-open]:tw-block 
          group-[.is-wrap]:tw-text-fgColor-link 
          print:!tw-hidden" 
        title="Toggle code wrap"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M16 132h416c8.837 0 16-7.163 16-16V76c0-8.837-7.163-16-16-16H16C7.163 60 0 67.163 0 76v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16z"/></svg></button>
      
      <button 
        class="
          copy-code-button
          tw-select-none
          tw-mx-2 
          tw-hidden
          group-[.is-open]:tw-block
          hover:tw-text-fgColor-link 
          print:!tw-hidden"
        title="Copy code">
          <span class="copy-icon tw-block"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M433.941 65.941l-51.882-51.882A48 48 0 0 0 348.118 0H176c-26.51 0-48 21.49-48 48v48H48c-26.51 0-48 21.49-48 48v320c0 26.51 21.49 48 48 48h224c26.51 0 48-21.49 48-48v-48h80c26.51 0 48-21.49 48-48V99.882a48 48 0 0 0-14.059-33.941zM266 464H54a6 6 0 0 1-6-6V150a6 6 0 0 1 6-6h74v224c0 26.51 21.49 48 48 48h96v42a6 6 0 0 1-6 6zm128-96H182a6 6 0 0 1-6-6V54a6 6 0 0 1 6-6h106v88c0 13.255 10.745 24 24 24h88v202a6 6 0 0 1-6 6zm6-256h-64V48h9.632c1.591 0 3.117.632 4.243 1.757l48.368 48.368a6 6 0 0 1 1.757 4.243V112z"/></svg></span>
          <span class="check-icon tw-hidden"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M173.898 439.404l-166.4-166.4c-9.997-9.997-9.997-26.206 0-36.204l36.203-36.204c9.997-9.998 26.207-9.998 36.204 0L192 312.69 432.095 72.596c9.997-9.997 26.207-9.997 36.204 0l36.203 36.204c9.997 9.997 9.997 26.206 0 36.204l-294.4 294.401c-9.998 9.997-26.207 9.997-36.204-.001z"/></svg></span>
      </button>
        
      <button 
        class="
          tw-select-none 
          tw-mx-2 
          tw-block 
          group-[.is-open]:tw-hidden 
          print:!tw-hidden" 
        disabled
        aria-hidden="true"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M328 256c0 39.8-32.2 72-72 72s-72-32.2-72-72 32.2-72 72-72 72 32.2 72 72zm104-72c-39.8 0-72 32.2-72 72s32.2 72 72 72 72-32.2 72-72-32.2-72-72-72zm-352 0c-39.8 0-72 32.2-72 72s32.2 72 72 72 72-32.2 72-72-32.2-72-72-72z"/></svg></button>
    </div>
  </div>
  <pre style="counter-reset: codeblock;" class="tw-block tw-m-0 tw-p-0"><code 
    id="codeblock-id-10" 
    class="
      chroma 
      !tw-block 
      tw-p-0
      tw-m-0
      tw-transition-[max-height] 
      tw-duration-500 
      tw-ease-in-out 
      group-[.is-closed]:!tw-max-h-0 
      group-[.is-wrap]:tw-text-wrap
      tw-overflow-y-hidden
      tw-overflow-x-auto
      tw-scrollbar-thin
      "><span class="line"><span class="cl">1481	1465269331.308138000	100.98.199.36	10.25.92.13	302	0		0.002276000
</span></span><span class="line"><span class="cl">1482	1465269331.308186000	10.25.92.13	    100.98.199.36	361	11	0.000063000
</span></span><span class="line"><span class="cl">1483	1465269331.308209000	100.98.199.36	10.25.92.13	496	0		0.004950000
</span></span><span class="line"><span class="cl">1484	1465269331.308223000	100.98.199.36	10.25.92.13	513	0		0.000000000
</span></span><span class="line"><span class="cl">1485	1465269331.308238000	100.98.199.36	10.25.92.13	326	0		0.055424000
</span></span><span class="line"><span class="cl">1486	1465269331.308246000	100.98.199.36	10.25.92.13	514	0		0.000000000
</span></span><span class="line"><span class="cl">1487	1465269331.308261000	10.25.92.71	    10.25.92.13	48	0		0.000229000
</span></span><span class="line"><span class="cl">1488	1465269331.308277000	100.98.199.36	10.25.92.13	254	0		0.055514000
</span></span><span class="line"><span class="cl">1489	1465269331.308307000	100.98.199.36	10.25.92.13	292	0		0.002096000
</span></span><span class="line"><span class="cl">1490	1465269331.308383000	100.98.199.36	10.25.92.13	308	0		0.055406000
</span></span><span class="line"><span class="cl">1491	1465269331.308403000	100.98.199.36	10.25.92.13	75	0		0.041664000
</span></span><span class="line"><span class="cl">1492	1465269331.308421000	100.98.199.36	10.25.92.13	291	0		0.001973000
</span></span><span class="line"><span class="cl">1493	1465269331.308532000	100.98.199.36	10.25.92.13	509	0		0.002100000
</span></span><span class="line"><span class="cl">1494	1465269331.308567000	100.98.199.36	10.25.92.13	123	0		0.041560000
</span></span><span class="line"><span class="cl">1495	1465269331.308576000	100.98.199.36	10.25.92.13	232	11		0.063317000
</span></span><span class="line"><span class="cl">1496	1465269331.308584000	100.98.199.36	10.25.92.13	465	655		0.018121000
</span></span><span class="line"><span class="cl">1497	1465269331.308626000	100.98.199.36	10.25.92.13	61	655		0.042409000
</span></span><span class="line"><span class="cl">1498	1465269331.308637000	100.98.199.36	10.25.92.13	146	0		0.001520000
</span></span><span class="line"><span class="cl">1499	1465269331.308639000	100.98.199.36	10.25.92.13	510	0		0.001460000
</span></span><span class="line"><span class="cl">1500	1465269331.308645000	100.98.199.36	10.25.92.13	237	11		0.063273000</span></span></code></pre>
</div>
<h2 id="分析有问题的包概览" class="headerLink">
    <a href="#%e5%88%86%e6%9e%90%e6%9c%89%e9%97%ae%e9%a2%98%e7%9a%84%e5%8c%85%e6%a6%82%e8%a7%88" class="header-mark"></a>分析有问题的包、概览</h2><div class="code-block highlight is-open show-line-numbers  tw-group tw-my-2">
  <div class="
    code-block-title 
    
    tw-flex 
    tw-flex-row 
    tw-justify-between 
    tw-w-full tw-bg-bgColor-secondary
    ">      
    <button 
      class="
        tw-select-none 
        tw-mx-2 
        tw-block
        group-[.is-open]:tw-rotate-90
        tw-transition-[transform] 
        tw-duration-500 
        tw-ease-in-out
        print:!tw-hidden"
      disabled
      aria-hidden="true"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M285.476 272.971L91.132 467.314c-9.373 9.373-24.569 9.373-33.941 0l-22.667-22.667c-9.357-9.357-9.375-24.522-.04-33.901L188.505 256 34.484 101.255c-9.335-9.379-9.317-24.544.04-33.901l22.667-22.667c9.373-9.373 24.569-9.373 33.941 0L285.475 239.03c9.373 9.372 9.373 24.568.001 33.941z"/></svg></button>

    <div class="code-block-title-bar tw-w-full">
      <p class="tw-select-none !tw-my-1">text</p>
    </div>
    <div class="tw-flex">
      <button 
        class="
          line-number-button
          tw-select-none 
          tw-mx-2 
          tw-hidden 
          group-[.is-open]:tw-block 
          group-[.show-line-numbers]:tw-text-fgColor-link 
          print:!tw-hidden" 
        title="Toggle line numbers"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M61.77 401l17.5-20.15a19.92 19.92 0 0 0 5.07-14.19v-3.31C84.34 356 80.5 352 73 352H16a8 8 0 0 0-8 8v16a8 8 0 0 0 8 8h22.83a157.41 157.41 0 0 0-11 12.31l-5.61 7c-4 5.07-5.25 10.13-2.8 14.88l1.05 1.93c3 5.76 6.29 7.88 12.25 7.88h4.73c10.33 0 15.94 2.44 15.94 9.09 0 4.72-4.2 8.22-14.36 8.22a41.54 41.54 0 0 1-15.47-3.12c-6.49-3.88-11.74-3.5-15.6 3.12l-5.59 9.31c-3.72 6.13-3.19 11.72 2.63 15.94 7.71 4.69 20.38 9.44 37 9.44 34.16 0 48.5-22.75 48.5-44.12-.03-14.38-9.12-29.76-28.73-34.88zM496 224H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zm0-160H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16V80a16 16 0 0 0-16-16zm0 320H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zM16 160h64a8 8 0 0 0 8-8v-16a8 8 0 0 0-8-8H64V40a8 8 0 0 0-8-8H32a8 8 0 0 0-7.14 4.42l-8 16A8 8 0 0 0 24 64h8v64H16a8 8 0 0 0-8 8v16a8 8 0 0 0 8 8zm-3.91 160H80a8 8 0 0 0 8-8v-16a8 8 0 0 0-8-8H41.32c3.29-10.29 48.34-18.68 48.34-56.44 0-29.06-25-39.56-44.47-39.56-21.36 0-33.8 10-40.46 18.75-4.37 5.59-3 10.84 2.8 15.37l8.58 6.88c5.61 4.56 11 2.47 16.12-2.44a13.44 13.44 0 0 1 9.46-3.84c3.33 0 9.28 1.56 9.28 8.75C51 248.19 0 257.31 0 304.59v4C0 316 5.08 320 12.09 320z"/></svg></button>

      <button 
        class="
          wrap-code-button
          tw-select-none 
          tw-mx-2 
          tw-hidden 
          group-[.is-open]:tw-block 
          group-[.is-wrap]:tw-text-fgColor-link 
          print:!tw-hidden" 
        title="Toggle code wrap"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M16 132h416c8.837 0 16-7.163 16-16V76c0-8.837-7.163-16-16-16H16C7.163 60 0 67.163 0 76v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16z"/></svg></button>
      
      <button 
        class="
          copy-code-button
          tw-select-none
          tw-mx-2 
          tw-hidden
          group-[.is-open]:tw-block
          hover:tw-text-fgColor-link 
          print:!tw-hidden"
        title="Copy code">
          <span class="copy-icon tw-block"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M433.941 65.941l-51.882-51.882A48 48 0 0 0 348.118 0H176c-26.51 0-48 21.49-48 48v48H48c-26.51 0-48 21.49-48 48v320c0 26.51 21.49 48 48 48h224c26.51 0 48-21.49 48-48v-48h80c26.51 0 48-21.49 48-48V99.882a48 48 0 0 0-14.059-33.941zM266 464H54a6 6 0 0 1-6-6V150a6 6 0 0 1 6-6h74v224c0 26.51 21.49 48 48 48h96v42a6 6 0 0 1-6 6zm128-96H182a6 6 0 0 1-6-6V54a6 6 0 0 1 6-6h106v88c0 13.255 10.745 24 24 24h88v202a6 6 0 0 1-6 6zm6-256h-64V48h9.632c1.591 0 3.117.632 4.243 1.757l48.368 48.368a6 6 0 0 1 1.757 4.243V112z"/></svg></span>
          <span class="check-icon tw-hidden"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M173.898 439.404l-166.4-166.4c-9.997-9.997-9.997-26.206 0-36.204l36.203-36.204c9.997-9.998 26.207-9.998 36.204 0L192 312.69 432.095 72.596c9.997-9.997 26.207-9.997 36.204 0l36.203 36.204c9.997 9.997 9.997 26.206 0 36.204l-294.4 294.401c-9.998 9.997-26.207 9.997-36.204-.001z"/></svg></span>
      </button>
        
      <button 
        class="
          tw-select-none 
          tw-mx-2 
          tw-block 
          group-[.is-open]:tw-hidden 
          print:!tw-hidden" 
        disabled
        aria-hidden="true"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M328 256c0 39.8-32.2 72-72 72s-72-32.2-72-72 32.2-72 72-72 72 32.2 72 72zm104-72c-39.8 0-72 32.2-72 72s32.2 72 72 72 72-32.2 72-72-32.2-72-72-72zm-352 0c-39.8 0-72 32.2-72 72s32.2 72 72 72 72-32.2 72-72-32.2-72-72-72z"/></svg></button>
    </div>
  </div>
  <pre style="counter-reset: codeblock;" class="tw-block tw-m-0 tw-p-0"><code 
    id="codeblock-id-11" 
    class="
      chroma 
      !tw-block 
      tw-p-0
      tw-m-0
      tw-transition-[max-height] 
      tw-duration-500 
      tw-ease-in-out 
      group-[.is-closed]:!tw-max-h-0 
      group-[.is-wrap]:tw-text-wrap
      tw-overflow-y-hidden
      tw-overflow-x-auto
      tw-scrollbar-thin
      "><span class="line"><span class="cl">$ tshark -r retrans.cap -q -z &#39;expert,note&#39;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Errors (22)
</span></span><span class="line"><span class="cl">=============
</span></span><span class="line"><span class="cl">   Frequency      Group           Protocol  Summary
</span></span><span class="line"><span class="cl">          22  Malformed              MySQL  Malformed Packet (Exception occurred)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Warns (749)
</span></span><span class="line"><span class="cl">=============
</span></span><span class="line"><span class="cl">   Frequency      Group           Protocol  Summary
</span></span><span class="line"><span class="cl">         538   Sequence                TCP  ACKed segment that wasn&#39;t captured (common at capture start)
</span></span><span class="line"><span class="cl">         192   Sequence                TCP  Connection reset (RST)
</span></span><span class="line"><span class="cl">          19   Sequence                TCP  Previous segment not captured (common at capture start)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Notes (1162)
</span></span><span class="line"><span class="cl">=============
</span></span><span class="line"><span class="cl">   Frequency      Group           Protocol  Summary
</span></span><span class="line"><span class="cl">          84   Sequence                TCP  TCP keep-alive segment
</span></span><span class="line"><span class="cl">         274   Sequence                TCP  Duplicate ACK (#1)
</span></span><span class="line"><span class="cl">          37   Sequence                TCP  ACK to a TCP keep-alive segment
</span></span><span class="line"><span class="cl">          23   Sequence                TCP  This frame is a (suspected) retransmission
</span></span><span class="line"><span class="cl">         262   Sequence                TCP  Duplicate ACK (#2)
</span></span><span class="line"><span class="cl">         259   Sequence                TCP  Duplicate ACK (#3)
</span></span><span class="line"><span class="cl">         141   Sequence                TCP  Duplicate ACK (#4)
</span></span><span class="line"><span class="cl">          69   Sequence                TCP  Duplicate ACK (#5)
</span></span><span class="line"><span class="cl">           7   Sequence                TCP  Duplicate ACK (#6)
</span></span><span class="line"><span class="cl">           5   Sequence                TCP  This frame is a (suspected) spurious retransmission
</span></span><span class="line"><span class="cl">           1   Sequence                TCP  Duplicate ACK (#7)</span></span></code></pre>
</div>
<h2 id="分析rtt丢包deplicate等等" class="headerLink">
    <a href="#%e5%88%86%e6%9e%90rtt%e4%b8%a2%e5%8c%85deplicate%e7%ad%89%e7%ad%89" class="header-mark"></a>分析rtt、丢包、deplicate等等</h2><blockquote>
  <p>$ tshark -r retrans.cap -q -z io,stat,1,&ldquo;AVG(tcp.analysis.ack_rtt)tcp.analysis.ack_rtt&rdquo;,&ldquo;COUNT(tcp.analysis.retransmission)  tcp.analysis.retransmission&rdquo;,&ldquo;COUNT(tcp.analysis.fast_retransmission) tcp.analysis.fast_retransmission&rdquo;,&ldquo;COUNT(tcp.analysis.duplicate_ack) tcp.analysis.duplicate_ack&rdquo;,&ldquo;COUNT(tcp.analysis.lost_segment) tcp.analysis.lost_segment&rdquo;,&ldquo;MIN(tcp.window_size)tcp.window_size&rdquo;</p>

</blockquote><div class="code-block highlight is-open show-line-numbers  tw-group tw-my-2">
  <div class="
    code-block-title 
    
    tw-flex 
    tw-flex-row 
    tw-justify-between 
    tw-w-full tw-bg-bgColor-secondary
    ">      
    <button 
      class="
        tw-select-none 
        tw-mx-2 
        tw-block
        group-[.is-open]:tw-rotate-90
        tw-transition-[transform] 
        tw-duration-500 
        tw-ease-in-out
        print:!tw-hidden"
      disabled
      aria-hidden="true"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M285.476 272.971L91.132 467.314c-9.373 9.373-24.569 9.373-33.941 0l-22.667-22.667c-9.357-9.357-9.375-24.522-.04-33.901L188.505 256 34.484 101.255c-9.335-9.379-9.317-24.544.04-33.901l22.667-22.667c9.373-9.373 24.569-9.373 33.941 0L285.475 239.03c9.373 9.372 9.373 24.568.001 33.941z"/></svg></button>

    <div class="code-block-title-bar tw-w-full">
      <p class="tw-select-none !tw-my-1">text</p>
    </div>
    <div class="tw-flex">
      <button 
        class="
          line-number-button
          tw-select-none 
          tw-mx-2 
          tw-hidden 
          group-[.is-open]:tw-block 
          group-[.show-line-numbers]:tw-text-fgColor-link 
          print:!tw-hidden" 
        title="Toggle line numbers"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M61.77 401l17.5-20.15a19.92 19.92 0 0 0 5.07-14.19v-3.31C84.34 356 80.5 352 73 352H16a8 8 0 0 0-8 8v16a8 8 0 0 0 8 8h22.83a157.41 157.41 0 0 0-11 12.31l-5.61 7c-4 5.07-5.25 10.13-2.8 14.88l1.05 1.93c3 5.76 6.29 7.88 12.25 7.88h4.73c10.33 0 15.94 2.44 15.94 9.09 0 4.72-4.2 8.22-14.36 8.22a41.54 41.54 0 0 1-15.47-3.12c-6.49-3.88-11.74-3.5-15.6 3.12l-5.59 9.31c-3.72 6.13-3.19 11.72 2.63 15.94 7.71 4.69 20.38 9.44 37 9.44 34.16 0 48.5-22.75 48.5-44.12-.03-14.38-9.12-29.76-28.73-34.88zM496 224H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zm0-160H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16V80a16 16 0 0 0-16-16zm0 320H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zM16 160h64a8 8 0 0 0 8-8v-16a8 8 0 0 0-8-8H64V40a8 8 0 0 0-8-8H32a8 8 0 0 0-7.14 4.42l-8 16A8 8 0 0 0 24 64h8v64H16a8 8 0 0 0-8 8v16a8 8 0 0 0 8 8zm-3.91 160H80a8 8 0 0 0 8-8v-16a8 8 0 0 0-8-8H41.32c3.29-10.29 48.34-18.68 48.34-56.44 0-29.06-25-39.56-44.47-39.56-21.36 0-33.8 10-40.46 18.75-4.37 5.59-3 10.84 2.8 15.37l8.58 6.88c5.61 4.56 11 2.47 16.12-2.44a13.44 13.44 0 0 1 9.46-3.84c3.33 0 9.28 1.56 9.28 8.75C51 248.19 0 257.31 0 304.59v4C0 316 5.08 320 12.09 320z"/></svg></button>

      <button 
        class="
          wrap-code-button
          tw-select-none 
          tw-mx-2 
          tw-hidden 
          group-[.is-open]:tw-block 
          group-[.is-wrap]:tw-text-fgColor-link 
          print:!tw-hidden" 
        title="Toggle code wrap"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M16 132h416c8.837 0 16-7.163 16-16V76c0-8.837-7.163-16-16-16H16C7.163 60 0 67.163 0 76v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16z"/></svg></button>
      
      <button 
        class="
          copy-code-button
          tw-select-none
          tw-mx-2 
          tw-hidden
          group-[.is-open]:tw-block
          hover:tw-text-fgColor-link 
          print:!tw-hidden"
        title="Copy code">
          <span class="copy-icon tw-block"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M433.941 65.941l-51.882-51.882A48 48 0 0 0 348.118 0H176c-26.51 0-48 21.49-48 48v48H48c-26.51 0-48 21.49-48 48v320c0 26.51 21.49 48 48 48h224c26.51 0 48-21.49 48-48v-48h80c26.51 0 48-21.49 48-48V99.882a48 48 0 0 0-14.059-33.941zM266 464H54a6 6 0 0 1-6-6V150a6 6 0 0 1 6-6h74v224c0 26.51 21.49 48 48 48h96v42a6 6 0 0 1-6 6zm128-96H182a6 6 0 0 1-6-6V54a6 6 0 0 1 6-6h106v88c0 13.255 10.745 24 24 24h88v202a6 6 0 0 1-6 6zm6-256h-64V48h9.632c1.591 0 3.117.632 4.243 1.757l48.368 48.368a6 6 0 0 1 1.757 4.243V112z"/></svg></span>
          <span class="check-icon tw-hidden"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M173.898 439.404l-166.4-166.4c-9.997-9.997-9.997-26.206 0-36.204l36.203-36.204c9.997-9.998 26.207-9.998 36.204 0L192 312.69 432.095 72.596c9.997-9.997 26.207-9.997 36.204 0l36.203 36.204c9.997 9.997 9.997 26.206 0 36.204l-294.4 294.401c-9.998 9.997-26.207 9.997-36.204-.001z"/></svg></span>
      </button>
        
      <button 
        class="
          tw-select-none 
          tw-mx-2 
          tw-block 
          group-[.is-open]:tw-hidden 
          print:!tw-hidden" 
        disabled
        aria-hidden="true"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M328 256c0 39.8-32.2 72-72 72s-72-32.2-72-72 32.2-72 72-72 72 32.2 72 72zm104-72c-39.8 0-72 32.2-72 72s32.2 72 72 72 72-32.2 72-72-32.2-72-72-72zm-352 0c-39.8 0-72 32.2-72 72s32.2 72 72 72 72-32.2 72-72-32.2-72-72-72z"/></svg></button>
    </div>
  </div>
  <pre style="counter-reset: codeblock;" class="tw-block tw-m-0 tw-p-0"><code 
    id="codeblock-id-12" 
    class="
      chroma 
      !tw-block 
      tw-p-0
      tw-m-0
      tw-transition-[max-height] 
      tw-duration-500 
      tw-ease-in-out 
      group-[.is-closed]:!tw-max-h-0 
      group-[.is-wrap]:tw-text-wrap
      tw-overflow-y-hidden
      tw-overflow-x-auto
      tw-scrollbar-thin
      "><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">===================================================================================
</span></span><span class="line"><span class="cl">| IO Statistics                                                                   |
</span></span><span class="line"><span class="cl">|                                                                                 |
</span></span><span class="line"><span class="cl">| Duration: 89.892365 secs                                                        |
</span></span><span class="line"><span class="cl">| Interval:  2 secs                                                               |
</span></span><span class="line"><span class="cl">|                                                                                 |
</span></span><span class="line"><span class="cl">| Col 1: AVG(tcp.analysis.ack_rtt)tcp.analysis.ack_rtt                            |
</span></span><span class="line"><span class="cl">|     2: COUNT(tcp.analysis.retransmission)  tcp.analysis.retransmission          |
</span></span><span class="line"><span class="cl">|     3: COUNT(tcp.analysis.fast_retransmission) tcp.analysis.fast_retransmission |
</span></span><span class="line"><span class="cl">|     4: COUNT(tcp.analysis.duplicate_ack) tcp.analysis.duplicate_ack             |
</span></span><span class="line"><span class="cl">|     5: COUNT(tcp.analysis.lost_segment) tcp.analysis.lost_segment               |
</span></span><span class="line"><span class="cl">|     6: AVG(tcp.window_size)tcp.window_size                                      |
</span></span><span class="line"><span class="cl">|---------------------------------------------------------------------------------|
</span></span><span class="line"><span class="cl">|          |1         |2      |3      |4      |5      |6      |                   |
</span></span><span class="line"><span class="cl">| Interval |    AVG   | COUNT | COUNT | COUNT | COUNT |  AVG  |                   |
</span></span><span class="line"><span class="cl">|-------------------------------------------------------------|                   |
</span></span><span class="line"><span class="cl">|  0 &lt;&gt;  2 | 0.001152 |     0 |     0 |     0 |     0 |  4206 |                   |
</span></span><span class="line"><span class="cl">|  2 &lt;&gt;  4 | 0.002088 |     0 |     0 |     0 |     1 |  6931 |                   |
</span></span><span class="line"><span class="cl">|  4 &lt;&gt;  6 | 0.001512 |     0 |     0 |     0 |     0 |  7099 |                   |
</span></span><span class="line"><span class="cl">|  6 &lt;&gt;  8 | 0.002859 |     0 |     0 |     0 |     0 |  7171 |                   |
</span></span><span class="line"><span class="cl">|  8 &lt;&gt; 10 | 0.001716 |     0 |     0 |     0 |     0 |  6472 |                   |
</span></span><span class="line"><span class="cl">| 10 &lt;&gt; 12 | 0.000319 |     0 |     0 |     0 |     2 |  5575 |                   |
</span></span><span class="line"><span class="cl">| 12 &lt;&gt; 14 | 0.002030 |     0 |     0 |     0 |     0 |  6922 |                   |
</span></span><span class="line"><span class="cl">| 14 &lt;&gt; 16 | 0.003371 |     0 |     0 |     0 |     2 |  5884 |                   |
</span></span><span class="line"><span class="cl">| 16 &lt;&gt; 18 | 0.000138 |     0 |     0 |     0 |     1 |  3480 |                   |
</span></span><span class="line"><span class="cl">| 18 &lt;&gt; 20 | 0.000999 |     0 |     0 |     0 |     4 |  6665 |                   |
</span></span><span class="line"><span class="cl">| 20 &lt;&gt; 22 | 0.000682 |     0 |     0 |    41 |     2 |  5484 |                   |
</span></span><span class="line"><span class="cl">| 22 &lt;&gt; 24 | 0.002302 |     2 |     0 |    19 |     0 |  7127 |                   |
</span></span><span class="line"><span class="cl">| 24 &lt;&gt; 26 | 0.000156 |     1 |     0 |    22 |     0 |  3042 |                   |
</span></span><span class="line"><span class="cl">| 26 &lt;&gt; 28 | 0.000000 |     1 |     0 |    19 |     1 |   152 |                   |
</span></span><span class="line"><span class="cl">| 28 &lt;&gt; 30 | 0.001498 |     1 |     0 |    24 |     0 |  5615 |                   |
</span></span><span class="line"><span class="cl">| 30 &lt;&gt; 32 | 0.000235 |     0 |     0 |    44 |     0 |  1880 |                   |</span></span></code></pre>
</div>
<h2 id="分析丢包duplicate-ack" class="headerLink">
    <a href="#%e5%88%86%e6%9e%90%e4%b8%a2%e5%8c%85duplicate-ack" class="header-mark"></a>分析丢包、duplicate ack</h2><blockquote>
  <p>$ tshark -r retrans.cap -q -z io,stat,5,&ldquo;COUNT(tcp.analysis.retransmission)  tcp.analysis.retransmission&rdquo;,&ldquo;COUNT(tcp.analysis.fast_retransmission) tcp.analysis.fast_retransmission&rdquo;,&ldquo;COUNT(tcp.analysis.duplicate_ack) tcp.analysis.duplicate_ack&rdquo;,&ldquo;COUNT(tcp.analysis.lost_segment) tcp.analysis.lost_segment&rdquo;</p>

</blockquote><div class="code-block highlight is-open show-line-numbers  tw-group tw-my-2">
  <div class="
    code-block-title 
    
    tw-flex 
    tw-flex-row 
    tw-justify-between 
    tw-w-full tw-bg-bgColor-secondary
    ">      
    <button 
      class="
        tw-select-none 
        tw-mx-2 
        tw-block
        group-[.is-open]:tw-rotate-90
        tw-transition-[transform] 
        tw-duration-500 
        tw-ease-in-out
        print:!tw-hidden"
      disabled
      aria-hidden="true"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M285.476 272.971L91.132 467.314c-9.373 9.373-24.569 9.373-33.941 0l-22.667-22.667c-9.357-9.357-9.375-24.522-.04-33.901L188.505 256 34.484 101.255c-9.335-9.379-9.317-24.544.04-33.901l22.667-22.667c9.373-9.373 24.569-9.373 33.941 0L285.475 239.03c9.373 9.372 9.373 24.568.001 33.941z"/></svg></button>

    <div class="code-block-title-bar tw-w-full">
      <p class="tw-select-none !tw-my-1">text</p>
    </div>
    <div class="tw-flex">
      <button 
        class="
          line-number-button
          tw-select-none 
          tw-mx-2 
          tw-hidden 
          group-[.is-open]:tw-block 
          group-[.show-line-numbers]:tw-text-fgColor-link 
          print:!tw-hidden" 
        title="Toggle line numbers"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M61.77 401l17.5-20.15a19.92 19.92 0 0 0 5.07-14.19v-3.31C84.34 356 80.5 352 73 352H16a8 8 0 0 0-8 8v16a8 8 0 0 0 8 8h22.83a157.41 157.41 0 0 0-11 12.31l-5.61 7c-4 5.07-5.25 10.13-2.8 14.88l1.05 1.93c3 5.76 6.29 7.88 12.25 7.88h4.73c10.33 0 15.94 2.44 15.94 9.09 0 4.72-4.2 8.22-14.36 8.22a41.54 41.54 0 0 1-15.47-3.12c-6.49-3.88-11.74-3.5-15.6 3.12l-5.59 9.31c-3.72 6.13-3.19 11.72 2.63 15.94 7.71 4.69 20.38 9.44 37 9.44 34.16 0 48.5-22.75 48.5-44.12-.03-14.38-9.12-29.76-28.73-34.88zM496 224H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zm0-160H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16V80a16 16 0 0 0-16-16zm0 320H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zM16 160h64a8 8 0 0 0 8-8v-16a8 8 0 0 0-8-8H64V40a8 8 0 0 0-8-8H32a8 8 0 0 0-7.14 4.42l-8 16A8 8 0 0 0 24 64h8v64H16a8 8 0 0 0-8 8v16a8 8 0 0 0 8 8zm-3.91 160H80a8 8 0 0 0 8-8v-16a8 8 0 0 0-8-8H41.32c3.29-10.29 48.34-18.68 48.34-56.44 0-29.06-25-39.56-44.47-39.56-21.36 0-33.8 10-40.46 18.75-4.37 5.59-3 10.84 2.8 15.37l8.58 6.88c5.61 4.56 11 2.47 16.12-2.44a13.44 13.44 0 0 1 9.46-3.84c3.33 0 9.28 1.56 9.28 8.75C51 248.19 0 257.31 0 304.59v4C0 316 5.08 320 12.09 320z"/></svg></button>

      <button 
        class="
          wrap-code-button
          tw-select-none 
          tw-mx-2 
          tw-hidden 
          group-[.is-open]:tw-block 
          group-[.is-wrap]:tw-text-fgColor-link 
          print:!tw-hidden" 
        title="Toggle code wrap"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M16 132h416c8.837 0 16-7.163 16-16V76c0-8.837-7.163-16-16-16H16C7.163 60 0 67.163 0 76v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16z"/></svg></button>
      
      <button 
        class="
          copy-code-button
          tw-select-none
          tw-mx-2 
          tw-hidden
          group-[.is-open]:tw-block
          hover:tw-text-fgColor-link 
          print:!tw-hidden"
        title="Copy code">
          <span class="copy-icon tw-block"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M433.941 65.941l-51.882-51.882A48 48 0 0 0 348.118 0H176c-26.51 0-48 21.49-48 48v48H48c-26.51 0-48 21.49-48 48v320c0 26.51 21.49 48 48 48h224c26.51 0 48-21.49 48-48v-48h80c26.51 0 48-21.49 48-48V99.882a48 48 0 0 0-14.059-33.941zM266 464H54a6 6 0 0 1-6-6V150a6 6 0 0 1 6-6h74v224c0 26.51 21.49 48 48 48h96v42a6 6 0 0 1-6 6zm128-96H182a6 6 0 0 1-6-6V54a6 6 0 0 1 6-6h106v88c0 13.255 10.745 24 24 24h88v202a6 6 0 0 1-6 6zm6-256h-64V48h9.632c1.591 0 3.117.632 4.243 1.757l48.368 48.368a6 6 0 0 1 1.757 4.243V112z"/></svg></span>
          <span class="check-icon tw-hidden"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M173.898 439.404l-166.4-166.4c-9.997-9.997-9.997-26.206 0-36.204l36.203-36.204c9.997-9.998 26.207-9.998 36.204 0L192 312.69 432.095 72.596c9.997-9.997 26.207-9.997 36.204 0l36.203 36.204c9.997 9.997 9.997 26.206 0 36.204l-294.4 294.401c-9.998 9.997-26.207 9.997-36.204-.001z"/></svg></span>
      </button>
        
      <button 
        class="
          tw-select-none 
          tw-mx-2 
          tw-block 
          group-[.is-open]:tw-hidden 
          print:!tw-hidden" 
        disabled
        aria-hidden="true"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M328 256c0 39.8-32.2 72-72 72s-72-32.2-72-72 32.2-72 72-72 72 32.2 72 72zm104-72c-39.8 0-72 32.2-72 72s32.2 72 72 72 72-32.2 72-72-32.2-72-72-72zm-352 0c-39.8 0-72 32.2-72 72s32.2 72 72 72 72-32.2 72-72-32.2-72-72-72z"/></svg></button>
    </div>
  </div>
  <pre style="counter-reset: codeblock;" class="tw-block tw-m-0 tw-p-0"><code 
    id="codeblock-id-13" 
    class="
      chroma 
      !tw-block 
      tw-p-0
      tw-m-0
      tw-transition-[max-height] 
      tw-duration-500 
      tw-ease-in-out 
      group-[.is-closed]:!tw-max-h-0 
      group-[.is-wrap]:tw-text-wrap
      tw-overflow-y-hidden
      tw-overflow-x-auto
      tw-scrollbar-thin
      "><span class="line"><span class="cl">===================================================================================
</span></span><span class="line"><span class="cl">| IO Statistics                                                                   |
</span></span><span class="line"><span class="cl">|                                                                                 |
</span></span><span class="line"><span class="cl">| Duration: 89.892365 secs                                                        |
</span></span><span class="line"><span class="cl">| Interval:  5 secs                                                               |
</span></span><span class="line"><span class="cl">|                                                                                 |
</span></span><span class="line"><span class="cl">| Col 1: COUNT(tcp.analysis.retransmission)  tcp.analysis.retransmission          |
</span></span><span class="line"><span class="cl">|     2: COUNT(tcp.analysis.fast_retransmission) tcp.analysis.fast_retransmission |
</span></span><span class="line"><span class="cl">|     3: COUNT(tcp.analysis.duplicate_ack) tcp.analysis.duplicate_ack             |
</span></span><span class="line"><span class="cl">|     4: COUNT(tcp.analysis.lost_segment) tcp.analysis.lost_segment               |
</span></span><span class="line"><span class="cl">|---------------------------------------------------------------------------------|
</span></span><span class="line"><span class="cl">|          |1      |2      |3      |4      |                                      |
</span></span><span class="line"><span class="cl">| Interval | COUNT | COUNT | COUNT | COUNT |                                      |
</span></span><span class="line"><span class="cl">|------------------------------------------|                                      |
</span></span><span class="line"><span class="cl">|  0 &lt;&gt;  5 |     0 |     0 |     0 |     1 |                                      |
</span></span><span class="line"><span class="cl">|  5 &lt;&gt; 10 |     0 |     0 |     0 |     0 |                                      |
</span></span><span class="line"><span class="cl">| 10 &lt;&gt; 15 |     0 |     0 |     0 |     4 |                                      |
</span></span><span class="line"><span class="cl">| 15 &lt;&gt; 20 |     0 |     0 |     0 |     5 |                                      |
</span></span><span class="line"><span class="cl">| 20 &lt;&gt; 25 |     3 |     0 |    67 |     2 |                                      |
</span></span><span class="line"><span class="cl">| 25 &lt;&gt; 30 |     2 |     0 |    58 |     1 |                                      |
</span></span><span class="line"><span class="cl">| 30 &lt;&gt; 35 |     0 |     0 |   112 |     0 |                                      |
</span></span><span class="line"><span class="cl">| 35 &lt;&gt; 40 |     1 |     0 |   156 |     0 |                                      |
</span></span><span class="line"><span class="cl">| 40 &lt;&gt; 45 |     0 |     0 |   127 |     2 |                                      |
</span></span><span class="line"><span class="cl">| 45 &lt;&gt; 50 |     1 |     0 |    91 |     0 |                                      |
</span></span><span class="line"><span class="cl">| 50 &lt;&gt; 55 |     0 |     0 |    63 |     0 |                                      |
</span></span><span class="line"><span class="cl">| 55 &lt;&gt; 60 |     0 |     0 |    65 |     2 |                                      |
</span></span><span class="line"><span class="cl">| 60 &lt;&gt; 65 |     2 |     0 |    41 |     0 |                                      |
</span></span><span class="line"><span class="cl">| 65 &lt;&gt; 70 |     3 |     0 |    34 |     2 |                                      |
</span></span><span class="line"><span class="cl">| 70 &lt;&gt; 75 |     7 |     0 |    55 |     0 |                                      |
</span></span><span class="line"><span class="cl">| 75 &lt;&gt; 80 |     3 |     0 |    68 |     0 |                                      |
</span></span><span class="line"><span class="cl">| 80 &lt;&gt; 85 |     1 |     0 |    46 |     0 |                                      |
</span></span><span class="line"><span class="cl">| 85 &lt;&gt; Dur|     0 |     0 |    30 |     0 |                                      |
</span></span><span class="line"><span class="cl">===================================================================================</span></span></code></pre>
</div>
<h2 id="分析rtt-时间" class="headerLink">
    <a href="#%e5%88%86%e6%9e%90rtt-%e6%97%b6%e9%97%b4" class="header-mark"></a>分析rtt 时间</h2><blockquote>
  <p>$ tshark -r ~/ali/metrics/tcpdump/rsb2.cap -q -z io,stat,1,&ldquo;MIN(tcp.analysis.ack_rtt)tcp.analysis.ack_rtt&rdquo;,&ldquo;MAX(tcp.analysis.ack_rtt)tcp.analysis.ack_rtt&rdquo;,&ldquo;AVG(tcp.analysis.ack_rtt)tcp.analysis.ack_rtt&rdquo;</p>

</blockquote><div class="code-block highlight is-open show-line-numbers  tw-group tw-my-2">
  <div class="
    code-block-title 
    
    tw-flex 
    tw-flex-row 
    tw-justify-between 
    tw-w-full tw-bg-bgColor-secondary
    ">      
    <button 
      class="
        tw-select-none 
        tw-mx-2 
        tw-block
        group-[.is-open]:tw-rotate-90
        tw-transition-[transform] 
        tw-duration-500 
        tw-ease-in-out
        print:!tw-hidden"
      disabled
      aria-hidden="true"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M285.476 272.971L91.132 467.314c-9.373 9.373-24.569 9.373-33.941 0l-22.667-22.667c-9.357-9.357-9.375-24.522-.04-33.901L188.505 256 34.484 101.255c-9.335-9.379-9.317-24.544.04-33.901l22.667-22.667c9.373-9.373 24.569-9.373 33.941 0L285.475 239.03c9.373 9.372 9.373 24.568.001 33.941z"/></svg></button>

    <div class="code-block-title-bar tw-w-full">
      <p class="tw-select-none !tw-my-1">text</p>
    </div>
    <div class="tw-flex">
      <button 
        class="
          line-number-button
          tw-select-none 
          tw-mx-2 
          tw-hidden 
          group-[.is-open]:tw-block 
          group-[.show-line-numbers]:tw-text-fgColor-link 
          print:!tw-hidden" 
        title="Toggle line numbers"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M61.77 401l17.5-20.15a19.92 19.92 0 0 0 5.07-14.19v-3.31C84.34 356 80.5 352 73 352H16a8 8 0 0 0-8 8v16a8 8 0 0 0 8 8h22.83a157.41 157.41 0 0 0-11 12.31l-5.61 7c-4 5.07-5.25 10.13-2.8 14.88l1.05 1.93c3 5.76 6.29 7.88 12.25 7.88h4.73c10.33 0 15.94 2.44 15.94 9.09 0 4.72-4.2 8.22-14.36 8.22a41.54 41.54 0 0 1-15.47-3.12c-6.49-3.88-11.74-3.5-15.6 3.12l-5.59 9.31c-3.72 6.13-3.19 11.72 2.63 15.94 7.71 4.69 20.38 9.44 37 9.44 34.16 0 48.5-22.75 48.5-44.12-.03-14.38-9.12-29.76-28.73-34.88zM496 224H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zm0-160H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16V80a16 16 0 0 0-16-16zm0 320H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zM16 160h64a8 8 0 0 0 8-8v-16a8 8 0 0 0-8-8H64V40a8 8 0 0 0-8-8H32a8 8 0 0 0-7.14 4.42l-8 16A8 8 0 0 0 24 64h8v64H16a8 8 0 0 0-8 8v16a8 8 0 0 0 8 8zm-3.91 160H80a8 8 0 0 0 8-8v-16a8 8 0 0 0-8-8H41.32c3.29-10.29 48.34-18.68 48.34-56.44 0-29.06-25-39.56-44.47-39.56-21.36 0-33.8 10-40.46 18.75-4.37 5.59-3 10.84 2.8 15.37l8.58 6.88c5.61 4.56 11 2.47 16.12-2.44a13.44 13.44 0 0 1 9.46-3.84c3.33 0 9.28 1.56 9.28 8.75C51 248.19 0 257.31 0 304.59v4C0 316 5.08 320 12.09 320z"/></svg></button>

      <button 
        class="
          wrap-code-button
          tw-select-none 
          tw-mx-2 
          tw-hidden 
          group-[.is-open]:tw-block 
          group-[.is-wrap]:tw-text-fgColor-link 
          print:!tw-hidden" 
        title="Toggle code wrap"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M16 132h416c8.837 0 16-7.163 16-16V76c0-8.837-7.163-16-16-16H16C7.163 60 0 67.163 0 76v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16z"/></svg></button>
      
      <button 
        class="
          copy-code-button
          tw-select-none
          tw-mx-2 
          tw-hidden
          group-[.is-open]:tw-block
          hover:tw-text-fgColor-link 
          print:!tw-hidden"
        title="Copy code">
          <span class="copy-icon tw-block"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M433.941 65.941l-51.882-51.882A48 48 0 0 0 348.118 0H176c-26.51 0-48 21.49-48 48v48H48c-26.51 0-48 21.49-48 48v320c0 26.51 21.49 48 48 48h224c26.51 0 48-21.49 48-48v-48h80c26.51 0 48-21.49 48-48V99.882a48 48 0 0 0-14.059-33.941zM266 464H54a6 6 0 0 1-6-6V150a6 6 0 0 1 6-6h74v224c0 26.51 21.49 48 48 48h96v42a6 6 0 0 1-6 6zm128-96H182a6 6 0 0 1-6-6V54a6 6 0 0 1 6-6h106v88c0 13.255 10.745 24 24 24h88v202a6 6 0 0 1-6 6zm6-256h-64V48h9.632c1.591 0 3.117.632 4.243 1.757l48.368 48.368a6 6 0 0 1 1.757 4.243V112z"/></svg></span>
          <span class="check-icon tw-hidden"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M173.898 439.404l-166.4-166.4c-9.997-9.997-9.997-26.206 0-36.204l36.203-36.204c9.997-9.998 26.207-9.998 36.204 0L192 312.69 432.095 72.596c9.997-9.997 26.207-9.997 36.204 0l36.203 36.204c9.997 9.997 9.997 26.206 0 36.204l-294.4 294.401c-9.998 9.997-26.207 9.997-36.204-.001z"/></svg></span>
      </button>
        
      <button 
        class="
          tw-select-none 
          tw-mx-2 
          tw-block 
          group-[.is-open]:tw-hidden 
          print:!tw-hidden" 
        disabled
        aria-hidden="true"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M328 256c0 39.8-32.2 72-72 72s-72-32.2-72-72 32.2-72 72-72 72 32.2 72 72zm104-72c-39.8 0-72 32.2-72 72s32.2 72 72 72 72-32.2 72-72-32.2-72-72-72zm-352 0c-39.8 0-72 32.2-72 72s32.2 72 72 72 72-32.2 72-72-32.2-72-72-72z"/></svg></button>
    </div>
  </div>
  <pre style="counter-reset: codeblock;" class="tw-block tw-m-0 tw-p-0"><code 
    id="codeblock-id-14" 
    class="
      chroma 
      !tw-block 
      tw-p-0
      tw-m-0
      tw-transition-[max-height] 
      tw-duration-500 
      tw-ease-in-out 
      group-[.is-closed]:!tw-max-h-0 
      group-[.is-wrap]:tw-text-wrap
      tw-overflow-y-hidden
      tw-overflow-x-auto
      tw-scrollbar-thin
      "><span class="line"><span class="cl">========================================================
</span></span><span class="line"><span class="cl">| IO Statistics                                        |
</span></span><span class="line"><span class="cl">|                                                      |
</span></span><span class="line"><span class="cl">| Duration: 33.914454 secs                             |
</span></span><span class="line"><span class="cl">| Interval:  1 secs                                    |
</span></span><span class="line"><span class="cl">|                                                      |
</span></span><span class="line"><span class="cl">| Col 1: MIN(tcp.analysis.ack_rtt)tcp.analysis.ack_rtt |
</span></span><span class="line"><span class="cl">|     2: MAX(tcp.analysis.ack_rtt)tcp.analysis.ack_rtt |
</span></span><span class="line"><span class="cl">|     3: AVG(tcp.analysis.ack_rtt)tcp.analysis.ack_rtt |
</span></span><span class="line"><span class="cl">|------------------------------------------------------|
</span></span><span class="line"><span class="cl">|          |1         |2         |3         |          |
</span></span><span class="line"><span class="cl">| Interval |    MIN   |    MAX   |    AVG   |          |
</span></span><span class="line"><span class="cl">|-------------------------------------------|          |
</span></span><span class="line"><span class="cl">|  0 &lt;&gt;  1 | 0.000005 | 0.248840 | 0.009615 |          |
</span></span><span class="line"><span class="cl">|  1 &lt;&gt;  2 | 0.000004 | 0.458952 | 0.009601 |          |
</span></span><span class="line"><span class="cl">|  2 &lt;&gt;  3 | 0.000002 | 0.251274 | 0.009340 |          |
</span></span><span class="line"><span class="cl">|  3 &lt;&gt;  4 | 0.000006 | 0.290993 | 0.010843 |          |
</span></span><span class="line"><span class="cl">|  4 &lt;&gt;  5 | 0.000004 | 0.390800 | 0.008995 |          |
</span></span><span class="line"><span class="cl">|  5 &lt;&gt;  6 | 0.000008 | 0.407525 | 0.011133 |          |
</span></span><span class="line"><span class="cl">|  6 &lt;&gt;  7 | 0.000004 | 0.239225 | 0.008763 |          |
</span></span><span class="line"><span class="cl">|  7 &lt;&gt;  8 | 0.000003 | 0.177203 | 0.009211 |          |
</span></span><span class="line"><span class="cl">|  8 &lt;&gt;  9 | 0.000007 | 0.265505 | 0.010294 |          |
</span></span><span class="line"><span class="cl">|  9 &lt;&gt; 10 | 0.000007 | 0.354278 | 0.008475 |          |
</span></span><span class="line"><span class="cl">| 10 &lt;&gt; 11 | 0.000005 | 5.337388 | 0.011211 |          |
</span></span><span class="line"><span class="cl">| 11 &lt;&gt; 12 | 0.000004 | 0.320651 | 0.008231 |          |
</span></span><span class="line"><span class="cl">| 12 &lt;&gt; 13 | 0.000008 | 0.272029 | 0.008526 |          |
</span></span><span class="line"><span class="cl">| 13 &lt;&gt; 14 | 0.000005 | 0.663421 | 0.014589 |          |
</span></span><span class="line"><span class="cl">| 14 &lt;&gt; 15 | 0.000005 | 0.277754 | 0.009128 |          |
</span></span><span class="line"><span class="cl">| 15 &lt;&gt; 16 | 0.000002 | 0.260320 | 0.010388 |          |
</span></span><span class="line"><span class="cl">| 16 &lt;&gt; 17 | 0.000006 | 0.429298 | 0.009155 |          |
</span></span><span class="line"><span class="cl">| 17 &lt;&gt; 18 | 0.000005 | 0.668089 | 0.010008 |          |
</span></span><span class="line"><span class="cl">| 18 &lt;&gt; 19 | 0.000005 | 0.452897 | 0.009574 |          |
</span></span><span class="line"><span class="cl">| 19 &lt;&gt; 20 | 0.000006 | 0.850698 | 0.010345 |          |
</span></span><span class="line"><span class="cl">| 20 &lt;&gt; 21 | 0.000007 | 0.270671 | 0.012368 |          |
</span></span><span class="line"><span class="cl">| 21 &lt;&gt; 22 | 0.000005 | 0.295439 | 0.008660 |          |
</span></span><span class="line"><span class="cl">| 22 &lt;&gt; 23 | 0.000008 | 0.710938 | 0.010321 |          |
</span></span><span class="line"><span class="cl">| 23 &lt;&gt; 24 | 0.000003 | 0.269014 | 0.010238 |          |
</span></span><span class="line"><span class="cl">| 24 &lt;&gt; 25 | 0.000005 | 0.287966 | 0.009604 |          |
</span></span><span class="line"><span class="cl">| 25 &lt;&gt; 26 | 0.000009 | 0.661160 | 0.010807 |          |
</span></span><span class="line"><span class="cl">| 26 &lt;&gt; 27 | 0.000006 | 0.310515 | 0.009439 |          |
</span></span><span class="line"><span class="cl">| 27 &lt;&gt; 28 | 0.000003 | 0.346298 | 0.011302 |          |
</span></span><span class="line"><span class="cl">| 28 &lt;&gt; 29 | 0.000004 | 0.375117 | 0.008333 |          |
</span></span><span class="line"><span class="cl">| 29 &lt;&gt; 30 | 0.000006 | 1.323647 | 0.008799 |          |
</span></span><span class="line"><span class="cl">| 30 &lt;&gt; 31 | 0.000006 | 0.283616 | 0.010187 |          |
</span></span><span class="line"><span class="cl">| 31 &lt;&gt; 32 | 0.000007 | 0.649273 | 0.008613 |          |
</span></span><span class="line"><span class="cl">| 32 &lt;&gt; 33 | 0.000004 | 0.440265 | 0.010663 |          |
</span></span><span class="line"><span class="cl">| 33 &lt;&gt; Dur| 0.000004 | 0.337023 | 0.011477 |          |
</span></span><span class="line"><span class="cl">========================================================</span></span></code></pre>
</div>
<h2 id="计算window-size" class="headerLink">
    <a href="#%e8%ae%a1%e7%ae%97window-size" class="header-mark"></a>计算window size</h2><blockquote>
  <p>$ tshark -r rsb-single2.cap -q -z io,stat,5,&ldquo;COUNT(tcp.analysis.retransmission) tcp.analysis.retransmission&rdquo;,&ldquo;AVG(tcp.window_size) tcp.window_size&rdquo;,&ldquo;MAX(tcp.window_size) tcp.window_size&rdquo;,&ldquo;MIN(tcp.window_size) tcp.window_size&rdquo;</p>

</blockquote><div class="code-block highlight is-open show-line-numbers  tw-group tw-my-2">
  <div class="
    code-block-title 
    
    tw-flex 
    tw-flex-row 
    tw-justify-between 
    tw-w-full tw-bg-bgColor-secondary
    ">      
    <button 
      class="
        tw-select-none 
        tw-mx-2 
        tw-block
        group-[.is-open]:tw-rotate-90
        tw-transition-[transform] 
        tw-duration-500 
        tw-ease-in-out
        print:!tw-hidden"
      disabled
      aria-hidden="true"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M285.476 272.971L91.132 467.314c-9.373 9.373-24.569 9.373-33.941 0l-22.667-22.667c-9.357-9.357-9.375-24.522-.04-33.901L188.505 256 34.484 101.255c-9.335-9.379-9.317-24.544.04-33.901l22.667-22.667c9.373-9.373 24.569-9.373 33.941 0L285.475 239.03c9.373 9.372 9.373 24.568.001 33.941z"/></svg></button>

    <div class="code-block-title-bar tw-w-full">
      <p class="tw-select-none !tw-my-1">text</p>
    </div>
    <div class="tw-flex">
      <button 
        class="
          line-number-button
          tw-select-none 
          tw-mx-2 
          tw-hidden 
          group-[.is-open]:tw-block 
          group-[.show-line-numbers]:tw-text-fgColor-link 
          print:!tw-hidden" 
        title="Toggle line numbers"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M61.77 401l17.5-20.15a19.92 19.92 0 0 0 5.07-14.19v-3.31C84.34 356 80.5 352 73 352H16a8 8 0 0 0-8 8v16a8 8 0 0 0 8 8h22.83a157.41 157.41 0 0 0-11 12.31l-5.61 7c-4 5.07-5.25 10.13-2.8 14.88l1.05 1.93c3 5.76 6.29 7.88 12.25 7.88h4.73c10.33 0 15.94 2.44 15.94 9.09 0 4.72-4.2 8.22-14.36 8.22a41.54 41.54 0 0 1-15.47-3.12c-6.49-3.88-11.74-3.5-15.6 3.12l-5.59 9.31c-3.72 6.13-3.19 11.72 2.63 15.94 7.71 4.69 20.38 9.44 37 9.44 34.16 0 48.5-22.75 48.5-44.12-.03-14.38-9.12-29.76-28.73-34.88zM496 224H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zm0-160H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16V80a16 16 0 0 0-16-16zm0 320H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zM16 160h64a8 8 0 0 0 8-8v-16a8 8 0 0 0-8-8H64V40a8 8 0 0 0-8-8H32a8 8 0 0 0-7.14 4.42l-8 16A8 8 0 0 0 24 64h8v64H16a8 8 0 0 0-8 8v16a8 8 0 0 0 8 8zm-3.91 160H80a8 8 0 0 0 8-8v-16a8 8 0 0 0-8-8H41.32c3.29-10.29 48.34-18.68 48.34-56.44 0-29.06-25-39.56-44.47-39.56-21.36 0-33.8 10-40.46 18.75-4.37 5.59-3 10.84 2.8 15.37l8.58 6.88c5.61 4.56 11 2.47 16.12-2.44a13.44 13.44 0 0 1 9.46-3.84c3.33 0 9.28 1.56 9.28 8.75C51 248.19 0 257.31 0 304.59v4C0 316 5.08 320 12.09 320z"/></svg></button>

      <button 
        class="
          wrap-code-button
          tw-select-none 
          tw-mx-2 
          tw-hidden 
          group-[.is-open]:tw-block 
          group-[.is-wrap]:tw-text-fgColor-link 
          print:!tw-hidden" 
        title="Toggle code wrap"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M16 132h416c8.837 0 16-7.163 16-16V76c0-8.837-7.163-16-16-16H16C7.163 60 0 67.163 0 76v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16z"/></svg></button>
      
      <button 
        class="
          copy-code-button
          tw-select-none
          tw-mx-2 
          tw-hidden
          group-[.is-open]:tw-block
          hover:tw-text-fgColor-link 
          print:!tw-hidden"
        title="Copy code">
          <span class="copy-icon tw-block"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M433.941 65.941l-51.882-51.882A48 48 0 0 0 348.118 0H176c-26.51 0-48 21.49-48 48v48H48c-26.51 0-48 21.49-48 48v320c0 26.51 21.49 48 48 48h224c26.51 0 48-21.49 48-48v-48h80c26.51 0 48-21.49 48-48V99.882a48 48 0 0 0-14.059-33.941zM266 464H54a6 6 0 0 1-6-6V150a6 6 0 0 1 6-6h74v224c0 26.51 21.49 48 48 48h96v42a6 6 0 0 1-6 6zm128-96H182a6 6 0 0 1-6-6V54a6 6 0 0 1 6-6h106v88c0 13.255 10.745 24 24 24h88v202a6 6 0 0 1-6 6zm6-256h-64V48h9.632c1.591 0 3.117.632 4.243 1.757l48.368 48.368a6 6 0 0 1 1.757 4.243V112z"/></svg></span>
          <span class="check-icon tw-hidden"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M173.898 439.404l-166.4-166.4c-9.997-9.997-9.997-26.206 0-36.204l36.203-36.204c9.997-9.998 26.207-9.998 36.204 0L192 312.69 432.095 72.596c9.997-9.997 26.207-9.997 36.204 0l36.203 36.204c9.997 9.997 9.997 26.206 0 36.204l-294.4 294.401c-9.998 9.997-26.207 9.997-36.204-.001z"/></svg></span>
      </button>
        
      <button 
        class="
          tw-select-none 
          tw-mx-2 
          tw-block 
          group-[.is-open]:tw-hidden 
          print:!tw-hidden" 
        disabled
        aria-hidden="true"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M328 256c0 39.8-32.2 72-72 72s-72-32.2-72-72 32.2-72 72-72 72 32.2 72 72zm104-72c-39.8 0-72 32.2-72 72s32.2 72 72 72 72-32.2 72-72-32.2-72-72-72zm-352 0c-39.8 0-72 32.2-72 72s32.2 72 72 72 72-32.2 72-72-32.2-72-72-72z"/></svg></button>
    </div>
  </div>
  <pre style="counter-reset: codeblock;" class="tw-block tw-m-0 tw-p-0"><code 
    id="codeblock-id-15" 
    class="
      chroma 
      !tw-block 
      tw-p-0
      tw-m-0
      tw-transition-[max-height] 
      tw-duration-500 
      tw-ease-in-out 
      group-[.is-closed]:!tw-max-h-0 
      group-[.is-wrap]:tw-text-wrap
      tw-overflow-y-hidden
      tw-overflow-x-auto
      tw-scrollbar-thin
      "><span class="line"><span class="cl">=========================================================================
</span></span><span class="line"><span class="cl">| IO Statistics                                                         |
</span></span><span class="line"><span class="cl">|                                                                       |
</span></span><span class="line"><span class="cl">| Duration: 30.776061 secs                                              |
</span></span><span class="line"><span class="cl">| Interval:  5 secs                                                     |
</span></span><span class="line"><span class="cl">|                                                                       |
</span></span><span class="line"><span class="cl">| Col 1: COUNT(tcp.analysis.retransmission) tcp.analysis.retransmission |
</span></span><span class="line"><span class="cl">|     2: AVG(tcp.window_size) tcp.window_size                           |
</span></span><span class="line"><span class="cl">|     3: MAX(tcp.window_size) tcp.window_size                           |
</span></span><span class="line"><span class="cl">|     4: MIN(tcp.window_size) tcp.window_size                           |
</span></span><span class="line"><span class="cl">|-----------------------------------------------------------------------|
</span></span><span class="line"><span class="cl">|          |1      |2      |3       |4     |                            |
</span></span><span class="line"><span class="cl">| Interval | COUNT |  AVG  |   MAX  |  MIN |                            |
</span></span><span class="line"><span class="cl">|------------------------------------------|                            |
</span></span><span class="line"><span class="cl">|  0 &lt;&gt;  5 |     0 |  4753 |  15744 |   96 |                            |
</span></span><span class="line"><span class="cl">|  5 &lt;&gt; 10 |     0 |  8067 | 431616 |   96 |                            |
</span></span><span class="line"><span class="cl">| 10 &lt;&gt; 15 |     0 |  5144 |  18688 |   96 |                            |
</span></span><span class="line"><span class="cl">| 15 &lt;&gt; 20 |     0 | 11225 | 611072 |   81 |                            |
</span></span><span class="line"><span class="cl">| 20 &lt;&gt; 25 |     0 |  5104 |  24448 |   96 |                            |
</span></span><span class="line"><span class="cl">| 25 &lt;&gt; 30 |     0 | 10103 | 506880 |   96 |                            |
</span></span><span class="line"><span class="cl">| 30 &lt;&gt; Dur|     0 |  5716 |  12423 |   96 |                            |
</span></span><span class="line"><span class="cl">=========================================================================</span></span></code></pre>
</div>
<h2 id="有用的命令这些命令也都是安装wireshark就装好了的" class="headerLink">
    <a href="#%e6%9c%89%e7%94%a8%e7%9a%84%e5%91%bd%e4%bb%a4%e8%bf%99%e4%ba%9b%e5%91%bd%e4%bb%a4%e4%b9%9f%e9%83%bd%e6%98%af%e5%ae%89%e8%a3%85wireshark%e5%b0%b1%e8%a3%85%e5%a5%bd%e4%ba%86%e7%9a%84" class="header-mark"></a>有用的命令（这些命令也都是安装WireShark就装好了的）：</h2><blockquote>
  <p>capinfos rsb2.cap</p>

</blockquote><blockquote>
  <p>tshark -q -n -r rsb2.cap  -z &ldquo;conv,ip&rdquo;   分析流量总况</p>

</blockquote><blockquote>
  <p>tshark -q -n -r rsb2.cap  -z &ldquo;conv,tcp&rdquo;  分析每一个连接的流量、rtt、响应时间、丢包率、重传率等等</p>

</blockquote><blockquote>
  <p>editcap -c 100000 ./rsb2.cap  rsb00.cap  //把大文件rsb2.cap按每个文件100000个package切成小文件</p>

</blockquote><h2 id="常用排错过滤条件" class="headerLink">
    <a href="#%e5%b8%b8%e7%94%a8%e6%8e%92%e9%94%99%e8%bf%87%e6%bb%a4%e6%9d%a1%e4%bb%b6" class="header-mark"></a>常用排错过滤条件:</h2><p>对于排查网络延时/应用问题有一些过滤条件是非常有用的：</p>
<ul>
<li>tcp.analysis.lost_segment：表明已经在抓包中看到不连续的序列号。报文丢失会造成重复的ACK，这会导致重传。</li>
<li>tcp.analysis.duplicate_ack：显示被确认过不止一次的报文。大量的重复ACK是TCP端点之间高延时的迹象。</li>
<li>tcp.analysis.retransmission：显示抓包中的所有重传。如果重传次数不多的话还是正常的，过多重传可能有问题。这通常意味着应用性能缓慢和/或用户报文丢失。</li>
<li>tcp.analysis.window_update：将传输过程中的TCP window大小图形化。如果看到窗口大小下降为零，这意味着发送方已经退出了，并等待接收方确认所有已传送数据。这可能表明接收端已经不堪重负了。</li>
<li>tcp.analysis.bytes_in_flight：某一时间点网络上未确认字节数。未确认字节数不能超过你的TCP窗口大小（定义于最初3此TCP握手），为了最大化吞吐量你想要获得尽可能接近TCP窗口大小。如果看到连续低于TCP窗口大小，可能意味着报文丢失或路径上其他影响吞吐量的问题。</li>
<li>tcp.analysis.ack_rtt：衡量抓取的TCP报文与相应的ACK。如果这一时间间隔比较长那可能表示某种类型的网络延时（报文丢失，拥塞，等等）。</li>
</ul>
<h2 id="抓包常用命令" class="headerLink">
    <a href="#%e6%8a%93%e5%8c%85%e5%b8%b8%e7%94%a8%e5%91%bd%e4%bb%a4" class="header-mark"></a>抓包常用命令</h2><div class="code-block highlight is-open show-line-numbers  tw-group tw-my-2">
  <div class="
    code-block-title 
    
    tw-flex 
    tw-flex-row 
    tw-justify-between 
    tw-w-full tw-bg-bgColor-secondary
    ">      
    <button 
      class="
        tw-select-none 
        tw-mx-2 
        tw-block
        group-[.is-open]:tw-rotate-90
        tw-transition-[transform] 
        tw-duration-500 
        tw-ease-in-out
        print:!tw-hidden"
      disabled
      aria-hidden="true"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M285.476 272.971L91.132 467.314c-9.373 9.373-24.569 9.373-33.941 0l-22.667-22.667c-9.357-9.357-9.375-24.522-.04-33.901L188.505 256 34.484 101.255c-9.335-9.379-9.317-24.544.04-33.901l22.667-22.667c9.373-9.373 24.569-9.373 33.941 0L285.475 239.03c9.373 9.372 9.373 24.568.001 33.941z"/></svg></button>

    <div class="code-block-title-bar tw-w-full">
      <p class="tw-select-none !tw-my-1">text</p>
    </div>
    <div class="tw-flex">
      <button 
        class="
          line-number-button
          tw-select-none 
          tw-mx-2 
          tw-hidden 
          group-[.is-open]:tw-block 
          group-[.show-line-numbers]:tw-text-fgColor-link 
          print:!tw-hidden" 
        title="Toggle line numbers"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M61.77 401l17.5-20.15a19.92 19.92 0 0 0 5.07-14.19v-3.31C84.34 356 80.5 352 73 352H16a8 8 0 0 0-8 8v16a8 8 0 0 0 8 8h22.83a157.41 157.41 0 0 0-11 12.31l-5.61 7c-4 5.07-5.25 10.13-2.8 14.88l1.05 1.93c3 5.76 6.29 7.88 12.25 7.88h4.73c10.33 0 15.94 2.44 15.94 9.09 0 4.72-4.2 8.22-14.36 8.22a41.54 41.54 0 0 1-15.47-3.12c-6.49-3.88-11.74-3.5-15.6 3.12l-5.59 9.31c-3.72 6.13-3.19 11.72 2.63 15.94 7.71 4.69 20.38 9.44 37 9.44 34.16 0 48.5-22.75 48.5-44.12-.03-14.38-9.12-29.76-28.73-34.88zM496 224H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zm0-160H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16V80a16 16 0 0 0-16-16zm0 320H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zM16 160h64a8 8 0 0 0 8-8v-16a8 8 0 0 0-8-8H64V40a8 8 0 0 0-8-8H32a8 8 0 0 0-7.14 4.42l-8 16A8 8 0 0 0 24 64h8v64H16a8 8 0 0 0-8 8v16a8 8 0 0 0 8 8zm-3.91 160H80a8 8 0 0 0 8-8v-16a8 8 0 0 0-8-8H41.32c3.29-10.29 48.34-18.68 48.34-56.44 0-29.06-25-39.56-44.47-39.56-21.36 0-33.8 10-40.46 18.75-4.37 5.59-3 10.84 2.8 15.37l8.58 6.88c5.61 4.56 11 2.47 16.12-2.44a13.44 13.44 0 0 1 9.46-3.84c3.33 0 9.28 1.56 9.28 8.75C51 248.19 0 257.31 0 304.59v4C0 316 5.08 320 12.09 320z"/></svg></button>

      <button 
        class="
          wrap-code-button
          tw-select-none 
          tw-mx-2 
          tw-hidden 
          group-[.is-open]:tw-block 
          group-[.is-wrap]:tw-text-fgColor-link 
          print:!tw-hidden" 
        title="Toggle code wrap"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M16 132h416c8.837 0 16-7.163 16-16V76c0-8.837-7.163-16-16-16H16C7.163 60 0 67.163 0 76v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16z"/></svg></button>
      
      <button 
        class="
          copy-code-button
          tw-select-none
          tw-mx-2 
          tw-hidden
          group-[.is-open]:tw-block
          hover:tw-text-fgColor-link 
          print:!tw-hidden"
        title="Copy code">
          <span class="copy-icon tw-block"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M433.941 65.941l-51.882-51.882A48 48 0 0 0 348.118 0H176c-26.51 0-48 21.49-48 48v48H48c-26.51 0-48 21.49-48 48v320c0 26.51 21.49 48 48 48h224c26.51 0 48-21.49 48-48v-48h80c26.51 0 48-21.49 48-48V99.882a48 48 0 0 0-14.059-33.941zM266 464H54a6 6 0 0 1-6-6V150a6 6 0 0 1 6-6h74v224c0 26.51 21.49 48 48 48h96v42a6 6 0 0 1-6 6zm128-96H182a6 6 0 0 1-6-6V54a6 6 0 0 1 6-6h106v88c0 13.255 10.745 24 24 24h88v202a6 6 0 0 1-6 6zm6-256h-64V48h9.632c1.591 0 3.117.632 4.243 1.757l48.368 48.368a6 6 0 0 1 1.757 4.243V112z"/></svg></span>
          <span class="check-icon tw-hidden"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M173.898 439.404l-166.4-166.4c-9.997-9.997-9.997-26.206 0-36.204l36.203-36.204c9.997-9.998 26.207-9.998 36.204 0L192 312.69 432.095 72.596c9.997-9.997 26.207-9.997 36.204 0l36.203 36.204c9.997 9.997 9.997 26.206 0 36.204l-294.4 294.401c-9.998 9.997-26.207 9.997-36.204-.001z"/></svg></span>
      </button>
        
      <button 
        class="
          tw-select-none 
          tw-mx-2 
          tw-block 
          group-[.is-open]:tw-hidden 
          print:!tw-hidden" 
        disabled
        aria-hidden="true"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M328 256c0 39.8-32.2 72-72 72s-72-32.2-72-72 32.2-72 72-72 72 32.2 72 72zm104-72c-39.8 0-72 32.2-72 72s32.2 72 72 72 72-32.2 72-72-32.2-72-72-72zm-352 0c-39.8 0-72 32.2-72 72s32.2 72 72 72 72-32.2 72-72-32.2-72-72-72z"/></svg></button>
    </div>
  </div>
  <pre style="counter-reset: codeblock;" class="tw-block tw-m-0 tw-p-0"><code 
    id="codeblock-id-16" 
    class="
      chroma 
      !tw-block 
      tw-p-0
      tw-m-0
      tw-transition-[max-height] 
      tw-duration-500 
      tw-ease-in-out 
      group-[.is-closed]:!tw-max-h-0 
      group-[.is-wrap]:tw-text-wrap
      tw-overflow-y-hidden
      tw-overflow-x-auto
      tw-scrollbar-thin
      "><span class="line"><span class="cl">#tshark 解析MySQL协议
</span></span><span class="line"><span class="cl">tshark -r ./mysql-compress.cap -o tcp.calculate_timestamps:true -T fields -e mysql.caps.cp -e frame.number -e frame.time_epoch  -e frame.time_delta_displayed  -e ip.src -e tcp.srcport -e tcp.dstport -e ip.dst -e tcp.time_delta -e frame.time_delta_displayed  -e tcp.stream -e tcp.len -e mysql.query
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">#用tcpdump抓取并保存包：
</span></span><span class="line"><span class="cl">sudo tcpdump -i eth0 port 3306 -w drds.cap
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">#每隔3秒钟生成一个新文件，总共生成5个文件后（15秒后）终止抓包，然后包名也按时间规范好了
</span></span><span class="line"><span class="cl">sudo  tcpdump -t -s 0 tcp port 3306  -w &#39;dump_%Y-%m-%d_%H:%M:%S.pcap&#39;   -G 3 -W 5 -Z root
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">#每隔30分钟��成一个包并压缩
</span></span><span class="line"><span class="cl">nohup sudo tcpdump -i eth0 -t -s 0 tcp and port 3306 -w &#39;dump_%Y-%m-%d_%H:%M:%S.pcap&#39; -G 1800 -W 48 -Zroot -z gzip &amp;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">#file size 1000M
</span></span><span class="line"><span class="cl">nohup sudo tcpdump -i eth0 -t -s 0 tcp and port 3306 -w &#39;dump_&#39; -C 1000 -W 300 -Z root -z gzip &amp;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">#抓取详细SQL语句, 快速确认client发过来的具体SQL内容：
</span></span><span class="line"><span class="cl">sudo tshark -i any -f &#39;port 8527&#39; -s 0 -l -w - |strings
</span></span><span class="line"><span class="cl">sudo tshark -i eth0 -d tcp.port==3306,mysql -T fields -e mysql.query &#39;port 3306&#39;
</span></span><span class="line"><span class="cl">sudo tshark -i eth0 -R &#34;ip.addr==11.163.182.137&#34; -d tcp.port==3306,mysql -T fields -e mysql.query &#39;port 3306&#39;
</span></span><span class="line"><span class="cl">sudo tshark -i eth0 -R &#34;tcp.srcport==62877&#34; -d tcp.port==3001,mysql -T fields -e tcp.srcport -e mysql.query &#39;port 3001&#39;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">#如果RDS开启了SSL，那么抓包后的内容tshark/wireshark分析不到MySQL的具体内容，可以强制关闭：connectionProperties里加上useSSL=false
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">tshark -r ./manager.cap -o tcp.calculate_timestamps:true -Y &#34; tcp.analysis.retransmission &#34;  -T fields-e tcp.stream -e frame.number -e frame.time -e ip.src -e tcp.srcport -e tcp.dstport -e ip.dst | sort
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">#分析MySQL rt，倒数第四列基本就是rt
</span></span><span class="line"><span class="cl">tshark -r gege_drds.pcap -Y &#34; ((tcp.srcport eq 3306 ) and tcp.len&gt;0 )&#34; -o tcp.calculate_timestamps:true -T fields -e frame.number -e frame.time_epoch  -e frame.time_delta_displayed  -e ip.src -e tcp.srcport -e tcp.dstport -e ip.dst -e tcp.time_delta -e tcp.stream -e tcp.len -e tcp.analysis.ack_rtt
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">#或者排序一下
</span></span><span class="line"><span class="cl">tshark -r 213_php.cap -Y &#34;mysql.query or (  tcp.srcport==3306)&#34; -o tcp.calculate_timestamps:true -T fields -e frame.number -e frame.time_epoch  -e frame.time_delta_displayed  -e ip.src -e tcp.srcport -e tcp.dstport -e ip.dst -e tcp.time_delta -e tcp.stream -e tcp.len -e mysql.query |sort -nk9 -nk1</span></span></code></pre>
</div>
<h2 id="wireshark-插件安装" class="headerLink">
    <a href="#wireshark-%e6%8f%92%e4%bb%b6%e5%ae%89%e8%a3%85" class="header-mark"></a>Wireshark 插件安装</h2><div class="code-block highlight is-open show-line-numbers  tw-group tw-my-2">
  <div class="
    code-block-title 
    
    tw-flex 
    tw-flex-row 
    tw-justify-between 
    tw-w-full tw-bg-bgColor-secondary
    ">      
    <button 
      class="
        tw-select-none 
        tw-mx-2 
        tw-block
        group-[.is-open]:tw-rotate-90
        tw-transition-[transform] 
        tw-duration-500 
        tw-ease-in-out
        print:!tw-hidden"
      disabled
      aria-hidden="true"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M285.476 272.971L91.132 467.314c-9.373 9.373-24.569 9.373-33.941 0l-22.667-22.667c-9.357-9.357-9.375-24.522-.04-33.901L188.505 256 34.484 101.255c-9.335-9.379-9.317-24.544.04-33.901l22.667-22.667c9.373-9.373 24.569-9.373 33.941 0L285.475 239.03c9.373 9.372 9.373 24.568.001 33.941z"/></svg></button>

    <div class="code-block-title-bar tw-w-full">
      <p class="tw-select-none !tw-my-1">text</p>
    </div>
    <div class="tw-flex">
      <button 
        class="
          line-number-button
          tw-select-none 
          tw-mx-2 
          tw-hidden 
          group-[.is-open]:tw-block 
          group-[.show-line-numbers]:tw-text-fgColor-link 
          print:!tw-hidden" 
        title="Toggle line numbers"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M61.77 401l17.5-20.15a19.92 19.92 0 0 0 5.07-14.19v-3.31C84.34 356 80.5 352 73 352H16a8 8 0 0 0-8 8v16a8 8 0 0 0 8 8h22.83a157.41 157.41 0 0 0-11 12.31l-5.61 7c-4 5.07-5.25 10.13-2.8 14.88l1.05 1.93c3 5.76 6.29 7.88 12.25 7.88h4.73c10.33 0 15.94 2.44 15.94 9.09 0 4.72-4.2 8.22-14.36 8.22a41.54 41.54 0 0 1-15.47-3.12c-6.49-3.88-11.74-3.5-15.6 3.12l-5.59 9.31c-3.72 6.13-3.19 11.72 2.63 15.94 7.71 4.69 20.38 9.44 37 9.44 34.16 0 48.5-22.75 48.5-44.12-.03-14.38-9.12-29.76-28.73-34.88zM496 224H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zm0-160H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16V80a16 16 0 0 0-16-16zm0 320H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zM16 160h64a8 8 0 0 0 8-8v-16a8 8 0 0 0-8-8H64V40a8 8 0 0 0-8-8H32a8 8 0 0 0-7.14 4.42l-8 16A8 8 0 0 0 24 64h8v64H16a8 8 0 0 0-8 8v16a8 8 0 0 0 8 8zm-3.91 160H80a8 8 0 0 0 8-8v-16a8 8 0 0 0-8-8H41.32c3.29-10.29 48.34-18.68 48.34-56.44 0-29.06-25-39.56-44.47-39.56-21.36 0-33.8 10-40.46 18.75-4.37 5.59-3 10.84 2.8 15.37l8.58 6.88c5.61 4.56 11 2.47 16.12-2.44a13.44 13.44 0 0 1 9.46-3.84c3.33 0 9.28 1.56 9.28 8.75C51 248.19 0 257.31 0 304.59v4C0 316 5.08 320 12.09 320z"/></svg></button>

      <button 
        class="
          wrap-code-button
          tw-select-none 
          tw-mx-2 
          tw-hidden 
          group-[.is-open]:tw-block 
          group-[.is-wrap]:tw-text-fgColor-link 
          print:!tw-hidden" 
        title="Toggle code wrap"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M16 132h416c8.837 0 16-7.163 16-16V76c0-8.837-7.163-16-16-16H16C7.163 60 0 67.163 0 76v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16z"/></svg></button>
      
      <button 
        class="
          copy-code-button
          tw-select-none
          tw-mx-2 
          tw-hidden
          group-[.is-open]:tw-block
          hover:tw-text-fgColor-link 
          print:!tw-hidden"
        title="Copy code">
          <span class="copy-icon tw-block"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M433.941 65.941l-51.882-51.882A48 48 0 0 0 348.118 0H176c-26.51 0-48 21.49-48 48v48H48c-26.51 0-48 21.49-48 48v320c0 26.51 21.49 48 48 48h224c26.51 0 48-21.49 48-48v-48h80c26.51 0 48-21.49 48-48V99.882a48 48 0 0 0-14.059-33.941zM266 464H54a6 6 0 0 1-6-6V150a6 6 0 0 1 6-6h74v224c0 26.51 21.49 48 48 48h96v42a6 6 0 0 1-6 6zm128-96H182a6 6 0 0 1-6-6V54a6 6 0 0 1 6-6h106v88c0 13.255 10.745 24 24 24h88v202a6 6 0 0 1-6 6zm6-256h-64V48h9.632c1.591 0 3.117.632 4.243 1.757l48.368 48.368a6 6 0 0 1 1.757 4.243V112z"/></svg></span>
          <span class="check-icon tw-hidden"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M173.898 439.404l-166.4-166.4c-9.997-9.997-9.997-26.206 0-36.204l36.203-36.204c9.997-9.998 26.207-9.998 36.204 0L192 312.69 432.095 72.596c9.997-9.997 26.207-9.997 36.204 0l36.203 36.204c9.997 9.997 9.997 26.206 0 36.204l-294.4 294.401c-9.998 9.997-26.207 9.997-36.204-.001z"/></svg></span>
      </button>
        
      <button 
        class="
          tw-select-none 
          tw-mx-2 
          tw-block 
          group-[.is-open]:tw-hidden 
          print:!tw-hidden" 
        disabled
        aria-hidden="true"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M328 256c0 39.8-32.2 72-72 72s-72-32.2-72-72 32.2-72 72-72 72 32.2 72 72zm104-72c-39.8 0-72 32.2-72 72s32.2 72 72 72 72-32.2 72-72-32.2-72-72-72zm-352 0c-39.8 0-72 32.2-72 72s32.2 72 72 72 72-32.2 72-72-32.2-72-72-72z"/></svg></button>
    </div>
  </div>
  <pre style="counter-reset: codeblock;" class="tw-block tw-m-0 tw-p-0"><code 
    id="codeblock-id-17" 
    class="
      chroma 
      !tw-block 
      tw-p-0
      tw-m-0
      tw-transition-[max-height] 
      tw-duration-500 
      tw-ease-in-out 
      group-[.is-closed]:!tw-max-h-0 
      group-[.is-wrap]:tw-text-wrap
      tw-overflow-y-hidden
      tw-overflow-x-auto
      tw-scrollbar-thin
      "><span class="line"><span class="cl">插件是使用lua开发的，安装比较简单，以OS X平台为例：
</span></span><span class="line"><span class="cl">1. 将协议解析脚本copy到/Applications/Wireshark.app/Contents/Resources/share/wireshark/ 目录
</span></span><span class="line"><span class="cl">2. 编辑init.lua文件，设置disable_lua = false，确保lua支持打开
</span></span><span class="line"><span class="cl">3. 在init.lua文件末尾增加
</span></span><span class="line"><span class="cl">dofile(&#34;hsf2.lua&#34;)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">再次启动Wireshark，会对12200端口的数据流使用脚本解析，已经可以识别HSF协议了。
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">补充下Windows平台下的安装，步骤类似，将hsf2.lua拷贝到wireshark的根目录，例如c:\Program Files\Wireshark\，在这个目录下也有init.lua，然后参照上面的步骤2和3。</span></span></code></pre>
</div>
<h2 id="一个案例" class="headerLink">
    <a href="#%e4%b8%80%e4%b8%aa%e6%a1%88%e4%be%8b" class="header-mark"></a>一个案例</h2><blockquote>
  <p>问题：客户现场不管怎么样增加应用机器，tps就是上不去，同时增加机器后，增加的机器CPU还都能被用完，但是tps没有变化（这点比较奇怪） 整体服务调用慢，数据库没有慢查询，不知道到具体时间花在哪里，各个环节都尝试过增加服务器（或提升配置），但是问题一直得不到解决</p>

</blockquote><p>tshark分析抓包文件数据库服务器网卡中断瓶颈导致rtt非常高，进一步导致每个Query的ResponseTime非常高（图中左边都是出问题、右边都是问题解决后的响应时间）</p>
<p>下面两个图是吧tshark解析结果丢到了数据库中好用SQL可以进一步分析</p>
<p><img class="tw-inline" loading="lazy" src=http://localhost:1313/Users/ren/case/ossimg/d99665729dbc0ccbcbebd5176900ce6c.png   alt="image.png"  ></p>
<p>** 问题修复后数据库每个查询的平均响应时间从47毫秒下降到了4.5毫秒 **</p>
<p><img class="tw-inline" loading="lazy" src=http://localhost:1313/Users/ren/case/ossimg/3a80fa647b634e1671a0ebfd40a468bd.png   alt="image.png"  ></p>
<h4 id="从wireshark中也可以看到类似的rtt不正常超过150ms的比较多" class="headerLink">
    <a href="#%e4%bb%8ewireshark%e4%b8%ad%e4%b9%9f%e5%8f%af%e4%bb%a5%e7%9c%8b%e5%88%b0%e7%b1%bb%e4%bc%bc%e7%9a%84rtt%e4%b8%8d%e6%ad%a3%e5%b8%b8%e8%b6%85%e8%bf%87150ms%e7%9a%84%e6%af%94%e8%be%83%e5%a4%9a" class="header-mark"></a>从wireshark中也可以看到类似的rtt不正常（超过150ms的比较多）</h4><p><img class="tw-inline" loading="lazy" src=http://localhost:1313/Users/ren/case/ossimg/52cb9d61ce948f9b64737b7be88ac84e.png   alt="image.png"  ></p>
<h4 id="从wireshark中也可以看到类似的rtt正常99都在10ms以内" class="headerLink">
    <a href="#%e4%bb%8ewireshark%e4%b8%ad%e4%b9%9f%e5%8f%af%e4%bb%a5%e7%9c%8b%e5%88%b0%e7%b1%bb%e4%bc%bc%e7%9a%84rtt%e6%ad%a3%e5%b8%b899%e9%83%bd%e5%9c%a810ms%e4%bb%a5%e5%86%85" class="header-mark"></a>从wireshark中也可以看到类似的rtt正常(99%都在10ms以内）</h4><p><img class="tw-inline" loading="lazy" src=http://localhost:1313/Users/ren/case/ossimg/196033f267c33c08a4ca6b6fdb957cf3.png   alt="image.png"  ></p>
<h2 id="tcprstat" class="headerLink">
    <a href="#tcprstat" class="header-mark"></a>tcprstat</h2><p>推荐一个快速统计rt的<a href="https://github.com/Lowercases/tcprstat" target="_blank" rel="noopener noreferrer">工具tcprstat</a>，实测在CPU打满的高压力情况下会丢失大量请求数据，但是作为统计平均值这问题不大。支持http、mysql协议等。实际测试在每秒2万个SQL的时候，对于一台4C的机器，只能采集到70%的请求。</p>
<p>或者看这个<a href="https://github.com/y123456yz/tcprstat" target="_blank" rel="noopener noreferrer">支持设置RT阈值的统计改进版</a></p>
<p>tcprstat 统计抓包离线文件</p>
<div class="code-block highlight is-open show-line-numbers  tw-group tw-my-2">
  <div class="
    code-block-title 
    
    tw-flex 
    tw-flex-row 
    tw-justify-between 
    tw-w-full tw-bg-bgColor-secondary
    ">      
    <button 
      class="
        tw-select-none 
        tw-mx-2 
        tw-block
        group-[.is-open]:tw-rotate-90
        tw-transition-[transform] 
        tw-duration-500 
        tw-ease-in-out
        print:!tw-hidden"
      disabled
      aria-hidden="true"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M285.476 272.971L91.132 467.314c-9.373 9.373-24.569 9.373-33.941 0l-22.667-22.667c-9.357-9.357-9.375-24.522-.04-33.901L188.505 256 34.484 101.255c-9.335-9.379-9.317-24.544.04-33.901l22.667-22.667c9.373-9.373 24.569-9.373 33.941 0L285.475 239.03c9.373 9.372 9.373 24.568.001 33.941z"/></svg></button>

    <div class="code-block-title-bar tw-w-full">
      <p class="tw-select-none !tw-my-1">text</p>
    </div>
    <div class="tw-flex">
      <button 
        class="
          line-number-button
          tw-select-none 
          tw-mx-2 
          tw-hidden 
          group-[.is-open]:tw-block 
          group-[.show-line-numbers]:tw-text-fgColor-link 
          print:!tw-hidden" 
        title="Toggle line numbers"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M61.77 401l17.5-20.15a19.92 19.92 0 0 0 5.07-14.19v-3.31C84.34 356 80.5 352 73 352H16a8 8 0 0 0-8 8v16a8 8 0 0 0 8 8h22.83a157.41 157.41 0 0 0-11 12.31l-5.61 7c-4 5.07-5.25 10.13-2.8 14.88l1.05 1.93c3 5.76 6.29 7.88 12.25 7.88h4.73c10.33 0 15.94 2.44 15.94 9.09 0 4.72-4.2 8.22-14.36 8.22a41.54 41.54 0 0 1-15.47-3.12c-6.49-3.88-11.74-3.5-15.6 3.12l-5.59 9.31c-3.72 6.13-3.19 11.72 2.63 15.94 7.71 4.69 20.38 9.44 37 9.44 34.16 0 48.5-22.75 48.5-44.12-.03-14.38-9.12-29.76-28.73-34.88zM496 224H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zm0-160H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16V80a16 16 0 0 0-16-16zm0 320H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zM16 160h64a8 8 0 0 0 8-8v-16a8 8 0 0 0-8-8H64V40a8 8 0 0 0-8-8H32a8 8 0 0 0-7.14 4.42l-8 16A8 8 0 0 0 24 64h8v64H16a8 8 0 0 0-8 8v16a8 8 0 0 0 8 8zm-3.91 160H80a8 8 0 0 0 8-8v-16a8 8 0 0 0-8-8H41.32c3.29-10.29 48.34-18.68 48.34-56.44 0-29.06-25-39.56-44.47-39.56-21.36 0-33.8 10-40.46 18.75-4.37 5.59-3 10.84 2.8 15.37l8.58 6.88c5.61 4.56 11 2.47 16.12-2.44a13.44 13.44 0 0 1 9.46-3.84c3.33 0 9.28 1.56 9.28 8.75C51 248.19 0 257.31 0 304.59v4C0 316 5.08 320 12.09 320z"/></svg></button>

      <button 
        class="
          wrap-code-button
          tw-select-none 
          tw-mx-2 
          tw-hidden 
          group-[.is-open]:tw-block 
          group-[.is-wrap]:tw-text-fgColor-link 
          print:!tw-hidden" 
        title="Toggle code wrap"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M16 132h416c8.837 0 16-7.163 16-16V76c0-8.837-7.163-16-16-16H16C7.163 60 0 67.163 0 76v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16z"/></svg></button>
      
      <button 
        class="
          copy-code-button
          tw-select-none
          tw-mx-2 
          tw-hidden
          group-[.is-open]:tw-block
          hover:tw-text-fgColor-link 
          print:!tw-hidden"
        title="Copy code">
          <span class="copy-icon tw-block"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M433.941 65.941l-51.882-51.882A48 48 0 0 0 348.118 0H176c-26.51 0-48 21.49-48 48v48H48c-26.51 0-48 21.49-48 48v320c0 26.51 21.49 48 48 48h224c26.51 0 48-21.49 48-48v-48h80c26.51 0 48-21.49 48-48V99.882a48 48 0 0 0-14.059-33.941zM266 464H54a6 6 0 0 1-6-6V150a6 6 0 0 1 6-6h74v224c0 26.51 21.49 48 48 48h96v42a6 6 0 0 1-6 6zm128-96H182a6 6 0 0 1-6-6V54a6 6 0 0 1 6-6h106v88c0 13.255 10.745 24 24 24h88v202a6 6 0 0 1-6 6zm6-256h-64V48h9.632c1.591 0 3.117.632 4.243 1.757l48.368 48.368a6 6 0 0 1 1.757 4.243V112z"/></svg></span>
          <span class="check-icon tw-hidden"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M173.898 439.404l-166.4-166.4c-9.997-9.997-9.997-26.206 0-36.204l36.203-36.204c9.997-9.998 26.207-9.998 36.204 0L192 312.69 432.095 72.596c9.997-9.997 26.207-9.997 36.204 0l36.203 36.204c9.997 9.997 9.997 26.206 0 36.204l-294.4 294.401c-9.998 9.997-26.207 9.997-36.204-.001z"/></svg></span>
      </button>
        
      <button 
        class="
          tw-select-none 
          tw-mx-2 
          tw-block 
          group-[.is-open]:tw-hidden 
          print:!tw-hidden" 
        disabled
        aria-hidden="true"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M328 256c0 39.8-32.2 72-72 72s-72-32.2-72-72 32.2-72 72-72 72 32.2 72 72zm104-72c-39.8 0-72 32.2-72 72s32.2 72 72 72 72-32.2 72-72-32.2-72-72-72zm-352 0c-39.8 0-72 32.2-72 72s32.2 72 72 72 72-32.2 72-72-32.2-72-72-72z"/></svg></button>
    </div>
  </div>
  <pre style="counter-reset: codeblock;" class="tw-block tw-m-0 tw-p-0"><code 
    id="codeblock-id-18" 
    class="
      chroma 
      !tw-block 
      tw-p-0
      tw-m-0
      tw-transition-[max-height] 
      tw-duration-500 
      tw-ease-in-out 
      group-[.is-closed]:!tw-max-h-0 
      group-[.is-wrap]:tw-text-wrap
      tw-overflow-y-hidden
      tw-overflow-x-auto
      tw-scrollbar-thin
      "><span class="line"><span class="cl"># -l 166.100.128.148  向目标端口80发起请求的地址
</span></span><span class="line"><span class="cl"># -p 80  发出response端口
</span></span><span class="line"><span class="cl"># -t 10 间隔10s一次汇总统计
</span></span><span class="line"><span class="cl"># -f 后面的分位置可以随便指定（90%、95%、99%等）
</span></span><span class="line"><span class="cl">tcprstat -r pts.pcap -p 80 -l 166.100.128.148 -t 10 -f &#34;%T\t%n\t%M\t%m\t%a\t%h\t%S\t%95M\t%90a\t%95S\t%99M\t%99a\t%90S\n&#34;</span></span></code></pre>
</div>
<h2 id="其它工具-packetdrill" class="headerLink">
    <a href="#%e5%85%b6%e5%ae%83%e5%b7%a5%e5%85%b7-packetdrill" class="header-mark"></a>其它工具 packetdrill</h2><p><a href="https://github.com/google/packetdrill" target="_blank" rel="noopener noreferrer">https://github.com/google/packetdrill</a></p>
<p><a href="https://mp.weixin.qq.com/s/CcM3rINPn54Oean144kvMw" target="_blank" rel="noopener noreferrer">https://mp.weixin.qq.com/s/CcM3rINPn54Oean144kvMw</a></p>
<p><a href="http://beta.computer-networking.info/syllabus/default/exercises/tcp-2.html" target="_blank" rel="noopener noreferrer">http://beta.computer-networking.info/syllabus/default/exercises/tcp-2.html</a></p>
<p><a href="https://segmentfault.com/a/1190000019193928" target="_blank" rel="noopener noreferrer">https://segmentfault.com/a/1190000019193928</a></p>
]]></description>
</item><item>
    <title>就是要你懂TCP--wireshark-dup-ack-issue</title>
    <link>http://localhost:1313/posts/%E5%B0%B1%E6%98%AF%E8%A6%81%E4%BD%A0%E6%87%82tcp--wireshark-dup-ack-issue/</link>
    <pubDate>Fri, 02 Jun 2017 15:30:03 &#43;0000</pubDate><author>
        <name>作者</name>
    </author><guid>http://localhost:1313/posts/%E5%B0%B1%E6%98%AF%E8%A6%81%E4%BD%A0%E6%87%82tcp--wireshark-dup-ack-issue/</guid>
    <description><![CDATA[<h1 id="就是要你懂tcp--wireshark-dup-ack-issue" class="headerLink">
    <a href="#%e5%b0%b1%e6%98%af%e8%a6%81%e4%bd%a0%e6%87%82tcp--wireshark-dup-ack-issue" class="header-mark"></a>就是要你懂TCP&ndash;wireshark-dup-ack-issue</h1><h2 id="问题" class="headerLink">
    <a href="#%e9%97%ae%e9%a2%98" class="header-mark"></a>问题：</h2><p>很多同学学会抓包后，经常拿着这样一个抓包来问我是怎么回事：</p>
<p>在wireshark中看到一个tcp会话中的两台机器突然一直互相发dup ack包，但是没有触发重传。每次重复ack都是间隔精确的20秒</p>
<h2 id="如下截图" class="headerLink">
    <a href="#%e5%a6%82%e4%b8%8b%e6%88%aa%e5%9b%be" class="header-mark"></a>如下截图：</h2><p><img class="tw-inline" loading="lazy" src=https://cdn.jsdelivr.net/gh/plantegg/plantegg.github.io/images/951413iMgBlog/bm3W68Q.png     ></p>
<p>client都一直在回复收到2号包（ack=2）了，可是server跟傻了一样居然还发seq=1的包（按理，应该发比2大的包啊）</p>
<h2 id="系统配置" class="headerLink">
    <a href="#%e7%b3%bb%e7%bb%9f%e9%85%8d%e7%bd%ae" class="header-mark"></a>系统配置：</h2><pre><code>net.ipv4.tcp_keepalive_time = 20
net.ipv4.tcp_keepalive_probes = 5
net.ipv4.tcp_keepalive_intvl = 3
</code></pre>
<h2 id="原因" class="headerLink">
    <a href="#%e5%8e%9f%e5%9b%a0" class="header-mark"></a>原因：</h2><p>抓包不全的话wireshark有缺陷，把keepalive包识别成了dup ack包，看内容这种dup ack和keepalive似乎是一样的，flags都是0x010。keep alive的定义的是后退一格(seq少1）。</p>
<p>2、4、6、8……号包，都有一个“tcp acked unseen segment”。这个一般表示它ack的这个包，没有被抓到。Wirshark如何作出此判断呢？前面一个包是seq=1, len=0，所以正常情况下是ack = seq + len = 1，然而Wireshark看到的确是ack = 2, 它只能判断有一个seq =1, len = 1的包没有抓到。
dup ack也是类似道理，这些包完全符合dup ack的定义，因为“ack = ” 某个数连续多次出现了。</p>
<p>这一切都是因为keep alive的特殊性导致的。打开66号包的tcp层（见后面的截图），可以看到它的 next sequence number = 12583，表示正常情况下server发出的下一个包应该是seq = 12583。可是在下一个包，也就是68号包中，却是seq = 12582。keep alive的定义的确是这样，即后退一格。
Wireshark只有在抓到数据包（66号包）和keep alive包的情况下才有可能正确识别，前面的抓包中恰好在keep alive之前丢失了数据包，所以Wireshark就蒙了。</p>
<h2 id="构造重现" class="headerLink">
    <a href="#%e6%9e%84%e9%80%a0%e9%87%8d%e7%8e%b0" class="header-mark"></a>构造重现</h2><p>如果用“frame.number &gt;= 68” 过滤这个包，然后File&ndash;&gt;export specified packets保存成一个新文件，再打开那个新文件，就会发现Wireshark又蒙了。本来能够正常识别的keep alive包又被错看成dup ack了，所以一旦碰到这种情况不要慌要稳</p>
<p>下面是知识点啦</p>
<h2 id="keepalive" class="headerLink">
    <a href="#keepalive" class="header-mark"></a>Keepalive</h2><p>TCP报文接收方必须回复的场景：</p>
<p>TCP携带字节数据
没有字节数据，携带SYN状态位
没有字节数据，携带FIN状态位</p>
<p>keepalive 提取历史发送的最后一个字节，充当心跳字节数据，依然使用该字节的最初序列号。也就是前面所说的seq回退了一个</p>
<p>对方收到后因为seq小于TCP滑动窗口的左侧，被判定为duplicated数据包，然后扔掉了，并回复一个duplicated ack</p>
<p>所以keepalive跟duplicated本质是一回事，就看wireshark能够正确识别了。</p>
<h2 id="duplication-ack是指" class="headerLink">
    <a href="#duplication-ack%e6%98%af%e6%8c%87" class="header-mark"></a>Duplication ack是指：</h2><p>server收到了3和8号包，但是没有收到中间的4/5/6/7，那么server就会ack 3，如果client还是继续发8/9号包，那么server会继续发dup ack 3#1 ; dup ack 3#2 来向客户端说明只收到了3号包，不要着急发后面的大包，把4/5/6/7给我发过来</p>
<h2 id="tcp-window-update" class="headerLink">
    <a href="#tcp-window-update" class="header-mark"></a>TCP Window Update</h2><p><img class="tw-inline" loading="lazy" src=http://localhost:1313/Users/ren/case/ossimg/1558941016099-bc4504f1-e9c7-4d84-85e1-a7f5c6554306.png     ></p>
<p>如上图，当接收方的tcp Window Size不足一个MSS的时候，为了避免 Silly Window Syndrome，Client不再发小包，而是发送探测包（跟keepalive一样，发一个回退一格的包，触发server ack同时server ack的时候会带过来新的window size）探测包间隔时间是200/400/800/1600……ms这样</p>
<h2 id="正常的keep-alive-case" class="headerLink">
    <a href="#%e6%ad%a3%e5%b8%b8%e7%9a%84keep-alive-case" class="header-mark"></a>正常的keep-alive Case：</h2><p><img class="tw-inline" loading="lazy" src=https://cdn.jsdelivr.net/gh/plantegg/plantegg.github.io/images/951413iMgBlog/DsTWFZr.png     ></p>
<p>keep-alive 通过发一个比实际seq小1的包，比如server都已经 ack 12583了，client故意发一个seq 12582来标识这是一个keep-Alive包</p>
<h2 id="duplication-ack是指-1" class="headerLink">
    <a href="#duplication-ack%e6%98%af%e6%8c%87-1" class="header-mark"></a>Duplication ack是指：</h2><p>server收到了3和8号包，但是没有收到中间的4/5/6/7，那么server就会ack 3，如果client还是继续发8/9号包，那么server会继续发dup ack 3#1 ; dup ack 3#2 来向客户端说明只收到了3号包，不要着急发后面的大包，把4/5/6/7给我发过来</p>
]]></description>
</item></channel>
</rss>
