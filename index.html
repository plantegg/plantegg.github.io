<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 8.1.1">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@7.0.0/css/all.min.css" integrity="sha256-VHqXKFhhMxcpubYf9xiWdCiojEbY9NexQ4jh8AxbvcM=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"plantegg.github.io","root":"/","images":"/images","scheme":"Muse","darkmode":false,"version":"8.26.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"codeblock":{"theme":{"light":"default","dark":"stackoverflow-dark"},"prism":{"light":"prism","dark":"prism-dark"},"copy_button":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"language":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"duration":200,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js" defer></script>

    <meta name="description" content="java mysql tcp performance network docker Linux">
<meta property="og:type" content="website">
<meta property="og:title" content="plantegg">
<meta property="og:url" content="https://plantegg.github.io/index.html">
<meta property="og:site_name" content="plantegg">
<meta property="og:description" content="java mysql tcp performance network docker Linux">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="twitter @plantegg">
<meta property="article:tag" content="技术,编程,博客">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://plantegg.github.io/">


<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>plantegg</title>
  








  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous" defer></script>
<script src="/js/utils.js" defer></script><script src="/js/motion.js" defer></script><script src="/js/sidebar.js" defer></script><script src="/js/next-boot.js" defer></script>

  






  
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>





  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">plantegg</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">java tcp mysql performance network docker Linux</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li>
  </ul>
</nav>




</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">twitter @plantegg</p>
  <div class="site-description" itemprop="description">java mysql tcp performance network docker Linux</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">190</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">18</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">282</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://plantegg.github.io/2117/06/07/%E5%85%B3%E4%BA%8E%E6%9C%AC%E5%8D%9A/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="twitter @plantegg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="plantegg">
      <meta itemprop="description" content="java mysql tcp performance network docker Linux">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | plantegg">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2117/06/07/%E5%85%B3%E4%BA%8E%E6%9C%AC%E5%8D%9A/" class="post-title-link" itemprop="url">关于本博</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2117-06-07 18:30:03" itemprop="dateCreated datePublished" datetime="2117-06-07T18:30:03+08:00">2117-06-07</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2025-11-16 19:58:49" itemprop="dateModified" datetime="2025-11-16T19:58:49+08:00">2025-11-16</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/others/" itemprop="url" rel="index"><span itemprop="name">others</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="关于本博"><a href="#关于本博" class="headerlink" title="关于本博"></a>关于本博</h2><p>find me on twitter: <a target="_blank" rel="noopener" href="https://twitter.com/plantegg">@plantegg</a></p>
<p>知识星球：<a target="_blank" rel="noopener" href="https://t.zsxq.com/0cSFEUh2J">https://t.zsxq.com/0cSFEUh2J</a></p>
<p>Github: <a target="_blank" rel="noopener" href="https://github.com/plantegg/programmer_case">欢迎star</a> </p>
<p>关注基础知识，一次把问题搞清楚，从案例出发深挖相关知识。</p>
<p>以前觉得自己一看就懂，实际是一问就打鼓，一用就糊涂。所以现在开始记录并总结再联系案例，一般是先把零散知识记录下来（看到过），慢慢地相关知识积累更多，直到碰到实践案例或是有点领悟到于是发现这块知识可以整理成一篇系统些的文章（基本快懂了）。</p>
<p>“技术变化太快，容易过时”，我的看法是网络知识、操作系统、计算机原理等核心概念知识的寿命会比你的职业生涯还长。这些都是40岁之后还会还会很有用</p>
<p><a href="https://plantegg.github.io/2018/05/23/%E5%A6%82%E4%BD%95%E5%9C%A8%E5%B7%A5%E4%BD%9C%E4%B8%AD%E5%AD%A6%E4%B9%A0/">如何在工作中学习</a> 所有方法我都记录在这篇文章中了，希望对你能有所帮助。</p>
<p>所有新文章从<a href="https://plantegg.github.io/archives">这里可以看到</a>，即使再简单的一篇总结我可以持续总结三五年，有新的发现、感悟都是直接在原文上增减，不会发表新的文章。</p>
<p><img src="/images/951413iMgBlog/image-20220421102225491.png" alt="image-20220421102225491"></p>
<p>为什么写博客而不是公众号，我见过20年前的互联网，深度依赖搜索引擎，所以还是喜欢博客。另外技术类文章更适合电脑阅读（随时摘录、实验）</p>
<h2 id="精华文章推荐"><a href="#精华文章推荐" class="headerlink" title="精华文章推荐"></a>精华文章推荐</h2><h4 id="在2010年前后MySQL、PG、Oracle数据库在使用NUMA的时候碰到了性能问题，流传最广的这篇-MySQL-–-The-MySQL-“swap-insanity”-problem-and-the-effects-of-the-NUMA-architecture-http-blog-jcole-us-2010-09-28-mysql-swap-insanity-and-the-numa-architecture-文章描述了性能问题的原因-文章中把原因找错了-以及解决方案：关闭NUMA。-实际这个原因是kernel实现的一个低级bug，这个Bug在2014年修复了https-github-com-torvalds-linux-commit-4f9b16a64753d0bb607454347036dc997fd03b82，但是修复这么多年后仍然以讹传讹，这篇文章希望正本清源、扭转错误的认识。"><a href="#在2010年前后MySQL、PG、Oracle数据库在使用NUMA的时候碰到了性能问题，流传最广的这篇-MySQL-–-The-MySQL-“swap-insanity”-problem-and-the-effects-of-the-NUMA-architecture-http-blog-jcole-us-2010-09-28-mysql-swap-insanity-and-the-numa-architecture-文章描述了性能问题的原因-文章中把原因找错了-以及解决方案：关闭NUMA。-实际这个原因是kernel实现的一个低级bug，这个Bug在2014年修复了https-github-com-torvalds-linux-commit-4f9b16a64753d0bb607454347036dc997fd03b82，但是修复这么多年后仍然以讹传讹，这篇文章希望正本清源、扭转错误的认识。" class="headerlink" title="在2010年前后MySQL、PG、Oracle数据库在使用NUMA的时候碰到了性能问题，流传最广的这篇  MySQL – The MySQL “swap insanity” problem and the effects of the NUMA architecture http://blog.jcole.us/2010/09/28/mysql-swap-insanity-and-the-numa-architecture/ 文章描述了性能问题的原因(文章中把原因找错了)以及解决方案：关闭NUMA。 实际这个原因是kernel实现的一个低级bug，这个Bug在2014年修复了https://github.com/torvalds/linux/commit/4f9b16a64753d0bb607454347036dc997fd03b82，但是修复这么多年后仍然以讹传讹，这篇文章希望正本清源、扭转错误的认识。"></a><a href="https://plantegg.github.io/2021/05/14/%E5%8D%81%E5%B9%B4%E5%90%8E%E6%95%B0%E6%8D%AE%E5%BA%93%E8%BF%98%E6%98%AF%E4%B8%8D%E6%95%A2%E6%8B%A5%E6%8A%B1NUMA/">在2010年前后MySQL、PG、Oracle数据库在使用NUMA的时候碰到了性能问题，流传最广的这篇  MySQL – The MySQL “swap insanity” problem and the effects of the NUMA architecture http://blog.jcole.us/2010/09/28/mysql-swap-insanity-and-the-numa-architecture/ 文章描述了性能问题的原因(文章中把原因找错了)以及解决方案：关闭NUMA。 实际这个原因是kernel实现的一个低级bug，这个Bug在2014年修复了https://github.com/torvalds/linux/commit/4f9b16a64753d0bb607454347036dc997fd03b82，但是修复这么多年后仍然以讹传讹，这篇文章希望正本清源、扭转错误的认识。</a></h4><p><img src="/images/951413iMgBlog/image-20210517082233798.png" alt="image-20210517082233798"></p>
<h4 id="CPU的制造和概念-从最底层的沙子开始用8篇文章来回答关于CPU的各种疑问以及大量的实验对比案例和测试数据来展示了CPU的各种原理，比如多核、超线程、NUMA、睿频、功耗、GPU、大小核再到分支预测、cache-line失效、加锁代价、IPC等各种指标（都有对应的代码和测试数据）。"><a href="#CPU的制造和概念-从最底层的沙子开始用8篇文章来回答关于CPU的各种疑问以及大量的实验对比案例和测试数据来展示了CPU的各种原理，比如多核、超线程、NUMA、睿频、功耗、GPU、大小核再到分支预测、cache-line失效、加锁代价、IPC等各种指标（都有对应的代码和测试数据）。" class="headerlink" title="CPU的制造和概念 从最底层的沙子开始用8篇文章来回答关于CPU的各种疑问以及大量的实验对比案例和测试数据来展示了CPU的各种原理，比如多核、超线程、NUMA、睿频、功耗、GPU、大小核再到分支预测、cache_line失效、加锁代价、IPC等各种指标（都有对应的代码和测试数据）。"></a><a href="https://plantegg.github.io/2021/06/01/CPU%E7%9A%84%E5%88%B6%E9%80%A0%E5%92%8C%E6%A6%82%E5%BF%B5/">CPU的制造和概念</a> 从最底层的沙子开始用8篇文章来回答关于CPU的各种疑问以及大量的实验对比案例和测试数据来展示了CPU的各种原理，比如多核、超线程、NUMA、睿频、功耗、GPU、大小核再到分支预测、cache_line失效、加锁代价、IPC等各种指标（都有对应的代码和测试数据）。</h4><p><img src="/images/951413iMgBlog/image-20210802161410524-1011377.png" alt="image-20210802161410524"> </p>
<h4 id="《Intel-PAUSE指令变化是如何影响自旋锁以及MySQL的性能的》-从一个参数引起的rt抖动定位到OS锁等待再到CPU-Pause指令，以及不同CPU型号对Pause使用cycles不同的影响，最终反馈到应用层面的rt全过程。在MySQL内核开发的时候考虑了Pause，但是没有考虑不同的CPU型号，所以换了CPU型号后性能差异比较大"><a href="#《Intel-PAUSE指令变化是如何影响自旋锁以及MySQL的性能的》-从一个参数引起的rt抖动定位到OS锁等待再到CPU-Pause指令，以及不同CPU型号对Pause使用cycles不同的影响，最终反馈到应用层面的rt全过程。在MySQL内核开发的时候考虑了Pause，但是没有考虑不同的CPU型号，所以换了CPU型号后性能差异比较大" class="headerlink" title="《Intel PAUSE指令变化是如何影响自旋锁以及MySQL的性能的》 从一个参数引起的rt抖动定位到OS锁等待再到CPU Pause指令，以及不同CPU型号对Pause使用cycles不同的影响，最终反馈到应用层面的rt全过程。在MySQL内核开发的时候考虑了Pause，但是没有考虑不同的CPU型号，所以换了CPU型号后性能差异比较大"></a><a href="https://plantegg.github.io/2019/12/16/Intel%20PAUSE%E6%8C%87%E4%BB%A4%E5%8F%98%E5%8C%96%E6%98%AF%E5%A6%82%E4%BD%95%E5%BD%B1%E5%93%8D%E8%87%AA%E6%97%8B%E9%94%81%E4%BB%A5%E5%8F%8AMySQL%E7%9A%84%E6%80%A7%E8%83%BD%E7%9A%84/">《Intel PAUSE指令变化是如何影响自旋锁以及MySQL的性能的》 从一个参数引起的rt抖动定位到OS锁等待再到CPU Pause指令，以及不同CPU型号对Pause使用cycles不同的影响，最终反馈到应用层面的rt全过程。在MySQL内核开发的时候考虑了Pause，但是没有考虑不同的CPU型号，所以换了CPU型号后性能差异比较大</a></h4><p><img src="/images/oss/d567449fe52725a9d0b9d4ec9baa372c.png" alt="image.png"></p>
<h4 id="10倍性能提升全过程-在双11的紧张流程下，将系统tps从500优化到5500，从网络到snat、再到Spring和StackTrace，一次全栈性能优化过程的详细记录和分析。"><a href="#10倍性能提升全过程-在双11的紧张流程下，将系统tps从500优化到5500，从网络到snat、再到Spring和StackTrace，一次全栈性能优化过程的详细记录和分析。" class="headerlink" title="10倍性能提升全过程 在双11的紧张流程下，将系统tps从500优化到5500，从网络到snat、再到Spring和StackTrace，一次全栈性能优化过程的详细记录和分析。"></a><a href="https://plantegg.github.io/2018/01/23/10+%E5%80%8D%E6%80%A7%E8%83%BD%E6%8F%90%E5%8D%87%E5%85%A8%E8%BF%87%E7%A8%8B/">10倍性能提升全过程</a> 在双11的紧张流程下，将系统tps从500优化到5500，从网络到snat、再到Spring和StackTrace，一次全栈性能优化过程的详细记录和分析。</h4><p><img src="/images/oss/05703c168e63e96821ea9f921d83712b.png" alt="image.png"></p>
<h4 id="就是要你懂TCP–半连接队列和全连接队列：偶发性的连接reset异常、重启服务后短时间的连接异常，通过一篇文章阐明TCP连接的半连接队列和全连接队大小是怎么影响连接创建的，以及用什么工具来观察队列有没有溢出、连接为什么会RESET"><a href="#就是要你懂TCP–半连接队列和全连接队列：偶发性的连接reset异常、重启服务后短时间的连接异常，通过一篇文章阐明TCP连接的半连接队列和全连接队大小是怎么影响连接创建的，以及用什么工具来观察队列有没有溢出、连接为什么会RESET" class="headerlink" title="就是要你懂TCP–半连接队列和全连接队列：偶发性的连接reset异常、重启服务后短时间的连接异常，通过一篇文章阐明TCP连接的半连接队列和全连接队大小是怎么影响连接创建的，以及用什么工具来观察队列有没有溢出、连接为什么会RESET"></a><a href="https://plantegg.github.io/2017/06/07/%E5%B0%B1%E6%98%AF%E8%A6%81%E4%BD%A0%E6%87%82TCP--%E5%8D%8A%E8%BF%9E%E6%8E%A5%E9%98%9F%E5%88%97%E5%92%8C%E5%85%A8%E8%BF%9E%E6%8E%A5%E9%98%9F%E5%88%97/">就是要你懂TCP–半连接队列和全连接队列：偶发性的连接reset异常、重启服务后短时间的连接异常，通过一篇文章阐明TCP连接的半连接队列和全连接队大小是怎么影响连接创建的，以及用什么工具来观察队列有没有溢出、连接为什么会RESET</a></h4><img src="/images/oss/1579241362064-807d8378-6c54-4a2c-a888-ff2337df817c.png" alt="image.png" style="zoom:80%;" />



<h4 id="就是要你懂TCP–性能和发送接收Buffer的关系：发送窗口大小-Buffer-、接收窗口大小-Buffer-对TCP传输速度的影响，以及怎么观察窗口对传输速度的影响。BDP、RT、带宽对传输速度又是怎么影响的"><a href="#就是要你懂TCP–性能和发送接收Buffer的关系：发送窗口大小-Buffer-、接收窗口大小-Buffer-对TCP传输速度的影响，以及怎么观察窗口对传输速度的影响。BDP、RT、带宽对传输速度又是怎么影响的" class="headerlink" title="就是要你懂TCP–性能和发送接收Buffer的关系：发送窗口大小(Buffer)、接收窗口大小(Buffer)对TCP传输速度的影响，以及怎么观察窗口对传输速度的影响。BDP、RT、带宽对传输速度又是怎么影响的"></a><a href="https://plantegg.github.io/2019/09/28/%E5%B0%B1%E6%98%AF%E8%A6%81%E4%BD%A0%E6%87%82TCP--%E6%80%A7%E8%83%BD%E5%92%8C%E5%8F%91%E9%80%81%E6%8E%A5%E6%94%B6Buffer%E7%9A%84%E5%85%B3%E7%B3%BB/">就是要你懂TCP–性能和发送接收Buffer的关系：发送窗口大小(Buffer)、接收窗口大小(Buffer)对TCP传输速度的影响，以及怎么观察窗口对传输速度的影响。BDP、RT、带宽对传输速度又是怎么影响的</a></h4><p><img src="/images/oss/e177d59ecb886daef5905ed80a84dfd2.png"></p>
<h4 id="就是要你懂网络–一个网络包的旅程：教科书式地阐述书本中的路由、网关、子网、Mac地址、IP地址是如何一起协作让网络包最终传输到目标机器上。-同时可以跟讲这块的RFC1180比较一下，RFC1180-写的确实很好，清晰简洁，图文并茂，结构逻辑合理，但是对于90-的程序员没有什么卵用，看完几周后就忘得差不多，因为他不是从实践的角度来阐述问题，中间没有很多为什么，所以一般资质的程序员看完当时感觉很好，实际还是不会灵活运用"><a href="#就是要你懂网络–一个网络包的旅程：教科书式地阐述书本中的路由、网关、子网、Mac地址、IP地址是如何一起协作让网络包最终传输到目标机器上。-同时可以跟讲这块的RFC1180比较一下，RFC1180-写的确实很好，清晰简洁，图文并茂，结构逻辑合理，但是对于90-的程序员没有什么卵用，看完几周后就忘得差不多，因为他不是从实践的角度来阐述问题，中间没有很多为什么，所以一般资质的程序员看完当时感觉很好，实际还是不会灵活运用" class="headerlink" title="就是要你懂网络–一个网络包的旅程：教科书式地阐述书本中的路由、网关、子网、Mac地址、IP地址是如何一起协作让网络包最终传输到目标机器上。  同时可以跟讲这块的RFC1180比较一下，RFC1180 写的确实很好，清晰简洁，图文并茂，结构逻辑合理，但是对于90%的程序员没有什么卵用，看完几周后就忘得差不多，因为他不是从实践的角度来阐述问题，中间没有很多为什么，所以一般资质的程序员看完当时感觉很好，实际还是不会灵活运用"></a><a href="https://plantegg.github.io/2019/05/15/%E5%B0%B1%E6%98%AF%E8%A6%81%E4%BD%A0%E6%87%82%E7%BD%91%E7%BB%9C--%E4%B8%80%E4%B8%AA%E7%BD%91%E7%BB%9C%E5%8C%85%E7%9A%84%E6%97%85%E7%A8%8B/">就是要你懂网络–一个网络包的旅程：教科书式地阐述书本中的路由、网关、子网、Mac地址、IP地址是如何一起协作让网络包最终传输到目标机器上。</a>  同时可以跟讲这块的<a target="_blank" rel="noopener" href="https://tools.ietf.org/html/rfc1180">RFC1180</a>比较一下，RFC1180 写的确实很好，清晰简洁，图文并茂，结构逻辑合理，但是对于90%的程序员没有什么卵用，看完几周后就忘得差不多，因为他不是从实践的角度来阐述问题，中间没有很多为什么，所以一般资质的程序员看完当时感觉很好，实际还是不会灵活运用</h4><p><img src="/images/oss/8f5d8518c1d92ed68d23218028e3cd11.png"></p>
<h4 id="国产CPU和Intel、AMD性能PK-从Intel、AMD、海光、鲲鹏920、飞腾2500-等CPU在TPCC、sysbench下的性能对比来分析他们的性能差距，同时分析内存延迟对性能的影响"><a href="#国产CPU和Intel、AMD性能PK-从Intel、AMD、海光、鲲鹏920、飞腾2500-等CPU在TPCC、sysbench下的性能对比来分析他们的性能差距，同时分析内存延迟对性能的影响" class="headerlink" title="国产CPU和Intel、AMD性能PK 从Intel、AMD、海光、鲲鹏920、飞腾2500 等CPU在TPCC、sysbench下的性能对比来分析他们的性能差距，同时分析内存延迟对性能的影响"></a><a href="https://plantegg.github.io/2022/01/13/%E4%B8%8D%E5%90%8CCPU%E6%80%A7%E8%83%BD%E5%A4%A7PK/">国产CPU和Intel、AMD性能PK</a> 从Intel、AMD、海光、鲲鹏920、飞腾2500 等CPU在TPCC、sysbench下的性能对比来分析他们的性能差距，同时分析内存延迟对性能的影响</h4><p><img src="/images/951413iMgBlog/image-20220319115644219.png" alt="image-20220319115644219"></p>
<h4 id="从网络路由连通性的原理上来看负载均衡lvs的DR、NAT、FullNAT到底搞了些什么鬼，以及为什么要这么搞，和带来的优缺点：《就是要你懂负载均衡–lvs和转发模式》"><a href="#从网络路由连通性的原理上来看负载均衡lvs的DR、NAT、FullNAT到底搞了些什么鬼，以及为什么要这么搞，和带来的优缺点：《就是要你懂负载均衡–lvs和转发模式》" class="headerlink" title="从网络路由连通性的原理上来看负载均衡lvs的DR、NAT、FullNAT到底搞了些什么鬼，以及为什么要这么搞，和带来的优缺点：《就是要你懂负载均衡–lvs和转发模式》"></a><a href="/2019/06/20/%E5%B0%B1%E6%98%AF%E8%A6%81%E4%BD%A0%E6%87%82%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1--lvs%E5%92%8C%E8%BD%AC%E5%8F%91%E6%A8%A1%E5%BC%8F/">从网络路由连通性的原理上来看负载均衡lvs的DR、NAT、FullNAT到底搞了些什么鬼，以及为什么要这么搞，和带来的优缺点：《就是要你懂负载均衡–lvs和转发模式》</a></h4><p><img src="/images/oss/94d55b926b5bb1573c4cab8353428712.png"></p>
<h4 id="LVS-20倍的负载不均衡，原来是内核的这个Bug，这个内核bug现在还在，可以稳定重现，有兴趣的话去重现一下，然后对照源代码以及抓包分析一下就清楚了。"><a href="#LVS-20倍的负载不均衡，原来是内核的这个Bug，这个内核bug现在还在，可以稳定重现，有兴趣的话去重现一下，然后对照源代码以及抓包分析一下就清楚了。" class="headerlink" title="LVS 20倍的负载不均衡，原来是内核的这个Bug，这个内核bug现在还在，可以稳定重现，有兴趣的话去重现一下，然后对照源代码以及抓包分析一下就清楚了。"></a><a href="/2019/07/19/%E5%B0%B1%E6%98%AF%E8%A6%81%E4%BD%A0%E6%87%82%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1--%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E8%B0%83%E5%BA%A6%E7%AE%97%E6%B3%95%E5%92%8C%E4%B8%BA%E4%BB%80%E4%B9%88%E4%B8%8D%E5%9D%87%E8%A1%A1/">LVS 20倍的负载不均衡，原来是内核的这个Bug</a>，这个内核bug现在还在，可以稳定重现，有兴趣的话去重现一下，然后对照源代码以及抓包分析一下就清楚了。</h4><h4 id="就是要你懂TCP–握手和挥手，不是你想象中三次握手、四次挥手就理解了TCP，本文从握手的本质–握手都做了什么事情、连接的本质是什么等来阐述握手、挥手的原理"><a href="#就是要你懂TCP–握手和挥手，不是你想象中三次握手、四次挥手就理解了TCP，本文从握手的本质–握手都做了什么事情、连接的本质是什么等来阐述握手、挥手的原理" class="headerlink" title="就是要你懂TCP–握手和挥手，不是你想象中三次握手、四次挥手就理解了TCP，本文从握手的本质–握手都做了什么事情、连接的本质是什么等来阐述握手、挥手的原理"></a><a href="/2017/06/02/%E5%B0%B1%E6%98%AF%E8%A6%81%E4%BD%A0%E6%87%82TCP--%E8%BF%9E%E6%8E%A5%E5%92%8C%E6%8F%A1%E6%89%8B/">就是要你懂TCP–握手和挥手，不是你想象中三次握手、四次挥手就理解了TCP，本文从握手的本质–握手都做了什么事情、连接的本质是什么等来阐述握手、挥手的原理</a></h4><p><img src="/images/oss/6d66dadecb72e11e3e5ab765c6c3ea2e.png"></p>
<h4 id="nslookup-OK-but-ping-fail–看看老司机是如何解决问题的，解决问题的方法肯定比知识点重要多了，同时透过一个问题怎么样通篇来理解一大块知识，让这块原理真正在你的只是提示中扎根下来"><a href="#nslookup-OK-but-ping-fail–看看老司机是如何解决问题的，解决问题的方法肯定比知识点重要多了，同时透过一个问题怎么样通篇来理解一大块知识，让这块原理真正在你的只是提示中扎根下来" class="headerlink" title="nslookup OK but ping fail–看看老司机是如何解决问题的，解决问题的方法肯定比知识点重要多了，同时透过一个问题怎么样通篇来理解一大块知识，让这块原理真正在你的只是提示中扎根下来"></a><a href="/2019/01/09/nslookup-OK-but-ping-fail/">nslookup OK but ping fail–看看老司机是如何解决问题的，解决问题的方法肯定比知识点重要多了，同时透过一个问题怎么样通篇来理解一大块知识，让这块原理真正在你的只是提示中扎根下来</a></h4><p><img src="/images/oss/ca466bb6430f1149958ceb41b9ffe591.png"></p>
<h4 id="如何在工作中学习-一篇很土但是很务实可以复制的方法论文章。不要讲举一反三、触类旁通，谁都知道要举一反三、触类旁通，但是为什么我总是不能够举一反三、触类旁通？"><a href="#如何在工作中学习-一篇很土但是很务实可以复制的方法论文章。不要讲举一反三、触类旁通，谁都知道要举一反三、触类旁通，但是为什么我总是不能够举一反三、触类旁通？" class="headerlink" title="如何在工作中学习 一篇很土但是很务实可以复制的方法论文章。不要讲举一反三、触类旁通，谁都知道要举一反三、触类旁通，但是为什么我总是不能够举一反三、触类旁通？"></a><a href="/2018/05/23/%E5%A6%82%E4%BD%95%E5%9C%A8%E5%B7%A5%E4%BD%9C%E4%B8%AD%E5%AD%A6%E4%B9%A0/">如何在工作中学习</a> 一篇很土但是很务实可以复制的方法论文章。不要讲举一反三、触类旁通，谁都知道要举一反三、触类旁通，但是为什么我总是不能够举一反三、触类旁通？</h4><h4 id="举三反一–从理论知识到实际问题的推导-坚决不让思路跑偏，如何从一个理论知识点推断可能的问题"><a href="#举三反一–从理论知识到实际问题的推导-坚决不让思路跑偏，如何从一个理论知识点推断可能的问题" class="headerlink" title="举三反一–从理论知识到实际问题的推导 坚决不让思路跑偏，如何从一个理论知识点推断可能的问题"></a><a href="/2020/11/02/%E4%B8%BE%E4%B8%89%E5%8F%8D%E4%B8%80--%E4%BB%8E%E7%90%86%E8%AE%BA%E7%9F%A5%E8%AF%86%E5%88%B0%E5%AE%9E%E9%99%85%E9%97%AE%E9%A2%98%E7%9A%84%E6%8E%A8%E5%AF%BC/">举三反一–从理论知识到实际问题的推导</a> 坚决不让思路跑偏，如何从一个理论知识点推断可能的问题</h4><h2 id="性能相关（2015-2018年）"><a href="#性能相关（2015-2018年）" class="headerlink" title="性能相关（2015-2018年）"></a>性能相关（2015-2018年）</h2><h4 id="就是要你懂TCP–半连接队列和全连接队列-偶发性的连接reset异常、重启服务后短时间的连接异常"><a href="#就是要你懂TCP–半连接队列和全连接队列-偶发性的连接reset异常、重启服务后短时间的连接异常" class="headerlink" title="就是要你懂TCP–半连接队列和全连接队列  偶发性的连接reset异常、重启服务后短时间的连接异常"></a><a href="/2017/06/07/%E5%B0%B1%E6%98%AF%E8%A6%81%E4%BD%A0%E6%87%82TCP--%E5%8D%8A%E8%BF%9E%E6%8E%A5%E9%98%9F%E5%88%97%E5%92%8C%E5%85%A8%E8%BF%9E%E6%8E%A5%E9%98%9F%E5%88%97/">就是要你懂TCP–半连接队列和全连接队列</a>  偶发性的连接reset异常、重启服务后短时间的连接异常</h4><h4 id="就是要你懂TCP–性能和发送接收Buffer的关系：发送窗口大小-Buffer-、接收窗口大小-Buffer-对TCP传输速度的影响，以及怎么观察窗口对传输速度的影响。BDP、RT、带宽对传输速度又是怎么影响的-发送窗口大小-Buffer-、接收窗口大小-Buffer-对TCP传输速度的影响，以及怎么观察窗口对传输速度的影响"><a href="#就是要你懂TCP–性能和发送接收Buffer的关系：发送窗口大小-Buffer-、接收窗口大小-Buffer-对TCP传输速度的影响，以及怎么观察窗口对传输速度的影响。BDP、RT、带宽对传输速度又是怎么影响的-发送窗口大小-Buffer-、接收窗口大小-Buffer-对TCP传输速度的影响，以及怎么观察窗口对传输速度的影响" class="headerlink" title="就是要你懂TCP–性能和发送接收Buffer的关系：发送窗口大小(Buffer)、接收窗口大小(Buffer)对TCP传输速度的影响，以及怎么观察窗口对传输速度的影响。BDP、RT、带宽对传输速度又是怎么影响的  发送窗口大小(Buffer)、接收窗口大小(Buffer)对TCP传输速度的影响，以及怎么观察窗口对传输速度的影响"></a><a href="/2019/09/28/%E5%B0%B1%E6%98%AF%E8%A6%81%E4%BD%A0%E6%87%82TCP--%E6%80%A7%E8%83%BD%E5%92%8C%E5%8F%91%E9%80%81%E6%8E%A5%E6%94%B6Buffer%E7%9A%84%E5%85%B3%E7%B3%BB/">就是要你懂TCP–性能和发送接收Buffer的关系：发送窗口大小(Buffer)、接收窗口大小(Buffer)对TCP传输速度的影响，以及怎么观察窗口对传输速度的影响。BDP、RT、带宽对传输速度又是怎么影响的</a>  发送窗口大小(Buffer)、接收窗口大小(Buffer)对TCP传输速度的影响，以及怎么观察窗口对传输速度的影响</h4><h4 id="就是要你懂TCP–性能优化大全"><a href="#就是要你懂TCP–性能优化大全" class="headerlink" title="就是要你懂TCP–性能优化大全"></a><a href="/2019/06/21/%E5%B0%B1%E6%98%AF%E8%A6%81%E4%BD%A0%E6%87%82TCP--%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E5%A4%A7%E5%85%A8/">就是要你懂TCP–性能优化大全</a></h4><h4 id="就是要你懂TCP–TCP性能问题-Nagle算法和delay-ack"><a href="#就是要你懂TCP–TCP性能问题-Nagle算法和delay-ack" class="headerlink" title="就是要你懂TCP–TCP性能问题 Nagle算法和delay ack"></a><a href="/2018/06/14/%E5%B0%B1%E6%98%AF%E8%A6%81%E4%BD%A0%E6%87%82TCP--%E6%9C%80%E7%BB%8F%E5%85%B8%E7%9A%84TCP%E6%80%A7%E8%83%BD%E9%97%AE%E9%A2%98/">就是要你懂TCP–TCP性能问题</a> Nagle算法和delay ack</h4><h4 id="10倍性能提升全过程-在双11的紧张流程下，将系统tps从500优化到5500，从网络到snat、再到Spring和StackTrace，看看一个性能全栈工程师如何在各种工具加持下发现各种问题的。"><a href="#10倍性能提升全过程-在双11的紧张流程下，将系统tps从500优化到5500，从网络到snat、再到Spring和StackTrace，看看一个性能全栈工程师如何在各种工具加持下发现各种问题的。" class="headerlink" title="10倍性能提升全过程 在双11的紧张流程下，将系统tps从500优化到5500，从网络到snat、再到Spring和StackTrace，看看一个性能全栈工程师如何在各种工具加持下发现各种问题的。"></a><a href="/2018/01/23/10+%E5%80%8D%E6%80%A7%E8%83%BD%E6%8F%90%E5%8D%87%E5%85%A8%E8%BF%87%E7%A8%8B/">10倍性能提升全过程</a> 在双11的紧张流程下，将系统tps从500优化到5500，从网络到snat、再到Spring和StackTrace，看看一个性能全栈工程师如何在各种工具加持下发现各种问题的。</h4><h2 id="CPU系列文章（2021年完成）"><a href="#CPU系列文章（2021年完成）" class="headerlink" title="CPU系列文章（2021年完成）"></a>CPU系列文章（2021年完成）</h2><h4 id="CPU的制造和概念"><a href="#CPU的制造和概念" class="headerlink" title="CPU的制造和概念"></a><a href="/2021/06/01/CPU%E7%9A%84%E5%88%B6%E9%80%A0%E5%92%8C%E6%A6%82%E5%BF%B5/">CPU的制造和概念</a></h4><h4 id="十年后数据库还是不敢拥抱NUMA？"><a href="#十年后数据库还是不敢拥抱NUMA？" class="headerlink" title="十年后数据库还是不敢拥抱NUMA？"></a><a href="/2021/05/14/%E5%8D%81%E5%B9%B4%E5%90%8E%E6%95%B0%E6%8D%AE%E5%BA%93%E8%BF%98%E6%98%AF%E4%B8%8D%E6%95%A2%E6%8B%A5%E6%8A%B1NUMA/">十年后数据库还是不敢拥抱NUMA？</a></h4><h4 id="Intel-PAUSE指令变化是如何影响自旋锁以及MySQL的性能的-2019-12-16-Intel-PAUSE指令变化是如何影响自旋锁以及MySQL的性能的"><a href="#Intel-PAUSE指令变化是如何影响自旋锁以及MySQL的性能的-2019-12-16-Intel-PAUSE指令变化是如何影响自旋锁以及MySQL的性能的" class="headerlink" title="[Intel PAUSE指令变化是如何影响自旋锁以及MySQL的性能的](&#x2F;2019&#x2F;12&#x2F;16&#x2F;Intel PAUSE指令变化是如何影响自旋锁以及MySQL的性能的&#x2F;)"></a>[Intel PAUSE指令变化是如何影响自旋锁以及MySQL的性能的](&#x2F;2019&#x2F;12&#x2F;16&#x2F;Intel PAUSE指令变化是如何影响自旋锁以及MySQL的性能的&#x2F;)</h4><h4 id="Perf-IPC以及CPU性能-2021-05-16-Perf-IPC以及CPU利用率"><a href="#Perf-IPC以及CPU性能-2021-05-16-Perf-IPC以及CPU利用率" class="headerlink" title="[Perf IPC以及CPU性能](&#x2F;2021&#x2F;05&#x2F;16&#x2F;Perf IPC以及CPU利用率&#x2F;)"></a>[Perf IPC以及CPU性能](&#x2F;2021&#x2F;05&#x2F;16&#x2F;Perf IPC以及CPU利用率&#x2F;)</h4><h4 id="CPU性能和CACHE"><a href="#CPU性能和CACHE" class="headerlink" title="CPU性能和CACHE"></a><a href="https://plantegg.github.io/2021/07/19/CPU%E6%80%A7%E8%83%BD%E5%92%8CCACHE/">CPU性能和CACHE</a></h4><h4 id="CPU-性能和Cache-Line-2021-05-16-CPU-Cache-Line-和性能"><a href="#CPU-性能和Cache-Line-2021-05-16-CPU-Cache-Line-和性能" class="headerlink" title="[CPU 性能和Cache Line](&#x2F;2021&#x2F;05&#x2F;16&#x2F;CPU Cache Line 和性能&#x2F;)"></a>[CPU 性能和Cache Line](&#x2F;2021&#x2F;05&#x2F;16&#x2F;CPU Cache Line 和性能&#x2F;)</h4><h4 id="AMD-Zen-CPU-架构-以及-AMD、海光、Intel、鲲鹏的性能对比"><a href="#AMD-Zen-CPU-架构-以及-AMD、海光、Intel、鲲鹏的性能对比" class="headerlink" title="AMD Zen CPU 架构 以及 AMD、海光、Intel、鲲鹏的性能对比"></a><a href="/2021/08/13/AMD_Zen_CPU%E6%9E%B6%E6%9E%84/">AMD Zen CPU 架构 以及 AMD、海光、Intel、鲲鹏的性能对比</a></h4><h4 id="Intel、海光、鲲鹏920、飞腾2500-CPU性能对比"><a href="#Intel、海光、鲲鹏920、飞腾2500-CPU性能对比" class="headerlink" title="Intel、海光、鲲鹏920、飞腾2500 CPU性能对比"></a><a href="/2021/06/18/%E5%87%A0%E6%AC%BECPU%E6%80%A7%E8%83%BD%E5%AF%B9%E6%AF%94/">Intel、海光、鲲鹏920、飞腾2500 CPU性能对比</a></h4><h2 id="网络相关基础知识（2017年完成）"><a href="#网络相关基础知识（2017年完成）" class="headerlink" title="网络相关基础知识（2017年完成）"></a>网络相关基础知识（2017年完成）</h2><h4 id="就是要你懂网络–一个网络包的旅程"><a href="#就是要你懂网络–一个网络包的旅程" class="headerlink" title="就是要你懂网络–一个网络包的旅程"></a><a href="/2019/05/15/%E5%B0%B1%E6%98%AF%E8%A6%81%E4%BD%A0%E6%87%82%E7%BD%91%E7%BB%9C--%E4%B8%80%E4%B8%AA%E7%BD%91%E7%BB%9C%E5%8C%85%E7%9A%84%E6%97%85%E7%A8%8B/">就是要你懂网络–一个网络包的旅程</a></h4><h4 id="通过案例来理解MSS、MTU等相关TCP概念"><a href="#通过案例来理解MSS、MTU等相关TCP概念" class="headerlink" title="通过案例来理解MSS、MTU等相关TCP概念"></a><a href="/2018/05/07/%E5%B0%B1%E6%98%AF%E8%A6%81%E4%BD%A0%E6%87%82TCP--%E9%80%9A%E8%BF%87%E6%A1%88%E4%BE%8B%E6%9D%A5%E5%AD%A6%E4%B9%A0MSS%E3%80%81MTU/">通过案例来理解MSS、MTU等相关TCP概念</a></h4><h4 id="就是要你懂TCP–握手和挥手"><a href="#就是要你懂TCP–握手和挥手" class="headerlink" title="就是要你懂TCP–握手和挥手"></a><a href="/2017/06/02/%E5%B0%B1%E6%98%AF%E8%A6%81%E4%BD%A0%E6%87%82TCP--%E8%BF%9E%E6%8E%A5%E5%92%8C%E6%8F%A1%E6%89%8B/">就是要你懂TCP–握手和挥手</a></h4><h4 id="wireshark-dup-ack-issue-and-keepalive"><a href="#wireshark-dup-ack-issue-and-keepalive" class="headerlink" title="wireshark-dup-ack-issue and keepalive"></a><a href="/2017/06/02/%E5%B0%B1%E6%98%AF%E8%A6%81%E4%BD%A0%E6%87%82TCP--wireshark-dup-ack-issue/">wireshark-dup-ack-issue and keepalive</a></h4><h4 id="一个没有遵守tcp规则导致的问题"><a href="#一个没有遵守tcp规则导致的问题" class="headerlink" title="一个没有遵守tcp规则导致的问题"></a><a href="/2018/11/26/%E4%B8%80%E4%B8%AA%E6%B2%A1%E6%9C%89%E9%81%B5%E5%AE%88tcp%E8%A7%84%E5%88%99%E5%AF%BC%E8%87%B4%E7%9A%84%E9%97%AE%E9%A2%98/">一个没有遵守tcp规则导致的问题</a></h4><h4 id="kubernetes-service-和-kube-proxy详解-2020-09-22-kubernetes-service-和-kube-proxy详解"><a href="#kubernetes-service-和-kube-proxy详解-2020-09-22-kubernetes-service-和-kube-proxy详解" class="headerlink" title="[kubernetes service 和 kube-proxy详解](&#x2F;2020&#x2F;09&#x2F;22&#x2F;kubernetes service 和 kube-proxy详解&#x2F;)"></a>[kubernetes service 和 kube-proxy详解](&#x2F;2020&#x2F;09&#x2F;22&#x2F;kubernetes service 和 kube-proxy详解&#x2F;)</h4><h2 id="DNS相关"><a href="#DNS相关" class="headerlink" title="DNS相关"></a>DNS相关</h2><h4 id="就是要你懂DNS–一文搞懂域名解析相关问题"><a href="#就是要你懂DNS–一文搞懂域名解析相关问题" class="headerlink" title="就是要你懂DNS–一文搞懂域名解析相关问题"></a><a href="/2019/06/09/%E4%B8%80%E6%96%87%E6%90%9E%E6%87%82%E5%9F%9F%E5%90%8D%E8%A7%A3%E6%9E%90%E7%9B%B8%E5%85%B3%E9%97%AE%E9%A2%98/">就是要你懂DNS–一文搞懂域名解析相关问题</a></h4><h4 id="nslookup-OK-but-ping-fail"><a href="#nslookup-OK-but-ping-fail" class="headerlink" title="nslookup OK but ping fail"></a><a href="/2019/01/09/nslookup-OK-but-ping-fail/">nslookup OK but ping fail</a></h4><h4 id="Docker中的DNS解析过程"><a href="#Docker中的DNS解析过程" class="headerlink" title="Docker中的DNS解析过程"></a><a href="/2019/01/12/Docker%E4%B8%AD%E7%9A%84DNS%E8%A7%A3%E6%9E%90%E8%BF%87%E7%A8%8B/">Docker中的DNS解析过程</a></h4><h4 id="windows7的wifi总是报DNS域名异常无法上网"><a href="#windows7的wifi总是报DNS域名异常无法上网" class="headerlink" title="windows7的wifi总是报DNS域名异常无法上网"></a><a href="/2019/01/10/windows7%E7%9A%84wifi%E6%80%BB%E6%98%AF%E6%8A%A5DNS%E5%9F%9F%E5%90%8D%E5%BC%82%E5%B8%B8%E6%97%A0%E6%B3%95%E4%B8%8A%E7%BD%91/">windows7的wifi总是报DNS域名异常无法上网</a></h4><h2 id="LVS-负载均衡"><a href="#LVS-负载均衡" class="headerlink" title="LVS 负载均衡"></a>LVS 负载均衡</h2><h4 id="就是要你懂负载均衡–lvs和转发模式"><a href="#就是要你懂负载均衡–lvs和转发模式" class="headerlink" title="就是要你懂负载均衡–lvs和转发模式"></a><a href="/2019/06/20/%E5%B0%B1%E6%98%AF%E8%A6%81%E4%BD%A0%E6%87%82%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1--lvs%E5%92%8C%E8%BD%AC%E5%8F%91%E6%A8%A1%E5%BC%8F/">就是要你懂负载均衡–lvs和转发模式</a></h4><h4 id="就是要你懂负载均衡–负载均衡调度算法和为什么不均衡"><a href="#就是要你懂负载均衡–负载均衡调度算法和为什么不均衡" class="headerlink" title="就是要你懂负载均衡–负载均衡调度算法和为什么不均衡"></a><a href="/2019/07/19/%E5%B0%B1%E6%98%AF%E8%A6%81%E4%BD%A0%E6%87%82%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1--%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E8%B0%83%E5%BA%A6%E7%AE%97%E6%B3%95%E5%92%8C%E4%B8%BA%E4%BB%80%E4%B9%88%E4%B8%8D%E5%9D%87%E8%A1%A1/">就是要你懂负载均衡–负载均衡调度算法和为什么不均衡</a></h4><h2 id="网络工具"><a href="#网络工具" class="headerlink" title="网络工具"></a>网络工具</h2><h4 id="就是要你懂Unix-Socket-进行抓包解析"><a href="#就是要你懂Unix-Socket-进行抓包解析" class="headerlink" title="就是要你懂Unix Socket 进行抓包解析"></a><a href="/2018/01/01/%E9%80%9A%E8%BF%87tcpdump%E5%AF%B9Unix%20Socket%20%E8%BF%9B%E8%A1%8C%E6%8A%93%E5%8C%85%E8%A7%A3%E6%9E%90/">就是要你懂Unix Socket 进行抓包解析</a></h4><h4 id="就是要你懂网络监控–ss用法大全"><a href="#就是要你懂网络监控–ss用法大全" class="headerlink" title="就是要你懂网络监控–ss用法大全"></a><a href="/2016/10/12/ss%E7%94%A8%E6%B3%95%E5%A4%A7%E5%85%A8/">就是要你懂网络监控–ss用法大全</a></h4><h4 id="就是要你懂抓包–WireShark之命令行版tshark"><a href="#就是要你懂抓包–WireShark之命令行版tshark" class="headerlink" title="就是要你懂抓包–WireShark之命令行版tshark"></a><a href="/2019/06/21/%E5%B0%B1%E6%98%AF%E8%A6%81%E4%BD%A0%E6%87%82%E6%8A%93%E5%8C%85--WireShark%E4%B9%8B%E5%91%BD%E4%BB%A4%E8%A1%8C%E7%89%88tshark/">就是要你懂抓包–WireShark之命令行版tshark</a></h4><h4 id="netstat-timer-keepalive-explain"><a href="#netstat-timer-keepalive-explain" class="headerlink" title="netstat timer keepalive explain"></a><a href="/2017/08/28/netstat%20%E7%AD%89%E7%BD%91%E7%BB%9C%E5%B7%A5%E5%85%B7/">netstat timer keepalive explain</a></h4><h4 id="Git-HTTP-Proxy-and-SSH-Proxy"><a href="#Git-HTTP-Proxy-and-SSH-Proxy" class="headerlink" title="Git HTTP Proxy and SSH Proxy"></a><a href="/2018/03/14/%E5%A6%82%E4%BD%95%E8%AE%BE%E7%BD%AEgit%20Proxy/">Git HTTP Proxy and SSH Proxy</a></h4>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://plantegg.github.io/2026/02/05/tcp-performance-troubleshooting/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="twitter @plantegg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="plantegg">
      <meta itemprop="description" content="java mysql tcp performance network docker Linux">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | plantegg">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2026/02/05/tcp-performance-troubleshooting/" class="post-title-link" itemprop="url">TCP 网络性能排查实战：两个经典案例的深度学习总结</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2026-02-05 17:30:03" itemprop="dateCreated datePublished" datetime="2026-02-05T17:30:03+08:00">2026-02-05</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2026-02-06 13:55:37" itemprop="dateModified" datetime="2026-02-06T13:55:37+08:00">2026-02-06</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/TCP/" itemprop="url" rel="index"><span itemprop="name">TCP</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="TCP-网络性能排查实战：两个经典案例的深度学习总结"><a href="#TCP-网络性能排查实战：两个经典案例的深度学习总结" class="headerlink" title="TCP 网络性能排查实战：两个经典案例的深度学习总结"></a>TCP 网络性能排查实战：两个经典案例的深度学习总结</h1><h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p>本文总结了两个真实的 TCP 网络性能问题排查案例，涉及 Kafka 消息队列在跨机房和同机房场景下的延迟问题。两个案例从不同角度揭示了 TCP 缓冲区、拥塞控制、内核参数对应用性能的深远影响。</p>
<hr>
<h2 id="案例一：跨机房-Kafka-消费延迟高达-10-分钟"><a href="#案例一：跨机房-Kafka-消费延迟高达-10-分钟" class="headerlink" title="案例一：跨机房 Kafka 消费延迟高达 10 分钟"></a>案例一：跨机房 Kafka 消费延迟高达 10 分钟</h2><h3 id="问题描述"><a href="#问题描述" class="headerlink" title="问题描述"></a>问题描述</h3><p>每天上午 9:30 开盘后，位于 Region-B 的 Kafka 消费者从 Region-A 的 Kafka Broker 拉取消息时，延迟不断增高到 10 多分钟，持续数小时才恢复。而 Region-A 同机房的消费者拉取同一 Topic 完全正常。</p>
<h3 id="排查过程"><a href="#排查过程" class="headerlink" title="排查过程"></a>排查过程</h3><p>整个排查经历了多个阶段，逐步逼近根因：</p>
<h4 id="阶段一：排除基础设施问题"><a href="#阶段一：排除基础设施问题" class="headerlink" title="阶段一：排除基础设施问题"></a>阶段一：排除基础设施问题</h4><ul>
<li>Broker&#x2F;Client 进程状态、机器资源（CPU&#x2F;内存&#x2F;磁盘）均正常</li>
<li>网络带宽充足，丢包率正常，wget 测试带宽足够</li>
<li>初步怀疑方向：网络链路本身</li>
</ul>
<h4 id="阶段二：发现拥塞窗口异常（TCP-层面）"><a href="#阶段二：发现拥塞窗口异常（TCP-层面）" class="headerlink" title="阶段二：发现拥塞窗口异常（TCP 层面）"></a>阶段二：发现拥塞窗口异常（TCP 层面）</h4><p>在客户端机器上抓包分析，发现关键线索：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 查看 TCP 连接的拥塞窗口</span><br><span class="line">ss -itmpn dst &quot;x.x.x.x&quot;</span><br><span class="line"></span><br><span class="line"># 关键输出（问题连接）</span><br><span class="line">cwnd:2 ssthresh:2    ← 拥塞窗口极小，只有 2 个 MSS</span><br><span class="line">send 170.0Kbps       ← 发送速率极低</span><br></pre></td></tr></table></figure>

<p>RTT 约 130ms，拥塞窗口只有 2（约 2.9KB），理论吞吐量：<code>2 × 1448 / 0.13 ≈ 22KB/s</code>，远不够传输开盘时的行情数据。</p>
<p>尝试通过 wget 大文件把 <code>ssthresh</code> 撑大，然后重启客户端新建连接，问题暂时缓解。但第二天又复发。</p>
<h4 id="阶段三：发现内核虚假重传（深入内核层面）"><a href="#阶段三：发现内核虚假重传（深入内核层面）" class="headerlink" title="阶段三：发现内核虚假重传（深入内核层面）"></a>阶段三：发现内核虚假重传（深入内核层面）</h4><p>通过 Wireshark 分析抓包文件，发现一个异常现象：</p>
<blockquote>
<p>Broker 发送响应后，如果 10ms 内没收到 ACK，就触发重传。而正常的 RTO 应该是 200ms+。</p>
</blockquote>
<p>这种 10ms 的重传远低于 RTO，也不是快速重传或 TLP。最终定位到 Linux 3.10 内核的 <code>tcp_early_retrans</code> 参数：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看当前值</span></span><br><span class="line">sysctl net.ipv4.tcp_early_retrans</span><br><span class="line"><span class="comment"># 输出: net.ipv4.tcp_early_retrans = 3</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 这是 3.10 内核 backport 新版本 early retrans 功能时引入的 bug</span></span><br><span class="line"><span class="comment"># 导致大量虚假重传，进而让拥塞控制算法误判网络拥塞，不断缩小 cwnd</span></span><br></pre></td></tr></table></figure>

<p>修复方法：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sysctl -w net.ipv4.tcp_early_retrans=0</span><br></pre></td></tr></table></figure>

<p>修改后，全网 TCP 重传率从万分之 5 降到正常水平。</p>
<h4 id="阶段四：发现-Send-Buffer-限制"><a href="#阶段四：发现-Send-Buffer-限制" class="headerlink" title="阶段四：发现 Send Buffer 限制"></a>阶段四：发现 Send Buffer 限制</h4><p>解决虚假重传后，抓包发现新的瓶颈：</p>
<blockquote>
<p>Broker 发送一批数据包后，在途字节（Bytes in flight）达到约 50KB 就停止发送，等一个 RTT（~130ms）收到 ACK 后才继续。</p>
</blockquote>
<p>原因：Kafka Broker 默认配置 <code>socket.send.buffer.bytes=102400</code>（100KB），内核实际分配约一半（~50KB），限制了发送窗口。</p>
<h4 id="阶段五：定位根因-—-客户端接收-Buffer"><a href="#阶段五：定位根因-—-客户端接收-Buffer" class="headerlink" title="阶段五：定位根因 — 客户端接收 Buffer"></a>阶段五：定位根因 — 客户端接收 Buffer</h4><p>将 Broker Send Buffer 限制去掉后仍然不行。最终在客户端日志中找到关键配置：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">receive.buffer.bytes = 65536    ← Kafka 客户端默认只有 64KB 接收缓冲区</span><br></pre></td></tr></table></figure>

<p>TCP 三次握手时，客户端根据 <code>receive.buffer.bytes</code> 通告接收窗口（rwnd）。64KB 的 rwnd 意味着：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">最大吞吐量 = rwnd / RTT = 64KB / 130ms ≈ 490KB/s</span><br></pre></td></tr></table></figure>

<p>而开盘高峰期需要数十 MB&#x2F;s 的吞吐量，64KB 的接收窗口成为致命瓶颈。</p>
<h3 id="根因与解决方案"><a href="#根因与解决方案" class="headerlink" title="根因与解决方案"></a>根因与解决方案</h3><p><strong>根因</strong>：Kafka 客户端默认接收缓冲区 64KB 太小，叠加跨机房 130ms 的 RTT，导致 TCP 吞吐量被严重限制。</p>
<p><strong>解决方案</strong>：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Kafka Consumer 配置</span></span><br><span class="line"><span class="attr">receive.buffer.bytes</span> = <span class="string">2097152    # 从 64KB 调整到 2MB（或设为 -1 让 OS 自动调优）</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># Kafka Broker 配置</span></span><br><span class="line"><span class="attr">socket.send.buffer.bytes</span> = <span class="string">-1     # 去掉 100KB 限制，让 OS 自动调优</span></span><br><span class="line"><span class="attr">socket.receive.buffer.bytes</span> = <span class="string">-1</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># Linux 内核参数（3.10 内核）</span></span><br><span class="line"><span class="attr">net.ipv4.tcp_early_retrans</span> = <span class="string">0    # 关闭有 bug 的 early retrans</span></span><br></pre></td></tr></table></figure>

<p><strong>效果</strong>：传输延迟从 10-60 分钟降低到 1-4 秒，性能提升约 1000 倍。</p>
<p>调整前后的 Wireshark 抓包对比：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">调整前：485KB 数据需要 8 个 RTT（8 × 130ms = 1040ms）分批传输</span><br><span class="line">调整后：485KB 数据在 3ms 内一次性传输完毕</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="案例二：同机房-TCP-订阅客户端异常缓慢"><a href="#案例二：同机房-TCP-订阅客户端异常缓慢" class="headerlink" title="案例二：同机房 TCP 订阅客户端异常缓慢"></a>案例二：同机房 TCP 订阅客户端异常缓慢</h2><h3 id="问题描述-1"><a href="#问题描述-1" class="headerlink" title="问题描述"></a>问题描述</h3><p>同机房 4 台机器部署了相同的行情订阅服务，其中 1 台拉取行情数据异常缓慢。</p>
<h3 id="排查过程-1"><a href="#排查过程-1" class="headerlink" title="排查过程"></a>排查过程</h3><h4 id="第一步：抓包发现-TCP-Zero-Window"><a href="#第一步：抓包发现-TCP-Zero-Window" class="headerlink" title="第一步：抓包发现 TCP Zero Window"></a>第一步：抓包发现 TCP Zero Window</h4><p>在客户端抓包，发现大量 <code>TCP Zero Window</code> 通告——客户端在告诉服务端”我的接收缓冲区满了，别再发了”。</p>
<h4 id="第二步：确认-Recv-Buffer-堆满"><a href="#第二步：确认-Recv-Buffer-堆满" class="headerlink" title="第二步：确认 Recv Buffer 堆满"></a>第二步：确认 Recv Buffer 堆满</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">netstat -ant | grep &lt;server_port&gt;</span><br><span class="line"><span class="comment"># 发现 Recv-Q 持续满载</span></span><br></pre></td></tr></table></figure>

<h4 id="第三步：发现-CPU-异常"><a href="#第三步：发现-CPU-异常" class="headerlink" title="第三步：发现 CPU 异常"></a>第三步：发现 CPU 异常</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">top -Hp &lt;java_pid&gt;</span><br><span class="line"><span class="comment"># 发现一个线程 CPU 持续接近 100%，像死循环</span></span><br></pre></td></tr></table></figure>

<h4 id="第四步：定位代码问题"><a href="#第四步：定位代码问题" class="headerlink" title="第四步：定位代码问题"></a>第四步：定位代码问题</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 用 top 看到的线程 ID（十进制）转十六进制</span></span><br><span class="line"><span class="built_in">printf</span> <span class="string">&#x27;%x\n&#x27;</span> &lt;thread_id&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 在 jstack 中查找对应线程堆栈</span></span><br><span class="line">jstack &lt;java_pid&gt; | grep -A 30 &lt;hex_thread_id&gt;</span><br></pre></td></tr></table></figure>

<p>找到问题代码：一个 <code>for</code> 循环中调用 <code>read()</code>，每次只读很少的数据（参数配置过小），导致：</p>
<ol>
<li>应用层读取速度跟不上网络数据到达速度</li>
<li>OS TCP Recv Buffer 被填满</li>
<li>TCP 通告 Zero Window，服务端停止发送</li>
<li>该线程 CPU 100%（不停地循环读取微量数据）</li>
</ol>
<h3 id="根因与解决方案-1"><a href="#根因与解决方案-1" class="headerlink" title="根因与解决方案"></a>根因与解决方案</h3><p><strong>根因</strong>：业务代码中 <code>read()</code> 的缓冲区参数配置过小，导致应用层消费速度远低于网络数据到达速度，TCP Recv Buffer 堆满触发 Zero Window。</p>
<p><strong>解决方案</strong>：修复代码，增大 <code>read()</code> 的缓冲区大小。</p>
<p><strong>效果</strong>：</p>
<ul>
<li>网络吞吐量恢复正常（流量曲线从”平台”变为正常波动）</li>
<li>CPU 使用率从 40% 降到 20%</li>
</ul>
<hr>
<h2 id="两个案例的关联与对比"><a href="#两个案例的关联与对比" class="headerlink" title="两个案例的关联与对比"></a>两个案例的关联与对比</h2><table>
<thead>
<tr>
<th>维度</th>
<th>案例一（跨机房延迟）</th>
<th>案例二（同机房 Zero Window）</th>
</tr>
</thead>
<tbody><tr>
<td>场景</td>
<td>跨机房，RTT ~130ms</td>
<td>同机房，RTT &lt;1ms</td>
</tr>
<tr>
<td>表现</td>
<td>消费延迟 10+ 分钟</td>
<td>TCP Zero Window，数据停滞</td>
</tr>
<tr>
<td>瓶颈层</td>
<td>TCP 接收窗口 + 内核参数</td>
<td>应用层读取速度</td>
</tr>
<tr>
<td>根因</td>
<td>Kafka 默认 receive buffer 64KB 太小</td>
<td>业务代码 read() 缓冲区配置过小</td>
</tr>
<tr>
<td>为什么同机房没问题</td>
<td>RTT 小，64KB 窗口也够用</td>
<td>其他机器代码&#x2F;配置正常</td>
</tr>
<tr>
<td>解决方式</td>
<td>调大 buffer + 修复内核参数</td>
<td>修复业务代码</td>
</tr>
</tbody></table>
<p>两个案例本质上都是 <strong>TCP 接收端处理能力不足</strong> 导致发送端被限速：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">案例一：接收窗口太小 → 发送端每个 RTT 只能发 64KB → 跨机房 RTT 大放大了问题</span><br><span class="line">案例二：应用层读取太慢 → Recv Buffer 堆满 → Zero Window → 发送端完全停止</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="TCP-缓冲区与窗口的核心原理"><a href="#TCP-缓冲区与窗口的核心原理" class="headerlink" title="TCP 缓冲区与窗口的核心原理"></a>TCP 缓冲区与窗口的核心原理</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">发送方应用 write()</span><br><span class="line">       ↓</span><br><span class="line">  Send Buffer (sk_sndbuf)</span><br><span class="line">       ↓  受发送窗口限制</span><br><span class="line">  发送窗口 = min(拥塞窗口 cwnd, 接收窗口 rwnd)</span><br><span class="line">       ↓</span><br><span class="line">  网络传输 (in-flight data)</span><br><span class="line">       ↓</span><br><span class="line">  Receive Buffer (sk_rcvbuf)</span><br><span class="line">       ↓  通告 rwnd = buffer_size - 已占用空间</span><br><span class="line">  接收方应用 read()</span><br></pre></td></tr></table></figure>

<p>关键关系：</p>
<ul>
<li><strong>接收窗口 rwnd</strong>：由接收端 Recv Buffer 剩余空间决定，通过 ACK 通告给发送端</li>
<li><strong>拥塞窗口 cwnd</strong>：由发送端拥塞控制算法（如 CUBIC）动态调整</li>
<li><strong>发送窗口</strong>：取 rwnd 和 cwnd 的较小值</li>
<li><strong>最大吞吐量</strong>：<code>min(rwnd, cwnd) / RTT</code></li>
</ul>
<h3 id="为什么-RTT-大时-Buffer-小的问题会被放大？"><a href="#为什么-RTT-大时-Buffer-小的问题会被放大？" class="headerlink" title="为什么 RTT 大时 Buffer 小的问题会被放大？"></a>为什么 RTT 大时 Buffer 小的问题会被放大？</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">同机房 (RTT=1ms):   吞吐量 = 64KB / 1ms   = 64MB/s   ← 够用</span><br><span class="line">跨机房 (RTT=130ms): 吞吐量 = 64KB / 130ms  = 490KB/s  ← 严重不足</span><br></pre></td></tr></table></figure>

<p>这就是案例一中”同机房正常、跨机房延迟”的根本原因。</p>
<hr>
<h2 id="关键排查命令速查"><a href="#关键排查命令速查" class="headerlink" title="关键排查命令速查"></a>关键排查命令速查</h2><h3 id="TCP-连接状态分析"><a href="#TCP-连接状态分析" class="headerlink" title="TCP 连接状态分析"></a>TCP 连接状态分析</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看 TCP 连接详细信息（拥塞窗口、RTT、重传等）</span></span><br><span class="line">ss -itmpn dst <span class="string">&quot;x.x.x.x&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 关键字段解读</span></span><br><span class="line"><span class="comment"># cwnd:10        拥塞窗口（MSS 数量）</span></span><br><span class="line"><span class="comment"># ssthresh:2     慢启动阈值</span></span><br><span class="line"><span class="comment"># rtt:130/0.5    RTT 均值/方差（ms）</span></span><br><span class="line"><span class="comment"># rto:330        重传超时（ms）</span></span><br><span class="line"><span class="comment"># send 850Kbps   当前发送速率</span></span><br><span class="line"><span class="comment"># unacked:38     未确认的包数量</span></span><br><span class="line"><span class="comment"># retrans:0/3    当前重传/累计重传</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看 TCP 缓存指标</span></span><br><span class="line">ip tcp_metrics show | grep &lt;ip&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看连接队列</span></span><br><span class="line">netstat -ant | grep &lt;port&gt;</span><br><span class="line"><span class="comment"># Recv-Q: 接收队列（应用未读取的数据）</span></span><br><span class="line"><span class="comment"># Send-Q: 发送队列（已发送未确认的数据）</span></span><br></pre></td></tr></table></figure>

<h3 id="网络重传监控"><a href="#网络重传监控" class="headerlink" title="网络重传监控"></a>网络重传监控</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 实时观察 TCP 重传</span></span><br><span class="line">watch -n 1 <span class="string">&#x27;nstat -az | grep TcpRetransSegs&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 检查 early retrans 参数（3.10 内核）</span></span><br><span class="line">sysctl net.ipv4.tcp_early_retrans</span><br></pre></td></tr></table></figure>

<h3 id="抓包分析"><a href="#抓包分析" class="headerlink" title="抓包分析"></a>抓包分析</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 抓取指定端口的包</span></span><br><span class="line">tcpdump -i eth0 port 9092 -w capture.pcap</span><br><span class="line"></span><br><span class="line"><span class="comment"># Wireshark 中关键过滤器</span></span><br><span class="line">tcp.analysis.zero_window          <span class="comment"># Zero Window 事件</span></span><br><span class="line">tcp.analysis.retransmission       <span class="comment"># 重传包</span></span><br><span class="line">tcp.analysis.bytes_in_flight      <span class="comment"># 在途字节数</span></span><br></pre></td></tr></table></figure>

<h3 id="Java-应用排查"><a href="#Java-应用排查" class="headerlink" title="Java 应用排查"></a>Java 应用排查</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看 Java 进程中各线程 CPU 使用</span></span><br><span class="line">top -Hp &lt;java_pid&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 线程 ID 转十六进制</span></span><br><span class="line"><span class="built_in">printf</span> <span class="string">&#x27;%x\n&#x27;</span> &lt;thread_id&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 导出线程堆栈并查找</span></span><br><span class="line">jstack &lt;java_pid&gt; | grep -A 30 &lt;hex_thread_id&gt;</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="经验教训"><a href="#经验教训" class="headerlink" title="经验教训"></a>经验教训</h2><h3 id="1-不要信任中间件的默认配置"><a href="#1-不要信任中间件的默认配置" class="headerlink" title="1. 不要信任中间件的默认配置"></a>1. 不要信任中间件的默认配置</h3><p>Kafka 客户端默认 <code>receive.buffer.bytes=64KB</code>、Broker 默认 <code>socket.send.buffer.bytes=100KB</code>，这些值在同机房低延迟环境下够用，但在跨机房高 RTT 场景下会成为致命瓶颈。</p>
<p><strong>建议</strong>：跨机房部署时，将 buffer 相关配置设为 <code>-1</code>（让 OS 自动调优），或根据 <code>BDP = 带宽 × RTT</code> 计算合理值。</p>
<h3 id="2-内核参数可能是隐藏的定时炸弹"><a href="#2-内核参数可能是隐藏的定时炸弹" class="headerlink" title="2. 内核参数可能是隐藏的定时炸弹"></a>2. 内核参数可能是隐藏的定时炸弹</h3><p>Linux 3.10 内核的 <code>tcp_early_retrans=3</code> 导致大量虚假重传，拉高全网重传率到万分之 5，掩盖了真实的网络问题。这种问题平时不显现，只在高负载时爆发。</p>
<p><strong>建议</strong>：关注内核版本差异，定期检查 TCP 重传率是否异常。</p>
<h3 id="3-学会用-Wireshark-做对比分析"><a href="#3-学会用-Wireshark-做对比分析" class="headerlink" title="3. 学会用 Wireshark 做对比分析"></a>3. 学会用 Wireshark 做对比分析</h3><p>排查网络问题最有效的方法是：抓一份有问题的包、一份正常的包，在 Wireshark 中对比分析。关注：</p>
<ul>
<li>Bytes in flight 的变化曲线</li>
<li>ACK 之间的间隔（是否有等待平台）</li>
<li>是否有异常重传</li>
</ul>
<h3 id="4-应用层的-Bug-也会表现为网络问题"><a href="#4-应用层的-Bug-也会表现为网络问题" class="headerlink" title="4. 应用层的 Bug 也会表现为网络问题"></a>4. 应用层的 Bug 也会表现为网络问题</h3><p>案例二中，业务代码 <code>read()</code> 缓冲区配置过小导致 TCP Zero Window，表面看是”网络问题”，实际是应用层 Bug。排查时不要只盯着网络层，要结合 <code>top -Hp</code> + <code>jstack</code> 看应用层行为。</p>
<h3 id="5-理解-BDP（带宽延迟积）"><a href="#5-理解-BDP（带宽延迟积）" class="headerlink" title="5. 理解 BDP（带宽延迟积）"></a>5. 理解 BDP（带宽延迟积）</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">BDP = 带宽 × RTT</span><br></pre></td></tr></table></figure>

<p>这是网络管道中能容纳的最大数据量。TCP Buffer 至少要等于 BDP 才能充分利用带宽。例如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">带宽 100Mbps, RTT 130ms:</span><br><span class="line">BDP = 100Mbps × 0.13s = 13Mb = 1.6MB</span><br><span class="line"></span><br><span class="line">→ TCP Buffer 至少需要 1.6MB 才能跑满带宽</span><br><span class="line">→ 64KB 的 Buffer 只能利用 64KB/1.6MB ≈ 4% 的带宽</span><br></pre></td></tr></table></figure>

<h3 id="6-排查要有层次感"><a href="#6-排查要有层次感" class="headerlink" title="6. 排查要有层次感"></a>6. 排查要有层次感</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">应用层 → 是否有代码 Bug、配置错误</span><br><span class="line">   ↓</span><br><span class="line">中间件层 → Kafka/MySQL 等的 Buffer 配置是否合理</span><br><span class="line">   ↓</span><br><span class="line">TCP 层 → 拥塞窗口、接收窗口、重传情况</span><br><span class="line">   ↓</span><br><span class="line">内核层 → tcp_early_retrans 等内核参数</span><br><span class="line">   ↓</span><br><span class="line">网络层 → 带宽、丢包、RTT</span><br></pre></td></tr></table></figure>

<p>从上到下逐层排查，每一层都可能是瓶颈。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://plantegg.github.io/2026/01/20/%E7%BD%91%E7%BB%9C%E7%9F%A5%E8%AF%86%E5%AD%A6%E4%B9%A0%E6%96%B9%E6%B3%95%E4%B8%8E%E6%8A%80%E5%B7%A7-plantegg/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="twitter @plantegg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="plantegg">
      <meta itemprop="description" content="java mysql tcp performance network docker Linux">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | plantegg">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2026/01/20/%E7%BD%91%E7%BB%9C%E7%9F%A5%E8%AF%86%E5%AD%A6%E4%B9%A0%E6%96%B9%E6%B3%95%E4%B8%8E%E6%8A%80%E5%B7%A7-plantegg/" class="post-title-link" itemprop="url">网络知识学习方法与技巧</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2026-01-20 17:30:03" itemprop="dateCreated datePublished" datetime="2026-01-20T17:30:03+08:00">2026-01-20</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2026-02-06 13:53:24" itemprop="dateModified" datetime="2026-02-06T13:53:24+08:00">2026-02-06</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/network/" itemprop="url" rel="index"><span itemprop="name">network</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="网络知识学习方法与技巧"><a href="#网络知识学习方法与技巧" class="headerlink" title="网络知识学习方法与技巧"></a>网络知识学习方法与技巧</h1><h2 id="一、学习路径：从理论到实战"><a href="#一、学习路径：从理论到实战" class="headerlink" title="一、学习路径：从理论到实战"></a>一、学习路径：从理论到实战</h2><h3 id="1-系统化学习框架"><a href="#1-系统化学习框架" class="headerlink" title="1. 系统化学习框架"></a>1. 系统化学习框架</h3><p>plantegg 博客提供了三大核心系列，构建完整的网络知识体系：</p>
<ul>
<li><strong>Understanding TCP 系列</strong> - TCP 协议全方位解析</li>
<li><strong>Understanding Network 系列</strong> - 网络基础概念深入</li>
<li><strong>Understanding Load Balancing 系列</strong> - 负载均衡策略与实践</li>
</ul>
<p><strong>学习建议</strong>：不要孤立学习理论，而是将理论与生产案例结合。plantegg 的内容强调从实际问题出发，通过案例理解原理。</p>
<h3 id="2-问题驱动的学习方法"><a href="#2-问题驱动的学习方法" class="headerlink" title="2. 问题驱动的学习方法"></a>2. 问题驱动的学习方法</h3><p>plantegg 博客的核心特点是<strong>问题导向</strong>：</p>
<ul>
<li>从生产环境的真实故障入手</li>
<li>通过排查过程学习工具使用</li>
<li>在解决问题中理解底层原理</li>
<li>积累可复用的诊断方法论</li>
</ul>
<p><strong>实践路径</strong>：</p>
<ol>
<li>遇到问题 → 2. 抓包分析 → 3. 定位根因 → 4. 理解原理 → 5. 总结方法</li>
</ol>
<h2 id="二、核心知识领域"><a href="#二、核心知识领域" class="headerlink" title="二、核心知识领域"></a>二、核心知识领域</h2><h3 id="1-TCP-连接管理"><a href="#1-TCP-连接管理" class="headerlink" title="1. TCP 连接管理"></a>1. TCP 连接管理</h3><h4 id="连接队列监控"><a href="#连接队列监控" class="headerlink" title="连接队列监控"></a>连接队列监控</h4><p>理解 TCP 连接的两个关键队列：</p>
<ul>
<li><strong>SYN 队列（半连接队列）</strong>：存储 SYN_RECV 状态的连接</li>
<li><strong>Accept 队列（全连接队列）</strong>：存储 ESTABLISHED 但未被 accept() 的连接</li>
</ul>
<p><strong>实时监控工具</strong>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 使用 bpftrace 工具包中的 tcpaccept</span></span><br><span class="line">tcpaccept</span><br></pre></td></tr></table></figure>

<p>输出示例解读：</p>
<ul>
<li>PID&#x2F;COMM：接受连接的进程信息</li>
<li>RADDR&#x2F;RPORT：远程地址和端口</li>
<li>LADDR&#x2F;LPORT：本地地址和端口</li>
<li><strong>Accept Queue</strong>：当前队列大小&#x2F;最大队列大小</li>
</ul>
<p><strong>关键洞察</strong>：</p>
<ul>
<li>队列满时会导致连接被丢弃（SYN 丢弃或 ACK 丢弃）</li>
<li>通过监控队列状态可以提前发现性能瓶颈</li>
<li>队列大小受 <code>somaxconn</code> 和应用层 <code>backlog</code> 参数影响</li>
</ul>
<h4 id="Socket-选项优化"><a href="#Socket-选项优化" class="headerlink" title="Socket 选项优化"></a>Socket 选项优化</h4><p><strong>SO_REUSEPORT</strong> - 多进程负载均衡：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> listenfd;</span><br><span class="line"><span class="type">int</span> reuse = <span class="number">1</span>;</span><br><span class="line">setsockopt(listenfd, SOL_SOCKET, SO_REUSEPORT, </span><br><span class="line">           (<span class="type">const</span> <span class="type">void</span> *)&amp;reuse, <span class="keyword">sizeof</span>(<span class="type">int</span>));</span><br></pre></td></tr></table></figure>

<p><strong>核心价值</strong>：</p>
<ul>
<li>允许多个进程绑定同一 IP:Port</li>
<li>内核通过哈希分发连接，实现负载均衡</li>
<li>解决”惊群效应”（thundering herd）</li>
<li>提升多核 CPU 利用率</li>
</ul>
<p><strong>适用场景</strong>：</p>
<ul>
<li>Nginx 多 worker 进程同时监听</li>
<li>高并发服务器提升连接接收能力</li>
<li>避免单一监听 socket 成为瓶颈</li>
</ul>
<p><strong>SO_REUSEADDR</strong> vs <strong>SO_REUSEPORT</strong>：</p>
<ul>
<li><code>SO_REUSEADDR</code>：允许 TIME_WAIT 状态下快速重启服务</li>
<li><code>SO_REUSEPORT</code>：多进程负载均衡，性能优化</li>
</ul>
<h3 id="2-Buffer-与内存管理"><a href="#2-Buffer-与内存管理" class="headerlink" title="2. Buffer 与内存管理"></a>2. Buffer 与内存管理</h3><h4 id="Socket-内存信息解读"><a href="#Socket-内存信息解读" class="headerlink" title="Socket 内存信息解读"></a>Socket 内存信息解读</h4><p>使用 <code>ss -m</code> 查看 socket 内存状态：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ss -m</span><br></pre></td></tr></table></figure>

<p>输出字段含义：</p>
<ul>
<li><code>r</code>：接收缓冲区已分配内存</li>
<li><code>rb</code>：接收缓冲区大小（sk_rcvbuf）</li>
<li><code>t</code>：发送缓冲区已分配内存</li>
<li><code>tb</code>：发送缓冲区大小（sk_sndbuf）</li>
<li><code>f</code>：forward allocation（预分配内存）</li>
<li><code>w</code>：发送队列中的数据</li>
<li><code>o</code>：选项内存（如 TCP options）</li>
<li><code>bl</code>：backlog 队列长度</li>
<li><code>d</code>：丢弃的包数量</li>
</ul>
<p><strong>内核实现</strong>（参考）：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">sk_get_meminfo</span><span class="params">(<span class="type">const</span> <span class="keyword">struct</span> sock *sk, u32 *mem)</span></span><br><span class="line">&#123;</span><br><span class="line">    mem[SK_MEMINFO_RMEM_ALLOC] = sk_rmem_alloc_get(sk);</span><br><span class="line">    mem[SK_MEMINFO_RCVBUF] = sk-&gt;sk_rcvbuf;</span><br><span class="line">    mem[SK_MEMINFO_WMEM_ALLOC] = sk_wmem_alloc_get(sk);</span><br><span class="line">    mem[SK_MEMINFO_SNDBUF] = sk-&gt;sk_sndbuf;</span><br><span class="line">    mem[SK_MEMINFO_FWD_ALLOC] = sk-&gt;sk_forward_alloc;</span><br><span class="line">    mem[SK_MEMINFO_WMEM_QUEUED] = sk-&gt;sk_wmem_queued;</span><br><span class="line">    mem[SK_MEMINFO_OPTMEM] = <span class="type">atomic_read</span>(&amp;sk-&gt;sk_omem_alloc);</span><br><span class="line">    mem[SK_MEMINFO_BACKLOG] = sk-&gt;sk_backlog.len;</span><br><span class="line">    mem[SK_MEMINFO_DROPS] = <span class="type">atomic_read</span>(&amp;sk-&gt;sk_drops);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>诊断技巧</strong>：</p>
<ul>
<li><code>r</code> 接近 <code>rb</code>：接收缓冲区快满，应用层消费慢</li>
<li><code>t</code> 接近 <code>tb</code>：发送缓冲区快满，网络发送慢或对端接收慢</li>
<li><code>d</code> 持续增长：socket 丢包，需检查缓冲区大小和应用处理速度</li>
<li><code>bl</code> 持续非零：backlog 队列有积压，应用 accept() 速度慢</li>
</ul>
<h4 id="内核参数调优"><a href="#内核参数调优" class="headerlink" title="内核参数调优"></a>内核参数调优</h4><p><strong>关键参数</strong>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看网络软中断预算</span></span><br><span class="line">sysctl -a | grep net.core.netdev_budget</span><br><span class="line"></span><br><span class="line"><span class="comment"># 临时调整（重启失效）</span></span><br><span class="line">sysctl -w net.core.netdev_budget=400</span><br></pre></td></tr></table></figure>

<p><strong>常见调优参数</strong>：</p>
<ul>
<li><code>net.core.netdev_budget</code>：单次软中断处理的最大包数</li>
<li><code>net.core.somaxconn</code>：listen() 的最大 backlog</li>
<li><code>net.ipv4.tcp_rmem</code>：TCP 接收缓冲区（min&#x2F;default&#x2F;max）</li>
<li><code>net.ipv4.tcp_wmem</code>：TCP 发送缓冲区（min&#x2F;default&#x2F;max）</li>
<li><code>net.ipv4.tcp_max_syn_backlog</code>：SYN 队列最大长度</li>
</ul>
<p><strong>调优原则</strong>：</p>
<ul>
<li>先监控，后调优（避免盲目调整）</li>
<li>理解参数含义和影响范围</li>
<li>在测试环境验证效果</li>
<li>记录调优前后的性能指标</li>
</ul>
<h3 id="3-TCP-性能指标"><a href="#3-TCP-性能指标" class="headerlink" title="3. TCP 性能指标"></a>3. TCP 性能指标</h3><h4 id="关键性能指标"><a href="#关键性能指标" class="headerlink" title="关键性能指标"></a>关键性能指标</h4><p><strong>RTT（Round-Trip Time）</strong>：</p>
<ul>
<li>衡量网络延迟的核心指标</li>
<li>影响 TCP 吞吐量：<code>Throughput ≈ Window Size / RTT</code></li>
<li>通过 <code>tcp.analysis.ack_rtt</code> 字段分析</li>
</ul>
<p><strong>重传率</strong>：</p>
<ul>
<li>反映网络质量和拥塞情况</li>
<li>类型：超时重传、快速重传</li>
<li>高重传率可能原因：网络丢包、接收端处理慢、拥塞</li>
</ul>
<p><strong>窗口大小</strong>：</p>
<ul>
<li>接收窗口（rwnd）：接收端通告的可用缓冲区</li>
<li>拥塞窗口（cwnd）：发送端的拥塞控制窗口</li>
<li>实际窗口 &#x3D; min(rwnd, cwnd)</li>
</ul>
<p><strong>丢包与重传分析</strong>：</p>
<ul>
<li><code>tcp.analysis.retransmission</code>：重传包</li>
<li><code>tcp.analysis.fast_retransmission</code>：快速重传</li>
<li><code>tcp.analysis.duplicate_ack</code>：重复 ACK</li>
<li><code>tcp.analysis.lost_segment</code>：丢失的段</li>
</ul>
<h4 id="TCP-选项优化"><a href="#TCP-选项优化" class="headerlink" title="TCP 选项优化"></a>TCP 选项优化</h4><p><strong>TCP_CORK</strong>：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">当设置 TCP_CORK 时，会将非满帧排队，直到清除该选项。</span><br><span class="line">适用场景：先发送 HTTP 头部，再用 sendfile() 发送数据体。</span><br><span class="line">TCP_CORK 可与 TCP_NODELAY 同时设置，且优先级更高。</span><br></pre></td></tr></table></figure>

<p><strong>应用场景</strong>：</p>
<ul>
<li>减少小包发送，提升网络效率</li>
<li>适合批量数据传输</li>
<li>与 <code>sendfile()</code> 配合使用</li>
</ul>
<h3 id="4-负载均衡与高可用"><a href="#4-负载均衡与高可用" class="headerlink" title="4. 负载均衡与高可用"></a>4. 负载均衡与高可用</h3><h4 id="SO-REUSEPORT-实现负载均衡"><a href="#SO-REUSEPORT-实现负载均衡" class="headerlink" title="SO_REUSEPORT 实现负载均衡"></a>SO_REUSEPORT 实现负载均衡</h4><p><strong>工作原理</strong>：</p>
<ul>
<li>内核通过哈希算法分发连接到不同进程</li>
<li>每个进程独立 listen() 和 accept()</li>
<li>避免进程间锁竞争</li>
</ul>
<p><strong>性能提升</strong>：</p>
<ul>
<li>多核 CPU 并行处理连接</li>
<li>消除单一监听 socket 瓶颈</li>
<li>提升高并发场景下的吞吐量</li>
</ul>
<p><strong>Nginx 配置示例</strong>：</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">worker_processes</span> <span class="number">4</span>;</span><br><span class="line"><span class="attribute">worker_cpu_affinity</span> <span class="number">00000000000000000000000000001111</span>;</span><br><span class="line"></span><br><span class="line"><span class="section">events</span> &#123;</span><br><span class="line">    <span class="attribute">use</span> <span class="literal">epoll</span>;</span><br><span class="line">    <span class="attribute">accept_mutex</span> <span class="literal">off</span>;  <span class="comment"># 关闭 accept 互斥锁</span></span><br><span class="line">    <span class="attribute">worker_connections</span> <span class="number">102400</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="section">http</span> &#123;</span><br><span class="line">    <span class="attribute">access_log</span> <span class="literal">off</span>;</span><br><span class="line">    <span class="attribute">sendfile</span> <span class="literal">on</span>;</span><br><span class="line">    <span class="attribute">sendfile_max_chunk</span> <span class="number">512k</span>;</span><br><span class="line">    <span class="attribute">tcp_nopush</span> <span class="literal">on</span>;</span><br><span class="line">    <span class="attribute">keepalive_timeout</span> <span class="number">60</span>;</span><br><span class="line">    <span class="attribute">keepalive_requests</span> <span class="number">100000000000</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 短连接 RPS 优化</span></span><br><span class="line">    <span class="attribute">open_file_cache</span> max=<span class="number">10240000</span> inactive=<span class="number">60s</span>;</span><br><span class="line">    <span class="attribute">open_file_cache_valid</span> <span class="number">80s</span>;</span><br><span class="line">    <span class="attribute">open_file_cache_min_uses</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>优化要点</strong>：</p>
<ul>
<li><code>accept_mutex off</code>：配合 SO_REUSEPORT 使用</li>
<li><code>sendfile</code>：零拷贝技术，减少 CPU 消耗</li>
<li><code>tcp_nopush</code>：与 TCP_CORK 类似，批量发送</li>
<li><code>open_file_cache</code>：缓存文件描述符，提升短连接性能</li>
</ul>
<h2 id="三、实战诊断方法论"><a href="#三、实战诊断方法论" class="headerlink" title="三、实战诊断方法论"></a>三、实战诊断方法论</h2><h3 id="1-性能问题排查流程"><a href="#1-性能问题排查流程" class="headerlink" title="1. 性能问题排查流程"></a>1. 性能问题排查流程</h3><p><strong>第一步：确定问题现象</strong></p>
<ul>
<li>延迟高？吞吐量低？连接失败？</li>
<li>收集监控数据：CPU、内存、网络流量、连接数</li>
</ul>
<p><strong>第二步：抓包分析</strong></p>
<ul>
<li>使用 tcpdump 捕获流量</li>
<li>用 tshark&#x2F;Wireshark 分析关键指标</li>
</ul>
<p><strong>第三步：定位瓶颈</strong></p>
<ul>
<li>网络层：RTT、丢包率、重传率</li>
<li>传输层：窗口大小、队列状态</li>
<li>应用层：响应时间、处理速度</li>
</ul>
<p><strong>第四步：验证假设</strong></p>
<ul>
<li>调整参数或代码</li>
<li>对比调整前后的性能数据</li>
<li>确认问题是否解决</li>
</ul>
<h3 id="2-常见问题模式"><a href="#2-常见问题模式" class="headerlink" title="2. 常见问题模式"></a>2. 常见问题模式</h3><h4 id="模式-1：高延迟"><a href="#模式-1：高延迟" class="headerlink" title="模式 1：高延迟"></a>模式 1：高延迟</h4><p><strong>可能原因</strong>：</p>
<ul>
<li>网络 RTT 高（物理距离、路由跳数）</li>
<li>应用层处理慢（数据库查询、计算密集）</li>
<li>队列积压（accept 队列、backlog 队列）</li>
</ul>
<p><strong>诊断方法</strong>：</p>
<ul>
<li>分析 <code>tcp.analysis.ack_rtt</code> 确定网络延迟</li>
<li>分析应用层响应时间（如 MySQL query time）</li>
<li>检查队列状态（tcpaccept、ss -l）</li>
</ul>
<h4 id="模式-2：高重传率"><a href="#模式-2：高重传率" class="headerlink" title="模式 2：高重传率"></a>模式 2：高重传率</h4><p><strong>可能原因</strong>：</p>
<ul>
<li>网络丢包（链路质量差、拥塞）</li>
<li>接收端处理慢（窗口满、应用消费慢）</li>
<li>发送端突发流量（超过网络容量）</li>
</ul>
<p><strong>诊断方法</strong>：</p>
<ul>
<li>统计重传类型（超时 vs 快速重传）</li>
<li>检查窗口大小变化</li>
<li>分析丢包位置（发送端、中间网络、接收端）</li>
</ul>
<h4 id="模式-3：连接失败"><a href="#模式-3：连接失败" class="headerlink" title="模式 3：连接失败"></a>模式 3：连接失败</h4><p><strong>可能原因</strong>：</p>
<ul>
<li>SYN 队列满（半连接队列溢出）</li>
<li>Accept 队列满（全连接队列溢出）</li>
<li>防火墙&#x2F;安全组规则</li>
<li>端口耗尽</li>
</ul>
<p><strong>诊断方法</strong>：</p>
<ul>
<li>检查 <code>netstat -s | grep -i listen</code></li>
<li>监控队列状态（tcpaccept）</li>
<li>检查可用端口范围</li>
</ul>
<h3 id="3-分层诊断策略"><a href="#3-分层诊断策略" class="headerlink" title="3. 分层诊断策略"></a>3. 分层诊断策略</h3><p><strong>应用层</strong>：</p>
<ul>
<li>响应时间分布（P50&#x2F;P95&#x2F;P99）</li>
<li>慢查询分析</li>
<li>业务逻辑性能</li>
</ul>
<p><strong>传输层（TCP）</strong>：</p>
<ul>
<li>连接建立时间</li>
<li>数据传输效率</li>
<li>连接关闭状态（TIME_WAIT 数量）</li>
</ul>
<p><strong>网络层（IP）</strong>：</p>
<ul>
<li>路由路径</li>
<li>MTU 设置</li>
<li>分片情况</li>
</ul>
<p><strong>链路层</strong>：</p>
<ul>
<li>网卡队列</li>
<li>软中断分布</li>
<li>丢包统计</li>
</ul>
<h2 id="四、工具链与技能树"><a href="#四、工具链与技能树" class="headerlink" title="四、工具链与技能树"></a>四、工具链与技能树</h2><h3 id="1-必备工具"><a href="#1-必备工具" class="headerlink" title="1. 必备工具"></a>1. 必备工具</h3><p><strong>抓包与分析</strong>：</p>
<ul>
<li>tcpdump：流量捕获</li>
<li>tshark：命令行分析</li>
<li>Wireshark：图形化深度分析</li>
</ul>
<p><strong>连接监控</strong>：</p>
<ul>
<li>ss：socket 统计（替代 netstat）</li>
<li>tcpaccept：连接队列监控（bpftrace）</li>
<li>netstat：传统网络统计</li>
</ul>
<p><strong>性能分析</strong>：</p>
<ul>
<li>perf：CPU 性能分析</li>
<li>sar：系统活动报告</li>
<li>iftop：实时流量监控</li>
</ul>
<p><strong>内核调试</strong>：</p>
<ul>
<li>sysctl：内核参数查看&#x2F;设置</li>
<li>bpftrace&#x2F;eBPF：内核动态追踪</li>
<li>SystemTap：内核探测</li>
</ul>
<h3 id="2-技能进阶路径"><a href="#2-技能进阶路径" class="headerlink" title="2. 技能进阶路径"></a>2. 技能进阶路径</h3><p><strong>初级（理解基础）</strong>：</p>
<ul>
<li>TCP 三次握手、四次挥手</li>
<li>常见状态（ESTABLISHED、TIME_WAIT、CLOSE_WAIT）</li>
<li>基本抓包和过滤</li>
</ul>
<p><strong>中级（诊断问题）</strong>：</p>
<ul>
<li>重传、丢包、窗口分析</li>
<li>内核参数调优</li>
<li>应用层协议解析（HTTP、MySQL）</li>
</ul>
<p><strong>高级（性能优化）</strong>：</p>
<ul>
<li>拥塞控制算法</li>
<li>零拷贝技术（sendfile、splice）</li>
<li>内核网络栈优化</li>
<li>eBPF 自定义追踪</li>
</ul>
<p><strong>专家级（架构设计）</strong>：</p>
<ul>
<li>高性能网络架构设计</li>
<li>负载均衡策略</li>
<li>容错与降级方案</li>
<li>大规模分布式系统网络优化</li>
</ul>
<h2 id="五、学习资源与实践建议"><a href="#五、学习资源与实践建议" class="headerlink" title="五、学习资源与实践建议"></a>五、学习资源与实践建议</h2><h3 id="1-plantegg-博客特色"><a href="#1-plantegg-博客特色" class="headerlink" title="1. plantegg 博客特色"></a>1. plantegg 博客特色</h3><p><strong>理论与实践结合</strong>：</p>
<ul>
<li>每个概念都有生产案例支撑</li>
<li>提供完整的命令和代码示例</li>
<li>强调可复现的实验方法</li>
</ul>
<p><strong>问题驱动</strong>：</p>
<ul>
<li>从真实故障出发</li>
<li>展示完整的排查过程</li>
<li>总结可复用的方法论</li>
</ul>
<p><strong>工具导向</strong>：</p>
<ul>
<li>详细的工具使用指南</li>
<li>参数含义和适用场景</li>
<li>输出结果的解读方法</li>
</ul>
<h3 id="2-实践建议"><a href="#2-实践建议" class="headerlink" title="2. 实践建议"></a>2. 实践建议</h3><p><strong>搭建实验环境</strong>：</p>
<ul>
<li>使用虚拟机或容器模拟网络场景</li>
<li>用 tc（traffic control）模拟延迟、丢包</li>
<li>搭建简单的客户端-服务器程序</li>
</ul>
<p><strong>动手实验</strong>：</p>
<ul>
<li>复现博客中的案例</li>
<li>修改参数观察效果</li>
<li>记录实验结果和心得</li>
</ul>
<p><strong>建立知识库</strong>：</p>
<ul>
<li>整理常用命令和参数</li>
<li>记录典型问题的排查步骤</li>
<li>积累自己的案例库</li>
</ul>
<p><strong>持续学习</strong>：</p>
<ul>
<li>关注内核版本更新（新特性、新参数）</li>
<li>学习新工具（eBPF、XDP）</li>
<li>阅读内核源码（理解实现细节）</li>
</ul>
<h3 id="3-避免的误区"><a href="#3-避免的误区" class="headerlink" title="3. 避免的误区"></a>3. 避免的误区</h3><p><strong>误区 1：只学理论不实践</strong></p>
<ul>
<li>网络知识必须通过实验验证</li>
<li>理论与实际环境可能有差异</li>
</ul>
<p><strong>误区 2：盲目调优参数</strong></p>
<ul>
<li>先理解参数含义和影响</li>
<li>在测试环境验证效果</li>
<li>记录调优前后的对比数据</li>
</ul>
<p><strong>误区 3：忽视应用层</strong></p>
<ul>
<li>很多”网络问题”实际是应用层问题</li>
<li>要结合应用日志和业务逻辑分析</li>
</ul>
<p><strong>误区 4：过度依赖工具</strong></p>
<ul>
<li>工具是手段，理解原理才是目的</li>
<li>学会从工具输出推导底层行为</li>
</ul>
<h2 id="六、总结"><a href="#六、总结" class="headerlink" title="六、总结"></a>六、总结</h2><p>plantegg 博客的核心价值在于：</p>
<ol>
<li><strong>系统化</strong>：完整的知识体系，从基础到高级</li>
<li><strong>实战化</strong>：真实案例，可复现的实验</li>
<li><strong>工具化</strong>：详细的工具使用指南</li>
<li><strong>方法论</strong>：可复用的问题排查流程</li>
</ol>
<p><strong>学习网络知识的最佳路径</strong>：</p>
<ul>
<li>理论学习 → 动手实验 → 问题排查 → 性能优化 → 架构设计</li>
</ul>
<p><strong>持续提升的关键</strong>：</p>
<ul>
<li>保持好奇心，深入理解原理</li>
<li>多动手实践，积累经验</li>
<li>建立自己的知识体系和工具链</li>
<li>关注技术演进，学习新技术</li>
</ul>
<hr>
<p><strong>文档生成时间</strong>：2026-01-18<br><strong>来源</strong>：plantegg.github.io (Context7 库)<br><strong>适用对象</strong>：系统工程师、SRE、后端开发、网络工程师</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://plantegg.github.io/2025/12/25/MySQL_PreparedStatement_Performance_Report_EN/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="twitter @plantegg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="plantegg">
      <meta itemprop="description" content="java mysql tcp performance network docker Linux">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | plantegg">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/12/25/MySQL_PreparedStatement_Performance_Report_EN/" class="post-title-link" itemprop="url">MySQL PreparedStatement Performance Issue Reproduction Report</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2025-12-25 17:30:03" itemprop="dateCreated datePublished" datetime="2025-12-25T17:30:03+08:00">2025-12-25</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2026-02-06 13:53:24" itemprop="dateModified" datetime="2026-02-06T13:53:24+08:00">2026-02-06</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/MySQL/" itemprop="url" rel="index"><span itemprop="name">MySQL</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="MySQL-PreparedStatement-Performance-Issue-Reproduction-Report"><a href="#MySQL-PreparedStatement-Performance-Issue-Reproduction-Report" class="headerlink" title="MySQL PreparedStatement Performance Issue Reproduction Report"></a>MySQL PreparedStatement Performance Issue Reproduction Report</h1><h2 id="1-Executive-Summary"><a href="#1-Executive-Summary" class="headerlink" title="1. Executive Summary"></a>1. Executive Summary</h2><h3 id="1-1-Issue-Description"><a href="#1-1-Issue-Description" class="headerlink" title="1.1 Issue Description"></a>1.1 Issue Description</h3><p>A severe performance issue was reported when MySQL processes PreparedStatement IN queries with a large number of parameters (50,000) using <code>useServerPrepStmts=true</code>. According to the original report, server-side prepared statements were <strong>190-207 times slower</strong> than client-side prepared statements.</p>
<h3 id="1-2-Issue-Source"><a href="#1-2-Issue-Source" class="headerlink" title="1.2 Issue Source"></a>1.2 Issue Source</h3><ul>
<li>GitHub Repository: <a target="_blank" rel="noopener" href="https://github.com/plantegg/MySQLPrepared">https://github.com/plantegg/MySQLPrepared</a></li>
<li>Original Discovery Version: MySQL 5.7.29</li>
<li>JDBC Driver: mysql-connector-j-8.0.33</li>
</ul>
<h3 id="1-3-Root-Cause-Original-Report"><a href="#1-3-Root-Cause-Original-Report" class="headerlink" title="1.3 Root Cause (Original Report)"></a>1.3 Root Cause (Original Report)</h3><p>When MySQL server processes PreparedStatement with large number of parameters:</p>
<ol>
<li><strong>Excessive memory reallocation</strong>: 50,000 parameter replacement operations</li>
<li><strong>String operation complexity</strong>: O(SQL length) × number of parameters</li>
<li><strong>Memory fragmentation</strong>: Frequent large memory block allocation and deallocation</li>
</ol>
<h2 id="2-Test-Environment"><a href="#2-Test-Environment" class="headerlink" title="2. Test Environment"></a>2. Test Environment</h2><h3 id="2-1-AWS-Resource-Information"><a href="#2-1-AWS-Resource-Information" class="headerlink" title="2.1 AWS Resource Information"></a>2.1 AWS Resource Information</h3><table>
<thead>
<tr>
<th>Resource</th>
<th>Configuration</th>
</tr>
</thead>
<tbody><tr>
<td>AWS Account</td>
<td>872515255872</td>
</tr>
<tr>
<td>Region</td>
<td>ap-southeast-1</td>
</tr>
<tr>
<td>VPC</td>
<td>vpc-084114e405054a5b7</td>
</tr>
</tbody></table>
<h3 id="2-2-RDS-MySQL-8-0-Instance"><a href="#2-2-RDS-MySQL-8-0-Instance" class="headerlink" title="2.2 RDS MySQL 8.0 Instance"></a>2.2 RDS MySQL 8.0 Instance</h3><table>
<thead>
<tr>
<th>Configuration</th>
<th>Value</th>
</tr>
</thead>
<tbody><tr>
<td>Instance Identifier</td>
<td>mysql-prepared-test</td>
</tr>
<tr>
<td>Instance Type</td>
<td>db.t3.medium (2vCPU, 4GB)</td>
</tr>
<tr>
<td>Storage</td>
<td>50GB gp3</td>
</tr>
<tr>
<td>Engine Version</td>
<td>MySQL 8.0.43</td>
</tr>
<tr>
<td>Endpoint</td>
<td>mysql-prepared-test.cfsoq6muu0jv.ap-southeast-1.rds.amazonaws.com</td>
</tr>
</tbody></table>
<h3 id="2-3-RDS-MySQL-5-7-Instance"><a href="#2-3-RDS-MySQL-5-7-Instance" class="headerlink" title="2.3 RDS MySQL 5.7 Instance"></a>2.3 RDS MySQL 5.7 Instance</h3><table>
<thead>
<tr>
<th>Configuration</th>
<th>Value</th>
</tr>
</thead>
<tbody><tr>
<td>Instance Identifier</td>
<td>mysql57-prepared-test</td>
</tr>
<tr>
<td>Instance Type</td>
<td>db.t3.medium (2vCPU, 4GB)</td>
</tr>
<tr>
<td>Storage</td>
<td>50GB gp3</td>
</tr>
<tr>
<td>Engine Version</td>
<td>MySQL 5.7.44-rds.20240408</td>
</tr>
<tr>
<td>Endpoint</td>
<td>mysql57-prepared-test.cfsoq6muu0jv.ap-southeast-1.rds.amazonaws.com</td>
</tr>
</tbody></table>
<h3 id="2-4-EC2-Test-Client"><a href="#2-4-EC2-Test-Client" class="headerlink" title="2.4 EC2 Test Client"></a>2.4 EC2 Test Client</h3><table>
<thead>
<tr>
<th>Configuration</th>
<th>Value</th>
</tr>
</thead>
<tbody><tr>
<td>Instance ID</td>
<td>i-0b26f3cb781bae059</td>
</tr>
<tr>
<td>Instance Type</td>
<td>t3.medium</td>
</tr>
<tr>
<td>AMI</td>
<td>Amazon Linux 2023</td>
</tr>
<tr>
<td>Public IP</td>
<td>18.141.185.36</td>
</tr>
<tr>
<td>Java</td>
<td>Amazon Corretto 17</td>
</tr>
<tr>
<td>Maven</td>
<td>3.8.4</td>
</tr>
</tbody></table>
<h2 id="3-Test-Methodology"><a href="#3-Test-Methodology" class="headerlink" title="3. Test Methodology"></a>3. Test Methodology</h2><h3 id="3-1-Test-Code"><a href="#3-1-Test-Code" class="headerlink" title="3.1 Test Code"></a>3.1 Test Code</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/plantegg/MySQLPrepared.git</span><br><span class="line"><span class="built_in">cd</span> MySQLPrepared</span><br><span class="line">./run_test.sh --host &lt;mysql-host&gt; --port 3306 --database <span class="built_in">test</span> \</span><br><span class="line">    --user admin --password <span class="string">&#x27;&lt;password&gt;&#x27;</span> --rounds 3</span><br></pre></td></tr></table></figure>

<h3 id="3-2-Test-Parameters"><a href="#3-2-Test-Parameters" class="headerlink" title="3.2 Test Parameters"></a>3.2 Test Parameters</h3><table>
<thead>
<tr>
<th>Parameter</th>
<th>Value</th>
</tr>
</thead>
<tbody><tr>
<td>IN query parameter count</td>
<td>50,000</td>
</tr>
<tr>
<td>Parameter type</td>
<td>15-digit large integers</td>
</tr>
<tr>
<td>SQL length (spaces&#x3D;128)</td>
<td>~6.5MB</td>
</tr>
<tr>
<td>Test rounds</td>
<td>3</td>
</tr>
</tbody></table>
<h3 id="3-3-AWS-CLI-Commands"><a href="#3-3-AWS-CLI-Commands" class="headerlink" title="3.3 AWS CLI Commands"></a>3.3 AWS CLI Commands</h3><h4 id="Create-RDS-MySQL-8-0-Instance"><a href="#Create-RDS-MySQL-8-0-Instance" class="headerlink" title="Create RDS MySQL 8.0 Instance"></a>Create RDS MySQL 8.0 Instance</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">aws rds create-db-instance \</span><br><span class="line">    --profile default --region ap-southeast-1 \</span><br><span class="line">    --db-instance-identifier mysql-prepared-test \</span><br><span class="line">    --db-instance-class db.t3.medium \</span><br><span class="line">    --engine mysql \</span><br><span class="line">    --engine-version 8.0 \</span><br><span class="line">    --master-username admin \</span><br><span class="line">    --master-user-password <span class="string">&#x27;&lt;password&gt;&#x27;</span> \</span><br><span class="line">    --allocated-storage 50 \</span><br><span class="line">    --storage-type gp3 \</span><br><span class="line">    --db-subnet-group-name mysql-benchmark-subnet-group \</span><br><span class="line">    --vpc-security-group-ids sg-01541b078e0b483d0 \</span><br><span class="line">    --no-multi-az \</span><br><span class="line">    --publicly-accessible \</span><br><span class="line">    --backup-retention-period 0 \</span><br><span class="line">    --no-auto-minor-version-upgrade</span><br></pre></td></tr></table></figure>

<h4 id="Create-RDS-MySQL-5-7-Instance"><a href="#Create-RDS-MySQL-5-7-Instance" class="headerlink" title="Create RDS MySQL 5.7 Instance"></a>Create RDS MySQL 5.7 Instance</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">aws rds create-db-instance \</span><br><span class="line">    --profile default --region ap-southeast-1 \</span><br><span class="line">    --db-instance-identifier mysql57-prepared-test \</span><br><span class="line">    --db-instance-class db.t3.medium \</span><br><span class="line">    --engine mysql \</span><br><span class="line">    --engine-version 5.7.44-rds.20240408 \</span><br><span class="line">    --master-username admin \</span><br><span class="line">    --master-user-password <span class="string">&#x27;&lt;password&gt;&#x27;</span> \</span><br><span class="line">    --allocated-storage 50 \</span><br><span class="line">    --storage-type gp3 \</span><br><span class="line">    --db-subnet-group-name mysql-benchmark-subnet-group \</span><br><span class="line">    --vpc-security-group-ids sg-01541b078e0b483d0 \</span><br><span class="line">    --no-multi-az \</span><br><span class="line">    --publicly-accessible \</span><br><span class="line">    --backup-retention-period 0 \</span><br><span class="line">    --no-auto-minor-version-upgrade</span><br></pre></td></tr></table></figure>

<h4 id="Create-EC2-Test-Instance"><a href="#Create-EC2-Test-Instance" class="headerlink" title="Create EC2 Test Instance"></a>Create EC2 Test Instance</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">aws ec2 run-instances \</span><br><span class="line">    --profile default --region ap-southeast-1 \</span><br><span class="line">    --image-id ami-0d1c0ec9903f7b01f \</span><br><span class="line">    --instance-type t3.medium \</span><br><span class="line">    --key-name renxijun-ec2-key \</span><br><span class="line">    --security-group-ids sg-0706d5fbe75649370 \</span><br><span class="line">    --subnet-id subnet-09d864b724dce6434 \</span><br><span class="line">    --tag-specifications <span class="string">&#x27;ResourceType=instance,Tags=[&#123;Key=Name,Value=mysql-prepared-test-ec2&#125;]&#x27;</span></span><br></pre></td></tr></table></figure>

<h2 id="4-Test-Results"><a href="#4-Test-Results" class="headerlink" title="4. Test Results"></a>4. Test Results</h2><h3 id="4-1-MySQL-8-0-43-Test-Results"><a href="#4-1-MySQL-8-0-43-Test-Results" class="headerlink" title="4.1 MySQL 8.0.43 Test Results"></a>4.1 MySQL 8.0.43 Test Results</h3><h4 id="Compact-Format-spaces-0-SQL-length-100KB"><a href="#Compact-Format-spaces-0-SQL-length-100KB" class="headerlink" title="Compact Format (spaces&#x3D;0, SQL length ~100KB)"></a>Compact Format (spaces&#x3D;0, SQL length ~100KB)</h4><table>
<thead>
<tr>
<th>Configuration</th>
<th>Average Execution Time</th>
<th>Com_stmt_prepare</th>
</tr>
</thead>
<tbody><tr>
<td>useServerPrepStmts&#x3D;false</td>
<td>129.6ms</td>
<td>0</td>
</tr>
<tr>
<td>useServerPrepStmts&#x3D;true</td>
<td>115.6ms</td>
<td>1</td>
</tr>
<tr>
<td><strong>Performance Difference</strong></td>
<td><strong>true is 1.1x faster</strong></td>
<td>-</td>
</tr>
</tbody></table>
<h4 id="With-Spaces-Format-spaces-128-SQL-length-6-5MB"><a href="#With-Spaces-Format-spaces-128-SQL-length-6-5MB" class="headerlink" title="With Spaces Format (spaces&#x3D;128, SQL length ~6.5MB)"></a>With Spaces Format (spaces&#x3D;128, SQL length ~6.5MB)</h4><table>
<thead>
<tr>
<th>Configuration</th>
<th>Average Execution Time</th>
<th>Com_stmt_prepare</th>
</tr>
</thead>
<tbody><tr>
<td>useServerPrepStmts&#x3D;false</td>
<td>400.7ms</td>
<td>0</td>
</tr>
<tr>
<td>useServerPrepStmts&#x3D;true</td>
<td>101.0ms</td>
<td>1</td>
</tr>
<tr>
<td><strong>Performance Difference</strong></td>
<td><strong>true is 4.0x faster</strong></td>
<td>-</td>
</tr>
</tbody></table>
<h3 id="4-2-MySQL-5-7-44-Test-Results"><a href="#4-2-MySQL-5-7-44-Test-Results" class="headerlink" title="4.2 MySQL 5.7.44 Test Results"></a>4.2 MySQL 5.7.44 Test Results</h3><h4 id="With-Spaces-Format-spaces-128-SQL-length-6-5MB-1"><a href="#With-Spaces-Format-spaces-128-SQL-length-6-5MB-1" class="headerlink" title="With Spaces Format (spaces&#x3D;128, SQL length ~6.5MB)"></a>With Spaces Format (spaces&#x3D;128, SQL length ~6.5MB)</h4><table>
<thead>
<tr>
<th>Configuration</th>
<th>Average Execution Time</th>
<th>Com_stmt_prepare</th>
</tr>
</thead>
<tbody><tr>
<td>useServerPrepStmts&#x3D;false</td>
<td>600.0ms</td>
<td>0</td>
</tr>
<tr>
<td>useServerPrepStmts&#x3D;true</td>
<td>90.0ms</td>
<td>1</td>
</tr>
<tr>
<td><strong>Performance Difference</strong></td>
<td><strong>true is 6.7x faster</strong></td>
<td>-</td>
</tr>
</tbody></table>
<h3 id="4-3-Comparison-with-Original-Report"><a href="#4-3-Comparison-with-Original-Report" class="headerlink" title="4.3 Comparison with Original Report"></a>4.3 Comparison with Original Report</h3><table>
<thead>
<tr>
<th>Version</th>
<th>Original Report (5.7.29)</th>
<th>This Test (5.7.44)</th>
<th>This Test (8.0.43)</th>
</tr>
</thead>
<tbody><tr>
<td>false avg time</td>
<td>~52ms</td>
<td>600ms</td>
<td>400.7ms</td>
</tr>
<tr>
<td>true avg time</td>
<td>~27,839ms</td>
<td>90ms</td>
<td>101ms</td>
</tr>
<tr>
<td>Performance Diff</td>
<td><strong>true 535x slower</strong></td>
<td><strong>true 6.7x faster</strong></td>
<td><strong>true 4.0x faster</strong></td>
</tr>
</tbody></table>
<h2 id="5-Conclusions"><a href="#5-Conclusions" class="headerlink" title="5. Conclusions"></a>5. Conclusions</h2><h3 id="5-1-Reproduction-Results"><a href="#5-1-Reproduction-Results" class="headerlink" title="5.1 Reproduction Results"></a>5.1 Reproduction Results</h3><p><strong>The performance issue described in the original report could NOT be reproduced on MySQL 5.7.44 and 8.0.43.</strong></p>
<p>Test results show:</p>
<ul>
<li>On both versions, <code>useServerPrepStmts=true</code> is actually <strong>faster</strong> than <code>false</code></li>
<li>MySQL 5.7.44: Server-side prepared statements are 6.7x faster</li>
<li>MySQL 8.0.43: Server-side prepared statements are 4.0x faster</li>
</ul>
<h3 id="5-2-Possible-Explanations"><a href="#5-2-Possible-Explanations" class="headerlink" title="5.2 Possible Explanations"></a>5.2 Possible Explanations</h3><ol>
<li><p><strong>MySQL Version Differences</strong></p>
<ul>
<li>Original issue was discovered on MySQL 5.7.29</li>
<li>This test used MySQL 5.7.44 and 8.0.43</li>
<li>The issue may have been fixed in versions after 5.7.29</li>
</ul>
</li>
<li><p><strong>AWS RDS Optimizations</strong></p>
<ul>
<li>AWS RDS may include specific performance optimizations</li>
<li>Behavior may differ from native MySQL installations</li>
</ul>
</li>
<li><p><strong>JDBC Driver Version</strong></p>
<ul>
<li>Test used mysql-connector-j-8.0.33</li>
<li>Driver may have optimized parameter handling logic</li>
</ul>
</li>
</ol>
<h3 id="5-3-Recommendations"><a href="#5-3-Recommendations" class="headerlink" title="5.3 Recommendations"></a>5.3 Recommendations</h3><ol>
<li><p><strong>To Reproduce the Original Issue</strong></p>
<ul>
<li>Use MySQL 5.7.29 or earlier versions</li>
<li>Use native MySQL instead of AWS RDS</li>
</ul>
</li>
<li><p><strong>Production Environment Recommendations</strong></p>
<ul>
<li>On newer MySQL versions, <code>useServerPrepStmts=true</code> performs better</li>
<li>Conduct performance testing with actual business scenarios</li>
<li>For IN queries with large parameter counts, consider batch queries or temporary table approaches</li>
</ul>
</li>
</ol>
<h2 id="6-Appendix"><a href="#6-Appendix" class="headerlink" title="6. Appendix"></a>6. Appendix</h2><h3 id="6-1-Test-Logs"><a href="#6-1-Test-Logs" class="headerlink" title="6.1 Test Logs"></a>6.1 Test Logs</h3><h4 id="MySQL-8-0-43-Complete-Output"><a href="#MySQL-8-0-43-Complete-Output" class="headerlink" title="MySQL 8.0.43 Complete Output"></a>MySQL 8.0.43 Complete Output</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">=== MySQL PreparedStatement Performance Comparison Test ===</span><br><span class="line">Connection: mysql-prepared-test.cfsoq6muu0jv.ap-southeast-1.rds.amazonaws.com:3306/test</span><br><span class="line">Parameter count: 50000</span><br><span class="line">Test rounds: 3</span><br><span class="line"></span><br><span class="line">Configuration: useServerPrepStmts=false</span><br><span class="line">Parameter spaces: 128</span><br><span class="line">SQL length: 6500023 characters</span><br><span class="line">Executing query 1...</span><br><span class="line">Query 1: 571ms (0 records returned)</span><br><span class="line">Executing query 2...</span><br><span class="line">Query 2: 317ms (0 records returned)</span><br><span class="line">Executing query 3...</span><br><span class="line">Query 3: 314ms (0 records returned)</span><br><span class="line"></span><br><span class="line">=== useServerPrepStmts=false Test Results ===</span><br><span class="line">Total execution time: 1202ms</span><br><span class="line">Average execution time: 400.7ms</span><br><span class="line">Records returned: 0</span><br><span class="line">Com_stmt_prepare: 0 -&gt; 0</span><br><span class="line"></span><br><span class="line">Configuration: useServerPrepStmts=true</span><br><span class="line">Parameter spaces: 128</span><br><span class="line">SQL length: 6500023 characters</span><br><span class="line">Executing query 1...</span><br><span class="line">Query 1: 138ms (0 records returned)</span><br><span class="line">Executing query 2...</span><br><span class="line">Query 2: 92ms (0 records returned)</span><br><span class="line">Executing query 3...</span><br><span class="line">Query 3: 73ms (0 records returned)</span><br><span class="line"></span><br><span class="line">=== useServerPrepStmts=true Test Results ===</span><br><span class="line">Total execution time: 303ms</span><br><span class="line">Average execution time: 101.0ms</span><br><span class="line">Records returned: 0</span><br><span class="line">Com_stmt_prepare: 0 -&gt; 1</span><br></pre></td></tr></table></figure>

<h4 id="MySQL-5-7-44-Complete-Output"><a href="#MySQL-5-7-44-Complete-Output" class="headerlink" title="MySQL 5.7.44 Complete Output"></a>MySQL 5.7.44 Complete Output</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">=== MySQL PreparedStatement Performance Comparison Test ===</span><br><span class="line">Connection: mysql57-prepared-test.cfsoq6muu0jv.ap-southeast-1.rds.amazonaws.com:3306/test</span><br><span class="line">Parameter count: 50000</span><br><span class="line">Test rounds: 3</span><br><span class="line"></span><br><span class="line">Configuration: useServerPrepStmts=false</span><br><span class="line">Parameter spaces: 128</span><br><span class="line">SQL length: 6500023 characters</span><br><span class="line">Executing query 1...</span><br><span class="line">Query 1: 639ms (0 records returned)</span><br><span class="line">Executing query 2...</span><br><span class="line">Query 2: 681ms (0 records returned)</span><br><span class="line">Executing query 3...</span><br><span class="line">Query 3: 480ms (0 records returned)</span><br><span class="line"></span><br><span class="line">=== useServerPrepStmts=false Test Results ===</span><br><span class="line">Total execution time: 1800ms</span><br><span class="line">Average execution time: 600.0ms</span><br><span class="line">Records returned: 0</span><br><span class="line">Com_stmt_prepare: 0 -&gt; 0</span><br><span class="line"></span><br><span class="line">Configuration: useServerPrepStmts=true</span><br><span class="line">Parameter spaces: 128</span><br><span class="line">SQL length: 6500023 characters</span><br><span class="line">Executing query 1...</span><br><span class="line">Query 1: 117ms (0 records returned)</span><br><span class="line">Executing query 2...</span><br><span class="line">Query 2: 77ms (0 records returned)</span><br><span class="line">Executing query 3...</span><br><span class="line">Query 3: 76ms (0 records returned)</span><br><span class="line"></span><br><span class="line">=== useServerPrepStmts=true Test Results ===</span><br><span class="line">Total execution time: 270ms</span><br><span class="line">Average execution time: 90.0ms</span><br><span class="line">Records returned: 0</span><br><span class="line">Com_stmt_prepare: 0 -&gt; 1</span><br></pre></td></tr></table></figure>

<h3 id="6-2-Original-Issue-Stack-Trace-from-original-report"><a href="#6-2-Original-Issue-Stack-Trace-from-original-report" class="headerlink" title="6.2 Original Issue Stack Trace (from original report)"></a>6.2 Original Issue Stack Trace (from original report)</h3><p>The original report included a <code>pstack</code> analysis showing the server spending excessive time in string replacement operations:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Thread 1 (Thread 0x7feeb8043640 (LWP 2508284)):</span><br><span class="line">#0 __memmove_avx512_unaligned_erms () from /lib64/libc.so.6</span><br><span class="line">#1 my_realloc () at mysys/my_malloc.c:112</span><br><span class="line">#2 String::mem_realloc () at sql-common/sql_string.cc:128</span><br><span class="line">#3 String::replace () at sql-common/sql_string.cc:804</span><br><span class="line">#4 String::replace () at sql-common/sql_string.cc:783</span><br><span class="line">#5 Prepared_statement::insert_params () at sql/sql_prepare.cc:924</span><br><span class="line">#6 Prepared_statement::set_parameters () at sql/sql_prepare.cc:3496</span><br><span class="line">#7 Prepared_statement::execute_loop () at sql/sql_prepare.cc:3559</span><br><span class="line">#8 mysqld_stmt_execute () at sql/sql_prepare.cc:2582</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>This stack trace indicates the server was performing extensive memory reallocation and string manipulation operations during parameter substitution.</p>
<h3 id="6-3-References"><a href="#6-3-References" class="headerlink" title="6.3 References"></a>6.3 References</h3><ul>
<li><a target="_blank" rel="noopener" href="https://github.com/plantegg/MySQLPrepared">MySQL PreparedStatement Performance Issue Reproduction Project</a></li>
<li><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/connector-j/8.0/en/">MySQL Connector&#x2F;J Documentation</a></li>
<li><a target="_blank" rel="noopener" href="https://bugs.mysql.com/">MySQL Bug Database</a></li>
</ul>
<h2 id="7-Submission-Notes-for-MySQL-Community"><a href="#7-Submission-Notes-for-MySQL-Community" class="headerlink" title="7. Submission Notes for MySQL Community"></a>7. Submission Notes for MySQL Community</h2><h3 id="7-1-Summary-for-Bug-Report"><a href="#7-1-Summary-for-Bug-Report" class="headerlink" title="7.1 Summary for Bug Report"></a>7.1 Summary for Bug Report</h3><p><strong>Title</strong>: Performance regression with useServerPrepStmts&#x3D;true for large IN queries appears to be fixed in MySQL 5.7.44+</p>
<p><strong>Description</strong>:<br>A previously reported performance issue where server-side prepared statements (<code>useServerPrepStmts=true</code>) were significantly slower than client-side prepared statements for IN queries with 50,000 parameters could not be reproduced on MySQL 5.7.44 and 8.0.43.</p>
<p><strong>Original Behavior (MySQL 5.7.29)</strong>:</p>
<ul>
<li><code>useServerPrepStmts=true</code>: ~27,839ms average</li>
<li><code>useServerPrepStmts=false</code>: ~52ms average</li>
<li>Performance difference: 535x slower with server-side</li>
</ul>
<p><strong>Current Behavior (MySQL 5.7.44 &#x2F; 8.0.43)</strong>:</p>
<ul>
<li><code>useServerPrepStmts=true</code>: ~90-101ms average</li>
<li><code>useServerPrepStmts=false</code>: ~400-600ms average</li>
<li>Performance difference: 4-6.7x faster with server-side</li>
</ul>
<p><strong>Request</strong>:<br>Could the MySQL team confirm if this issue was intentionally fixed in a specific version? If so, please document the fix in the release notes for user awareness.</p>
<hr>
<p><strong>Report Generated</strong>: 2026-01-12<br><strong>Test Executor</strong>: Kiro CLI<br><strong>AWS Account</strong>: 872515255872</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://plantegg.github.io/2025/11/29/mysql_sysbench_v2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="twitter @plantegg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="plantegg">
      <meta itemprop="description" content="java mysql tcp performance network docker Linux">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | plantegg">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/11/29/mysql_sysbench_v2/" class="post-title-link" itemprop="url">云盘和本地盘谁强？各家云厂商云盘谁更强？</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2025-11-29 17:30:03" itemprop="dateCreated datePublished" datetime="2025-11-29T17:30:03+08:00">2025-11-29</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2026-02-06 13:53:25" itemprop="dateModified" datetime="2026-02-06T13:53:25+08:00">2026-02-06</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/MySQL/" itemprop="url" rel="index"><span itemprop="name">MySQL</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="MySQL-Sysbench-性能测试综合报告"><a href="#MySQL-Sysbench-性能测试综合报告" class="headerlink" title="MySQL Sysbench 性能测试综合报告"></a>MySQL Sysbench 性能测试综合报告</h1><p>测试代码开源：<a target="_blank" rel="noopener" href="https://github.com/plantegg/sysbench_report">https://github.com/plantegg/sysbench_report</a> ，包含自动生成下面的测试报告，对每个测试场景自动列出压测当时的 CPU&#x2F;磁盘负载</p>
<h2 id="📊-执行摘要"><a href="#📊-执行摘要" class="headerlink" title="📊 执行摘要"></a>📊 执行摘要</h2><p>本报告汇总了10 多个不同环境下的MySQL性能测试结果，涵盖了IDC自建机房、华为云&#x2F;阿里云ECS&#x2F;AWS EC2，自建 MySQL(非云实例)。测试使用sysbench工具进行标准化性能评估，包含点查询、只读、读写混合、只写四种典型业务场景。</p>
<h2 id="点评"><a href="#点评" class="headerlink" title="点评"></a>点评</h2><ul>
<li>测试场景故意用 16*1000 万行50G 数据，MySQL 配置 16Gbuffer，考验磁盘性能</li>
<li>警惕 AWS 云盘，即使换成很贵的 io1&#x2F;io2 云盘，性能较其他家有很大的差距，尤其是在没有压力的时延上是阿里云的 5 倍，是 IDC 的 10 倍，</li>
<li>相对来说 aliyun 的表现很优秀，云盘有很大的 iops 弹性，可以买更便宜的，关键时刻享受自动弹性</li>
<li>不管怎么样，云盘还是非常昂贵，一个实例上云盘的价格会是机器的一半到一倍</li>
<li>CPU 计算性能大差不差，其中 aliyun 买的是今年最新一代，占点优势</li>
</ul>
<h3 id="测试环境概览"><a href="#测试环境概览" class="headerlink" title="测试环境概览"></a>测试环境概览</h3><p>说明：</p>
<ol>
<li>trx1 表示innodb_flush_log_at_trx_commit 为 1；默认配置的 2；表示刷盘频率</li>
<li>gp3&#x2F;io1&#x2F;io2 表示 aws 的三款不同性能的云盘(io2 最好最贵)(2T 云盘的价格是 8C32G 机器的 8 倍)</li>
<li>trx1.repl 的 repl 表示开启半同步复制，看看网络 replication 带来的时延</li>
<li>ali.repl.rtt0.7 的 repl 表示开启半同步复制，rtt0.7ms 表示网络延时，模拟跨可用区</li>
<li>idc 表示在我们自己的机房搭建 MySQL(测试默认不含主从复制，repl 除外)</li>
<li>云厂商都是购买 ECS 搭建 MySQL</li>
<li>超过 8 核的机器，通过绑核的形式限制只能用 8 核</li>
</ol>
<table>
<thead>
<tr>
<th>环境</th>
<th>CPU型号</th>
<th>核数</th>
<th>内存</th>
<th>Buffer Pool</th>
<th>Flush Log</th>
</tr>
</thead>
<tbody><tr>
<td><strong>idc</strong></td>
<td>INTEL(R) XEON(R) SILVER 4510</td>
<td>48</td>
<td>376G</td>
<td>16GB</td>
<td>2</td>
</tr>
<tr>
<td><strong>idc.trx1</strong></td>
<td>INTEL(R) XEON(R) SILVER 4510</td>
<td>48</td>
<td>376G</td>
<td>16GB</td>
<td>1</td>
</tr>
<tr>
<td><strong>huawei</strong></td>
<td>Intel(R) Xeon(R) Gold 6348 CPU @ 2.60GHz</td>
<td>64</td>
<td>251G</td>
<td>16GB</td>
<td>2</td>
</tr>
<tr>
<td><strong>aliyun</strong></td>
<td>Intel(R) Xeon(R) 6982P-C</td>
<td>8</td>
<td>30Gi</td>
<td>16GB</td>
<td>2</td>
</tr>
<tr>
<td><strong>aliyun.trx1</strong></td>
<td>Intel(R) Xeon(R) 6982P-C</td>
<td>8</td>
<td>30Gi</td>
<td>16GB</td>
<td>1</td>
</tr>
<tr>
<td><strong>aliyun.trx1.repl</strong></td>
<td>Intel(R) Xeon(R) 6982P-C</td>
<td>8</td>
<td>30Gi</td>
<td>16GB</td>
<td>1</td>
</tr>
<tr>
<td><strong>ali.repl.rtt0.7</strong></td>
<td>Intel(R) Xeon(R) 6982P-C</td>
<td>8</td>
<td>30Gi</td>
<td>16GB</td>
<td>2</td>
</tr>
<tr>
<td><strong>aws.io2.trx1</strong></td>
<td>Intel(R) Xeon(R) Platinum 8375C CPU @ 2.90GHz</td>
<td>8</td>
<td>30Gi</td>
<td>16GB</td>
<td>1</td>
</tr>
<tr>
<td><strong>aws.io2</strong></td>
<td>Intel(R) Xeon(R) Platinum 8375C CPU @ 2.90GHz</td>
<td>8</td>
<td>30Gi</td>
<td>16GB</td>
<td>2</td>
</tr>
<tr>
<td><strong>aws.io1</strong></td>
<td>Intel(R) Xeon(R) Platinum 8488C</td>
<td>8</td>
<td>30Gi</td>
<td>16GB</td>
<td>2</td>
</tr>
<tr>
<td><strong>aws.gp3</strong></td>
<td>Intel(R) Xeon(R) Platinum 8488C</td>
<td>8</td>
<td>30Gi</td>
<td>16GB</td>
<td>2</td>
</tr>
</tbody></table>
<h3 id="测试配置"><a href="#测试配置" class="headerlink" title="测试配置"></a>测试配置</h3><ul>
<li><strong>测试工具</strong>: sysbench + tsar</li>
<li><strong>测试数据集</strong>: 16表 × 1000万行</li>
<li><strong>测试时长</strong>: 每场景30秒</li>
<li><strong>测试场景</strong>: 点查询、只读、读写混合、只写</li>
<li><strong>并发级别</strong>: 1, 8, 16, 32, 64, 128 线程</li>
</ul>
<hr>
<h2 id="🏆-性能排名"><a href="#🏆-性能排名" class="headerlink" title="🏆 性能排名"></a>🏆 性能排名</h2><h3 id="点查询性能对比-oltp-point-select"><a href="#点查询性能对比-oltp-point-select" class="headerlink" title="点查询性能对比 (oltp_point_select)"></a>点查询性能对比 (oltp_point_select)</h3><table>
<thead>
<tr>
<th>环境</th>
<th>1线程</th>
<th>8线程</th>
<th>16线程</th>
<th>32线程</th>
<th>64线程</th>
<th>128线程</th>
</tr>
</thead>
<tbody><tr>
<td><strong>idc</strong></td>
<td>24,725</td>
<td>159,877</td>
<td>252,082</td>
<td>304,631</td>
<td>299,555</td>
<td>287,407</td>
</tr>
<tr>
<td><strong>idc.trx1</strong></td>
<td>15,153</td>
<td>129,671</td>
<td>231,142</td>
<td>296,421</td>
<td>297,696</td>
<td>285,109</td>
</tr>
<tr>
<td><strong>huawei</strong></td>
<td>6,019</td>
<td>45,989</td>
<td>86,219</td>
<td>155,542</td>
<td>196,915</td>
<td>190,484</td>
</tr>
<tr>
<td><strong>aliyun</strong></td>
<td>15,750</td>
<td>109,914</td>
<td>196,497</td>
<td>301,160</td>
<td>328,098</td>
<td>309,373</td>
</tr>
<tr>
<td><strong>aliyun.trx1</strong></td>
<td>15,625</td>
<td>113,189</td>
<td>195,783</td>
<td>302,140</td>
<td>326,549</td>
<td>310,429</td>
</tr>
<tr>
<td><strong>aliyun.trx1.repl</strong></td>
<td>17,027</td>
<td>109,505</td>
<td>190,769</td>
<td>287,309</td>
<td>329,548</td>
<td>301,471</td>
</tr>
<tr>
<td><strong>ali.repl.rtt0.7</strong></td>
<td>14,484</td>
<td>96,810</td>
<td>168,662</td>
<td>254,690</td>
<td>271,234</td>
<td>235,929</td>
</tr>
<tr>
<td><strong>aws.io2.trx1</strong></td>
<td>11,888</td>
<td>75,291</td>
<td>127,179</td>
<td>161,447</td>
<td>162,516</td>
<td>155,947</td>
</tr>
<tr>
<td><strong>aws.io2</strong></td>
<td>12,004</td>
<td>75,171</td>
<td>126,712</td>
<td>160,866</td>
<td>157,480</td>
<td>153,448</td>
</tr>
<tr>
<td><strong>aws.io1</strong></td>
<td>1,835</td>
<td>56,871</td>
<td>170,296</td>
<td>251,905</td>
<td>249,718</td>
<td>236,283</td>
</tr>
<tr>
<td><strong>aws.gp3</strong></td>
<td>2,316</td>
<td>60,437</td>
<td>162,670</td>
<td>232,535</td>
<td>228,321</td>
<td>217,381</td>
</tr>
</tbody></table>
<h3 id="只写性能对比-oltp-write-only"><a href="#只写性能对比-oltp-write-only" class="headerlink" title="只写性能对比 (oltp_write_only)"></a>只写性能对比 (oltp_write_only)</h3><table>
<thead>
<tr>
<th>环境</th>
<th>1线程</th>
<th>8线程</th>
<th>16线程</th>
<th>32线程</th>
<th>64线程</th>
<th>128线程</th>
</tr>
</thead>
<tbody><tr>
<td><strong>idc</strong></td>
<td>19,282</td>
<td>77,540</td>
<td>94,457</td>
<td>88,015</td>
<td>103,249</td>
<td>115,778</td>
</tr>
<tr>
<td><strong>idc.trx1</strong></td>
<td>15,367</td>
<td>61,477</td>
<td>78,108</td>
<td>82,004</td>
<td>97,106</td>
<td>108,842</td>
</tr>
<tr>
<td><strong>huawei</strong></td>
<td>4,930</td>
<td>30,173</td>
<td>49,163</td>
<td>70,800</td>
<td>85,898</td>
<td>64,958</td>
</tr>
<tr>
<td><strong>aliyun</strong></td>
<td>12,484</td>
<td>61,401</td>
<td>90,134</td>
<td>101,548</td>
<td>110,923</td>
<td>121,385</td>
</tr>
<tr>
<td><strong>aliyun.trx1</strong></td>
<td>6,909</td>
<td>38,470</td>
<td>57,604</td>
<td>88,163</td>
<td>112,561</td>
<td>105,554</td>
</tr>
<tr>
<td><strong>aliyun.trx1.repl</strong></td>
<td>5,832</td>
<td>27,926</td>
<td>36,521</td>
<td>52,252</td>
<td>86,217</td>
<td>95,690</td>
</tr>
<tr>
<td><strong>ali.repl.rtt0.7</strong></td>
<td>4,876</td>
<td>26,828</td>
<td>41,624</td>
<td>57,505</td>
<td>76,301</td>
<td>86,433</td>
</tr>
<tr>
<td><strong>aws.io2.trx1</strong></td>
<td>3,575</td>
<td>21,479</td>
<td>37,696</td>
<td>59,664</td>
<td>76,279</td>
<td>79,531</td>
</tr>
<tr>
<td><strong>aws.io2</strong></td>
<td>8,881</td>
<td>44,059</td>
<td>64,137</td>
<td>79,024</td>
<td>79,754</td>
<td>70,019</td>
</tr>
<tr>
<td><strong>aws.io1</strong></td>
<td>1,786</td>
<td>19,047</td>
<td>39,006</td>
<td>68,442</td>
<td>94,216</td>
<td>66,370</td>
</tr>
<tr>
<td><strong>aws.gp3</strong></td>
<td>1,689</td>
<td>17,630</td>
<td>34,757</td>
<td>36,656</td>
<td>43,519</td>
<td>52,980</td>
</tr>
</tbody></table>
<h3 id="读写混合性能对比-oltp-read-write"><a href="#读写混合性能对比-oltp-read-write" class="headerlink" title="读写混合性能对比 (oltp_read_write)"></a>读写混合性能对比 (oltp_read_write)</h3><table>
<thead>
<tr>
<th>环境</th>
<th>1线程</th>
<th>8线程</th>
<th>16线程</th>
<th>32线程</th>
<th>64线程</th>
<th>128线程</th>
</tr>
</thead>
<tbody><tr>
<td><strong>idc</strong></td>
<td>9,208</td>
<td>49,874</td>
<td>64,265</td>
<td>68,103</td>
<td>69,255</td>
<td>69,969</td>
</tr>
<tr>
<td><strong>idc.trx1</strong></td>
<td>7,297</td>
<td>45,183</td>
<td>58,254</td>
<td>63,486</td>
<td>65,714</td>
<td>67,345</td>
</tr>
<tr>
<td><strong>huawei</strong></td>
<td>3,728</td>
<td>25,512</td>
<td>40,124</td>
<td>49,743</td>
<td>51,940</td>
<td>52,357</td>
</tr>
<tr>
<td><strong>aliyun</strong></td>
<td>7,952</td>
<td>51,194</td>
<td>71,761</td>
<td>81,858</td>
<td>83,569</td>
<td>82,403</td>
</tr>
<tr>
<td><strong>aliyun.trx1</strong></td>
<td>6,868</td>
<td>44,801</td>
<td>66,062</td>
<td>78,590</td>
<td>83,049</td>
<td>84,131</td>
</tr>
<tr>
<td><strong>aliyun.trx1.repl</strong></td>
<td>8,125</td>
<td>51,348</td>
<td>76,515</td>
<td>98,436</td>
<td>109,191</td>
<td>111,512</td>
</tr>
<tr>
<td><strong>ali.repl.rtt0.7</strong></td>
<td>6,225</td>
<td>39,379</td>
<td>62,234</td>
<td>74,702</td>
<td>78,823</td>
<td>0</td>
</tr>
<tr>
<td><strong>aws.io2.trx1</strong></td>
<td>5,074</td>
<td>29,077</td>
<td>41,737</td>
<td>47,906</td>
<td>49,160</td>
<td>50,050</td>
</tr>
<tr>
<td><strong>aws.io2</strong></td>
<td>6,743</td>
<td>35,997</td>
<td>45,274</td>
<td>50,664</td>
<td>51,002</td>
<td>50,315</td>
</tr>
<tr>
<td><strong>aws.io1</strong></td>
<td>1,924</td>
<td>24,967</td>
<td>54,742</td>
<td>68,211</td>
<td>71,816</td>
<td>70,575</td>
</tr>
<tr>
<td><strong>aws.gp3</strong></td>
<td>1,741</td>
<td>19,019</td>
<td>42,144</td>
<td>60,885</td>
<td>64,869</td>
<td>63,936</td>
</tr>
</tbody></table>
<h3 id="只读性能对比-oltp-read-only"><a href="#只读性能对比-oltp-read-only" class="headerlink" title="只读性能对比 (oltp_read_only)"></a>只读性能对比 (oltp_read_only)</h3><table>
<thead>
<tr>
<th>环境</th>
<th>1线程</th>
<th>8线程</th>
<th>16线程</th>
<th>32线程</th>
<th>64线程</th>
<th>128线程</th>
</tr>
</thead>
<tbody><tr>
<td><strong>idc</strong></td>
<td>11,527</td>
<td>58,919</td>
<td>73,087</td>
<td>74,820</td>
<td>74,631</td>
<td>73,444</td>
</tr>
<tr>
<td><strong>idc.trx1</strong></td>
<td>10,803</td>
<td>60,145</td>
<td>71,110</td>
<td>73,527</td>
<td>73,290</td>
<td>72,280</td>
</tr>
<tr>
<td><strong>huawei</strong></td>
<td>4,433</td>
<td>27,454</td>
<td>41,995</td>
<td>49,173</td>
<td>51,212</td>
<td>51,027</td>
</tr>
<tr>
<td><strong>aliyun</strong></td>
<td>9,389</td>
<td>60,278</td>
<td>76,662</td>
<td>84,123</td>
<td>85,224</td>
<td>85,054</td>
</tr>
<tr>
<td><strong>aliyun.trx1</strong></td>
<td>9,311</td>
<td>59,695</td>
<td>76,820</td>
<td>84,023</td>
<td>85,283</td>
<td>85,127</td>
</tr>
<tr>
<td><strong>aliyun.trx1.repl</strong></td>
<td>11,207</td>
<td>73,855</td>
<td>103,284</td>
<td>120,653</td>
<td>125,685</td>
<td>122,608</td>
</tr>
<tr>
<td><strong>ali.repl.rtt0.7</strong></td>
<td>9,124</td>
<td>55,926</td>
<td>73,447</td>
<td>81,446</td>
<td>83,524</td>
<td>83,351</td>
</tr>
<tr>
<td><strong>aws.io2.trx1</strong></td>
<td>7,068</td>
<td>39,993</td>
<td>47,383</td>
<td>50,146</td>
<td>49,763</td>
<td>49,209</td>
</tr>
<tr>
<td><strong>aws.io2</strong></td>
<td>7,039</td>
<td>39,720</td>
<td>47,558</td>
<td>49,995</td>
<td>49,821</td>
<td>49,165</td>
</tr>
<tr>
<td><strong>aws.io1</strong></td>
<td>1,845</td>
<td>28,879</td>
<td>64,551</td>
<td>73,173</td>
<td>74,400</td>
<td>74,024</td>
</tr>
<tr>
<td><strong>aws.gp3</strong></td>
<td>1,692</td>
<td>31,915</td>
<td>59,828</td>
<td>66,972</td>
<td>67,678</td>
<td>67,480</td>
</tr>
</tbody></table>
<hr>
<h2 id="📈-延迟分析"><a href="#📈-延迟分析" class="headerlink" title="📈 延迟分析"></a>📈 延迟分析</h2><h3 id="点查询延迟对比-95-分位-ms"><a href="#点查询延迟对比-95-分位-ms" class="headerlink" title="点查询延迟对比 (95%分位, ms)"></a>点查询延迟对比 (95%分位, ms)</h3><table>
<thead>
<tr>
<th>环境</th>
<th>1线程</th>
<th>8线程</th>
<th>16线程</th>
<th>32线程</th>
<th>64线程</th>
<th>128线程</th>
</tr>
</thead>
<tbody><tr>
<td><strong>idc</strong></td>
<td>0.04</td>
<td>0.06</td>
<td>0.10</td>
<td>0.16</td>
<td>0.32</td>
<td>0.61</td>
</tr>
<tr>
<td><strong>idc.trx1</strong></td>
<td>0.26</td>
<td>0.23</td>
<td>0.13</td>
<td>0.18</td>
<td>0.31</td>
<td>0.62</td>
</tr>
<tr>
<td><strong>huawei</strong></td>
<td>0.17</td>
<td>0.19</td>
<td>0.21</td>
<td>0.31</td>
<td>0.48</td>
<td>0.94</td>
</tr>
<tr>
<td><strong>aliyun</strong></td>
<td>0.07</td>
<td>0.08</td>
<td>0.10</td>
<td>0.16</td>
<td>0.29</td>
<td>0.59</td>
</tr>
<tr>
<td><strong>aliyun.trx1</strong></td>
<td>0.07</td>
<td>0.08</td>
<td>0.10</td>
<td>0.16</td>
<td>0.29</td>
<td>0.58</td>
</tr>
<tr>
<td><strong>aliyun.trx1.repl</strong></td>
<td>0.06</td>
<td>0.09</td>
<td>0.11</td>
<td>0.18</td>
<td>0.30</td>
<td>0.60</td>
</tr>
<tr>
<td><strong>ali.repl.rtt0.7</strong></td>
<td>0.07</td>
<td>0.09</td>
<td>0.12</td>
<td>0.19</td>
<td>0.54</td>
<td>1.12</td>
</tr>
<tr>
<td><strong>aws.io2.trx1</strong></td>
<td>0.09</td>
<td>0.12</td>
<td>0.18</td>
<td>0.32</td>
<td>0.56</td>
<td>1.06</td>
</tr>
<tr>
<td><strong>aws.io2</strong></td>
<td>0.09</td>
<td>0.12</td>
<td>0.18</td>
<td>0.32</td>
<td>0.55</td>
<td>1.08</td>
</tr>
<tr>
<td><strong>aws.io1</strong></td>
<td>0.72</td>
<td>0.49</td>
<td>0.13</td>
<td>0.20</td>
<td>0.36</td>
<td>0.72</td>
</tr>
<tr>
<td><strong>aws.gp3</strong></td>
<td>0.67</td>
<td>0.46</td>
<td>0.14</td>
<td>0.23</td>
<td>0.39</td>
<td>0.78</td>
</tr>
</tbody></table>
<h3 id="读写混合延迟对比-95-分位-ms"><a href="#读写混合延迟对比-95-分位-ms" class="headerlink" title="读写混合延迟对比 (95%分位, ms)"></a>读写混合延迟对比 (95%分位, ms)</h3><table>
<thead>
<tr>
<th>环境</th>
<th>1线程</th>
<th>8线程</th>
<th>16线程</th>
<th>32线程</th>
<th>64线程</th>
<th>128线程</th>
</tr>
</thead>
<tbody><tr>
<td><strong>idc</strong></td>
<td>2.81</td>
<td>4.82</td>
<td>8.74</td>
<td>15.27</td>
<td>36.24</td>
<td>80.03</td>
</tr>
<tr>
<td><strong>idc.trx1</strong></td>
<td>3.49</td>
<td>5.28</td>
<td>8.58</td>
<td>15.83</td>
<td>36.24</td>
<td>75.82</td>
</tr>
<tr>
<td><strong>huawei</strong></td>
<td>6.79</td>
<td>8.43</td>
<td>11.45</td>
<td>20.00</td>
<td>49.21</td>
<td>106.75</td>
</tr>
<tr>
<td><strong>aliyun</strong></td>
<td>3.30</td>
<td>4.10</td>
<td>6.32</td>
<td>11.65</td>
<td>29.72</td>
<td>86.00</td>
</tr>
<tr>
<td><strong>aliyun.trx1</strong></td>
<td>3.68</td>
<td>4.65</td>
<td>6.55</td>
<td>11.45</td>
<td>25.28</td>
<td>94.10</td>
</tr>
<tr>
<td><strong>aliyun.trx1.repl</strong></td>
<td>2.86</td>
<td>3.89</td>
<td>5.18</td>
<td>8.58</td>
<td>17.95</td>
<td>38.25</td>
</tr>
<tr>
<td><strong>ali.repl.rtt0.7</strong></td>
<td>3.96</td>
<td>5.00</td>
<td>6.55</td>
<td>12.08</td>
<td>27.66</td>
<td>0.00</td>
</tr>
<tr>
<td><strong>aws.io2.trx1</strong></td>
<td>4.82</td>
<td>6.79</td>
<td>10.09</td>
<td>19.29</td>
<td>50.11</td>
<td>125.52</td>
</tr>
<tr>
<td><strong>aws.io2</strong></td>
<td>3.89</td>
<td>5.88</td>
<td>10.65</td>
<td>19.65</td>
<td>47.47</td>
<td>139.85</td>
</tr>
<tr>
<td><strong>aws.io1</strong></td>
<td>13.95</td>
<td>9.73</td>
<td>9.06</td>
<td>13.70</td>
<td>29.72</td>
<td>106.75</td>
</tr>
<tr>
<td><strong>aws.gp3</strong></td>
<td>15.00</td>
<td>17.32</td>
<td>15.00</td>
<td>15.83</td>
<td>33.72</td>
<td>116.80</td>
</tr>
</tbody></table>
<h3 id="只写延迟对比-95-分位-ms"><a href="#只写延迟对比-95-分位-ms" class="headerlink" title="只写延迟对比 (95%分位, ms)"></a>只写延迟对比 (95%分位, ms)</h3><table>
<thead>
<tr>
<th>环境</th>
<th>1线程</th>
<th>8线程</th>
<th>16线程</th>
<th>32线程</th>
<th>64线程</th>
<th>128线程</th>
</tr>
</thead>
<tbody><tr>
<td><strong>idc</strong></td>
<td>0.52</td>
<td>0.94</td>
<td>1.76</td>
<td>4.18</td>
<td>8.74</td>
<td>16.12</td>
</tr>
<tr>
<td><strong>idc.trx1</strong></td>
<td>0.63</td>
<td>1.18</td>
<td>2.00</td>
<td>4.10</td>
<td>8.13</td>
<td>14.46</td>
</tr>
<tr>
<td><strong>huawei</strong></td>
<td>2.35</td>
<td>2.86</td>
<td>3.49</td>
<td>5.00</td>
<td>8.90</td>
<td>17.95</td>
</tr>
<tr>
<td><strong>aliyun</strong></td>
<td>0.99</td>
<td>1.37</td>
<td>1.70</td>
<td>2.86</td>
<td>7.17</td>
<td>23.95</td>
</tr>
<tr>
<td><strong>aliyun.trx1</strong></td>
<td>1.37</td>
<td>1.93</td>
<td>2.43</td>
<td>3.13</td>
<td>4.74</td>
<td>9.22</td>
</tr>
<tr>
<td><strong>aliyun.trx1.repl</strong></td>
<td>1.44</td>
<td>2.43</td>
<td>3.43</td>
<td>4.82</td>
<td>6.55</td>
<td>12.08</td>
</tr>
<tr>
<td><strong>ali.repl.rtt0.7</strong></td>
<td>1.47</td>
<td>2.26</td>
<td>2.91</td>
<td>4.49</td>
<td>7.43</td>
<td>13.22</td>
</tr>
<tr>
<td><strong>aws.io2.trx1</strong></td>
<td>2.57</td>
<td>3.07</td>
<td>3.49</td>
<td>4.41</td>
<td>7.30</td>
<td>14.46</td>
</tr>
<tr>
<td><strong>aws.io2</strong></td>
<td>1.61</td>
<td>2.00</td>
<td>2.52</td>
<td>4.25</td>
<td>13.70</td>
<td>38.94</td>
</tr>
<tr>
<td><strong>aws.io1</strong></td>
<td>5.09</td>
<td>4.82</td>
<td>4.65</td>
<td>5.37</td>
<td>7.70</td>
<td>24.38</td>
</tr>
<tr>
<td><strong>aws.gp3</strong></td>
<td>5.99</td>
<td>5.67</td>
<td>5.67</td>
<td>15.00</td>
<td>29.72</td>
<td>44.98</td>
</tr>
</tbody></table>
<hr>
<h2 id="💡-关键发现"><a href="#💡-关键发现" class="headerlink" title="💡 关键发现"></a>💡 关键发现</h2><h3 id="性能特点"><a href="#性能特点" class="headerlink" title="性能特点"></a>性能特点</h3><ol>
<li><p><strong>CPU架构影响</strong></p>
<ul>
<li>不同CPU架构在各场景下表现差异明显</li>
<li>单核性能对点查询场景影响显著</li>
</ul>
</li>
<li><p><strong>事务持久化设置</strong></p>
<ul>
<li>innodb_flush_log_at_trx_commit&#x3D;1 vs 2 对写入性能影响明显</li>
<li>建议根据业务对数据安全性要求选择合适配置</li>
</ul>
</li>
<li><p><strong>并发扩展性</strong></p>
<ul>
<li>各环境在不同并发级别下的扩展性表现不同</li>
<li>需要根据实际业务并发选择合适的硬件配置</li>
</ul>
</li>
<li><p><strong>延迟控制</strong></p>
<ul>
<li>高并发下延迟控制能力体现系统稳定性</li>
<li>95%分位延迟是衡量用户体验的重要指标</li>
</ul>
</li>
</ol>
<h3 id="环境推荐"><a href="#环境推荐" class="headerlink" title="环境推荐"></a>环境推荐</h3><ul>
<li><strong>查询密集型业务</strong>: 推荐 <strong>aliyun.trx1</strong> 环境</li>
<li><strong>写入密集型业务</strong>: 推荐 <strong>aliyun</strong> 环境</li>
<li><strong>混合负载</strong>: 需要综合考虑QPS、延迟和成本</li>
</ul>
<hr>
<h2 id="📊-64线程性能对比"><a href="#📊-64线程性能对比" class="headerlink" title="📊 64线程性能对比"></a>📊 64线程性能对比</h2><table>
<thead>
<tr>
<th>测试场景</th>
<th>idc</th>
<th>idc.trx1</th>
<th>huawei</th>
<th>aliyun</th>
<th>aliyun.trx1</th>
<th>aliyun.trx1.repl</th>
<th>ali.repl.rtt0.7</th>
<th>aws.io2.trx1</th>
<th>aws.io2</th>
<th>aws.io1</th>
<th>aws.gp3</th>
</tr>
</thead>
<tbody><tr>
<td><strong>点查询</strong></td>
<td>299,555</td>
<td>297,696</td>
<td>196,915</td>
<td>328,098</td>
<td>326,549</td>
<td>329,548</td>
<td>271,234</td>
<td>162,516</td>
<td>157,480</td>
<td>249,718</td>
<td>228,321</td>
</tr>
<tr>
<td><strong>只读</strong></td>
<td>74,631</td>
<td>73,290</td>
<td>51,212</td>
<td>85,224</td>
<td>85,283</td>
<td>125,685</td>
<td>83,524</td>
<td>49,763</td>
<td>49,821</td>
<td>74,400</td>
<td>67,678</td>
</tr>
<tr>
<td><strong>读写混合</strong></td>
<td>69,255</td>
<td>65,714</td>
<td>51,940</td>
<td>83,569</td>
<td>83,049</td>
<td>109,191</td>
<td>78,823</td>
<td>49,160</td>
<td>51,002</td>
<td>71,816</td>
<td>64,869</td>
</tr>
<tr>
<td><strong>只写</strong></td>
<td>103,249</td>
<td>97,106</td>
<td>85,898</td>
<td>110,923</td>
<td>112,561</td>
<td>86,217</td>
<td>76,301</td>
<td>76,279</td>
<td>79,754</td>
<td>94,216</td>
<td>43,519</td>
</tr>
</tbody></table>
<hr>
<h1 id="第一章：idc-环境详细报告"><a href="#第一章：idc-环境详细报告" class="headerlink" title="第一章：idc 环境详细报告"></a>第一章：idc 环境详细报告</h1><p><strong>测试时间</strong>: 2025-11-27 10:28:39<br><strong>测试工具</strong>: sysbench + tsar (按时间段精确匹配)<br><strong>tsar数据样本</strong>: 51706 条记录  </p>
<h2 id="测试配置信息"><a href="#测试配置信息" class="headerlink" title="测试配置信息"></a>测试配置信息</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">=== 测试配置信息 ===</span><br><span class="line">MYSQL_HOST: 10.9.10.145</span><br><span class="line">MYSQL_PORT: 3306</span><br><span class="line">TABLES: 16</span><br><span class="line">TABLE_SIZE: 10000000</span><br><span class="line">TEST_TIME: 30</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="MySQL配置参数"><a href="#MySQL配置参数" class="headerlink" title="MySQL配置参数"></a>MySQL配置参数</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mysql: [Warning] Using a password on the command line interface can be insecure.</span><br><span class="line">Variable_name	Value</span><br><span class="line">innodb_buffer_pool_size	17179869184</span><br><span class="line">innodb_flush_log_at_trx_commit	2</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="压测服务器配置"><a href="#压测服务器配置" class="headerlink" title="压测服务器配置"></a>压测服务器配置</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">=== CPU 信息 ===</span><br><span class="line">Architecture:          x86_64</span><br><span class="line">CPU op-mode(s):        32-bit, 64-bit</span><br><span class="line">Byte Order:            Little Endian</span><br><span class="line">CPU(s):                48</span><br><span class="line">On-line CPU(s) list:   0-47</span><br><span class="line">Thread(s) per core:    2</span><br><span class="line">Core(s) per socket:    12</span><br><span class="line">座：                 2</span><br><span class="line">NUMA 节点：         2</span><br><span class="line">厂商 ID：           GenuineIntel</span><br><span class="line">CPU 系列：          6</span><br><span class="line">型号：              143</span><br><span class="line">型号名称：        INTEL(R) XEON(R) SILVER 4510</span><br><span class="line">步进：              8</span><br><span class="line">CPU MHz：             2400.000</span><br><span class="line">BogoMIPS：            4800.00</span><br><span class="line">虚拟化：           VT-x</span><br><span class="line">L1d 缓存：          48K</span><br><span class="line">L1i 缓存：          32K</span><br><span class="line">L2 缓存：           2048K</span><br><span class="line">L3 缓存：           30720K</span><br><span class="line">NUMA 节点0 CPU：    0,2,4,6,8,10,12,14,16,18,20,22,24,26,28,30,32,34,36,38,40,42,44,46</span><br><span class="line">NUMA 节点1 CPU：    1,3,5,7,9,11,13,15,17,19,21,23,25,27,29,31,33,35,37,39,41,43,45,47</span><br><span class="line">Flags:                 fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov pat pse36 clflush dts acpi mmx fxsr sse sse2 ss ht tm pbe syscall nx pdpe1gb rdtscp lm constant_tsc art arch_perfmon pebs bts rep_good nopl xtopology nonstop_tsc aperfmperf eagerfpu pni pclmulqdq dtes64 monitor ds_cpl vmx smx est tm2 ssse3 sdbg fma cx16 xtpr pdcm pcid dca sse4_1 sse4_2 x2apic movbe popcnt tsc_deadline_timer aes xsave avx f16c rdrand lahf_lm abm 3dnowprefetch epb cat_l3 cat_l2 cdp_l3 invpcid_single intel_pt cdp_l2 ssbd mba ibrs ibpb stibp ibrs_enhanced tpr_shadow vnmi flexpriority ept vpid fsgsbase tsc_adjust bmi1 hle avx2 smep bmi2 erms invpcid rtm cqm rdt_a avx512f avx512dq rdseed adx smap avx512ifma clflushopt clwb avx512cd sha_ni avx512bw avx512vl xsaveopt xsavec xgetbv1 cqm_llc cqm_occup_llc cqm_mbm_total cqm_mbm_local dtherm ida arat pln pts avx512vbmi umip pku ospke avx512_vbmi2 gfni vaes vpclmulqdq avx512_vnni avx512_bitalg avx512_vpopcntdq cldemote movdiri movdir64b md_clear pconfig spec_ctrl intel_stibp flush_l1d arch_capabilities</span><br><span class="line"></span><br><span class="line">=== 内存信息 ===</span><br><span class="line">              total        used        free      shared  buff/cache   available</span><br><span class="line">Mem:           376G         47G        257G        1.7G         71G        326G</span><br><span class="line">Swap:            0B          0B          0B</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="性能测试结果汇总-含CPU-IO监控数据"><a href="#性能测试结果汇总-含CPU-IO监控数据" class="headerlink" title="性能测试结果汇总 (含CPU&#x2F;IO监控数据)"></a>性能测试结果汇总 (含CPU&#x2F;IO监控数据)</h2><table>
<thead>
<tr>
<th>测试场景</th>
<th>并发数</th>
<th>QPS</th>
<th>TPS</th>
<th>平均延迟(ms)</th>
<th>95%延迟(ms)</th>
<th>CPU软中断(%)</th>
<th>CPU用户(%)</th>
<th>CPU系统(%)</th>
<th>CPU等待(%)</th>
<th>IO利用率(%)</th>
<th>测试时间段</th>
</tr>
</thead>
<tbody><tr>
<td>oltp_point_select</td>
<td>1</td>
<td>24,725</td>
<td>24,725</td>
<td>0.04</td>
<td>0.04</td>
<td>0.0</td>
<td>0.6</td>
<td>0.6</td>
<td>0.2</td>
<td>11.6</td>
<td>2025-11-24 08:56:53 ~ 2025-11-24 08:57:23</td>
</tr>
<tr>
<td>oltp_point_select</td>
<td>8</td>
<td>159,877</td>
<td>159,877</td>
<td>0.05</td>
<td>0.06</td>
<td>0.4</td>
<td>4.8</td>
<td>2.9</td>
<td>1.0</td>
<td>51.9</td>
<td>2025-11-24 08:57:25 ~ 2025-11-24 08:57:55</td>
</tr>
<tr>
<td>oltp_point_select</td>
<td>16</td>
<td>252,082</td>
<td>252,082</td>
<td>0.06</td>
<td>0.10</td>
<td>0.6</td>
<td>8.1</td>
<td>4.8</td>
<td>0.6</td>
<td>56.9</td>
<td>2025-11-24 08:57:57 ~ 2025-11-24 08:58:27</td>
</tr>
<tr>
<td>oltp_point_select</td>
<td>32</td>
<td>304,631</td>
<td>304,631</td>
<td>0.10</td>
<td>0.16</td>
<td>0.9</td>
<td>10.3</td>
<td>5.8</td>
<td>0.0</td>
<td>42.3</td>
<td>2025-11-24 08:58:29 ~ 2025-11-24 08:58:59</td>
</tr>
<tr>
<td>oltp_point_select</td>
<td>64</td>
<td>299,555</td>
<td>299,555</td>
<td>0.21</td>
<td>0.32</td>
<td>1.1</td>
<td>10.4</td>
<td>5.7</td>
<td>0.0</td>
<td>30.0</td>
<td>2025-11-24 08:59:01 ~ 2025-11-24 08:59:31</td>
</tr>
<tr>
<td>oltp_point_select</td>
<td>128</td>
<td>287,407</td>
<td>287,407</td>
<td>0.45</td>
<td>0.61</td>
<td>1.0</td>
<td>10.5</td>
<td>5.7</td>
<td>0.0</td>
<td>22.0</td>
<td>2025-11-24 08:59:33 ~ 2025-11-24 09:00:03</td>
</tr>
<tr>
<td>oltp_read_only</td>
<td>1</td>
<td>11,527</td>
<td>720</td>
<td>1.39</td>
<td>1.61</td>
<td>0.0</td>
<td>1.3</td>
<td>0.4</td>
<td>0.0</td>
<td>1.0</td>
<td>2025-11-24 09:00:05 ~ 2025-11-24 09:00:35</td>
</tr>
<tr>
<td>oltp_read_only</td>
<td>8</td>
<td>58,919</td>
<td>3,682</td>
<td>2.17</td>
<td>3.30</td>
<td>0.3</td>
<td>9.5</td>
<td>1.2</td>
<td>0.1</td>
<td>4.8</td>
<td>2025-11-24 09:00:37 ~ 2025-11-24 09:01:07</td>
</tr>
<tr>
<td>oltp_read_only</td>
<td>16</td>
<td>73,087</td>
<td>4,568</td>
<td>3.50</td>
<td>5.28</td>
<td>0.2</td>
<td>13.8</td>
<td>1.6</td>
<td>0.0</td>
<td>5.7</td>
<td>2025-11-24 09:01:09 ~ 2025-11-24 09:01:39</td>
</tr>
<tr>
<td>oltp_read_only</td>
<td>32</td>
<td>74,820</td>
<td>4,676</td>
<td>6.84</td>
<td>9.73</td>
<td>0.3</td>
<td>14.7</td>
<td>1.6</td>
<td>0.0</td>
<td>5.5</td>
<td>2025-11-24 09:01:41 ~ 2025-11-24 09:02:11</td>
</tr>
<tr>
<td>oltp_read_only</td>
<td>64</td>
<td>74,631</td>
<td>4,664</td>
<td>13.72</td>
<td>17.01</td>
<td>0.3</td>
<td>14.7</td>
<td>1.6</td>
<td>0.0</td>
<td>4.9</td>
<td>2025-11-24 09:02:13 ~ 2025-11-24 09:02:43</td>
</tr>
<tr>
<td>oltp_read_only</td>
<td>128</td>
<td>73,444</td>
<td>4,590</td>
<td>27.88</td>
<td>33.12</td>
<td>0.3</td>
<td>14.6</td>
<td>1.7</td>
<td>0.0</td>
<td>4.8</td>
<td>2025-11-24 09:02:45 ~ 2025-11-24 09:03:15</td>
</tr>
<tr>
<td>oltp_read_write</td>
<td>1</td>
<td>9,208</td>
<td>460</td>
<td>2.17</td>
<td>2.81</td>
<td>0.0</td>
<td>1.7</td>
<td>0.8</td>
<td>0.2</td>
<td>29.3</td>
<td>2025-11-24 09:03:17 ~ 2025-11-24 09:03:47</td>
</tr>
<tr>
<td>oltp_read_write</td>
<td>8</td>
<td>49,874</td>
<td>2,494</td>
<td>3.21</td>
<td>4.82</td>
<td>0.2</td>
<td>10.0</td>
<td>2.0</td>
<td>0.4</td>
<td>52.4</td>
<td>2025-11-24 09:03:49 ~ 2025-11-24 09:04:19</td>
</tr>
<tr>
<td>oltp_read_write</td>
<td>16</td>
<td>64,265</td>
<td>3,213</td>
<td>4.98</td>
<td>8.74</td>
<td>0.3</td>
<td>12.8</td>
<td>2.1</td>
<td>0.2</td>
<td>38.9</td>
<td>2025-11-24 09:04:21 ~ 2025-11-24 09:04:51</td>
</tr>
<tr>
<td>oltp_read_write</td>
<td>32</td>
<td>68,103</td>
<td>3,405</td>
<td>9.39</td>
<td>15.27</td>
<td>0.2</td>
<td>13.8</td>
<td>2.1</td>
<td>0.0</td>
<td>36.2</td>
<td>2025-11-24 09:04:53 ~ 2025-11-24 09:05:23</td>
</tr>
<tr>
<td>oltp_read_write</td>
<td>64</td>
<td>69,255</td>
<td>3,463</td>
<td>18.48</td>
<td>36.24</td>
<td>0.3</td>
<td>13.9</td>
<td>2.0</td>
<td>0.0</td>
<td>33.9</td>
<td>2025-11-24 09:05:25 ~ 2025-11-24 09:05:55</td>
</tr>
<tr>
<td>oltp_read_write</td>
<td>128</td>
<td>69,969</td>
<td>3,498</td>
<td>36.57</td>
<td>80.03</td>
<td>0.3</td>
<td>13.8</td>
<td>2.0</td>
<td>0.0</td>
<td>31.4</td>
<td>2025-11-24 09:05:57 ~ 2025-11-24 09:06:28</td>
</tr>
<tr>
<td>oltp_write_only</td>
<td>1</td>
<td>19,282</td>
<td>3,214</td>
<td>0.31</td>
<td>0.52</td>
<td>0.0</td>
<td>2.0</td>
<td>1.0</td>
<td>0.1</td>
<td>8.9</td>
<td>2025-11-24 09:06:30 ~ 2025-11-24 09:07:00</td>
</tr>
<tr>
<td>oltp_write_only</td>
<td>8</td>
<td>77,540</td>
<td>12,923</td>
<td>0.62</td>
<td>0.94</td>
<td>0.3</td>
<td>8.6</td>
<td>2.8</td>
<td>0.2</td>
<td>25.3</td>
<td>2025-11-24 09:07:02 ~ 2025-11-24 09:07:32</td>
</tr>
<tr>
<td>oltp_write_only</td>
<td>16</td>
<td>94,457</td>
<td>15,743</td>
<td>1.02</td>
<td>1.76</td>
<td>0.4</td>
<td>11.1</td>
<td>3.3</td>
<td>0.1</td>
<td>31.3</td>
<td>2025-11-24 09:07:34 ~ 2025-11-24 09:08:04</td>
</tr>
<tr>
<td>oltp_write_only</td>
<td>32</td>
<td>88,015</td>
<td>14,669</td>
<td>2.18</td>
<td>4.18</td>
<td>0.4</td>
<td>10.4</td>
<td>3.2</td>
<td>0.1</td>
<td>41.4</td>
<td>2025-11-24 09:08:06 ~ 2025-11-24 09:08:36</td>
</tr>
<tr>
<td>oltp_write_only</td>
<td>64</td>
<td>103,249</td>
<td>17,208</td>
<td>3.72</td>
<td>8.74</td>
<td>0.4</td>
<td>11.7</td>
<td>3.2</td>
<td>0.1</td>
<td>37.7</td>
<td>2025-11-24 09:08:38 ~ 2025-11-24 09:09:08</td>
</tr>
<tr>
<td>oltp_write_only</td>
<td>128</td>
<td>115,778</td>
<td>19,296</td>
<td>6.63</td>
<td>16.12</td>
<td>0.5</td>
<td>12.4</td>
<td>3.4</td>
<td>0.1</td>
<td>39.6</td>
<td>2025-11-24 09:09:10 ~ 2025-11-24 09:09:40</td>
</tr>
</tbody></table>
<hr>
<hr>
<h1 id="第二章：idc-trx1-环境详细报告"><a href="#第二章：idc-trx1-环境详细报告" class="headerlink" title="第二章：idc.trx1 环境详细报告"></a>第二章：idc.trx1 环境详细报告</h1><p><strong>测试时间</strong>: 2025-11-27 10:29:01<br><strong>测试工具</strong>: sysbench + tsar (按时间段精确匹配)<br><strong>tsar数据样本</strong>: 50627 条记录  </p>
<h2 id="测试配置信息-1"><a href="#测试配置信息-1" class="headerlink" title="测试配置信息"></a>测试配置信息</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">=== 测试配置信息 ===</span><br><span class="line">MYSQL_HOST: 10.9.10.145</span><br><span class="line">MYSQL_PORT: 3306</span><br><span class="line">TABLES: 16</span><br><span class="line">TABLE_SIZE: 10000000</span><br><span class="line">TEST_TIME: 30</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="MySQL配置参数-1"><a href="#MySQL配置参数-1" class="headerlink" title="MySQL配置参数"></a>MySQL配置参数</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mysql: [Warning] Using a password on the command line interface can be insecure.</span><br><span class="line">Variable_name	Value</span><br><span class="line">innodb_buffer_pool_size	17179869184</span><br><span class="line">innodb_flush_log_at_trx_commit	1</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="压测服务器配置-1"><a href="#压测服务器配置-1" class="headerlink" title="压测服务器配置"></a>压测服务器配置</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">=== CPU 信息 ===</span><br><span class="line">Architecture:          x86_64</span><br><span class="line">CPU op-mode(s):        32-bit, 64-bit</span><br><span class="line">Byte Order:            Little Endian</span><br><span class="line">CPU(s):                48</span><br><span class="line">On-line CPU(s) list:   0-47</span><br><span class="line">Thread(s) per core:    2</span><br><span class="line">Core(s) per socket:    12</span><br><span class="line">座：                 2</span><br><span class="line">NUMA 节点：         2</span><br><span class="line">厂商 ID：           GenuineIntel</span><br><span class="line">CPU 系列：          6</span><br><span class="line">型号：              143</span><br><span class="line">型号名称：        INTEL(R) XEON(R) SILVER 4510</span><br><span class="line">步进：              8</span><br><span class="line">CPU MHz：             2400.000</span><br><span class="line">BogoMIPS：            4800.00</span><br><span class="line">虚拟化：           VT-x</span><br><span class="line">L1d 缓存：          48K</span><br><span class="line">L1i 缓存：          32K</span><br><span class="line">L2 缓存：           2048K</span><br><span class="line">L3 缓存：           30720K</span><br><span class="line">NUMA 节点0 CPU：    0,2,4,6,8,10,12,14,16,18,20,22,24,26,28,30,32,34,36,38,40,42,44,46</span><br><span class="line">NUMA 节点1 CPU：    1,3,5,7,9,11,13,15,17,19,21,23,25,27,29,31,33,35,37,39,41,43,45,47</span><br><span class="line">Flags:                 fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov pat pse36 clflush dts acpi mmx fxsr sse sse2 ss ht tm pbe syscall nx pdpe1gb rdtscp lm constant_tsc art arch_perfmon pebs bts rep_good nopl xtopology nonstop_tsc aperfmperf eagerfpu pni pclmulqdq dtes64 monitor ds_cpl vmx smx est tm2 ssse3 sdbg fma cx16 xtpr pdcm pcid dca sse4_1 sse4_2 x2apic movbe popcnt tsc_deadline_timer aes xsave avx f16c rdrand lahf_lm abm 3dnowprefetch epb cat_l3 cat_l2 cdp_l3 invpcid_single intel_pt cdp_l2 ssbd mba ibrs ibpb stibp ibrs_enhanced tpr_shadow vnmi flexpriority ept vpid fsgsbase tsc_adjust bmi1 hle avx2 smep bmi2 erms invpcid rtm cqm rdt_a avx512f avx512dq rdseed adx smap avx512ifma clflushopt clwb avx512cd sha_ni avx512bw avx512vl xsaveopt xsavec xgetbv1 cqm_llc cqm_occup_llc cqm_mbm_total cqm_mbm_local dtherm ida arat pln pts avx512vbmi umip pku ospke avx512_vbmi2 gfni vaes vpclmulqdq avx512_vnni avx512_bitalg avx512_vpopcntdq cldemote movdiri movdir64b md_clear pconfig spec_ctrl intel_stibp flush_l1d arch_capabilities</span><br><span class="line"></span><br><span class="line">=== 内存信息 ===</span><br><span class="line">              total        used        free      shared  buff/cache   available</span><br><span class="line">Mem:           376G         47G        257G        1.7G         71G        326G</span><br><span class="line">Swap:            0B          0B          0B</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="性能测试结果汇总-含CPU-IO监控数据-1"><a href="#性能测试结果汇总-含CPU-IO监控数据-1" class="headerlink" title="性能测试结果汇总 (含CPU&#x2F;IO监控数据)"></a>性能测试结果汇总 (含CPU&#x2F;IO监控数据)</h2><table>
<thead>
<tr>
<th>测试场景</th>
<th>并发数</th>
<th>QPS</th>
<th>TPS</th>
<th>平均延迟(ms)</th>
<th>95%延迟(ms)</th>
<th>CPU软中断(%)</th>
<th>CPU用户(%)</th>
<th>CPU系统(%)</th>
<th>CPU等待(%)</th>
<th>IO利用率(%)</th>
<th>测试时间段</th>
</tr>
</thead>
<tbody><tr>
<td>oltp_point_select</td>
<td>1</td>
<td>15,153</td>
<td>15,153</td>
<td>0.07</td>
<td>0.26</td>
<td>0.0</td>
<td>0.6</td>
<td>0.6</td>
<td>0.8</td>
<td>42.6</td>
<td>2025-11-24 08:38:54 ~ 2025-11-24 08:39:24</td>
</tr>
<tr>
<td>oltp_point_select</td>
<td>8</td>
<td>129,671</td>
<td>129,671</td>
<td>0.06</td>
<td>0.23</td>
<td>0.2</td>
<td>4.1</td>
<td>2.7</td>
<td>2.3</td>
<td>81.3</td>
<td>2025-11-24 08:39:26 ~ 2025-11-24 08:39:56</td>
</tr>
<tr>
<td>oltp_point_select</td>
<td>16</td>
<td>231,142</td>
<td>231,142</td>
<td>0.07</td>
<td>0.13</td>
<td>0.9</td>
<td>7.8</td>
<td>4.2</td>
<td>0.8</td>
<td>68.0</td>
<td>2025-11-24 08:39:58 ~ 2025-11-24 08:40:28</td>
</tr>
<tr>
<td>oltp_point_select</td>
<td>32</td>
<td>296,421</td>
<td>296,421</td>
<td>0.11</td>
<td>0.18</td>
<td>0.9</td>
<td>10.3</td>
<td>5.7</td>
<td>0.0</td>
<td>47.1</td>
<td>2025-11-24 08:40:30 ~ 2025-11-24 08:41:00</td>
</tr>
<tr>
<td>oltp_point_select</td>
<td>64</td>
<td>297,696</td>
<td>297,696</td>
<td>0.21</td>
<td>0.31</td>
<td>0.9</td>
<td>10.4</td>
<td>5.7</td>
<td>0.0</td>
<td>31.4</td>
<td>2025-11-24 08:41:02 ~ 2025-11-24 08:41:32</td>
</tr>
<tr>
<td>oltp_point_select</td>
<td>128</td>
<td>285,109</td>
<td>285,109</td>
<td>0.45</td>
<td>0.62</td>
<td>0.8</td>
<td>10.5</td>
<td>5.6</td>
<td>0.0</td>
<td>21.7</td>
<td>2025-11-24 08:41:34 ~ 2025-11-24 08:42:04</td>
</tr>
<tr>
<td>oltp_read_only</td>
<td>1</td>
<td>10,803</td>
<td>675</td>
<td>1.48</td>
<td>1.86</td>
<td>0.0</td>
<td>1.3</td>
<td>0.4</td>
<td>0.0</td>
<td>1.0</td>
<td>2025-11-24 08:42:06 ~ 2025-11-24 08:42:36</td>
</tr>
<tr>
<td>oltp_read_only</td>
<td>8</td>
<td>60,145</td>
<td>3,759</td>
<td>2.13</td>
<td>3.25</td>
<td>0.1</td>
<td>10.2</td>
<td>1.3</td>
<td>0.1</td>
<td>5.3</td>
<td>2025-11-24 08:42:38 ~ 2025-11-24 08:43:08</td>
</tr>
<tr>
<td>oltp_read_only</td>
<td>16</td>
<td>71,110</td>
<td>4,444</td>
<td>3.60</td>
<td>5.88</td>
<td>0.2</td>
<td>13.5</td>
<td>1.6</td>
<td>0.0</td>
<td>5.6</td>
<td>2025-11-24 08:43:10 ~ 2025-11-24 08:43:40</td>
</tr>
<tr>
<td>oltp_read_only</td>
<td>32</td>
<td>73,527</td>
<td>4,595</td>
<td>6.96</td>
<td>10.09</td>
<td>0.2</td>
<td>14.6</td>
<td>1.6</td>
<td>0.0</td>
<td>5.6</td>
<td>2025-11-24 08:43:42 ~ 2025-11-24 08:44:12</td>
</tr>
<tr>
<td>oltp_read_only</td>
<td>64</td>
<td>73,290</td>
<td>4,581</td>
<td>13.97</td>
<td>18.28</td>
<td>0.3</td>
<td>14.6</td>
<td>1.6</td>
<td>0.0</td>
<td>5.1</td>
<td>2025-11-24 08:44:14 ~ 2025-11-24 08:44:44</td>
</tr>
<tr>
<td>oltp_read_only</td>
<td>128</td>
<td>72,280</td>
<td>4,518</td>
<td>28.32</td>
<td>34.95</td>
<td>0.2</td>
<td>14.5</td>
<td>1.6</td>
<td>0.0</td>
<td>4.9</td>
<td>2025-11-24 08:44:46 ~ 2025-11-24 08:45:16</td>
</tr>
<tr>
<td>oltp_read_write</td>
<td>1</td>
<td>7,297</td>
<td>365</td>
<td>2.74</td>
<td>3.49</td>
<td>0.0</td>
<td>1.5</td>
<td>0.7</td>
<td>0.2</td>
<td>28.6</td>
<td>2025-11-24 08:45:18 ~ 2025-11-24 08:45:48</td>
</tr>
<tr>
<td>oltp_read_write</td>
<td>8</td>
<td>45,183</td>
<td>2,259</td>
<td>3.54</td>
<td>5.28</td>
<td>0.1</td>
<td>9.5</td>
<td>2.0</td>
<td>0.4</td>
<td>44.6</td>
<td>2025-11-24 08:45:50 ~ 2025-11-24 08:46:20</td>
</tr>
<tr>
<td>oltp_read_write</td>
<td>16</td>
<td>58,254</td>
<td>2,913</td>
<td>5.49</td>
<td>8.58</td>
<td>0.2</td>
<td>12.2</td>
<td>2.2</td>
<td>0.2</td>
<td>32.3</td>
<td>2025-11-24 08:46:22 ~ 2025-11-24 08:46:53</td>
</tr>
<tr>
<td>oltp_read_write</td>
<td>32</td>
<td>63,486</td>
<td>3,174</td>
<td>10.08</td>
<td>15.83</td>
<td>0.2</td>
<td>13.5</td>
<td>2.2</td>
<td>0.1</td>
<td>33.5</td>
<td>2025-11-24 08:46:55 ~ 2025-11-24 08:47:25</td>
</tr>
<tr>
<td>oltp_read_write</td>
<td>64</td>
<td>65,714</td>
<td>3,286</td>
<td>19.47</td>
<td>36.24</td>
<td>0.3</td>
<td>13.7</td>
<td>2.0</td>
<td>0.0</td>
<td>33.2</td>
<td>2025-11-24 08:47:27 ~ 2025-11-24 08:47:57</td>
</tr>
<tr>
<td>oltp_read_write</td>
<td>128</td>
<td>67,345</td>
<td>3,367</td>
<td>37.99</td>
<td>75.82</td>
<td>0.3</td>
<td>14.0</td>
<td>2.0</td>
<td>0.0</td>
<td>32.0</td>
<td>2025-11-24 08:47:59 ~ 2025-11-24 08:48:29</td>
</tr>
<tr>
<td>oltp_write_only</td>
<td>1</td>
<td>15,367</td>
<td>2,561</td>
<td>0.39</td>
<td>0.63</td>
<td>0.0</td>
<td>2.1</td>
<td>1.1</td>
<td>0.2</td>
<td>14.5</td>
<td>2025-11-24 08:48:31 ~ 2025-11-24 08:49:01</td>
</tr>
<tr>
<td>oltp_write_only</td>
<td>8</td>
<td>61,477</td>
<td>10,246</td>
<td>0.78</td>
<td>1.18</td>
<td>0.2</td>
<td>8.1</td>
<td>3.1</td>
<td>0.2</td>
<td>33.5</td>
<td>2025-11-24 08:49:03 ~ 2025-11-24 08:49:33</td>
</tr>
<tr>
<td>oltp_write_only</td>
<td>16</td>
<td>78,108</td>
<td>13,018</td>
<td>1.23</td>
<td>2.00</td>
<td>0.4</td>
<td>10.2</td>
<td>3.3</td>
<td>0.2</td>
<td>34.6</td>
<td>2025-11-24 08:49:35 ~ 2025-11-24 08:50:05</td>
</tr>
<tr>
<td>oltp_write_only</td>
<td>32</td>
<td>82,004</td>
<td>13,667</td>
<td>2.34</td>
<td>4.10</td>
<td>0.4</td>
<td>10.4</td>
<td>3.2</td>
<td>0.2</td>
<td>40.3</td>
<td>2025-11-24 08:50:07 ~ 2025-11-24 08:50:37</td>
</tr>
<tr>
<td>oltp_write_only</td>
<td>64</td>
<td>97,106</td>
<td>16,184</td>
<td>3.95</td>
<td>8.13</td>
<td>0.4</td>
<td>11.6</td>
<td>3.1</td>
<td>0.1</td>
<td>36.8</td>
<td>2025-11-24 08:50:39 ~ 2025-11-24 08:51:09</td>
</tr>
<tr>
<td>oltp_write_only</td>
<td>128</td>
<td>108,842</td>
<td>18,140</td>
<td>7.05</td>
<td>14.46</td>
<td>0.4</td>
<td>12.2</td>
<td>3.3</td>
<td>0.1</td>
<td>40.1</td>
<td>2025-11-24 08:51:11 ~ 2025-11-24 08:51:41</td>
</tr>
</tbody></table>
<hr>
<hr>
<h1 id="第三章：huawei-环境详细报告"><a href="#第三章：huawei-环境详细报告" class="headerlink" title="第三章：huawei 环境详细报告"></a>第三章：huawei 环境详细报告</h1><p><strong>测试时间</strong>: 2025-11-27 10:29:08<br><strong>测试工具</strong>: sysbench + tsar (按时间段精确匹配)<br><strong>tsar数据样本</strong>: 60059 条记录  </p>
<h2 id="测试配置信息-2"><a href="#测试配置信息-2" class="headerlink" title="测试配置信息"></a>测试配置信息</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">=== 测试配置信息 ===</span><br><span class="line">MYSQL_HOST: 10.16.104.124</span><br><span class="line">MYSQL_PORT: 3306</span><br><span class="line">TABLES: 16</span><br><span class="line">TABLE_SIZE: 10000000</span><br><span class="line">TEST_TIME: 30</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="MySQL配置参数-2"><a href="#MySQL配置参数-2" class="headerlink" title="MySQL配置参数"></a>MySQL配置参数</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mysql: [Warning] Using a password on the command line interface can be insecure.</span><br><span class="line">Variable_name	Value</span><br><span class="line">innodb_buffer_pool_size	17179869184</span><br><span class="line">innodb_flush_log_at_trx_commit	2</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="压测服务器配置-2"><a href="#压测服务器配置-2" class="headerlink" title="压测服务器配置"></a>压测服务器配置</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">=== CPU 信息 ===</span><br><span class="line">Architecture:          x86_64</span><br><span class="line">CPU op-mode(s):        32-bit, 64-bit</span><br><span class="line">Byte Order:            Little Endian</span><br><span class="line">CPU(s):                64</span><br><span class="line">On-line CPU(s) list:   0-63</span><br><span class="line">Thread(s) per core:    2</span><br><span class="line">Core(s) per socket:    16</span><br><span class="line">座：                 2</span><br><span class="line">NUMA 节点：         2</span><br><span class="line">厂商 ID：           GenuineIntel</span><br><span class="line">CPU 系列：          6</span><br><span class="line">型号：              106</span><br><span class="line">型号名称：        Intel(R) Xeon(R) Gold 6348 CPU @ 2.60GHz</span><br><span class="line">步进：              6</span><br><span class="line">CPU MHz：             2600.000</span><br><span class="line">BogoMIPS：            5200.00</span><br><span class="line">超管理器厂商：  KVM</span><br><span class="line">虚拟化类型：     完全</span><br><span class="line">L1d 缓存：          48K</span><br><span class="line">L1i 缓存：          32K</span><br><span class="line">L2 缓存：           1280K</span><br><span class="line">L3 缓存：           43008K</span><br><span class="line">NUMA 节点0 CPU：    0-31</span><br><span class="line">NUMA 节点1 CPU：    32-63</span><br><span class="line">Flags:                 fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov pat pse36 clflush mmx fxsr sse sse2 ss ht syscall nx pdpe1gb rdtscp lm constant_tsc rep_good nopl xtopology nonstop_tsc eagerfpu pni pclmulqdq ssse3 fma cx16 pcid sse4_1 sse4_2 x2apic movbe popcnt tsc_deadline_timer aes xsave avx f16c rdrand hypervisor lahf_lm abm 3dnowprefetch invpcid_single ssbd rsb_ctxsw ibrs ibpb stibp ibrs_enhanced fsgsbase tsc_adjust bmi1 hle avx2 smep bmi2 erms invpcid rtm avx512f avx512dq rdseed adx smap avx512ifma clflushopt clwb avx512cd sha_ni avx512bw avx512vl xsaveopt xsavec xgetbv1 arat avx512vbmi umip avx512_vbmi2 gfni vaes vpclmulqdq avx512_vnni avx512_bitalg avx512_vpopcntdq md_clear spec_ctrl intel_stibp arch_capabilities</span><br><span class="line"></span><br><span class="line">=== 内存信息 ===</span><br><span class="line">              total        used        free      shared  buff/cache   available</span><br><span class="line">Mem:           251G         21G        127G        944K        102G        229G</span><br><span class="line">Swap:            0B          0B          0B</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="性能测试结果汇总-含CPU-IO监控数据-2"><a href="#性能测试结果汇总-含CPU-IO监控数据-2" class="headerlink" title="性能测试结果汇总 (含CPU&#x2F;IO监控数据)"></a>性能测试结果汇总 (含CPU&#x2F;IO监控数据)</h2><table>
<thead>
<tr>
<th>测试场景</th>
<th>并发数</th>
<th>QPS</th>
<th>TPS</th>
<th>平均延迟(ms)</th>
<th>95%延迟(ms)</th>
<th>CPU软中断(%)</th>
<th>CPU用户(%)</th>
<th>CPU系统(%)</th>
<th>CPU等待(%)</th>
<th>IO利用率(%)</th>
<th>测试时间段</th>
</tr>
</thead>
<tbody><tr>
<td>oltp_point_select</td>
<td>1</td>
<td>6,019</td>
<td>6,019</td>
<td>0.17</td>
<td>0.17</td>
<td>0.0</td>
<td>0.2</td>
<td>0.1</td>
<td>0.1</td>
<td>22.1</td>
<td>2025-11-24 10:03:09 ~ 2025-11-24 10:03:39</td>
</tr>
<tr>
<td>oltp_point_select</td>
<td>8</td>
<td>45,989</td>
<td>45,989</td>
<td>0.17</td>
<td>0.19</td>
<td>0.0</td>
<td>1.3</td>
<td>0.6</td>
<td>0.4</td>
<td>77.2</td>
<td>2025-11-24 10:03:41 ~ 2025-11-24 10:04:12</td>
</tr>
<tr>
<td>oltp_point_select</td>
<td>16</td>
<td>86,219</td>
<td>86,219</td>
<td>0.19</td>
<td>0.21</td>
<td>0.2</td>
<td>3.5</td>
<td>1.5</td>
<td>0.6</td>
<td>92.5</td>
<td>2025-11-24 10:04:14 ~ 2025-11-24 10:04:44</td>
</tr>
<tr>
<td>oltp_point_select</td>
<td>32</td>
<td>155,542</td>
<td>155,542</td>
<td>0.21</td>
<td>0.31</td>
<td>0.5</td>
<td>7.0</td>
<td>2.7</td>
<td>0.4</td>
<td>96.2</td>
<td>2025-11-24 10:04:46 ~ 2025-11-24 10:05:16</td>
</tr>
<tr>
<td>oltp_point_select</td>
<td>64</td>
<td>196,915</td>
<td>196,915</td>
<td>0.32</td>
<td>0.48</td>
<td>0.4</td>
<td>8.7</td>
<td>3.2</td>
<td>0.0</td>
<td>95.2</td>
<td>2025-11-24 10:05:18 ~ 2025-11-24 10:05:48</td>
</tr>
<tr>
<td>oltp_point_select</td>
<td>128</td>
<td>190,484</td>
<td>190,484</td>
<td>0.67</td>
<td>0.94</td>
<td>0.5</td>
<td>8.6</td>
<td>3.2</td>
<td>0.0</td>
<td>90.4</td>
<td>2025-11-24 10:05:50 ~ 2025-11-24 10:06:20</td>
</tr>
<tr>
<td>oltp_read_only</td>
<td>1</td>
<td>4,433</td>
<td>277</td>
<td>3.61</td>
<td>4.10</td>
<td>0.0</td>
<td>0.5</td>
<td>0.1</td>
<td>0.0</td>
<td>5.7</td>
<td>2025-11-24 10:06:22 ~ 2025-11-24 10:06:52</td>
</tr>
<tr>
<td>oltp_read_only</td>
<td>8</td>
<td>27,454</td>
<td>1,716</td>
<td>4.66</td>
<td>6.79</td>
<td>0.0</td>
<td>4.1</td>
<td>0.5</td>
<td>0.1</td>
<td>29.2</td>
<td>2025-11-24 10:06:54 ~ 2025-11-24 10:07:24</td>
</tr>
<tr>
<td>oltp_read_only</td>
<td>16</td>
<td>41,995</td>
<td>2,625</td>
<td>6.09</td>
<td>9.06</td>
<td>0.1</td>
<td>7.6</td>
<td>0.7</td>
<td>0.1</td>
<td>38.9</td>
<td>2025-11-24 10:07:26 ~ 2025-11-24 10:07:56</td>
</tr>
<tr>
<td>oltp_read_only</td>
<td>32</td>
<td>49,173</td>
<td>3,073</td>
<td>10.41</td>
<td>16.71</td>
<td>0.1</td>
<td>10.2</td>
<td>0.8</td>
<td>0.1</td>
<td>41.8</td>
<td>2025-11-24 10:07:58 ~ 2025-11-24 10:08:28</td>
</tr>
<tr>
<td>oltp_read_only</td>
<td>64</td>
<td>51,212</td>
<td>3,201</td>
<td>19.99</td>
<td>31.94</td>
<td>0.2</td>
<td>11.1</td>
<td>0.9</td>
<td>0.0</td>
<td>41.0</td>
<td>2025-11-24 10:08:30 ~ 2025-11-24 10:09:00</td>
</tr>
<tr>
<td>oltp_read_only</td>
<td>128</td>
<td>51,027</td>
<td>3,189</td>
<td>40.12</td>
<td>53.85</td>
<td>0.2</td>
<td>11.2</td>
<td>0.9</td>
<td>0.0</td>
<td>39.5</td>
<td>2025-11-24 10:09:02 ~ 2025-11-24 10:09:32</td>
</tr>
<tr>
<td>oltp_read_write</td>
<td>1</td>
<td>3,728</td>
<td>186</td>
<td>5.36</td>
<td>6.79</td>
<td>0.0</td>
<td>0.6</td>
<td>0.2</td>
<td>0.2</td>
<td>50.4</td>
<td>2025-11-24 10:09:34 ~ 2025-11-24 10:10:04</td>
</tr>
<tr>
<td>oltp_read_write</td>
<td>8</td>
<td>25,512</td>
<td>1,276</td>
<td>6.27</td>
<td>8.43</td>
<td>0.1</td>
<td>4.6</td>
<td>0.8</td>
<td>0.8</td>
<td>92.8</td>
<td>2025-11-24 10:10:06 ~ 2025-11-24 10:10:36</td>
</tr>
<tr>
<td>oltp_read_write</td>
<td>16</td>
<td>40,124</td>
<td>2,006</td>
<td>7.97</td>
<td>11.45</td>
<td>0.1</td>
<td>7.6</td>
<td>1.0</td>
<td>0.6</td>
<td>91.4</td>
<td>2025-11-24 10:10:38 ~ 2025-11-24 10:11:08</td>
</tr>
<tr>
<td>oltp_read_write</td>
<td>32</td>
<td>49,743</td>
<td>2,487</td>
<td>12.86</td>
<td>20.00</td>
<td>0.1</td>
<td>10.1</td>
<td>1.1</td>
<td>0.4</td>
<td>90.3</td>
<td>2025-11-24 10:11:10 ~ 2025-11-24 10:11:40</td>
</tr>
<tr>
<td>oltp_read_write</td>
<td>64</td>
<td>51,940</td>
<td>2,597</td>
<td>24.63</td>
<td>49.21</td>
<td>0.2</td>
<td>10.8</td>
<td>1.0</td>
<td>0.2</td>
<td>90.0</td>
<td>2025-11-24 10:11:42 ~ 2025-11-24 10:12:12</td>
</tr>
<tr>
<td>oltp_read_write</td>
<td>128</td>
<td>52,357</td>
<td>2,618</td>
<td>48.87</td>
<td>106.75</td>
<td>0.2</td>
<td>10.6</td>
<td>1.0</td>
<td>0.2</td>
<td>86.6</td>
<td>2025-11-24 10:12:14 ~ 2025-11-24 10:12:45</td>
</tr>
<tr>
<td>oltp_write_only</td>
<td>1</td>
<td>4,930</td>
<td>822</td>
<td>1.22</td>
<td>2.35</td>
<td>0.0</td>
<td>0.5</td>
<td>0.2</td>
<td>0.2</td>
<td>37.4</td>
<td>2025-11-24 10:12:47 ~ 2025-11-24 10:13:17</td>
</tr>
<tr>
<td>oltp_write_only</td>
<td>8</td>
<td>30,173</td>
<td>5,029</td>
<td>1.59</td>
<td>2.86</td>
<td>0.1</td>
<td>2.7</td>
<td>0.7</td>
<td>0.5</td>
<td>78.5</td>
<td>2025-11-24 10:13:19 ~ 2025-11-24 10:13:49</td>
</tr>
<tr>
<td>oltp_write_only</td>
<td>16</td>
<td>49,163</td>
<td>8,194</td>
<td>1.95</td>
<td>3.49</td>
<td>0.1</td>
<td>4.8</td>
<td>1.2</td>
<td>0.6</td>
<td>87.7</td>
<td>2025-11-24 10:13:51 ~ 2025-11-24 10:14:21</td>
</tr>
<tr>
<td>oltp_write_only</td>
<td>32</td>
<td>70,800</td>
<td>11,800</td>
<td>2.71</td>
<td>5.00</td>
<td>0.2</td>
<td>7.1</td>
<td>1.6</td>
<td>0.5</td>
<td>91.8</td>
<td>2025-11-24 10:14:23 ~ 2025-11-24 10:14:53</td>
</tr>
<tr>
<td>oltp_write_only</td>
<td>64</td>
<td>85,898</td>
<td>14,316</td>
<td>4.47</td>
<td>8.90</td>
<td>0.3</td>
<td>8.8</td>
<td>1.9</td>
<td>0.4</td>
<td>93.3</td>
<td>2025-11-24 10:14:55 ~ 2025-11-24 10:15:25</td>
</tr>
<tr>
<td>oltp_write_only</td>
<td>128</td>
<td>64,958</td>
<td>10,826</td>
<td>11.82</td>
<td>17.95</td>
<td>0.2</td>
<td>6.3</td>
<td>1.5</td>
<td>0.5</td>
<td>97.7</td>
<td>2025-11-24 10:15:27 ~ 2025-11-24 10:15:57</td>
</tr>
</tbody></table>
<hr>
<hr>
<h1 id="第四章：aliyun-环境详细报告"><a href="#第四章：aliyun-环境详细报告" class="headerlink" title="第四章：aliyun 环境详细报告"></a>第四章：aliyun 环境详细报告</h1><p><strong>测试时间</strong>: 2025-11-27 10:28:27<br><strong>测试工具</strong>: sysbench + tsar (按时间段精确匹配)<br><strong>tsar数据样本</strong>: 811 条记录  </p>
<h2 id="测试配置信息-3"><a href="#测试配置信息-3" class="headerlink" title="测试配置信息"></a>测试配置信息</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">=== 测试配置信息 ===</span><br><span class="line">MYSQL_HOST: 10.127.33.154</span><br><span class="line">MYSQL_PORT: 3316</span><br><span class="line">TABLES: 16</span><br><span class="line">TABLE_SIZE: 10000000</span><br><span class="line">TEST_TIME: 30</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="MySQL配置参数-3"><a href="#MySQL配置参数-3" class="headerlink" title="MySQL配置参数"></a>MySQL配置参数</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mysql: [Warning] Using a password on the command line interface can be insecure.</span><br><span class="line">Variable_name	Value</span><br><span class="line">innodb_buffer_pool_size	17179869184</span><br><span class="line">innodb_flush_log_at_trx_commit	2</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="压测服务器配置-3"><a href="#压测服务器配置-3" class="headerlink" title="压测服务器配置"></a>压测服务器配置</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">=== CPU 信息 ===</span><br><span class="line">架构：           x86_64</span><br><span class="line">CPU 运行模式：   32-bit, 64-bit</span><br><span class="line">字节序：         Little Endian</span><br><span class="line">CPU:             8</span><br><span class="line">在线 CPU 列表：  0-7</span><br><span class="line">每个核的线程数： 2</span><br><span class="line">每个座的核数：   4</span><br><span class="line">座：             1</span><br><span class="line">NUMA 节点：      1</span><br><span class="line">厂商 ID：        GenuineIntel</span><br><span class="line">BIOS Vendor ID:  Alibaba Cloud</span><br><span class="line">CPU 系列：       6</span><br><span class="line">型号：           173</span><br><span class="line">型号名称：       Intel(R) Xeon(R) 6982P-C</span><br><span class="line">BIOS Model name: pc-i440fx-2.1</span><br><span class="line">步进：           1</span><br><span class="line">CPU MHz：        3600.000</span><br><span class="line">CPU 最大 MHz：   3900.0000</span><br><span class="line">CPU 最小 MHz：   800.0000</span><br><span class="line">BogoMIPS：       5600.00</span><br><span class="line">超管理器厂商：   KVM</span><br><span class="line">虚拟化类型：     完全</span><br><span class="line">L1d 缓存：       48K</span><br><span class="line">L1i 缓存：       64K</span><br><span class="line">L2 缓存：        2048K</span><br><span class="line">L3 缓存：        516096K</span><br><span class="line">NUMA 节点0 CPU： 0-7</span><br><span class="line">标记：           fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov pat pse36 clflush dts mmx fxsr sse sse2 ss ht syscall nx pdpe1gb rdtscp lm constant_tsc arch_perfmon pebs rep_good nopl xtopology nonstop_tsc cpuid aperfmperf tsc_known_freq pni pclmulqdq dtes64 monitor ssse3 fma cx16 pdcm pcid sse4_1 sse4_2 x2apic movbe popcnt aes xsave avx f16c rdrand hypervisor lahf_lm abm 3dnowprefetch cpuid_fault invpcid_single ssbd ibrs ibpb stibp ibrs_enhanced fsgsbase tsc_adjust bmi1 hle avx2 smep bmi2 erms invpcid rtm avx512f avx512dq rdseed adx smap avx512ifma clflushopt clwb avx512cd sha_ni avx512bw avx512vl xsaveopt xsavec xgetbv1 xsaves avx_vnni avx512_bf16 wbnoinvd ida arat hwp hwp_notify hwp_act_window hwp_epp hwp_pkg_req avx512vbmi umip pku ospke waitpkg avx512_vbmi2 gfni vaes vpclmulqdq avx512_vnni avx512_bitalg avx512_vpopcntdq rdpid bus_lock_detect cldemote movdiri movdir64b enqcmd fsrm uintr md_clear serialize tsxldtrk arch_lbr amx_bf16 avx512_fp16 amx_tile amx_int8 flush_l1d arch_capabilities</span><br><span class="line"></span><br><span class="line">=== 内存信息 ===</span><br><span class="line">              total        used        free      shared  buff/cache   available</span><br><span class="line">Mem:           30Gi        20Gi       1.2Gi       2.0Mi       9.1Gi       9.6Gi</span><br><span class="line">Swap:            0B          0B          0B</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="性能测试结果汇总-含CPU-IO监控数据-3"><a href="#性能测试结果汇总-含CPU-IO监控数据-3" class="headerlink" title="性能测试结果汇总 (含CPU&#x2F;IO监控数据)"></a>性能测试结果汇总 (含CPU&#x2F;IO监控数据)</h2><table>
<thead>
<tr>
<th>测试场景</th>
<th>并发数</th>
<th>QPS</th>
<th>TPS</th>
<th>平均延迟(ms)</th>
<th>95%延迟(ms)</th>
<th>CPU软中断(%)</th>
<th>CPU用户(%)</th>
<th>CPU系统(%)</th>
<th>CPU等待(%)</th>
<th>IO利用率(%)</th>
<th>测试时间段</th>
</tr>
</thead>
<tbody><tr>
<td>oltp_point_select</td>
<td>1</td>
<td>15,750</td>
<td>15,750</td>
<td>0.06</td>
<td>0.07</td>
<td>0.5</td>
<td>1.7</td>
<td>1.0</td>
<td>0.8</td>
<td>22.6</td>
<td>2025-11-23 07:59:31 ~ 2025-11-23 08:00:01</td>
</tr>
<tr>
<td>oltp_point_select</td>
<td>8</td>
<td>109,914</td>
<td>109,914</td>
<td>0.07</td>
<td>0.08</td>
<td>4.6</td>
<td>14.8</td>
<td>7.5</td>
<td>4.6</td>
<td>77.7</td>
<td>2025-11-23 08:00:03 ~ 2025-11-23 08:00:33</td>
</tr>
<tr>
<td>oltp_point_select</td>
<td>16</td>
<td>196,497</td>
<td>196,497</td>
<td>0.08</td>
<td>0.10</td>
<td>9.2</td>
<td>32.1</td>
<td>17.0</td>
<td>3.7</td>
<td>90.2</td>
<td>2025-11-23 08:00:35 ~ 2025-11-23 08:01:05</td>
</tr>
<tr>
<td>oltp_point_select</td>
<td>32</td>
<td>301,160</td>
<td>301,160</td>
<td>0.11</td>
<td>0.16</td>
<td>13.4</td>
<td>46.4</td>
<td>30.8</td>
<td>0.8</td>
<td>94.7</td>
<td>2025-11-23 08:01:07 ~ 2025-11-23 08:01:37</td>
</tr>
<tr>
<td>oltp_point_select</td>
<td>64</td>
<td>328,098</td>
<td>328,098</td>
<td>0.19</td>
<td>0.29</td>
<td>13.6</td>
<td>48.1</td>
<td>33.6</td>
<td>0.0</td>
<td>90.5</td>
<td>2025-11-23 08:01:39 ~ 2025-11-23 08:02:09</td>
</tr>
<tr>
<td>oltp_point_select</td>
<td>128</td>
<td>309,373</td>
<td>309,373</td>
<td>0.41</td>
<td>0.59</td>
<td>13.3</td>
<td>48.2</td>
<td>33.8</td>
<td>0.0</td>
<td>81.9</td>
<td>2025-11-23 08:02:11 ~ 2025-11-23 08:02:41</td>
</tr>
<tr>
<td>oltp_read_only</td>
<td>1</td>
<td>9,389</td>
<td>587</td>
<td>1.70</td>
<td>2.03</td>
<td>0.3</td>
<td>6.0</td>
<td>0.7</td>
<td>0.2</td>
<td>5.2</td>
<td>2025-11-23 08:02:43 ~ 2025-11-23 08:03:13</td>
</tr>
<tr>
<td>oltp_read_only</td>
<td>8</td>
<td>60,278</td>
<td>3,767</td>
<td>2.12</td>
<td>2.43</td>
<td>2.7</td>
<td>50.3</td>
<td>5.4</td>
<td>1.1</td>
<td>27.4</td>
<td>2025-11-23 08:03:15 ~ 2025-11-23 08:03:45</td>
</tr>
<tr>
<td>oltp_read_only</td>
<td>16</td>
<td>76,662</td>
<td>4,791</td>
<td>3.34</td>
<td>4.57</td>
<td>4.0</td>
<td>71.2</td>
<td>8.8</td>
<td>0.4</td>
<td>31.7</td>
<td>2025-11-23 08:03:47 ~ 2025-11-23 08:04:17</td>
</tr>
<tr>
<td>oltp_read_only</td>
<td>32</td>
<td>84,123</td>
<td>5,258</td>
<td>6.08</td>
<td>8.58</td>
<td>4.0</td>
<td>80.6</td>
<td>9.8</td>
<td>0.1</td>
<td>33.2</td>
<td>2025-11-23 08:04:19 ~ 2025-11-23 08:04:49</td>
</tr>
<tr>
<td>oltp_read_only</td>
<td>64</td>
<td>85,224</td>
<td>5,326</td>
<td>12.01</td>
<td>15.55</td>
<td>3.9</td>
<td>81.8</td>
<td>10.5</td>
<td>0.0</td>
<td>30.8</td>
<td>2025-11-23 08:04:51 ~ 2025-11-23 08:05:21</td>
</tr>
<tr>
<td>oltp_read_only</td>
<td>128</td>
<td>85,054</td>
<td>5,316</td>
<td>24.07</td>
<td>26.68</td>
<td>3.8</td>
<td>81.6</td>
<td>10.4</td>
<td>0.0</td>
<td>29.0</td>
<td>2025-11-23 08:05:23 ~ 2025-11-23 08:05:53</td>
</tr>
<tr>
<td>oltp_read_write</td>
<td>1</td>
<td>7,952</td>
<td>398</td>
<td>2.51</td>
<td>3.30</td>
<td>0.4</td>
<td>6.9</td>
<td>2.6</td>
<td>2.6</td>
<td>73.0</td>
<td>2025-11-23 08:05:55 ~ 2025-11-23 08:06:25</td>
</tr>
<tr>
<td>oltp_read_write</td>
<td>8</td>
<td>51,194</td>
<td>2,560</td>
<td>3.12</td>
<td>4.10</td>
<td>3.0</td>
<td>48.6</td>
<td>10.3</td>
<td>5.2</td>
<td>94.7</td>
<td>2025-11-23 08:06:27 ~ 2025-11-23 08:06:57</td>
</tr>
<tr>
<td>oltp_read_write</td>
<td>16</td>
<td>71,761</td>
<td>3,588</td>
<td>4.46</td>
<td>6.32</td>
<td>4.1</td>
<td>67.2</td>
<td>11.6</td>
<td>1.6</td>
<td>85.0</td>
<td>2025-11-23 08:06:59 ~ 2025-11-23 08:07:30</td>
</tr>
<tr>
<td>oltp_read_write</td>
<td>32</td>
<td>81,858</td>
<td>4,093</td>
<td>7.82</td>
<td>11.65</td>
<td>4.2</td>
<td>77.9</td>
<td>11.9</td>
<td>0.4</td>
<td>83.9</td>
<td>2025-11-23 08:07:32 ~ 2025-11-23 08:08:02</td>
</tr>
<tr>
<td>oltp_read_write</td>
<td>64</td>
<td>83,569</td>
<td>4,178</td>
<td>15.31</td>
<td>29.72</td>
<td>4.2</td>
<td>78.7</td>
<td>12.1</td>
<td>0.2</td>
<td>83.7</td>
<td>2025-11-23 08:08:04 ~ 2025-11-23 08:08:34</td>
</tr>
<tr>
<td>oltp_read_write</td>
<td>128</td>
<td>82,403</td>
<td>4,120</td>
<td>31.04</td>
<td>86.00</td>
<td>4.3</td>
<td>77.6</td>
<td>12.8</td>
<td>0.2</td>
<td>81.8</td>
<td>2025-11-23 08:08:36 ~ 2025-11-23 08:09:06</td>
</tr>
<tr>
<td>oltp_write_only</td>
<td>1</td>
<td>12,484</td>
<td>2,081</td>
<td>0.48</td>
<td>0.99</td>
<td>0.5</td>
<td>5.7</td>
<td>2.2</td>
<td>1.8</td>
<td>33.3</td>
<td>2025-11-23 08:09:08 ~ 2025-11-23 08:09:38</td>
</tr>
<tr>
<td>oltp_write_only</td>
<td>8</td>
<td>61,401</td>
<td>10,233</td>
<td>0.78</td>
<td>1.37</td>
<td>3.3</td>
<td>33.1</td>
<td>11.4</td>
<td>4.6</td>
<td>78.9</td>
<td>2025-11-23 08:09:40 ~ 2025-11-23 08:10:10</td>
</tr>
<tr>
<td>oltp_write_only</td>
<td>16</td>
<td>90,134</td>
<td>15,022</td>
<td>1.06</td>
<td>1.70</td>
<td>5.0</td>
<td>47.3</td>
<td>15.9</td>
<td>3.8</td>
<td>83.7</td>
<td>2025-11-23 08:10:12 ~ 2025-11-23 08:10:42</td>
</tr>
<tr>
<td>oltp_write_only</td>
<td>32</td>
<td>101,548</td>
<td>16,925</td>
<td>1.89</td>
<td>2.86</td>
<td>5.6</td>
<td>50.4</td>
<td>17.0</td>
<td>3.2</td>
<td>88.5</td>
<td>2025-11-23 08:10:44 ~ 2025-11-23 08:11:14</td>
</tr>
<tr>
<td>oltp_write_only</td>
<td>64</td>
<td>110,923</td>
<td>18,487</td>
<td>3.46</td>
<td>7.17</td>
<td>5.8</td>
<td>52.8</td>
<td>17.6</td>
<td>2.4</td>
<td>86.8</td>
<td>2025-11-23 08:11:16 ~ 2025-11-23 08:11:47</td>
</tr>
<tr>
<td>oltp_write_only</td>
<td>128</td>
<td>121,385</td>
<td>20,231</td>
<td>6.32</td>
<td>23.95</td>
<td>6.5</td>
<td>58.8</td>
<td>18.9</td>
<td>2.0</td>
<td>85.4</td>
<td>2025-11-23 08:11:49 ~ 2025-11-23 08:12:19</td>
</tr>
</tbody></table>
<hr>
<hr>
<h1 id="第五章：aliyun-trx1-环境详细报告"><a href="#第五章：aliyun-trx1-环境详细报告" class="headerlink" title="第五章：aliyun.trx1 环境详细报告"></a>第五章：aliyun.trx1 环境详细报告</h1><p><strong>测试时间</strong>: 2025-11-27 10:27:05<br><strong>测试工具</strong>: sysbench + tsar (按时间段精确匹配)<br><strong>tsar数据样本</strong>: 791 条记录  </p>
<h2 id="测试配置信息-4"><a href="#测试配置信息-4" class="headerlink" title="测试配置信息"></a>测试配置信息</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">=== 测试配置信息 ===</span><br><span class="line">MYSQL_HOST: 10.127.33.154</span><br><span class="line">MYSQL_PORT: 3316</span><br><span class="line">TABLES: 16</span><br><span class="line">TABLE_SIZE: 10000000</span><br><span class="line">TEST_TIME: 30</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="MySQL配置参数-4"><a href="#MySQL配置参数-4" class="headerlink" title="MySQL配置参数"></a>MySQL配置参数</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mysql: [Warning] Using a password on the command line interface can be insecure.</span><br><span class="line">Variable_name	Value</span><br><span class="line">innodb_buffer_pool_size	17179869184</span><br><span class="line">innodb_flush_log_at_trx_commit	1</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="压测服务器配置-4"><a href="#压测服务器配置-4" class="headerlink" title="压测服务器配置"></a>压测服务器配置</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">=== CPU 信息 ===</span><br><span class="line">架构：           x86_64</span><br><span class="line">CPU 运行模式：   32-bit, 64-bit</span><br><span class="line">字节序：         Little Endian</span><br><span class="line">CPU:             8</span><br><span class="line">在线 CPU 列表：  0-7</span><br><span class="line">每个核的线程数： 2</span><br><span class="line">每个座的核数：   4</span><br><span class="line">座：             1</span><br><span class="line">NUMA 节点：      1</span><br><span class="line">厂商 ID：        GenuineIntel</span><br><span class="line">BIOS Vendor ID:  Alibaba Cloud</span><br><span class="line">CPU 系列：       6</span><br><span class="line">型号：           173</span><br><span class="line">型号名称：       Intel(R) Xeon(R) 6982P-C</span><br><span class="line">BIOS Model name: pc-i440fx-2.1</span><br><span class="line">步进：           1</span><br><span class="line">CPU MHz：        3600.000</span><br><span class="line">CPU 最大 MHz：   3900.0000</span><br><span class="line">CPU 最小 MHz：   800.0000</span><br><span class="line">BogoMIPS：       5600.00</span><br><span class="line">超管理器厂商：   KVM</span><br><span class="line">虚拟化类型：     完全</span><br><span class="line">L1d 缓存：       48K</span><br><span class="line">L1i 缓存：       64K</span><br><span class="line">L2 缓存：        2048K</span><br><span class="line">L3 缓存：        516096K</span><br><span class="line">NUMA 节点0 CPU： 0-7</span><br><span class="line">标记：           fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov pat pse36 clflush dts mmx fxsr sse sse2 ss ht syscall nx pdpe1gb rdtscp lm constant_tsc arch_perfmon pebs rep_good nopl xtopology nonstop_tsc cpuid aperfmperf tsc_known_freq pni pclmulqdq dtes64 monitor ssse3 fma cx16 pdcm pcid sse4_1 sse4_2 x2apic movbe popcnt aes xsave avx f16c rdrand hypervisor lahf_lm abm 3dnowprefetch cpuid_fault invpcid_single ssbd ibrs ibpb stibp ibrs_enhanced fsgsbase tsc_adjust bmi1 hle avx2 smep bmi2 erms invpcid rtm avx512f avx512dq rdseed adx smap avx512ifma clflushopt clwb avx512cd sha_ni avx512bw avx512vl xsaveopt xsavec xgetbv1 xsaves avx_vnni avx512_bf16 wbnoinvd ida arat hwp hwp_notify hwp_act_window hwp_epp hwp_pkg_req avx512vbmi umip pku ospke waitpkg avx512_vbmi2 gfni vaes vpclmulqdq avx512_vnni avx512_bitalg avx512_vpopcntdq rdpid bus_lock_detect cldemote movdiri movdir64b enqcmd fsrm uintr md_clear serialize tsxldtrk arch_lbr amx_bf16 avx512_fp16 amx_tile amx_int8 flush_l1d arch_capabilities</span><br><span class="line"></span><br><span class="line">=== 内存信息 ===</span><br><span class="line">              total        used        free      shared  buff/cache   available</span><br><span class="line">Mem:           30Gi        20Gi       1.2Gi       2.0Mi       9.1Gi       9.6Gi</span><br><span class="line">Swap:            0B          0B          0B</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="性能测试结果汇总-含CPU-IO监控数据-4"><a href="#性能测试结果汇总-含CPU-IO监控数据-4" class="headerlink" title="性能测试结果汇总 (含CPU&#x2F;IO监控数据)"></a>性能测试结果汇总 (含CPU&#x2F;IO监控数据)</h2><table>
<thead>
<tr>
<th>测试场景</th>
<th>并发数</th>
<th>QPS</th>
<th>TPS</th>
<th>平均延迟(ms)</th>
<th>95%延迟(ms)</th>
<th>CPU软中断(%)</th>
<th>CPU用户(%)</th>
<th>CPU系统(%)</th>
<th>CPU等待(%)</th>
<th>IO利用率(%)</th>
<th>测试时间段</th>
</tr>
</thead>
<tbody><tr>
<td>oltp_point_select</td>
<td>1</td>
<td>15,625</td>
<td>15,625</td>
<td>0.06</td>
<td>0.07</td>
<td>0.5</td>
<td>1.8</td>
<td>0.9</td>
<td>0.8</td>
<td>22.3</td>
<td>2025-11-23 19:27:06 ~ 2025-11-23 19:27:36</td>
</tr>
<tr>
<td>oltp_point_select</td>
<td>8</td>
<td>113,189</td>
<td>113,189</td>
<td>0.07</td>
<td>0.08</td>
<td>4.7</td>
<td>15.6</td>
<td>7.6</td>
<td>4.7</td>
<td>78.1</td>
<td>2025-11-23 19:27:38 ~ 2025-11-23 19:28:08</td>
</tr>
<tr>
<td>oltp_point_select</td>
<td>16</td>
<td>195,783</td>
<td>195,783</td>
<td>0.08</td>
<td>0.10</td>
<td>9.1</td>
<td>31.9</td>
<td>16.4</td>
<td>3.9</td>
<td>90.4</td>
<td>2025-11-23 19:28:10 ~ 2025-11-23 19:28:40</td>
</tr>
<tr>
<td>oltp_point_select</td>
<td>32</td>
<td>302,140</td>
<td>302,140</td>
<td>0.11</td>
<td>0.16</td>
<td>13.1</td>
<td>46.5</td>
<td>30.2</td>
<td>0.8</td>
<td>93.8</td>
<td>2025-11-23 19:28:42 ~ 2025-11-23 19:29:12</td>
</tr>
<tr>
<td>oltp_point_select</td>
<td>64</td>
<td>326,549</td>
<td>326,549</td>
<td>0.20</td>
<td>0.29</td>
<td>13.6</td>
<td>47.2</td>
<td>33.4</td>
<td>0.0</td>
<td>90.1</td>
<td>2025-11-23 19:29:14 ~ 2025-11-23 19:29:44</td>
</tr>
<tr>
<td>oltp_point_select</td>
<td>128</td>
<td>310,429</td>
<td>310,429</td>
<td>0.41</td>
<td>0.58</td>
<td>13.2</td>
<td>47.4</td>
<td>33.5</td>
<td>0.0</td>
<td>81.1</td>
<td>2025-11-23 19:29:46 ~ 2025-11-23 19:30:16</td>
</tr>
<tr>
<td>oltp_read_only</td>
<td>1</td>
<td>9,311</td>
<td>582</td>
<td>1.72</td>
<td>2.03</td>
<td>0.3</td>
<td>5.6</td>
<td>0.6</td>
<td>0.2</td>
<td>5.0</td>
<td>2025-11-23 19:30:18 ~ 2025-11-23 19:30:48</td>
</tr>
<tr>
<td>oltp_read_only</td>
<td>8</td>
<td>59,695</td>
<td>3,731</td>
<td>2.14</td>
<td>2.43</td>
<td>2.7</td>
<td>48.4</td>
<td>5.5</td>
<td>1.1</td>
<td>27.2</td>
<td>2025-11-23 19:30:50 ~ 2025-11-23 19:31:20</td>
</tr>
<tr>
<td>oltp_read_only</td>
<td>16</td>
<td>76,820</td>
<td>4,801</td>
<td>3.33</td>
<td>4.57</td>
<td>3.9</td>
<td>70.1</td>
<td>8.5</td>
<td>0.4</td>
<td>31.7</td>
<td>2025-11-23 19:31:22 ~ 2025-11-23 19:31:52</td>
</tr>
<tr>
<td>oltp_read_only</td>
<td>32</td>
<td>84,023</td>
<td>5,251</td>
<td>6.09</td>
<td>8.58</td>
<td>3.9</td>
<td>79.1</td>
<td>9.6</td>
<td>0.1</td>
<td>31.6</td>
<td>2025-11-23 19:31:54 ~ 2025-11-23 19:32:24</td>
</tr>
<tr>
<td>oltp_read_only</td>
<td>64</td>
<td>85,283</td>
<td>5,330</td>
<td>12.00</td>
<td>15.55</td>
<td>3.9</td>
<td>80.2</td>
<td>10.3</td>
<td>0.0</td>
<td>31.0</td>
<td>2025-11-23 19:32:26 ~ 2025-11-23 19:32:56</td>
</tr>
<tr>
<td>oltp_read_only</td>
<td>128</td>
<td>85,127</td>
<td>5,320</td>
<td>24.05</td>
<td>27.17</td>
<td>3.7</td>
<td>79.4</td>
<td>10.1</td>
<td>0.0</td>
<td>28.7</td>
<td>2025-11-23 19:32:58 ~ 2025-11-23 19:33:29</td>
</tr>
<tr>
<td>oltp_read_write</td>
<td>1</td>
<td>6,868</td>
<td>343</td>
<td>2.91</td>
<td>3.68</td>
<td>0.4</td>
<td>5.8</td>
<td>2.2</td>
<td>3.9</td>
<td>78.4</td>
<td>2025-11-23 19:33:31 ~ 2025-11-23 19:34:01</td>
</tr>
<tr>
<td>oltp_read_write</td>
<td>8</td>
<td>44,801</td>
<td>2,240</td>
<td>3.57</td>
<td>4.65</td>
<td>2.7</td>
<td>43.5</td>
<td>9.2</td>
<td>8.5</td>
<td>96.9</td>
<td>2025-11-23 19:34:03 ~ 2025-11-23 19:34:33</td>
</tr>
<tr>
<td>oltp_read_write</td>
<td>16</td>
<td>66,062</td>
<td>3,303</td>
<td>4.84</td>
<td>6.55</td>
<td>4.1</td>
<td>62.1</td>
<td>11.4</td>
<td>3.7</td>
<td>96.5</td>
<td>2025-11-23 19:34:35 ~ 2025-11-23 19:35:05</td>
</tr>
<tr>
<td>oltp_read_write</td>
<td>32</td>
<td>78,590</td>
<td>3,930</td>
<td>8.14</td>
<td>11.45</td>
<td>4.4</td>
<td>73.3</td>
<td>12.1</td>
<td>1.3</td>
<td>94.8</td>
<td>2025-11-23 19:35:07 ~ 2025-11-23 19:35:37</td>
</tr>
<tr>
<td>oltp_read_write</td>
<td>64</td>
<td>83,049</td>
<td>4,152</td>
<td>15.41</td>
<td>25.28</td>
<td>4.3</td>
<td>76.3</td>
<td>12.0</td>
<td>0.5</td>
<td>89.1</td>
<td>2025-11-23 19:35:39 ~ 2025-11-23 19:36:09</td>
</tr>
<tr>
<td>oltp_read_write</td>
<td>128</td>
<td>84,131</td>
<td>4,207</td>
<td>30.41</td>
<td>94.10</td>
<td>4.2</td>
<td>75.7</td>
<td>11.9</td>
<td>0.4</td>
<td>83.4</td>
<td>2025-11-23 19:36:11 ~ 2025-11-23 19:36:41</td>
</tr>
<tr>
<td>oltp_write_only</td>
<td>1</td>
<td>6,909</td>
<td>1,152</td>
<td>0.87</td>
<td>1.37</td>
<td>0.4</td>
<td>4.0</td>
<td>1.7</td>
<td>5.7</td>
<td>94.9</td>
<td>2025-11-23 19:36:43 ~ 2025-11-23 19:37:14</td>
</tr>
<tr>
<td>oltp_write_only</td>
<td>8</td>
<td>38,470</td>
<td>6,412</td>
<td>1.25</td>
<td>1.93</td>
<td>2.0</td>
<td>22.2</td>
<td>7.5</td>
<td>7.8</td>
<td>97.7</td>
<td>2025-11-23 19:37:16 ~ 2025-11-23 19:37:46</td>
</tr>
<tr>
<td>oltp_write_only</td>
<td>16</td>
<td>57,604</td>
<td>9,601</td>
<td>1.67</td>
<td>2.43</td>
<td>3.2</td>
<td>28.4</td>
<td>10.1</td>
<td>7.1</td>
<td>97.6</td>
<td>2025-11-23 19:37:48 ~ 2025-11-23 19:38:18</td>
</tr>
<tr>
<td>oltp_write_only</td>
<td>32</td>
<td>88,163</td>
<td>14,694</td>
<td>2.18</td>
<td>3.13</td>
<td>5.1</td>
<td>41.1</td>
<td>14.4</td>
<td>4.7</td>
<td>97.6</td>
<td>2025-11-23 19:38:20 ~ 2025-11-23 19:38:50</td>
</tr>
<tr>
<td>oltp_write_only</td>
<td>64</td>
<td>112,561</td>
<td>18,760</td>
<td>3.41</td>
<td>4.74</td>
<td>6.1</td>
<td>52.3</td>
<td>17.9</td>
<td>2.5</td>
<td>97.3</td>
<td>2025-11-23 19:38:52 ~ 2025-11-23 19:39:22</td>
</tr>
<tr>
<td>oltp_write_only</td>
<td>128</td>
<td>105,554</td>
<td>17,592</td>
<td>7.27</td>
<td>9.22</td>
<td>5.6</td>
<td>49.4</td>
<td>16.8</td>
<td>2.3</td>
<td>94.8</td>
<td>2025-11-23 19:39:24 ~ 2025-11-23 19:39:54</td>
</tr>
</tbody></table>
<hr>
<hr>
<h1 id="第六章：aliyun-trx1-repl-环境详细报告"><a href="#第六章：aliyun-trx1-repl-环境详细报告" class="headerlink" title="第六章：aliyun.trx1.repl 环境详细报告"></a>第六章：aliyun.trx1.repl 环境详细报告</h1><p><strong>测试时间</strong>: 2025-12-01 18:26:22<br><strong>测试工具</strong>: sysbench + tsar (按时间段精确匹配)<br><strong>tsar数据样本</strong>: 517 条记录  </p>
<h2 id="测试配置信息-5"><a href="#测试配置信息-5" class="headerlink" title="测试配置信息"></a>测试配置信息</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">=== 测试配置信息 ===</span><br><span class="line">MYSQL_HOST: 10.127.33.154</span><br><span class="line">MYSQL_PORT: 3316</span><br><span class="line">TABLES: 16</span><br><span class="line">TABLE_SIZE: 100000</span><br><span class="line">TEST_TIME: 10</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="MySQL配置参数-5"><a href="#MySQL配置参数-5" class="headerlink" title="MySQL配置参数"></a>MySQL配置参数</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mysql: [Warning] Using a password on the command line interface can be insecure.</span><br><span class="line">Variable_name	Value</span><br><span class="line">innodb_buffer_pool_size	17179869184</span><br><span class="line">innodb_flush_log_at_trx_commit	1</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="压测服务器配置-5"><a href="#压测服务器配置-5" class="headerlink" title="压测服务器配置"></a>压测服务器配置</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">=== CPU 信息 ===</span><br><span class="line">架构：           x86_64</span><br><span class="line">CPU 运行模式：   32-bit, 64-bit</span><br><span class="line">字节序：         Little Endian</span><br><span class="line">CPU:             8</span><br><span class="line">在线 CPU 列表：  0-7</span><br><span class="line">每个核的线程数： 2</span><br><span class="line">每个座的核数：   4</span><br><span class="line">座：             1</span><br><span class="line">NUMA 节点：      1</span><br><span class="line">厂商 ID：        GenuineIntel</span><br><span class="line">BIOS Vendor ID:  Alibaba Cloud</span><br><span class="line">CPU 系列：       6</span><br><span class="line">型号：           173</span><br><span class="line">型号名称：       Intel(R) Xeon(R) 6982P-C</span><br><span class="line">BIOS Model name: pc-i440fx-2.1</span><br><span class="line">步进：           1</span><br><span class="line">CPU MHz：        3600.000</span><br><span class="line">CPU 最大 MHz：   3900.0000</span><br><span class="line">CPU 最小 MHz：   800.0000</span><br><span class="line">BogoMIPS：       5600.00</span><br><span class="line">超管理器厂商：   KVM</span><br><span class="line">虚拟化类型：     完全</span><br><span class="line">L1d 缓存：       48K</span><br><span class="line">L1i 缓存：       64K</span><br><span class="line">L2 缓存：        2048K</span><br><span class="line">L3 缓存：        516096K</span><br><span class="line">NUMA 节点0 CPU： 0-7</span><br><span class="line">标记：           fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov pat pse36 clflush dts mmx fxsr sse sse2 ss ht syscall nx pdpe1gb rdtscp lm constant_tsc arch_perfmon pebs rep_good nopl xtopology nonstop_tsc cpuid aperfmperf tsc_known_freq pni pclmulqdq dtes64 monitor ssse3 fma cx16 pdcm pcid sse4_1 sse4_2 x2apic movbe popcnt aes xsave avx f16c rdrand hypervisor lahf_lm abm 3dnowprefetch cpuid_fault invpcid_single ssbd ibrs ibpb stibp ibrs_enhanced fsgsbase tsc_adjust bmi1 hle avx2 smep bmi2 erms invpcid rtm avx512f avx512dq rdseed adx smap avx512ifma clflushopt clwb avx512cd sha_ni avx512bw avx512vl xsaveopt xsavec xgetbv1 xsaves avx_vnni avx512_bf16 wbnoinvd ida arat hwp hwp_notify hwp_act_window hwp_epp hwp_pkg_req avx512vbmi umip pku ospke waitpkg avx512_vbmi2 gfni vaes vpclmulqdq avx512_vnni avx512_bitalg avx512_vpopcntdq rdpid bus_lock_detect cldemote movdiri movdir64b enqcmd fsrm uintr md_clear serialize tsxldtrk arch_lbr amx_bf16 avx512_fp16 amx_tile amx_int8 flush_l1d arch_capabilities</span><br><span class="line"></span><br><span class="line">=== 内存信息 ===</span><br><span class="line">              total        used        free      shared  buff/cache   available</span><br><span class="line">Mem:           30Gi        21Gi       6.7Gi       2.0Mi       2.8Gi       8.8Gi</span><br><span class="line">Swap:            0B          0B          0B</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="性能测试结果汇总-含CPU-IO监控数据-5"><a href="#性能测试结果汇总-含CPU-IO监控数据-5" class="headerlink" title="性能测试结果汇总 (含CPU&#x2F;IO监控数据)"></a>性能测试结果汇总 (含CPU&#x2F;IO监控数据)</h2><table>
<thead>
<tr>
<th>测试场景</th>
<th>并发数</th>
<th>QPS</th>
<th>TPS</th>
<th>平均延迟(ms)</th>
<th>95%延迟(ms)</th>
<th>CPU软中断(%)</th>
<th>CPU用户(%)</th>
<th>CPU系统(%)</th>
<th>CPU等待(%)</th>
<th>IO利用率(%)</th>
<th>测试时间段</th>
</tr>
</thead>
<tbody><tr>
<td>oltp_point_select</td>
<td>1</td>
<td>17,027</td>
<td>17,027</td>
<td>0.06</td>
<td>0.06</td>
<td>0.5</td>
<td>1.5</td>
<td>0.9</td>
<td>0.2</td>
<td>4.6</td>
<td>2025-12-01 18:21:28 ~ 2025-12-01 18:21:38</td>
</tr>
<tr>
<td>oltp_point_select</td>
<td>8</td>
<td>109,505</td>
<td>109,505</td>
<td>0.07</td>
<td>0.09</td>
<td>4.2</td>
<td>14.3</td>
<td>6.8</td>
<td>0.4</td>
<td>12.2</td>
<td>2025-12-01 18:21:40 ~ 2025-12-01 18:21:50</td>
</tr>
<tr>
<td>oltp_point_select</td>
<td>16</td>
<td>190,769</td>
<td>190,769</td>
<td>0.08</td>
<td>0.11</td>
<td>8.9</td>
<td>28.6</td>
<td>15.7</td>
<td>0.2</td>
<td>8.5</td>
<td>2025-12-01 18:21:52 ~ 2025-12-01 18:22:02</td>
</tr>
<tr>
<td>oltp_point_select</td>
<td>32</td>
<td>287,309</td>
<td>287,309</td>
<td>0.11</td>
<td>0.18</td>
<td>12.7</td>
<td>41.0</td>
<td>28.7</td>
<td>0.0</td>
<td>6.5</td>
<td>2025-12-01 18:22:04 ~ 2025-12-01 18:22:14</td>
</tr>
<tr>
<td>oltp_point_select</td>
<td>64</td>
<td>329,548</td>
<td>329,548</td>
<td>0.19</td>
<td>0.30</td>
<td>13.0</td>
<td>43.3</td>
<td>30.9</td>
<td>0.0</td>
<td>3.8</td>
<td>2025-12-01 18:22:16 ~ 2025-12-01 18:22:26</td>
</tr>
<tr>
<td>oltp_point_select</td>
<td>128</td>
<td>301,471</td>
<td>301,471</td>
<td>0.42</td>
<td>0.60</td>
<td>12.7</td>
<td>42.3</td>
<td>31.6</td>
<td>0.0</td>
<td>2.5</td>
<td>2025-12-01 18:22:28 ~ 2025-12-01 18:22:38</td>
</tr>
<tr>
<td>oltp_read_only</td>
<td>1</td>
<td>11,207</td>
<td>700</td>
<td>1.43</td>
<td>1.50</td>
<td>0.4</td>
<td>4.1</td>
<td>0.6</td>
<td>0.0</td>
<td>0.1</td>
<td>2025-12-01 18:22:40 ~ 2025-12-01 18:22:50</td>
</tr>
<tr>
<td>oltp_read_only</td>
<td>8</td>
<td>73,855</td>
<td>4,616</td>
<td>1.73</td>
<td>1.93</td>
<td>3.4</td>
<td>35.6</td>
<td>6.2</td>
<td>0.0</td>
<td>0.6</td>
<td>2025-12-01 18:22:52 ~ 2025-12-01 18:23:02</td>
</tr>
<tr>
<td>oltp_read_only</td>
<td>16</td>
<td>103,284</td>
<td>6,455</td>
<td>2.48</td>
<td>3.19</td>
<td>5.3</td>
<td>55.6</td>
<td>11.5</td>
<td>0.0</td>
<td>0.7</td>
<td>2025-12-01 18:23:04 ~ 2025-12-01 18:23:14</td>
</tr>
<tr>
<td>oltp_read_only</td>
<td>32</td>
<td>120,653</td>
<td>7,541</td>
<td>4.24</td>
<td>5.88</td>
<td>5.5</td>
<td>65.8</td>
<td>13.0</td>
<td>0.0</td>
<td>0.8</td>
<td>2025-12-01 18:23:16 ~ 2025-12-01 18:23:26</td>
</tr>
<tr>
<td>oltp_read_only</td>
<td>64</td>
<td>125,685</td>
<td>7,855</td>
<td>8.14</td>
<td>10.84</td>
<td>5.2</td>
<td>67.2</td>
<td>13.8</td>
<td>0.0</td>
<td>0.8</td>
<td>2025-12-01 18:23:28 ~ 2025-12-01 18:23:38</td>
</tr>
<tr>
<td>oltp_read_only</td>
<td>128</td>
<td>122,608</td>
<td>7,663</td>
<td>16.68</td>
<td>19.29</td>
<td>5.3</td>
<td>65.4</td>
<td>13.8</td>
<td>0.0</td>
<td>0.6</td>
<td>2025-12-01 18:23:40 ~ 2025-12-01 18:23:50</td>
</tr>
<tr>
<td>oltp_read_write</td>
<td>1</td>
<td>8,125</td>
<td>406</td>
<td>2.46</td>
<td>2.86</td>
<td>0.3</td>
<td>3.6</td>
<td>0.9</td>
<td>2.1</td>
<td>52.2</td>
<td>2025-12-01 18:23:52 ~ 2025-12-01 18:24:02</td>
</tr>
<tr>
<td>oltp_read_write</td>
<td>8</td>
<td>51,348</td>
<td>2,567</td>
<td>3.11</td>
<td>3.89</td>
<td>2.7</td>
<td>26.9</td>
<td>6.1</td>
<td>4.4</td>
<td>81.0</td>
<td>2025-12-01 18:24:04 ~ 2025-12-01 18:24:14</td>
</tr>
<tr>
<td>oltp_read_write</td>
<td>16</td>
<td>76,515</td>
<td>3,826</td>
<td>4.18</td>
<td>5.18</td>
<td>4.1</td>
<td>42.0</td>
<td>10.0</td>
<td>3.2</td>
<td>83.1</td>
<td>2025-12-01 18:24:16 ~ 2025-12-01 18:24:26</td>
</tr>
<tr>
<td>oltp_read_write</td>
<td>32</td>
<td>98,436</td>
<td>4,922</td>
<td>6.50</td>
<td>8.58</td>
<td>5.0</td>
<td>53.8</td>
<td>13.1</td>
<td>1.5</td>
<td>82.1</td>
<td>2025-12-01 18:24:28 ~ 2025-12-01 18:24:38</td>
</tr>
<tr>
<td>oltp_read_write</td>
<td>64</td>
<td>109,191</td>
<td>5,460</td>
<td>11.71</td>
<td>17.95</td>
<td>5.3</td>
<td>58.7</td>
<td>14.0</td>
<td>0.7</td>
<td>71.0</td>
<td>2025-12-01 18:24:40 ~ 2025-12-01 18:24:51</td>
</tr>
<tr>
<td>oltp_read_write</td>
<td>128</td>
<td>111,512</td>
<td>5,576</td>
<td>22.89</td>
<td>38.25</td>
<td>5.5</td>
<td>62.8</td>
<td>14.7</td>
<td>0.5</td>
<td>51.9</td>
<td>2025-12-01 18:24:53 ~ 2025-12-01 18:25:03</td>
</tr>
<tr>
<td>oltp_write_only</td>
<td>1</td>
<td>5,832</td>
<td>972</td>
<td>1.03</td>
<td>1.44</td>
<td>0.4</td>
<td>2.5</td>
<td>1.1</td>
<td>4.8</td>
<td>90.0</td>
<td>2025-12-01 18:25:05 ~ 2025-12-01 18:25:15</td>
</tr>
<tr>
<td>oltp_write_only</td>
<td>8</td>
<td>27,926</td>
<td>4,654</td>
<td>1.72</td>
<td>2.43</td>
<td>1.5</td>
<td>10.3</td>
<td>3.8</td>
<td>6.1</td>
<td>89.2</td>
<td>2025-12-01 18:25:17 ~ 2025-12-01 18:25:27</td>
</tr>
<tr>
<td>oltp_write_only</td>
<td>16</td>
<td>36,521</td>
<td>6,087</td>
<td>2.63</td>
<td>3.43</td>
<td>2.1</td>
<td>13.7</td>
<td>5.1</td>
<td>4.8</td>
<td>78.9</td>
<td>2025-12-01 18:25:29 ~ 2025-12-01 18:25:39</td>
</tr>
<tr>
<td>oltp_write_only</td>
<td>32</td>
<td>52,252</td>
<td>8,709</td>
<td>3.67</td>
<td>4.82</td>
<td>2.8</td>
<td>18.9</td>
<td>7.3</td>
<td>3.8</td>
<td>70.4</td>
<td>2025-12-01 18:25:41 ~ 2025-12-01 18:25:51</td>
</tr>
<tr>
<td>oltp_write_only</td>
<td>64</td>
<td>86,217</td>
<td>14,370</td>
<td>4.45</td>
<td>6.55</td>
<td>4.4</td>
<td>31.3</td>
<td>12.3</td>
<td>3.2</td>
<td>80.9</td>
<td>2025-12-01 18:25:53 ~ 2025-12-01 18:26:03</td>
</tr>
<tr>
<td>oltp_write_only</td>
<td>128</td>
<td>95,690</td>
<td>15,948</td>
<td>8.00</td>
<td>12.08</td>
<td>4.7</td>
<td>32.8</td>
<td>12.8</td>
<td>2.2</td>
<td>74.1</td>
<td>2025-12-01 18:26:05 ~ 2025-12-01 18:26:16</td>
</tr>
</tbody></table>
<hr>
<hr>
<h1 id="第七章：ali-repl-rtt0-7-环境详细报告"><a href="#第七章：ali-repl-rtt0-7-环境详细报告" class="headerlink" title="第七章：ali.repl.rtt0.7 环境详细报告"></a>第七章：ali.repl.rtt0.7 环境详细报告</h1><p><strong>测试时间</strong>: 2025-12-05 15:02:51<br><strong>测试工具</strong>: sysbench + tsar (按时间段精确匹配)<br><strong>tsar数据样本</strong>: 4414 条记录  </p>
<h2 id="测试配置信息-6"><a href="#测试配置信息-6" class="headerlink" title="测试配置信息"></a>测试配置信息</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">=== 测试配置信息 ===</span><br><span class="line">MYSQL_HOST: 10.127.33.154</span><br><span class="line">MYSQL_PORT: 3316</span><br><span class="line">TABLES: 16</span><br><span class="line">TABLE_SIZE: 10000000</span><br><span class="line">TEST_TIME: 30</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="MySQL配置参数-6"><a href="#MySQL配置参数-6" class="headerlink" title="MySQL配置参数"></a>MySQL配置参数</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mysql: [Warning] Using a password on the command line interface can be insecure.</span><br><span class="line">Variable_name	Value</span><br><span class="line">innodb_buffer_pool_size	17179869184</span><br><span class="line">innodb_flush_log_at_trx_commit	2</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="压测服务器配置-6"><a href="#压测服务器配置-6" class="headerlink" title="压测服务器配置"></a>压测服务器配置</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">=== CPU 信息 ===</span><br><span class="line">架构：           x86_64</span><br><span class="line">CPU 运行模式：   32-bit, 64-bit</span><br><span class="line">字节序：         Little Endian</span><br><span class="line">CPU:             8</span><br><span class="line">在线 CPU 列表：  0-7</span><br><span class="line">每个核的线程数： 2</span><br><span class="line">每个座的核数：   4</span><br><span class="line">座：             1</span><br><span class="line">NUMA 节点：      1</span><br><span class="line">厂商 ID：        GenuineIntel</span><br><span class="line">BIOS Vendor ID:  Alibaba Cloud</span><br><span class="line">CPU 系列：       6</span><br><span class="line">型号：           173</span><br><span class="line">型号名称：       Intel(R) Xeon(R) 6982P-C</span><br><span class="line">BIOS Model name: pc-i440fx-2.1</span><br><span class="line">步进：           1</span><br><span class="line">CPU MHz：        3600.289</span><br><span class="line">CPU 最大 MHz：   3900.0000</span><br><span class="line">CPU 最小 MHz：   800.0000</span><br><span class="line">BogoMIPS：       5600.00</span><br><span class="line">超管理器厂商：   KVM</span><br><span class="line">虚拟化类型：     完全</span><br><span class="line">L1d 缓存：       48K</span><br><span class="line">L1i 缓存：       64K</span><br><span class="line">L2 缓存：        2048K</span><br><span class="line">L3 缓存：        516096K</span><br><span class="line">NUMA 节点0 CPU： 0-7</span><br><span class="line">标记：           fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov pat pse36 clflush dts mmx fxsr sse sse2 ss ht syscall nx pdpe1gb rdtscp lm constant_tsc arch_perfmon pebs rep_good nopl xtopology nonstop_tsc cpuid aperfmperf tsc_known_freq pni pclmulqdq dtes64 monitor ssse3 fma cx16 pdcm pcid sse4_1 sse4_2 x2apic movbe popcnt aes xsave avx f16c rdrand hypervisor lahf_lm abm 3dnowprefetch cpuid_fault invpcid_single ssbd ibrs ibpb stibp ibrs_enhanced fsgsbase tsc_adjust bmi1 hle avx2 smep bmi2 erms invpcid rtm avx512f avx512dq rdseed adx smap avx512ifma clflushopt clwb avx512cd sha_ni avx512bw avx512vl xsaveopt xsavec xgetbv1 xsaves avx_vnni avx512_bf16 wbnoinvd ida arat hwp hwp_notify hwp_act_window hwp_epp hwp_pkg_req avx512vbmi umip pku ospke waitpkg avx512_vbmi2 gfni vaes vpclmulqdq avx512_vnni avx512_bitalg avx512_vpopcntdq rdpid bus_lock_detect cldemote movdiri movdir64b enqcmd fsrm uintr md_clear serialize tsxldtrk arch_lbr amx_bf16 avx512_fp16 amx_tile amx_int8 flush_l1d arch_capabilities</span><br><span class="line"></span><br><span class="line">=== 内存信息 ===</span><br><span class="line">              total        used        free      shared  buff/cache   available</span><br><span class="line">Mem:           30Gi        19Gi       546Mi       2.0Mi        11Gi        11Gi</span><br><span class="line">Swap:            0B          0B          0B</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="性能测试结果汇总-含CPU-IO监控数据-6"><a href="#性能测试结果汇总-含CPU-IO监控数据-6" class="headerlink" title="性能测试结果汇总 (含CPU&#x2F;IO监控数据)"></a>性能测试结果汇总 (含CPU&#x2F;IO监控数据)</h2><table>
<thead>
<tr>
<th>测试场景</th>
<th>并发数</th>
<th>QPS</th>
<th>TPS</th>
<th>平均延迟(ms)</th>
<th>95%延迟(ms)</th>
<th>CPU软中断(%)</th>
<th>CPU用户(%)</th>
<th>CPU系统(%)</th>
<th>CPU等待(%)</th>
<th>IO利用率(%)</th>
<th>测试时间段</th>
</tr>
</thead>
<tbody><tr>
<td>oltp_point_select</td>
<td>1</td>
<td>14,484</td>
<td>14,484</td>
<td>0.07</td>
<td>0.07</td>
<td>0.7</td>
<td>1.7</td>
<td>1.0</td>
<td>0.8</td>
<td>21.7</td>
<td>2025-12-05 14:50:30 ~ 2025-12-05 14:51:00</td>
</tr>
<tr>
<td>oltp_point_select</td>
<td>8</td>
<td>96,810</td>
<td>96,810</td>
<td>0.08</td>
<td>0.09</td>
<td>4.1</td>
<td>13.1</td>
<td>6.3</td>
<td>4.4</td>
<td>74.8</td>
<td>2025-12-05 14:51:02 ~ 2025-12-05 14:51:32</td>
</tr>
<tr>
<td>oltp_point_select</td>
<td>16</td>
<td>168,662</td>
<td>168,662</td>
<td>0.09</td>
<td>0.12</td>
<td>8.7</td>
<td>29.3</td>
<td>15.5</td>
<td>3.6</td>
<td>87.4</td>
<td>2025-12-05 14:51:34 ~ 2025-12-05 14:52:04</td>
</tr>
<tr>
<td>oltp_point_select</td>
<td>32</td>
<td>254,690</td>
<td>254,690</td>
<td>0.13</td>
<td>0.19</td>
<td>12.4</td>
<td>44.3</td>
<td>27.8</td>
<td>1.2</td>
<td>93.5</td>
<td>2025-12-05 14:52:06 ~ 2025-12-05 14:52:36</td>
</tr>
<tr>
<td>oltp_point_select</td>
<td>64</td>
<td>271,234</td>
<td>271,234</td>
<td>0.24</td>
<td>0.54</td>
<td>12.9</td>
<td>46.0</td>
<td>29.4</td>
<td>0.5</td>
<td>90.2</td>
<td>2025-12-05 14:52:38 ~ 2025-12-05 14:53:08</td>
</tr>
<tr>
<td>oltp_point_select</td>
<td>128</td>
<td>235,929</td>
<td>235,929</td>
<td>0.54</td>
<td>1.12</td>
<td>12.5</td>
<td>45.0</td>
<td>24.6</td>
<td>0.6</td>
<td>79.5</td>
<td>2025-12-05 14:53:10 ~ 2025-12-05 14:53:40</td>
</tr>
<tr>
<td>oltp_read_only</td>
<td>1</td>
<td>9,124</td>
<td>570</td>
<td>1.75</td>
<td>2.07</td>
<td>0.3</td>
<td>5.4</td>
<td>0.5</td>
<td>0.2</td>
<td>5.8</td>
<td>2025-12-05 14:53:42 ~ 2025-12-05 14:54:12</td>
</tr>
<tr>
<td>oltp_read_only</td>
<td>8</td>
<td>55,926</td>
<td>3,495</td>
<td>2.29</td>
<td>2.66</td>
<td>2.9</td>
<td>44.9</td>
<td>5.1</td>
<td>1.3</td>
<td>30.4</td>
<td>2025-12-05 14:54:14 ~ 2025-12-05 14:54:44</td>
</tr>
<tr>
<td>oltp_read_only</td>
<td>16</td>
<td>73,447</td>
<td>4,590</td>
<td>3.48</td>
<td>4.65</td>
<td>4.3</td>
<td>66.8</td>
<td>9.4</td>
<td>0.5</td>
<td>35.5</td>
<td>2025-12-05 14:54:46 ~ 2025-12-05 14:55:16</td>
</tr>
<tr>
<td>oltp_read_only</td>
<td>32</td>
<td>81,446</td>
<td>5,090</td>
<td>6.28</td>
<td>8.90</td>
<td>4.3</td>
<td>77.0</td>
<td>10.9</td>
<td>0.1</td>
<td>36.8</td>
<td>2025-12-05 14:55:18 ~ 2025-12-05 14:55:48</td>
</tr>
<tr>
<td>oltp_read_only</td>
<td>64</td>
<td>83,524</td>
<td>5,220</td>
<td>12.25</td>
<td>16.71</td>
<td>3.9</td>
<td>79.2</td>
<td>11.3</td>
<td>0.0</td>
<td>35.3</td>
<td>2025-12-05 14:55:50 ~ 2025-12-05 14:56:20</td>
</tr>
<tr>
<td>oltp_read_only</td>
<td>128</td>
<td>83,351</td>
<td>5,209</td>
<td>24.55</td>
<td>28.16</td>
<td>3.9</td>
<td>77.7</td>
<td>11.1</td>
<td>0.0</td>
<td>32.2</td>
<td>2025-12-05 14:56:22 ~ 2025-12-05 14:56:53</td>
</tr>
<tr>
<td>oltp_read_write</td>
<td>1</td>
<td>6,225</td>
<td>311</td>
<td>3.21</td>
<td>3.96</td>
<td>0.4</td>
<td>5.6</td>
<td>2.1</td>
<td>1.9</td>
<td>57.9</td>
<td>2025-12-05 14:56:55 ~ 2025-12-05 14:57:25</td>
</tr>
<tr>
<td>oltp_read_write</td>
<td>8</td>
<td>39,379</td>
<td>1,969</td>
<td>4.06</td>
<td>5.00</td>
<td>2.6</td>
<td>37.7</td>
<td>8.7</td>
<td>5.3</td>
<td>94.0</td>
<td>2025-12-05 14:57:27 ~ 2025-12-05 14:57:57</td>
</tr>
<tr>
<td>oltp_read_write</td>
<td>16</td>
<td>62,234</td>
<td>3,112</td>
<td>5.14</td>
<td>6.55</td>
<td>4.3</td>
<td>59.8</td>
<td>12.1</td>
<td>2.1</td>
<td>86.0</td>
<td>2025-12-05 14:57:59 ~ 2025-12-05 14:58:29</td>
</tr>
<tr>
<td>oltp_read_write</td>
<td>32</td>
<td>74,702</td>
<td>3,735</td>
<td>8.56</td>
<td>12.08</td>
<td>4.7</td>
<td>71.9</td>
<td>13.7</td>
<td>0.8</td>
<td>81.7</td>
<td>2025-12-05 14:58:31 ~ 2025-12-05 14:59:01</td>
</tr>
<tr>
<td>oltp_read_write</td>
<td>64</td>
<td>78,823</td>
<td>3,941</td>
<td>16.23</td>
<td>27.66</td>
<td>4.6</td>
<td>75.1</td>
<td>13.1</td>
<td>0.4</td>
<td>80.9</td>
<td>2025-12-05 14:59:03 ~ 2025-12-05 14:59:33</td>
</tr>
<tr>
<td>oltp_read_write</td>
<td>128</td>
<td>0</td>
<td>0</td>
<td>0.00</td>
<td>0.00</td>
<td>0.6</td>
<td>2.2</td>
<td>0.9</td>
<td>1.7</td>
<td>28.4</td>
<td>2025-12-05 14:59:35 ~ 2025-12-05 14:59:36</td>
</tr>
<tr>
<td>oltp_write_only</td>
<td>1</td>
<td>4,876</td>
<td>813</td>
<td>1.23</td>
<td>1.47</td>
<td>0.3</td>
<td>2.9</td>
<td>1.1</td>
<td>1.1</td>
<td>19.0</td>
<td>2025-12-05 14:59:38 ~ 2025-12-05 15:00:08</td>
</tr>
<tr>
<td>oltp_write_only</td>
<td>8</td>
<td>26,828</td>
<td>4,471</td>
<td>1.79</td>
<td>2.26</td>
<td>1.7</td>
<td>15.0</td>
<td>5.1</td>
<td>2.7</td>
<td>48.4</td>
<td>2025-12-05 15:00:10 ~ 2025-12-05 15:00:40</td>
</tr>
<tr>
<td>oltp_write_only</td>
<td>16</td>
<td>41,624</td>
<td>6,937</td>
<td>2.31</td>
<td>2.91</td>
<td>2.8</td>
<td>23.8</td>
<td>8.2</td>
<td>3.1</td>
<td>57.6</td>
<td>2025-12-05 15:00:42 ~ 2025-12-05 15:01:12</td>
</tr>
<tr>
<td>oltp_write_only</td>
<td>32</td>
<td>57,505</td>
<td>9,584</td>
<td>3.34</td>
<td>4.49</td>
<td>3.6</td>
<td>31.1</td>
<td>10.9</td>
<td>2.9</td>
<td>62.5</td>
<td>2025-12-05 15:01:14 ~ 2025-12-05 15:01:44</td>
</tr>
<tr>
<td>oltp_write_only</td>
<td>64</td>
<td>76,301</td>
<td>12,717</td>
<td>5.03</td>
<td>7.43</td>
<td>4.8</td>
<td>40.4</td>
<td>14.4</td>
<td>2.8</td>
<td>70.4</td>
<td>2025-12-05 15:01:46 ~ 2025-12-05 15:02:16</td>
</tr>
<tr>
<td>oltp_write_only</td>
<td>128</td>
<td>86,433</td>
<td>14,406</td>
<td>8.88</td>
<td>13.22</td>
<td>5.3</td>
<td>44.7</td>
<td>16.4</td>
<td>2.5</td>
<td>75.2</td>
<td>2025-12-05 15:02:18 ~ 2025-12-05 15:02:48</td>
</tr>
</tbody></table>
<hr>
<hr>
<h1 id="第八章：aws-io2-trx1-环境详细报告"><a href="#第八章：aws-io2-trx1-环境详细报告" class="headerlink" title="第八章：aws.io2.trx1 环境详细报告"></a>第八章：aws.io2.trx1 环境详细报告</h1><p><strong>测试时间</strong>: 2025-11-30 09:15:26<br><strong>测试工具</strong>: sysbench + tsar (按时间段精确匹配)<br><strong>tsar数据样本</strong>: 5679 条记录  </p>
<h2 id="测试配置信息-7"><a href="#测试配置信息-7" class="headerlink" title="测试配置信息"></a>测试配置信息</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">=== 测试配置信息 ===</span><br><span class="line">MYSQL_HOST: 10.1.2.89</span><br><span class="line">MYSQL_PORT: 3306</span><br><span class="line">TABLES: 16</span><br><span class="line">TABLE_SIZE: 10000000</span><br><span class="line">TEST_TIME: 30</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="MySQL配置参数-7"><a href="#MySQL配置参数-7" class="headerlink" title="MySQL配置参数"></a>MySQL配置参数</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mysql: [Warning] Using a password on the command line interface can be insecure.</span><br><span class="line">Variable_name	Value</span><br><span class="line">innodb_buffer_pool_size	17179869184</span><br><span class="line">innodb_flush_log_at_trx_commit	1</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="压测服务器配置-7"><a href="#压测服务器配置-7" class="headerlink" title="压测服务器配置"></a>压测服务器配置</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">=== CPU 信息 ===</span><br><span class="line">架构：           x86_64</span><br><span class="line">CPU 运行模式：   32-bit, 64-bit</span><br><span class="line">字节序：         Little Endian</span><br><span class="line">CPU:             8</span><br><span class="line">在线 CPU 列表：  0-7</span><br><span class="line">每个核的线程数： 2</span><br><span class="line">每个座的核数：   4</span><br><span class="line">座：             1</span><br><span class="line">NUMA 节点：      1</span><br><span class="line">厂商 ID：        GenuineIntel</span><br><span class="line">BIOS Vendor ID:  Intel(R) Corporation</span><br><span class="line">CPU 系列：       6</span><br><span class="line">型号：           106</span><br><span class="line">型号名称：       Intel(R) Xeon(R) Platinum 8375C CPU @ 2.90GHz</span><br><span class="line">BIOS Model name: Intel(R) Xeon(R) Platinum 8375C CPU @ 2.90GHz</span><br><span class="line">步进：           6</span><br><span class="line">CPU MHz：        2899.956</span><br><span class="line">BogoMIPS：       5799.91</span><br><span class="line">超管理器厂商：   KVM</span><br><span class="line">虚拟化类型：     完全</span><br><span class="line">L1d 缓存：       48K</span><br><span class="line">L1i 缓存：       32K</span><br><span class="line">L2 缓存：        1280K</span><br><span class="line">L3 缓存：        55296K</span><br><span class="line">NUMA 节点0 CPU： 0-7</span><br><span class="line">标记：           fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov pat pse36 clflush mmx fxsr sse sse2 ss ht syscall nx pdpe1gb rdtscp lm constant_tsc rep_good nopl xtopology nonstop_tsc cpuid aperfmperf tsc_known_freq pni pclmulqdq ssse3 fma cx16 pcid sse4_1 sse4_2 x2apic movbe popcnt tsc_deadline_timer aes xsave avx f16c rdrand hypervisor lahf_lm abm 3dnowprefetch cpuid_fault invpcid_single ssbd ibrs ibpb stibp ibrs_enhanced fsgsbase tsc_adjust bmi1 avx2 smep bmi2 erms invpcid avx512f avx512dq rdseed adx smap avx512ifma clflushopt clwb avx512cd sha_ni avx512bw avx512vl xsaveopt xsavec xgetbv1 xsaves wbnoinvd ida arat avx512vbmi pku ospke avx512_vbmi2 gfni vaes vpclmulqdq avx512_vnni avx512_bitalg tme avx512_vpopcntdq rdpid md_clear flush_l1d arch_capabilities</span><br><span class="line"></span><br><span class="line">=== 内存信息 ===</span><br><span class="line">              total        used        free      shared  buff/cache   available</span><br><span class="line">Mem:           30Gi        18Gi       243Mi        24Mi        11Gi        11Gi</span><br><span class="line">Swap:            0B          0B          0B</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="性能测试结果汇总-含CPU-IO监控数据-7"><a href="#性能测试结果汇总-含CPU-IO监控数据-7" class="headerlink" title="性能测试结果汇总 (含CPU&#x2F;IO监控数据)"></a>性能测试结果汇总 (含CPU&#x2F;IO监控数据)</h2><table>
<thead>
<tr>
<th>测试场景</th>
<th>并发数</th>
<th>QPS</th>
<th>TPS</th>
<th>平均延迟(ms)</th>
<th>95%延迟(ms)</th>
<th>CPU软中断(%)</th>
<th>CPU用户(%)</th>
<th>CPU系统(%)</th>
<th>CPU等待(%)</th>
<th>IO利用率(%)</th>
<th>测试时间段</th>
</tr>
</thead>
<tbody><tr>
<td>oltp_point_select</td>
<td>1</td>
<td>11,888</td>
<td>11,888</td>
<td>0.08</td>
<td>0.09</td>
<td>0.6</td>
<td>2.7</td>
<td>1.1</td>
<td>4.0</td>
<td>50.3</td>
<td>2025-11-30 09:02:35 ~ 2025-11-30 09:03:05</td>
</tr>
<tr>
<td>oltp_point_select</td>
<td>8</td>
<td>75,291</td>
<td>75,291</td>
<td>0.11</td>
<td>0.12</td>
<td>5.1</td>
<td>25.9</td>
<td>10.7</td>
<td>6.1</td>
<td>82.0</td>
<td>2025-11-30 09:03:07 ~ 2025-11-30 09:03:37</td>
</tr>
<tr>
<td>oltp_point_select</td>
<td>16</td>
<td>127,179</td>
<td>127,179</td>
<td>0.13</td>
<td>0.18</td>
<td>7.8</td>
<td>42.7</td>
<td>22.0</td>
<td>2.6</td>
<td>86.1</td>
<td>2025-11-30 09:03:39 ~ 2025-11-30 09:04:09</td>
</tr>
<tr>
<td>oltp_point_select</td>
<td>32</td>
<td>161,447</td>
<td>161,447</td>
<td>0.20</td>
<td>0.32</td>
<td>7.4</td>
<td>54.4</td>
<td>26.7</td>
<td>0.8</td>
<td>86.5</td>
<td>2025-11-30 09:04:11 ~ 2025-11-30 09:04:41</td>
</tr>
<tr>
<td>oltp_point_select</td>
<td>64</td>
<td>162,516</td>
<td>162,516</td>
<td>0.39</td>
<td>0.56</td>
<td>7.6</td>
<td>55.8</td>
<td>27.9</td>
<td>0.0</td>
<td>85.5</td>
<td>2025-11-30 09:04:43 ~ 2025-11-30 09:05:13</td>
</tr>
<tr>
<td>oltp_point_select</td>
<td>128</td>
<td>155,947</td>
<td>155,947</td>
<td>0.82</td>
<td>1.06</td>
<td>7.7</td>
<td>57.8</td>
<td>28.6</td>
<td>0.0</td>
<td>81.8</td>
<td>2025-11-30 09:05:15 ~ 2025-11-30 09:05:46</td>
</tr>
<tr>
<td>oltp_read_only</td>
<td>1</td>
<td>7,068</td>
<td>442</td>
<td>2.26</td>
<td>2.86</td>
<td>0.4</td>
<td>6.0</td>
<td>0.5</td>
<td>0.4</td>
<td>7.9</td>
<td>2025-11-30 09:05:48 ~ 2025-11-30 09:06:18</td>
</tr>
<tr>
<td>oltp_read_only</td>
<td>8</td>
<td>39,993</td>
<td>2,500</td>
<td>3.20</td>
<td>3.82</td>
<td>3.1</td>
<td>55.9</td>
<td>6.2</td>
<td>1.9</td>
<td>35.5</td>
<td>2025-11-30 09:06:20 ~ 2025-11-30 09:06:50</td>
</tr>
<tr>
<td>oltp_read_only</td>
<td>16</td>
<td>47,383</td>
<td>2,961</td>
<td>5.40</td>
<td>8.74</td>
<td>3.0</td>
<td>73.2</td>
<td>8.3</td>
<td>0.8</td>
<td>39.2</td>
<td>2025-11-30 09:06:52 ~ 2025-11-30 09:07:22</td>
</tr>
<tr>
<td>oltp_read_only</td>
<td>32</td>
<td>50,146</td>
<td>3,134</td>
<td>10.21</td>
<td>14.46</td>
<td>2.7</td>
<td>81.9</td>
<td>9.9</td>
<td>0.1</td>
<td>38.8</td>
<td>2025-11-30 09:07:24 ~ 2025-11-30 09:07:54</td>
</tr>
<tr>
<td>oltp_read_only</td>
<td>64</td>
<td>49,763</td>
<td>3,110</td>
<td>20.57</td>
<td>23.95</td>
<td>2.8</td>
<td>81.8</td>
<td>9.9</td>
<td>0.0</td>
<td>36.6</td>
<td>2025-11-30 09:07:56 ~ 2025-11-30 09:08:26</td>
</tr>
<tr>
<td>oltp_read_only</td>
<td>128</td>
<td>49,209</td>
<td>3,076</td>
<td>41.59</td>
<td>45.79</td>
<td>2.8</td>
<td>80.9</td>
<td>10.1</td>
<td>0.0</td>
<td>35.3</td>
<td>2025-11-30 09:08:28 ~ 2025-11-30 09:08:58</td>
</tr>
<tr>
<td>oltp_read_write</td>
<td>1</td>
<td>5,074</td>
<td>254</td>
<td>3.94</td>
<td>4.82</td>
<td>0.3</td>
<td>5.6</td>
<td>1.9</td>
<td>4.6</td>
<td>68.4</td>
<td>2025-11-30 09:09:00 ~ 2025-11-30 09:09:30</td>
</tr>
<tr>
<td>oltp_read_write</td>
<td>8</td>
<td>29,077</td>
<td>1,454</td>
<td>5.50</td>
<td>6.79</td>
<td>2.3</td>
<td>40.2</td>
<td>8.5</td>
<td>10.0</td>
<td>96.1</td>
<td>2025-11-30 09:09:32 ~ 2025-11-30 09:10:02</td>
</tr>
<tr>
<td>oltp_read_write</td>
<td>16</td>
<td>41,737</td>
<td>2,087</td>
<td>7.66</td>
<td>10.09</td>
<td>3.1</td>
<td>61.4</td>
<td>10.3</td>
<td>4.4</td>
<td>96.0</td>
<td>2025-11-30 09:10:04 ~ 2025-11-30 09:10:34</td>
</tr>
<tr>
<td>oltp_read_write</td>
<td>32</td>
<td>47,906</td>
<td>2,395</td>
<td>13.35</td>
<td>19.29</td>
<td>2.8</td>
<td>70.4</td>
<td>10.0</td>
<td>2.0</td>
<td>90.2</td>
<td>2025-11-30 09:10:36 ~ 2025-11-30 09:11:06</td>
</tr>
<tr>
<td>oltp_read_write</td>
<td>64</td>
<td>49,160</td>
<td>2,458</td>
<td>26.02</td>
<td>50.11</td>
<td>2.8</td>
<td>72.8</td>
<td>10.7</td>
<td>1.2</td>
<td>81.6</td>
<td>2025-11-30 09:11:08 ~ 2025-11-30 09:11:39</td>
</tr>
<tr>
<td>oltp_read_write</td>
<td>128</td>
<td>50,050</td>
<td>2,503</td>
<td>51.10</td>
<td>125.52</td>
<td>3.0</td>
<td>76.5</td>
<td>11.0</td>
<td>0.7</td>
<td>76.1</td>
<td>2025-11-30 09:11:41 ~ 2025-11-30 09:12:11</td>
</tr>
<tr>
<td>oltp_write_only</td>
<td>1</td>
<td>3,575</td>
<td>596</td>
<td>1.68</td>
<td>2.57</td>
<td>0.2</td>
<td>2.7</td>
<td>1.2</td>
<td>7.5</td>
<td>96.1</td>
<td>2025-11-30 09:12:13 ~ 2025-11-30 09:12:43</td>
</tr>
<tr>
<td>oltp_write_only</td>
<td>8</td>
<td>21,479</td>
<td>3,580</td>
<td>2.23</td>
<td>3.07</td>
<td>1.6</td>
<td>16.4</td>
<td>5.0</td>
<td>9.7</td>
<td>96.2</td>
<td>2025-11-30 09:12:45 ~ 2025-11-30 09:13:15</td>
</tr>
<tr>
<td>oltp_write_only</td>
<td>16</td>
<td>37,696</td>
<td>6,283</td>
<td>2.55</td>
<td>3.49</td>
<td>2.8</td>
<td>28.8</td>
<td>8.5</td>
<td>7.4</td>
<td>96.0</td>
<td>2025-11-30 09:13:17 ~ 2025-11-30 09:13:47</td>
</tr>
<tr>
<td>oltp_write_only</td>
<td>32</td>
<td>59,664</td>
<td>9,944</td>
<td>3.22</td>
<td>4.41</td>
<td>4.0</td>
<td>44.1</td>
<td>13.1</td>
<td>4.4</td>
<td>95.9</td>
<td>2025-11-30 09:13:49 ~ 2025-11-30 09:14:19</td>
</tr>
<tr>
<td>oltp_write_only</td>
<td>64</td>
<td>76,279</td>
<td>12,713</td>
<td>5.03</td>
<td>7.30</td>
<td>4.3</td>
<td>55.4</td>
<td>15.5</td>
<td>2.4</td>
<td>95.0</td>
<td>2025-11-30 09:14:21 ~ 2025-11-30 09:14:51</td>
</tr>
<tr>
<td>oltp_write_only</td>
<td>128</td>
<td>79,531</td>
<td>13,255</td>
<td>9.65</td>
<td>14.46</td>
<td>4.4</td>
<td>57.5</td>
<td>16.0</td>
<td>1.9</td>
<td>87.8</td>
<td>2025-11-30 09:14:53 ~ 2025-11-30 09:15:24</td>
</tr>
</tbody></table>
<hr>
<hr>
<h1 id="第九章：aws-io2-环境详细报告"><a href="#第九章：aws-io2-环境详细报告" class="headerlink" title="第九章：aws.io2 环境详细报告"></a>第九章：aws.io2 环境详细报告</h1><p><strong>测试时间</strong>: 2025-11-30 08:10:38<br><strong>测试工具</strong>: sysbench + tsar (按时间段精确匹配)<br><strong>tsar数据样本</strong>: 1879 条记录  </p>
<h2 id="测试配置信息-8"><a href="#测试配置信息-8" class="headerlink" title="测试配置信息"></a>测试配置信息</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">=== 测试配置信息 ===</span><br><span class="line">MYSQL_HOST: 10.1.2.89</span><br><span class="line">MYSQL_PORT: 3306</span><br><span class="line">TABLES: 16</span><br><span class="line">TABLE_SIZE: 10000000</span><br><span class="line">TEST_TIME: 30</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="MySQL配置参数-8"><a href="#MySQL配置参数-8" class="headerlink" title="MySQL配置参数"></a>MySQL配置参数</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mysql: [Warning] Using a password on the command line interface can be insecure.</span><br><span class="line">Variable_name	Value</span><br><span class="line">innodb_buffer_pool_size	17179869184</span><br><span class="line">innodb_flush_log_at_trx_commit	2</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="压测服务器配置-8"><a href="#压测服务器配置-8" class="headerlink" title="压测服务器配置"></a>压测服务器配置</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">=== CPU 信息 ===</span><br><span class="line">架构：           x86_64</span><br><span class="line">CPU 运行模式：   32-bit, 64-bit</span><br><span class="line">字节序：         Little Endian</span><br><span class="line">CPU:             8</span><br><span class="line">在线 CPU 列表：  0-7</span><br><span class="line">每个核的线程数： 2</span><br><span class="line">每个座的核数：   4</span><br><span class="line">座：             1</span><br><span class="line">NUMA 节点：      1</span><br><span class="line">厂商 ID：        GenuineIntel</span><br><span class="line">BIOS Vendor ID:  Intel(R) Corporation</span><br><span class="line">CPU 系列：       6</span><br><span class="line">型号：           106</span><br><span class="line">型号名称：       Intel(R) Xeon(R) Platinum 8375C CPU @ 2.90GHz</span><br><span class="line">BIOS Model name: Intel(R) Xeon(R) Platinum 8375C CPU @ 2.90GHz</span><br><span class="line">步进：           6</span><br><span class="line">CPU MHz：        2899.956</span><br><span class="line">BogoMIPS：       5799.91</span><br><span class="line">超管理器厂商：   KVM</span><br><span class="line">虚拟化类型：     完全</span><br><span class="line">L1d 缓存：       48K</span><br><span class="line">L1i 缓存：       32K</span><br><span class="line">L2 缓存：        1280K</span><br><span class="line">L3 缓存：        55296K</span><br><span class="line">NUMA 节点0 CPU： 0-7</span><br><span class="line">标记：           fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov pat pse36 clflush mmx fxsr sse sse2 ss ht syscall nx pdpe1gb rdtscp lm constant_tsc rep_good nopl xtopology nonstop_tsc cpuid aperfmperf tsc_known_freq pni pclmulqdq ssse3 fma cx16 pcid sse4_1 sse4_2 x2apic movbe popcnt tsc_deadline_timer aes xsave avx f16c rdrand hypervisor lahf_lm abm 3dnowprefetch cpuid_fault invpcid_single ssbd ibrs ibpb stibp ibrs_enhanced fsgsbase tsc_adjust bmi1 avx2 smep bmi2 erms invpcid avx512f avx512dq rdseed adx smap avx512ifma clflushopt clwb avx512cd sha_ni avx512bw avx512vl xsaveopt xsavec xgetbv1 xsaves wbnoinvd ida arat avx512vbmi pku ospke avx512_vbmi2 gfni vaes vpclmulqdq avx512_vnni avx512_bitalg tme avx512_vpopcntdq rdpid md_clear flush_l1d arch_capabilities</span><br><span class="line"></span><br><span class="line">=== 内存信息 ===</span><br><span class="line">              total        used        free      shared  buff/cache   available</span><br><span class="line">Mem:           30Gi        18Gi       251Mi        24Mi        12Gi        11Gi</span><br><span class="line">Swap:            0B          0B          0B</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="性能测试结果汇总-含CPU-IO监控数据-8"><a href="#性能测试结果汇总-含CPU-IO监控数据-8" class="headerlink" title="性能测试结果汇总 (含CPU&#x2F;IO监控数据)"></a>性能测试结果汇总 (含CPU&#x2F;IO监控数据)</h2><table>
<thead>
<tr>
<th>测试场景</th>
<th>并发数</th>
<th>QPS</th>
<th>TPS</th>
<th>平均延迟(ms)</th>
<th>95%延迟(ms)</th>
<th>CPU软中断(%)</th>
<th>CPU用户(%)</th>
<th>CPU系统(%)</th>
<th>CPU等待(%)</th>
<th>IO利用率(%)</th>
<th>测试时间段</th>
</tr>
</thead>
<tbody><tr>
<td>oltp_point_select</td>
<td>1</td>
<td>12,004</td>
<td>12,004</td>
<td>0.08</td>
<td>0.09</td>
<td>0.6</td>
<td>2.8</td>
<td>0.8</td>
<td>0.9</td>
<td>20.1</td>
<td>2025-11-30 07:57:47 ~ 2025-11-30 07:58:17</td>
</tr>
<tr>
<td>oltp_point_select</td>
<td>8</td>
<td>75,171</td>
<td>75,171</td>
<td>0.11</td>
<td>0.12</td>
<td>5.2</td>
<td>27.1</td>
<td>8.4</td>
<td>4.6</td>
<td>70.1</td>
<td>2025-11-30 07:58:19 ~ 2025-11-30 07:58:49</td>
</tr>
<tr>
<td>oltp_point_select</td>
<td>16</td>
<td>126,712</td>
<td>126,712</td>
<td>0.13</td>
<td>0.18</td>
<td>8.3</td>
<td>44.3</td>
<td>20.8</td>
<td>2.3</td>
<td>83.8</td>
<td>2025-11-30 07:58:51 ~ 2025-11-30 07:59:21</td>
</tr>
<tr>
<td>oltp_point_select</td>
<td>32</td>
<td>160,866</td>
<td>160,866</td>
<td>0.20</td>
<td>0.32</td>
<td>7.6</td>
<td>55.6</td>
<td>27.6</td>
<td>0.7</td>
<td>88.5</td>
<td>2025-11-30 07:59:23 ~ 2025-11-30 07:59:53</td>
</tr>
<tr>
<td>oltp_point_select</td>
<td>64</td>
<td>157,480</td>
<td>157,480</td>
<td>0.41</td>
<td>0.55</td>
<td>7.6</td>
<td>57.3</td>
<td>28.3</td>
<td>0.0</td>
<td>86.7</td>
<td>2025-11-30 07:59:55 ~ 2025-11-30 08:00:25</td>
</tr>
<tr>
<td>oltp_point_select</td>
<td>128</td>
<td>153,448</td>
<td>153,448</td>
<td>0.83</td>
<td>1.08</td>
<td>7.5</td>
<td>55.8</td>
<td>27.9</td>
<td>0.0</td>
<td>78.9</td>
<td>2025-11-30 08:00:27 ~ 2025-11-30 08:00:58</td>
</tr>
<tr>
<td>oltp_read_only</td>
<td>1</td>
<td>7,039</td>
<td>440</td>
<td>2.27</td>
<td>2.86</td>
<td>0.4</td>
<td>6.0</td>
<td>0.6</td>
<td>0.4</td>
<td>8.2</td>
<td>2025-11-30 08:01:00 ~ 2025-11-30 08:01:30</td>
</tr>
<tr>
<td>oltp_read_only</td>
<td>8</td>
<td>39,720</td>
<td>2,482</td>
<td>3.22</td>
<td>3.82</td>
<td>3.1</td>
<td>56.1</td>
<td>6.5</td>
<td>2.0</td>
<td>36.4</td>
<td>2025-11-30 08:01:32 ~ 2025-11-30 08:02:02</td>
</tr>
<tr>
<td>oltp_read_only</td>
<td>16</td>
<td>47,558</td>
<td>2,972</td>
<td>5.38</td>
<td>7.70</td>
<td>2.7</td>
<td>75.0</td>
<td>7.7</td>
<td>0.9</td>
<td>39.3</td>
<td>2025-11-30 08:02:04 ~ 2025-11-30 08:02:34</td>
</tr>
<tr>
<td>oltp_read_only</td>
<td>32</td>
<td>49,995</td>
<td>3,125</td>
<td>10.24</td>
<td>14.73</td>
<td>2.8</td>
<td>82.1</td>
<td>10.0</td>
<td>0.1</td>
<td>39.2</td>
<td>2025-11-30 08:02:36 ~ 2025-11-30 08:03:06</td>
</tr>
<tr>
<td>oltp_read_only</td>
<td>64</td>
<td>49,821</td>
<td>3,114</td>
<td>20.55</td>
<td>23.95</td>
<td>2.8</td>
<td>82.1</td>
<td>10.3</td>
<td>0.0</td>
<td>38.9</td>
<td>2025-11-30 08:03:08 ~ 2025-11-30 08:03:38</td>
</tr>
<tr>
<td>oltp_read_only</td>
<td>128</td>
<td>49,165</td>
<td>3,073</td>
<td>41.63</td>
<td>45.79</td>
<td>2.8</td>
<td>82.0</td>
<td>10.5</td>
<td>0.0</td>
<td>36.4</td>
<td>2025-11-30 08:03:40 ~ 2025-11-30 08:04:10</td>
</tr>
<tr>
<td>oltp_read_write</td>
<td>1</td>
<td>6,743</td>
<td>337</td>
<td>2.96</td>
<td>3.89</td>
<td>0.4</td>
<td>7.3</td>
<td>2.5</td>
<td>2.5</td>
<td>50.3</td>
<td>2025-11-30 08:04:12 ~ 2025-11-30 08:04:42</td>
</tr>
<tr>
<td>oltp_read_write</td>
<td>8</td>
<td>35,997</td>
<td>1,800</td>
<td>4.44</td>
<td>5.88</td>
<td>2.8</td>
<td>53.1</td>
<td>10.6</td>
<td>4.7</td>
<td>94.0</td>
<td>2025-11-30 08:04:44 ~ 2025-11-30 08:05:14</td>
</tr>
<tr>
<td>oltp_read_write</td>
<td>16</td>
<td>45,274</td>
<td>2,264</td>
<td>7.07</td>
<td>10.65</td>
<td>2.9</td>
<td>69.0</td>
<td>11.1</td>
<td>2.4</td>
<td>85.7</td>
<td>2025-11-30 08:05:16 ~ 2025-11-30 08:05:46</td>
</tr>
<tr>
<td>oltp_read_write</td>
<td>32</td>
<td>50,664</td>
<td>2,533</td>
<td>12.63</td>
<td>19.65</td>
<td>2.9</td>
<td>78.5</td>
<td>11.3</td>
<td>0.5</td>
<td>76.2</td>
<td>2025-11-30 08:05:48 ~ 2025-11-30 08:06:18</td>
</tr>
<tr>
<td>oltp_read_write</td>
<td>64</td>
<td>51,002</td>
<td>2,550</td>
<td>25.08</td>
<td>47.47</td>
<td>2.8</td>
<td>77.0</td>
<td>11.0</td>
<td>0.3</td>
<td>71.6</td>
<td>2025-11-30 08:06:20 ~ 2025-11-30 08:06:51</td>
</tr>
<tr>
<td>oltp_read_write</td>
<td>128</td>
<td>50,315</td>
<td>2,516</td>
<td>50.83</td>
<td>139.85</td>
<td>3.0</td>
<td>78.0</td>
<td>11.5</td>
<td>0.4</td>
<td>71.6</td>
<td>2025-11-30 08:06:53 ~ 2025-11-30 08:07:23</td>
</tr>
<tr>
<td>oltp_write_only</td>
<td>1</td>
<td>8,881</td>
<td>1,480</td>
<td>0.68</td>
<td>1.61</td>
<td>0.5</td>
<td>5.9</td>
<td>2.3</td>
<td>2.3</td>
<td>31.3</td>
<td>2025-11-30 08:07:25 ~ 2025-11-30 08:07:55</td>
</tr>
<tr>
<td>oltp_write_only</td>
<td>8</td>
<td>44,059</td>
<td>7,343</td>
<td>1.09</td>
<td>2.00</td>
<td>3.2</td>
<td>34.6</td>
<td>12.0</td>
<td>4.8</td>
<td>71.6</td>
<td>2025-11-30 08:07:57 ~ 2025-11-30 08:08:27</td>
</tr>
<tr>
<td>oltp_write_only</td>
<td>16</td>
<td>64,137</td>
<td>10,690</td>
<td>1.50</td>
<td>2.52</td>
<td>4.4</td>
<td>49.6</td>
<td>16.0</td>
<td>3.7</td>
<td>78.3</td>
<td>2025-11-30 08:08:29 ~ 2025-11-30 08:08:59</td>
</tr>
<tr>
<td>oltp_write_only</td>
<td>32</td>
<td>79,024</td>
<td>13,171</td>
<td>2.43</td>
<td>4.25</td>
<td>4.5</td>
<td>58.9</td>
<td>17.1</td>
<td>2.0</td>
<td>81.3</td>
<td>2025-11-30 08:09:01 ~ 2025-11-30 08:09:31</td>
</tr>
<tr>
<td>oltp_write_only</td>
<td>64</td>
<td>79,754</td>
<td>13,292</td>
<td>4.81</td>
<td>13.70</td>
<td>4.5</td>
<td>59.5</td>
<td>17.6</td>
<td>1.6</td>
<td>81.6</td>
<td>2025-11-30 08:09:33 ~ 2025-11-30 08:10:03</td>
</tr>
<tr>
<td>oltp_write_only</td>
<td>128</td>
<td>70,019</td>
<td>11,670</td>
<td>10.96</td>
<td>38.94</td>
<td>4.1</td>
<td>53.5</td>
<td>16.8</td>
<td>2.3</td>
<td>84.7</td>
<td>2025-11-30 08:10:05 ~ 2025-11-30 08:10:35</td>
</tr>
</tbody></table>
<hr>
<hr>
<h1 id="第十章：aws-io1-环境详细报告"><a href="#第十章：aws-io1-环境详细报告" class="headerlink" title="第十章：aws.io1 环境详细报告"></a>第十章：aws.io1 环境详细报告</h1><p><strong>测试时间</strong>: 2025-11-28 11:09:53<br><strong>测试工具</strong>: sysbench + tsar (按时间段精确匹配)<br><strong>tsar数据样本</strong>: 7925 条记录  </p>
<h2 id="测试配置信息-9"><a href="#测试配置信息-9" class="headerlink" title="测试配置信息"></a>测试配置信息</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">=== 测试配置信息 ===</span><br><span class="line">MYSQL_HOST: 10.1.0.47</span><br><span class="line">MYSQL_PORT: 3306</span><br><span class="line">TABLES: 16</span><br><span class="line">TABLE_SIZE: 10000000</span><br><span class="line">TEST_TIME: 30</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="MySQL配置参数-9"><a href="#MySQL配置参数-9" class="headerlink" title="MySQL配置参数"></a>MySQL配置参数</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mysql: [Warning] Using a password on the command line interface can be insecure.</span><br><span class="line">Variable_name	Value</span><br><span class="line">innodb_buffer_pool_size	17179869184</span><br><span class="line">innodb_flush_log_at_trx_commit	2</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="压测服务器配置-9"><a href="#压测服务器配置-9" class="headerlink" title="压测服务器配置"></a>压测服务器配置</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">=== CPU 信息 ===</span><br><span class="line">架构：           x86_64</span><br><span class="line">CPU 运行模式：   32-bit, 64-bit</span><br><span class="line">字节序：         Little Endian</span><br><span class="line">CPU:             8</span><br><span class="line">在线 CPU 列表：  0-7</span><br><span class="line">每个核的线程数： 2</span><br><span class="line">每个座的核数：   4</span><br><span class="line">座：             1</span><br><span class="line">NUMA 节点：      1</span><br><span class="line">厂商 ID：        GenuineIntel</span><br><span class="line">BIOS Vendor ID:  Intel(R) Corporation</span><br><span class="line">CPU 系列：       6</span><br><span class="line">型号：           143</span><br><span class="line">型号名称：       Intel(R) Xeon(R) Platinum 8488C</span><br><span class="line">BIOS Model name: Intel(R) Xeon(R) Platinum 8488C</span><br><span class="line">步进：           8</span><br><span class="line">CPU MHz：        2400.000</span><br><span class="line">BogoMIPS：       4800.00</span><br><span class="line">超管理器厂商：   KVM</span><br><span class="line">虚拟化类型：     完全</span><br><span class="line">L1d 缓存：       48K</span><br><span class="line">L1i 缓存：       32K</span><br><span class="line">L2 缓存：        2048K</span><br><span class="line">L3 缓存：        107520K</span><br><span class="line">NUMA 节点0 CPU： 0-7</span><br><span class="line">标记：           fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov pat pse36 clflush mmx fxsr sse sse2 ss ht syscall nx pdpe1gb rdtscp lm constant_tsc arch_perfmon rep_good nopl xtopology nonstop_tsc cpuid aperfmperf tsc_known_freq pni pclmulqdq monitor ssse3 fma cx16 pdcm pcid sse4_1 sse4_2 x2apic movbe popcnt tsc_deadline_timer aes xsave avx f16c rdrand hypervisor lahf_lm abm 3dnowprefetch cpuid_fault invpcid_single ssbd ibrs ibpb stibp ibrs_enhanced fsgsbase tsc_adjust bmi1 avx2 smep bmi2 erms invpcid avx512f avx512dq rdseed adx smap avx512ifma clflushopt clwb avx512cd sha_ni avx512bw avx512vl xsaveopt xsavec xgetbv1 xsaves avx_vnni avx512_bf16 wbnoinvd ida arat avx512vbmi umip pku ospke waitpkg avx512_vbmi2 gfni vaes vpclmulqdq avx512_vnni avx512_bitalg tme avx512_vpopcntdq rdpid cldemote movdiri movdir64b md_clear serialize amx_bf16 avx512_fp16 amx_tile amx_int8 flush_l1d arch_capabilities</span><br><span class="line"></span><br><span class="line">=== 内存信息 ===</span><br><span class="line">              total        used        free      shared  buff/cache   available</span><br><span class="line">Mem:           30Gi        21Gi       253Mi        16Mi       8.9Gi       8.7Gi</span><br><span class="line">Swap:            0B          0B          0B</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="性能测试结果汇总-含CPU-IO监控数据-9"><a href="#性能测试结果汇总-含CPU-IO监控数据-9" class="headerlink" title="性能测试结果汇总 (含CPU&#x2F;IO监控数据)"></a>性能测试结果汇总 (含CPU&#x2F;IO监控数据)</h2><table>
<thead>
<tr>
<th>测试场景</th>
<th>并发数</th>
<th>QPS</th>
<th>TPS</th>
<th>平均延迟(ms)</th>
<th>95%延迟(ms)</th>
<th>CPU软中断(%)</th>
<th>CPU用户(%)</th>
<th>CPU系统(%)</th>
<th>CPU等待(%)</th>
<th>IO利用率(%)</th>
<th>测试时间段</th>
</tr>
</thead>
<tbody><tr>
<td>oltp_point_select</td>
<td>1</td>
<td>1,835</td>
<td>1,835</td>
<td>0.54</td>
<td>0.72</td>
<td>0.3</td>
<td>2.4</td>
<td>1.0</td>
<td>8.6</td>
<td>89.6</td>
<td>2025-11-28 10:57:00 ~ 2025-11-28 10:57:30</td>
</tr>
<tr>
<td>oltp_point_select</td>
<td>8</td>
<td>56,871</td>
<td>56,871</td>
<td>0.14</td>
<td>0.49</td>
<td>3.1</td>
<td>14.2</td>
<td>5.2</td>
<td>5.4</td>
<td>64.7</td>
<td>2025-11-28 10:57:32 ~ 2025-11-28 10:58:02</td>
</tr>
<tr>
<td>oltp_point_select</td>
<td>16</td>
<td>170,296</td>
<td>170,296</td>
<td>0.09</td>
<td>0.13</td>
<td>7.4</td>
<td>43.1</td>
<td>19.7</td>
<td>3.1</td>
<td>90.8</td>
<td>2025-11-28 10:58:04 ~ 2025-11-28 10:58:34</td>
</tr>
<tr>
<td>oltp_point_select</td>
<td>32</td>
<td>251,905</td>
<td>251,905</td>
<td>0.13</td>
<td>0.20</td>
<td>6.2</td>
<td>58.5</td>
<td>25.3</td>
<td>1.3</td>
<td>94.2</td>
<td>2025-11-28 10:58:36 ~ 2025-11-28 10:59:06</td>
</tr>
<tr>
<td>oltp_point_select</td>
<td>64</td>
<td>249,718</td>
<td>249,718</td>
<td>0.26</td>
<td>0.36</td>
<td>7.1</td>
<td>59.0</td>
<td>28.1</td>
<td>0.0</td>
<td>90.9</td>
<td>2025-11-28 10:59:08 ~ 2025-11-28 10:59:38</td>
</tr>
<tr>
<td>oltp_point_select</td>
<td>128</td>
<td>236,283</td>
<td>236,283</td>
<td>0.54</td>
<td>0.72</td>
<td>6.5</td>
<td>59.9</td>
<td>27.8</td>
<td>0.0</td>
<td>83.4</td>
<td>2025-11-28 10:59:40 ~ 2025-11-28 11:00:10</td>
</tr>
<tr>
<td>oltp_read_only</td>
<td>1</td>
<td>1,845</td>
<td>115</td>
<td>8.67</td>
<td>10.46</td>
<td>0.3</td>
<td>2.2</td>
<td>0.3</td>
<td>0.1</td>
<td>1.5</td>
<td>2025-11-28 11:00:12 ~ 2025-11-28 11:00:42</td>
</tr>
<tr>
<td>oltp_read_only</td>
<td>8</td>
<td>28,879</td>
<td>1,805</td>
<td>4.43</td>
<td>7.43</td>
<td>2.0</td>
<td>26.8</td>
<td>3.6</td>
<td>1.0</td>
<td>20.0</td>
<td>2025-11-28 11:00:44 ~ 2025-11-28 11:01:14</td>
</tr>
<tr>
<td>oltp_read_only</td>
<td>16</td>
<td>64,551</td>
<td>4,034</td>
<td>3.96</td>
<td>5.88</td>
<td>2.7</td>
<td>66.8</td>
<td>7.7</td>
<td>0.7</td>
<td>37.5</td>
<td>2025-11-28 11:01:16 ~ 2025-11-28 11:01:46</td>
</tr>
<tr>
<td>oltp_read_only</td>
<td>32</td>
<td>73,173</td>
<td>4,573</td>
<td>6.99</td>
<td>11.24</td>
<td>2.5</td>
<td>79.5</td>
<td>9.2</td>
<td>0.3</td>
<td>39.7</td>
<td>2025-11-28 11:01:48 ~ 2025-11-28 11:02:18</td>
</tr>
<tr>
<td>oltp_read_only</td>
<td>64</td>
<td>74,400</td>
<td>4,650</td>
<td>13.76</td>
<td>19.65</td>
<td>2.6</td>
<td>81.9</td>
<td>10.0</td>
<td>0.0</td>
<td>37.2</td>
<td>2025-11-28 11:02:20 ~ 2025-11-28 11:02:50</td>
</tr>
<tr>
<td>oltp_read_only</td>
<td>128</td>
<td>74,024</td>
<td>4,626</td>
<td>27.65</td>
<td>31.37</td>
<td>2.5</td>
<td>81.6</td>
<td>10.0</td>
<td>0.0</td>
<td>36.0</td>
<td>2025-11-28 11:02:52 ~ 2025-11-28 11:03:22</td>
</tr>
<tr>
<td>oltp_read_write</td>
<td>1</td>
<td>1,924</td>
<td>96</td>
<td>10.39</td>
<td>13.95</td>
<td>0.3</td>
<td>3.0</td>
<td>1.2</td>
<td>2.6</td>
<td>37.3</td>
<td>2025-11-28 11:03:24 ~ 2025-11-28 11:03:54</td>
</tr>
<tr>
<td>oltp_read_write</td>
<td>8</td>
<td>24,967</td>
<td>1,248</td>
<td>6.41</td>
<td>9.73</td>
<td>1.6</td>
<td>26.0</td>
<td>6.0</td>
<td>8.2</td>
<td>92.0</td>
<td>2025-11-28 11:03:56 ~ 2025-11-28 11:04:27</td>
</tr>
<tr>
<td>oltp_read_write</td>
<td>16</td>
<td>54,742</td>
<td>2,737</td>
<td>5.84</td>
<td>9.06</td>
<td>2.7</td>
<td>59.0</td>
<td>10.1</td>
<td>4.5</td>
<td>95.7</td>
<td>2025-11-28 11:04:29 ~ 2025-11-28 11:04:59</td>
</tr>
<tr>
<td>oltp_read_write</td>
<td>32</td>
<td>68,211</td>
<td>3,411</td>
<td>9.38</td>
<td>13.70</td>
<td>2.6</td>
<td>73.2</td>
<td>10.3</td>
<td>2.2</td>
<td>89.3</td>
<td>2025-11-28 11:05:01 ~ 2025-11-28 11:05:31</td>
</tr>
<tr>
<td>oltp_read_write</td>
<td>64</td>
<td>71,816</td>
<td>3,591</td>
<td>17.81</td>
<td>29.72</td>
<td>2.7</td>
<td>78.2</td>
<td>11.2</td>
<td>0.7</td>
<td>88.3</td>
<td>2025-11-28 11:05:33 ~ 2025-11-28 11:06:03</td>
</tr>
<tr>
<td>oltp_read_write</td>
<td>128</td>
<td>70,575</td>
<td>3,529</td>
<td>36.24</td>
<td>106.75</td>
<td>2.7</td>
<td>76.1</td>
<td>11.0</td>
<td>1.2</td>
<td>88.7</td>
<td>2025-11-28 11:06:05 ~ 2025-11-28 11:06:35</td>
</tr>
<tr>
<td>oltp_write_only</td>
<td>1</td>
<td>1,786</td>
<td>298</td>
<td>3.36</td>
<td>5.09</td>
<td>0.3</td>
<td>2.6</td>
<td>1.1</td>
<td>3.4</td>
<td>35.3</td>
<td>2025-11-28 11:06:37 ~ 2025-11-28 11:07:07</td>
</tr>
<tr>
<td>oltp_write_only</td>
<td>8</td>
<td>19,047</td>
<td>3,174</td>
<td>2.52</td>
<td>4.82</td>
<td>1.4</td>
<td>13.9</td>
<td>4.7</td>
<td>6.8</td>
<td>65.8</td>
<td>2025-11-28 11:07:09 ~ 2025-11-28 11:07:39</td>
</tr>
<tr>
<td>oltp_write_only</td>
<td>16</td>
<td>39,006</td>
<td>6,501</td>
<td>2.46</td>
<td>4.65</td>
<td>2.2</td>
<td>25.9</td>
<td>8.5</td>
<td>7.0</td>
<td>80.9</td>
<td>2025-11-28 11:07:41 ~ 2025-11-28 11:08:11</td>
</tr>
<tr>
<td>oltp_write_only</td>
<td>32</td>
<td>68,442</td>
<td>11,407</td>
<td>2.80</td>
<td>5.37</td>
<td>3.0</td>
<td>41.0</td>
<td>12.3</td>
<td>5.7</td>
<td>87.6</td>
<td>2025-11-28 11:08:13 ~ 2025-11-28 11:08:43</td>
</tr>
<tr>
<td>oltp_write_only</td>
<td>64</td>
<td>94,216</td>
<td>15,703</td>
<td>4.07</td>
<td>7.70</td>
<td>3.6</td>
<td>53.5</td>
<td>15.8</td>
<td>3.8</td>
<td>91.0</td>
<td>2025-11-28 11:08:45 ~ 2025-11-28 11:09:16</td>
</tr>
<tr>
<td>oltp_write_only</td>
<td>128</td>
<td>66,370</td>
<td>11,062</td>
<td>11.37</td>
<td>24.38</td>
<td>2.5</td>
<td>39.9</td>
<td>12.5</td>
<td>5.2</td>
<td>96.3</td>
<td>2025-11-28 11:09:18 ~ 2025-11-28 11:09:51</td>
</tr>
</tbody></table>
<hr>
<hr>
<h1 id="第十一章：aws-gp3-环境详细报告"><a href="#第十一章：aws-gp3-环境详细报告" class="headerlink" title="第十一章：aws.gp3 环境详细报告"></a>第十一章：aws.gp3 环境详细报告</h1><p><strong>测试时间</strong>: 2025-11-28 11:28:11<br><strong>测试工具</strong>: sysbench + tsar (按时间段精确匹配)<br><strong>tsar数据样本</strong>: 8979 条记录  </p>
<h2 id="测试配置信息-10"><a href="#测试配置信息-10" class="headerlink" title="测试配置信息"></a>测试配置信息</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">=== 测试配置信息 ===</span><br><span class="line">MYSQL_HOST: 10.1.0.52</span><br><span class="line">MYSQL_PORT: 3306</span><br><span class="line">TABLES: 16</span><br><span class="line">TABLE_SIZE: 10000000</span><br><span class="line">TEST_TIME: 30</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="MySQL配置参数-10"><a href="#MySQL配置参数-10" class="headerlink" title="MySQL配置参数"></a>MySQL配置参数</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mysql: [Warning] Using a password on the command line interface can be insecure.</span><br><span class="line">Variable_name	Value</span><br><span class="line">innodb_buffer_pool_size	17179869184</span><br><span class="line">innodb_flush_log_at_trx_commit	2</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="压测服务器配置-10"><a href="#压测服务器配置-10" class="headerlink" title="压测服务器配置"></a>压测服务器配置</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">=== CPU 信息 ===</span><br><span class="line">架构：           x86_64</span><br><span class="line">CPU 运行模式：   32-bit, 64-bit</span><br><span class="line">字节序：         Little Endian</span><br><span class="line">CPU:             8</span><br><span class="line">在线 CPU 列表：  0-7</span><br><span class="line">每个核的线程数： 2</span><br><span class="line">每个座的核数：   4</span><br><span class="line">座：             1</span><br><span class="line">NUMA 节点：      1</span><br><span class="line">厂商 ID：        GenuineIntel</span><br><span class="line">BIOS Vendor ID:  (invalid)</span><br><span class="line">CPU 系列：       6</span><br><span class="line">型号：           143</span><br><span class="line">型号名称：       Intel(R) Xeon(R) Platinum 8488C</span><br><span class="line">BIOS Model name: (invalid)</span><br><span class="line">步进：           8</span><br><span class="line">CPU MHz：        3437.734</span><br><span class="line">BogoMIPS：       4800.00</span><br><span class="line">超管理器厂商：   KVM</span><br><span class="line">虚拟化类型：     完全</span><br><span class="line">L1d 缓存：       48K</span><br><span class="line">L1i 缓存：       32K</span><br><span class="line">L2 缓存：        2048K</span><br><span class="line">L3 缓存：        107520K</span><br><span class="line">NUMA 节点0 CPU： 0-7</span><br><span class="line">标记：           fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov pat pse36 clflush mmx fxsr sse sse2 ss ht syscall nx pdpe1gb rdtscp lm constant_tsc arch_perfmon rep_good nopl xtopology nonstop_tsc cpuid aperfmperf tsc_known_freq pni pclmulqdq monitor ssse3 fma cx16 pdcm pcid sse4_1 sse4_2 x2apic movbe popcnt tsc_deadline_timer aes xsave avx f16c rdrand hypervisor lahf_lm abm 3dnowprefetch cpuid_fault invpcid_single ssbd ibrs ibpb stibp ibrs_enhanced fsgsbase tsc_adjust bmi1 avx2 smep bmi2 erms invpcid avx512f avx512dq rdseed adx smap avx512ifma clflushopt clwb avx512cd sha_ni avx512bw avx512vl xsaveopt xsavec xgetbv1 xsaves avx_vnni avx512_bf16 wbnoinvd ida arat avx512vbmi umip pku ospke waitpkg avx512_vbmi2 gfni vaes vpclmulqdq avx512_vnni avx512_bitalg tme avx512_vpopcntdq rdpid cldemote movdiri movdir64b md_clear serialize amx_bf16 avx512_fp16 amx_tile amx_int8 flush_l1d arch_capabilities</span><br><span class="line"></span><br><span class="line">=== 内存信息 ===</span><br><span class="line">              total        used        free      shared  buff/cache   available</span><br><span class="line">Mem:           30Gi        21Gi       514Mi        16Mi       8.8Gi       8.8Gi</span><br><span class="line">Swap:            0B          0B          0B</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="性能测试结果汇总-含CPU-IO监控数据-10"><a href="#性能测试结果汇总-含CPU-IO监控数据-10" class="headerlink" title="性能测试结果汇总 (含CPU&#x2F;IO监控数据)"></a>性能测试结果汇总 (含CPU&#x2F;IO监控数据)</h2><table>
<thead>
<tr>
<th>测试场景</th>
<th>并发数</th>
<th>QPS</th>
<th>TPS</th>
<th>平均延迟(ms)</th>
<th>95%延迟(ms)</th>
<th>CPU软中断(%)</th>
<th>CPU用户(%)</th>
<th>CPU系统(%)</th>
<th>CPU等待(%)</th>
<th>IO利用率(%)</th>
<th>测试时间段</th>
</tr>
</thead>
<tbody><tr>
<td>oltp_point_select</td>
<td>1</td>
<td>2,316</td>
<td>2,316</td>
<td>0.43</td>
<td>0.67</td>
<td>0.3</td>
<td>1.8</td>
<td>0.5</td>
<td>0.3</td>
<td>4.6</td>
<td>2025-11-28 11:15:20 ~ 2025-11-28 11:15:50</td>
</tr>
<tr>
<td>oltp_point_select</td>
<td>8</td>
<td>60,437</td>
<td>60,437</td>
<td>0.13</td>
<td>0.46</td>
<td>3.0</td>
<td>16.4</td>
<td>6.1</td>
<td>4.7</td>
<td>59.8</td>
<td>2025-11-28 11:15:52 ~ 2025-11-28 11:16:23</td>
</tr>
<tr>
<td>oltp_point_select</td>
<td>16</td>
<td>162,670</td>
<td>162,670</td>
<td>0.10</td>
<td>0.14</td>
<td>7.2</td>
<td>43.6</td>
<td>20.4</td>
<td>3.6</td>
<td>91.5</td>
<td>2025-11-28 11:16:25 ~ 2025-11-28 11:16:55</td>
</tr>
<tr>
<td>oltp_point_select</td>
<td>32</td>
<td>232,535</td>
<td>232,535</td>
<td>0.14</td>
<td>0.23</td>
<td>6.6</td>
<td>58.1</td>
<td>26.7</td>
<td>1.4</td>
<td>94.6</td>
<td>2025-11-28 11:16:57 ~ 2025-11-28 11:17:27</td>
</tr>
<tr>
<td>oltp_point_select</td>
<td>64</td>
<td>228,321</td>
<td>228,321</td>
<td>0.28</td>
<td>0.39</td>
<td>6.9</td>
<td>59.1</td>
<td>28.1</td>
<td>0.0</td>
<td>92.8</td>
<td>2025-11-28 11:17:29 ~ 2025-11-28 11:17:59</td>
</tr>
<tr>
<td>oltp_point_select</td>
<td>128</td>
<td>217,381</td>
<td>217,381</td>
<td>0.59</td>
<td>0.78</td>
<td>6.4</td>
<td>59.6</td>
<td>28.1</td>
<td>0.0</td>
<td>86.7</td>
<td>2025-11-28 11:18:01 ~ 2025-11-28 11:18:31</td>
</tr>
<tr>
<td>oltp_read_only</td>
<td>1</td>
<td>1,692</td>
<td>106</td>
<td>9.45</td>
<td>10.65</td>
<td>0.3</td>
<td>2.2</td>
<td>0.4</td>
<td>0.1</td>
<td>2.0</td>
<td>2025-11-28 11:18:33 ~ 2025-11-28 11:19:03</td>
</tr>
<tr>
<td>oltp_read_only</td>
<td>8</td>
<td>31,915</td>
<td>1,995</td>
<td>4.01</td>
<td>6.67</td>
<td>1.8</td>
<td>34.3</td>
<td>4.6</td>
<td>1.5</td>
<td>26.1</td>
<td>2025-11-28 11:19:05 ~ 2025-11-28 11:19:35</td>
</tr>
<tr>
<td>oltp_read_only</td>
<td>16</td>
<td>59,828</td>
<td>3,739</td>
<td>4.28</td>
<td>6.21</td>
<td>2.7</td>
<td>67.8</td>
<td>8.3</td>
<td>0.9</td>
<td>40.5</td>
<td>2025-11-28 11:19:37 ~ 2025-11-28 11:20:07</td>
</tr>
<tr>
<td>oltp_read_only</td>
<td>32</td>
<td>66,972</td>
<td>4,186</td>
<td>7.64</td>
<td>11.24</td>
<td>2.4</td>
<td>79.6</td>
<td>9.5</td>
<td>0.3</td>
<td>42.0</td>
<td>2025-11-28 11:20:09 ~ 2025-11-28 11:20:39</td>
</tr>
<tr>
<td>oltp_read_only</td>
<td>64</td>
<td>67,678</td>
<td>4,230</td>
<td>15.13</td>
<td>22.28</td>
<td>2.6</td>
<td>81.4</td>
<td>10.1</td>
<td>0.0</td>
<td>41.4</td>
<td>2025-11-28 11:20:41 ~ 2025-11-28 11:21:11</td>
</tr>
<tr>
<td>oltp_read_only</td>
<td>128</td>
<td>67,480</td>
<td>4,217</td>
<td>30.33</td>
<td>34.33</td>
<td>2.4</td>
<td>81.4</td>
<td>10.0</td>
<td>0.0</td>
<td>38.4</td>
<td>2025-11-28 11:21:13 ~ 2025-11-28 11:21:43</td>
</tr>
<tr>
<td>oltp_read_write</td>
<td>1</td>
<td>1,741</td>
<td>87</td>
<td>11.48</td>
<td>15.00</td>
<td>0.3</td>
<td>3.2</td>
<td>1.2</td>
<td>3.1</td>
<td>38.8</td>
<td>2025-11-28 11:21:45 ~ 2025-11-28 11:22:15</td>
</tr>
<tr>
<td>oltp_read_write</td>
<td>8</td>
<td>19,019</td>
<td>951</td>
<td>8.41</td>
<td>17.32</td>
<td>1.3</td>
<td>25.3</td>
<td>5.9</td>
<td>15.7</td>
<td>94.5</td>
<td>2025-11-28 11:22:17 ~ 2025-11-28 11:22:47</td>
</tr>
<tr>
<td>oltp_read_write</td>
<td>16</td>
<td>42,144</td>
<td>2,107</td>
<td>7.59</td>
<td>15.00</td>
<td>2.2</td>
<td>50.3</td>
<td>8.9</td>
<td>10.8</td>
<td>94.7</td>
<td>2025-11-28 11:22:49 ~ 2025-11-28 11:23:19</td>
</tr>
<tr>
<td>oltp_read_write</td>
<td>32</td>
<td>60,885</td>
<td>3,044</td>
<td>10.51</td>
<td>15.83</td>
<td>2.4</td>
<td>71.0</td>
<td>10.2</td>
<td>2.7</td>
<td>90.0</td>
<td>2025-11-28 11:23:21 ~ 2025-11-28 11:23:51</td>
</tr>
<tr>
<td>oltp_read_write</td>
<td>64</td>
<td>64,869</td>
<td>3,243</td>
<td>19.72</td>
<td>33.72</td>
<td>2.5</td>
<td>75.7</td>
<td>10.7</td>
<td>1.0</td>
<td>87.9</td>
<td>2025-11-28 11:23:53 ~ 2025-11-28 11:24:24</td>
</tr>
<tr>
<td>oltp_read_write</td>
<td>128</td>
<td>63,936</td>
<td>3,197</td>
<td>40.01</td>
<td>116.80</td>
<td>2.6</td>
<td>76.2</td>
<td>10.7</td>
<td>1.4</td>
<td>89.4</td>
<td>2025-11-28 11:24:26 ~ 2025-11-28 11:24:56</td>
</tr>
<tr>
<td>oltp_write_only</td>
<td>1</td>
<td>1,689</td>
<td>282</td>
<td>3.55</td>
<td>5.99</td>
<td>0.3</td>
<td>2.9</td>
<td>1.1</td>
<td>4.4</td>
<td>42.9</td>
<td>2025-11-28 11:24:58 ~ 2025-11-28 11:25:28</td>
</tr>
<tr>
<td>oltp_write_only</td>
<td>8</td>
<td>17,630</td>
<td>2,938</td>
<td>2.72</td>
<td>5.67</td>
<td>1.2</td>
<td>18.0</td>
<td>5.5</td>
<td>7.8</td>
<td>72.3</td>
<td>2025-11-28 11:25:30 ~ 2025-11-28 11:26:00</td>
</tr>
<tr>
<td>oltp_write_only</td>
<td>16</td>
<td>34,757</td>
<td>5,793</td>
<td>2.76</td>
<td>5.67</td>
<td>1.9</td>
<td>26.9</td>
<td>8.3</td>
<td>8.0</td>
<td>84.9</td>
<td>2025-11-28 11:26:02 ~ 2025-11-28 11:26:32</td>
</tr>
<tr>
<td>oltp_write_only</td>
<td>32</td>
<td>36,656</td>
<td>6,109</td>
<td>5.24</td>
<td>15.00</td>
<td>1.7</td>
<td>25.6</td>
<td>7.7</td>
<td>17.7</td>
<td>95.5</td>
<td>2025-11-28 11:26:34 ~ 2025-11-28 11:27:04</td>
</tr>
<tr>
<td>oltp_write_only</td>
<td>64</td>
<td>43,519</td>
<td>7,253</td>
<td>8.82</td>
<td>29.72</td>
<td>2.0</td>
<td>29.3</td>
<td>9.1</td>
<td>20.9</td>
<td>97.5</td>
<td>2025-11-28 11:27:06 ~ 2025-11-28 11:27:36</td>
</tr>
<tr>
<td>oltp_write_only</td>
<td>128</td>
<td>52,980</td>
<td>8,830</td>
<td>14.49</td>
<td>44.98</td>
<td>2.3</td>
<td>34.6</td>
<td>11.0</td>
<td>22.3</td>
<td>98.1</td>
<td>2025-11-28 11:27:38 ~ 2025-11-28 11:28:09</td>
</tr>
</tbody></table>
<hr>
<hr>
<h1 id="附录：监控指标说明"><a href="#附录：监控指标说明" class="headerlink" title="附录：监控指标说明"></a>附录：监控指标说明</h1><h2 id="监控数据说明"><a href="#监控数据说明" class="headerlink" title="监控数据说明"></a>监控数据说明</h2><table>
<thead>
<tr>
<th>报告列名</th>
<th>tsar对应列</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>CPU软中断(%)</td>
<td>sirq</td>
<td>软中断CPU使用率</td>
</tr>
<tr>
<td>CPU用户(%)</td>
<td>user</td>
<td>用户态CPU使用率</td>
</tr>
<tr>
<td>CPU系统(%)</td>
<td>sys</td>
<td>内核态CPU使用率</td>
</tr>
<tr>
<td>CPU等待(%)</td>
<td>wait</td>
<td>IO等待时间占用的CPU</td>
</tr>
<tr>
<td>IO利用率(%)</td>
<td>util (IO部分)</td>
<td>磁盘IO使用率</td>
</tr>
</tbody></table>
<h2 id="性能指标说明"><a href="#性能指标说明" class="headerlink" title="性能指标说明"></a>性能指标说明</h2><ul>
<li><strong>QPS (Queries Per Second)</strong>: 每秒查询数，衡量数据库处理查询的能力</li>
<li><strong>TPS (Transactions Per Second)</strong>: 每秒事务数，与QPS在点查询场景下相等</li>
<li><strong>平均延迟</strong>: 所有请求的平均响应时间</li>
<li><strong>95%延迟</strong>: 95%的请求响应时间不超过此值，更能反映用户体验</li>
</ul>
<h2 id="测试场景说明"><a href="#测试场景说明" class="headerlink" title="测试场景说明"></a>测试场景说明</h2><table>
<thead>
<tr>
<th>场景</th>
<th>描述</th>
<th>主要指标</th>
</tr>
</thead>
<tbody><tr>
<td>oltp_point_select</td>
<td>主键点查询</td>
<td>QPS, 延迟</td>
</tr>
<tr>
<td>oltp_read_only</td>
<td>只读事务(包含多表JOIN)</td>
<td>TPS, QPS</td>
</tr>
<tr>
<td>oltp_read_write</td>
<td>读写混合事务</td>
<td>TPS, 延迟</td>
</tr>
<tr>
<td>oltp_write_only</td>
<td>只写事务</td>
<td>TPS, IO利用率</td>
</tr>
</tbody></table>
<h2 id="数据来源说明"><a href="#数据来源说明" class="headerlink" title="数据来源说明"></a>数据来源说明</h2><ul>
<li>CPU&#x2F;IO数据来源于tsar监控日志，按测试时间段精确匹配并计算平均值</li>
<li>系统监控数据与性能数据时间精确对应，确保数据准确性</li>
<li>测试使用sysbench工具，针对MySQL数据库进行标准化性能测试</li>
</ul>
<hr>
<p><em>报告生成时间: 2025-12-05 16:03:37</em></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://plantegg.github.io/2025/11/05/MySQL_PreparedStatement_Performance_Issue_Reproduction/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="twitter @plantegg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="plantegg">
      <meta itemprop="description" content="java mysql tcp performance network docker Linux">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | plantegg">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/11/05/MySQL_PreparedStatement_Performance_Issue_Reproduction/" class="post-title-link" itemprop="url">MySQL PreparedStatement 性能问题重现</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2025-11-05 17:30:03" itemprop="dateCreated datePublished" datetime="2025-11-05T17:30:03+08:00">2025-11-05</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2025-11-29 15:45:36" itemprop="dateModified" datetime="2025-11-29T15:45:36+08:00">2025-11-29</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/MySQL/" itemprop="url" rel="index"><span itemprop="name">MySQL</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="MySQL-PreparedStatement-性能问题重现"><a href="#MySQL-PreparedStatement-性能问题重现" class="headerlink" title="MySQL PreparedStatement 性能问题重现"></a>MySQL PreparedStatement 性能问题重现</h1><h2 id="问题描述"><a href="#问题描述" class="headerlink" title="问题描述"></a>问题描述</h2><p>在生产环境中发现，当使用 <code>useServerPrepStmts=true</code> 参数时，包含大量参数的 PreparedStatement 查询性能极差。通过系统测试发现，<strong>SQL 格式和长度对性能有巨大影响</strong>。</p>
<p>只需要一个空表就能稳定重现这个问题，可以给官方提交 bug 了</p>
<h2 id="环境信息"><a href="#环境信息" class="headerlink" title="环境信息"></a>环境信息</h2><ul>
<li><strong>MySQL版本</strong>: 5.7.29</li>
<li><strong>JDBC驱动</strong>: mysql-connector-j-8.0.33</li>
<li><strong>测试场景</strong>: 5万个大整数参数的 IN 查询</li>
<li><strong>参数格式</strong>: 15位大整数（如 176302640511975）</li>
<li><strong>重现代码</strong>: <a target="_blank" rel="noopener" href="https://github.com/plantegg/MySQLPrepared">https://github.com/plantegg/MySQLPrepared</a></li>
</ul>
<h2 id="核心发现"><a href="#核心发现" class="headerlink" title="核心发现"></a>核心发现</h2><h3 id="🔥-SQL-格式对性能的巨大影响"><a href="#🔥-SQL-格式对性能的巨大影响" class="headerlink" title="🔥 SQL 格式对性能的巨大影响"></a>🔥 SQL 格式对性能的巨大影响</h3><p>我们发现 <strong>SQL 字符串的格式和长度</strong> 是影响服务器端预编译性能的关键因素：</p>
<table>
<thead>
<tr>
<th>SQL格式</th>
<th>SQL长度</th>
<th>false平均时间</th>
<th>true平均时间</th>
<th>性能差异</th>
</tr>
</thead>
<tbody><tr>
<td><strong>紧凑格式</strong> (?,?,?)</td>
<td><strong>100KB</strong></td>
<td><strong>35ms</strong></td>
<td><strong>645ms</strong></td>
<td><strong>慢18倍</strong> ⭐ 最优</td>
</tr>
<tr>
<td>带换行格式</td>
<td>2.1MB</td>
<td>47ms</td>
<td>9,128ms</td>
<td>慢194倍</td>
</tr>
<tr>
<td>带换行+空格 (128)</td>
<td>6.5MB</td>
<td>52ms</td>
<td>27,839ms</td>
<td>慢535倍</td>
</tr>
<tr>
<td>带换行+大量空格 (128)</td>
<td>8.5MB</td>
<td>62ms</td>
<td>44,521ms</td>
<td>慢712倍 🔥 最差</td>
</tr>
</tbody></table>
<p><strong>关键结论</strong>: </p>
<ul>
<li>✅ <strong>最优化的紧凑格式</strong> 可以将服务器端性能提升 <strong>14倍</strong>（9,128ms → 645ms）</li>
<li>⚠️ 即使优化后，客户端预编译（35ms）仍比服务器端（645ms）快 <strong>18倍</strong></li>
</ul>
<h2 id="重现步骤"><a href="#重现步骤" class="headerlink" title="重现步骤"></a>重现步骤</h2><h3 id="1-环境准备"><a href="#1-环境准备" class="headerlink" title="1. 环境准备"></a>1. 环境准备</h3><p>创建测试表：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql -h your-host -P your-port -u your-user -p your-database &lt; create_table.sql</span><br></pre></td></tr></table></figure>

<p><code>create_table.sql</code> 内容：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> `large_table`;</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE TABLE</span> `large_table` (</span><br><span class="line">  `id` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NOT NULL</span>,</span><br><span class="line">  `col1` <span class="type">varchar</span>(<span class="number">50</span>) <span class="keyword">COLLATE</span> utf8_unicode_ci <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `col2` <span class="type">varchar</span>(<span class="number">50</span>) <span class="keyword">COLLATE</span> utf8_unicode_ci <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  <span class="comment">-- ... col3-col19 ...</span></span><br><span class="line">  `col20` <span class="type">varchar</span>(<span class="number">50</span>) <span class="keyword">COLLATE</span> utf8_unicode_ci <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  <span class="keyword">PRIMARY KEY</span> (`id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8 <span class="keyword">COLLATE</span><span class="operator">=</span>utf8_unicode_ci;</span><br></pre></td></tr></table></figure>

<h3 id="2-运行测试"><a href="#2-运行测试" class="headerlink" title="2. 运行测试"></a>2. 运行测试</h3><h4 id="使用脚本（推荐）"><a href="#使用脚本（推荐）" class="headerlink" title="使用脚本（推荐）"></a>使用脚本（推荐）</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 最优配置（紧凑格式）</span></span><br><span class="line">./run_test.sh --host localhost --port 3306 --database <span class="built_in">test</span> \</span><br><span class="line">  --user root --password mypass --spaces 0</span><br><span class="line"></span><br><span class="line"><span class="comment"># 测试不同空格配置的影响</span></span><br><span class="line">./run_test.sh --host localhost --port 3306 --database <span class="built_in">test</span> \</span><br><span class="line">  --user root --password mypass --spaces 128</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看帮助</span></span><br><span class="line">./run_test.sh --<span class="built_in">help</span></span><br></pre></td></tr></table></figure>

<h4 id="使用-Maven"><a href="#使用-Maven" class="headerlink" title="使用 Maven"></a>使用 Maven</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mvn compile <span class="built_in">exec</span>:java \</span><br><span class="line">    -Dexec.mainClass=<span class="string">&quot;com.test.PreparedStatementPerformanceTest&quot;</span> \</span><br><span class="line">    -Ddb.host=localhost \</span><br><span class="line">    -Ddb.port=3306 \</span><br><span class="line">    -Ddb.name=<span class="built_in">test</span> \</span><br><span class="line">    -Ddb.user=root \</span><br><span class="line">    -Ddb.password=mypassword \</span><br><span class="line">    -Dparam.spaces=0</span><br></pre></td></tr></table></figure>

<h3 id="3-参数说明"><a href="#3-参数说明" class="headerlink" title="3. 参数说明"></a>3. 参数说明</h3><table>
<thead>
<tr>
<th>参数</th>
<th>默认值</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>--spaces</code></td>
<td>128</td>
<td>参数之间的空格数量，0&#x3D;最紧凑格式</td>
</tr>
<tr>
<td><code>--rounds</code></td>
<td>2</td>
<td>测试轮次</td>
</tr>
</tbody></table>
<h2 id="详细测试结果"><a href="#详细测试结果" class="headerlink" title="详细测试结果"></a>详细测试结果</h2><h3 id="测试-1-紧凑格式-spaces-0-⭐-推荐"><a href="#测试-1-紧凑格式-spaces-0-⭐-推荐" class="headerlink" title="测试 1: 紧凑格式 (spaces&#x3D;0) ⭐ 推荐"></a>测试 1: 紧凑格式 (spaces&#x3D;0) ⭐ 推荐</h3><p><strong>SQL 示例</strong>: <code>WHERE id IN (?,?,?,?,...)</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">配置: useServerPrepStmts=false</span><br><span class="line">SQL长度: 100,151 字符 (~100KB)</span><br><span class="line">平均执行时间: 35.0ms</span><br><span class="line">Com_stmt_prepare: 0</span><br><span class="line"></span><br><span class="line">配置: useServerPrepStmts=true  </span><br><span class="line">SQL长度: 100,151 字符 (~100KB)</span><br><span class="line">平均执行时间: 645.5ms</span><br><span class="line">Com_stmt_prepare: 1</span><br><span class="line"></span><br><span class="line">性能差异: 慢 18 倍</span><br></pre></td></tr></table></figure>

<h3 id="测试-2-带换行格式-旧版本"><a href="#测试-2-带换行格式-旧版本" class="headerlink" title="测试 2: 带换行格式 (旧版本)"></a>测试 2: 带换行格式 (旧版本)</h3><p><strong>SQL 示例</strong>: </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">WHERE</span> id <span class="keyword">IN</span> (?</span><br><span class="line">                  ,</span><br><span class="line">                    ?</span><br><span class="line">                  ,</span><br><span class="line">                    ?</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">配置: useServerPrepStmts=false</span><br><span class="line">SQL长度: 2,100,111 字符 (~2.1MB)</span><br><span class="line">平均执行时间: 47.0ms</span><br><span class="line">Com_stmt_prepare: 0</span><br><span class="line"></span><br><span class="line">配置: useServerPrepStmts=true</span><br><span class="line">SQL长度: 2,100,111 字符 (~2.1MB)</span><br><span class="line">平均执行时间: 9,128.5ms</span><br><span class="line">Com_stmt_prepare: 1</span><br><span class="line"></span><br><span class="line">性能差异: 慢 194 倍</span><br></pre></td></tr></table></figure>

<h3 id="测试-3-带空格格式-spaces-128"><a href="#测试-3-带空格格式-spaces-128" class="headerlink" title="测试 3: 带空格格式 (spaces&#x3D;128)"></a>测试 3: 带空格格式 (spaces&#x3D;128)</h3><p><strong>SQL 示例</strong>: <code>WHERE id IN (?,&lt;128 spaces&gt;?,&lt;128 spaces&gt;?,...)</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">配置: useServerPrepStmts=false</span><br><span class="line">SQL长度: 6,500,023 字符 (~6.5MB)</span><br><span class="line">平均执行时间: 52.0ms</span><br><span class="line">Com_stmt_prepare: 0</span><br><span class="line"></span><br><span class="line">配置: useServerPrepStmts=true</span><br><span class="line">SQL长度: 6,500,023 字符 (~6.5MB)</span><br><span class="line">平均执行时间: 27,839.5ms</span><br><span class="line">Com_stmt_prepare: 1</span><br><span class="line"></span><br><span class="line">性能差异: 慢 535 倍</span><br></pre></td></tr></table></figure>

<h3 id="测试-4-带换行-大量空格-极端情况"><a href="#测试-4-带换行-大量空格-极端情况" class="headerlink" title="测试 4: 带换行+大量空格 (极端情况)"></a>测试 4: 带换行+大量空格 (极端情况)</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">配置: useServerPrepStmts=false</span><br><span class="line">SQL长度: 8,499,983 字符 (~8.5MB)</span><br><span class="line">平均执行时间: 62.5ms</span><br><span class="line">Com_stmt_prepare: 0</span><br><span class="line"></span><br><span class="line">配置: useServerPrepStmts=true</span><br><span class="line">SQL长度: 8,499,983 字符 (~8.5MB)</span><br><span class="line">平均执行时间: 44,521.5ms</span><br><span class="line">Com_stmt_prepare: 1</span><br><span class="line"></span><br><span class="line">性能差异: 慢 712 倍</span><br></pre></td></tr></table></figure>

<h2 id="性能分析"><a href="#性能分析" class="headerlink" title="性能分析"></a>性能分析</h2><h3 id="1-SQL-长度与性能的线性关系"><a href="#1-SQL-长度与性能的线性关系" class="headerlink" title="1. SQL 长度与性能的线性关系"></a>1. SQL 长度与性能的线性关系</h3><p>服务器端预编译性能随 SQL 长度线性恶化：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">100KB  SQL → 645ms    (基准)</span><br><span class="line">2.1MB  SQL → 9,128ms  (14倍恶化)</span><br><span class="line">6.5MB  SQL → 27,839ms (43倍恶化)</span><br><span class="line">8.5MB  SQL → 44,521ms (69倍恶化)</span><br></pre></td></tr></table></figure>

<h3 id="2-客户端预编译的稳定性"><a href="#2-客户端预编译的稳定性" class="headerlink" title="2. 客户端预编译的稳定性"></a>2. 客户端预编译的稳定性</h3><p>客户端预编译几乎不受 SQL 长度影响：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">100KB  SQL → 35-47ms</span><br><span class="line">8.5MB  SQL → 62ms</span><br><span class="line">变化幅度: 仅 77%</span><br></pre></td></tr></table></figure>

<h3 id="3-问题根因"><a href="#3-问题根因" class="headerlink" title="3. 问题根因"></a>3. 问题根因</h3><p>根据 <code>pstack</code> 分析，服务器端预编译在处理大 SQL 时：</p>
<ol>
<li><p><strong>大量内存重分配</strong>: </p>
<ul>
<li>50,000 次参数替换操作</li>
<li>每次替换需要在大 SQL 字符串中定位和替换</li>
<li><code>my_realloc</code> 和 <code>memmove</code> 频繁调用</li>
</ul>
</li>
<li><p><strong>字符串操作复杂度</strong>: </p>
<ul>
<li>O(SQL长度) × 参数数量 &#x3D; 极高时间复杂度</li>
<li>单线程 100% CPU 占用</li>
</ul>
</li>
<li><p><strong>内存碎片化</strong>:</p>
<ul>
<li>频繁的大块内存分配和释放</li>
<li>进一步降低性能</li>
</ul>
</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">Thread 1 (Thread 0x7feeb8043640 (LWP 2508284)):</span><br><span class="line">#0  0x00007ff302bb5515 in __memmove_avx512_unaligned_erms () from /lib64/libc.so.6</span><br><span class="line">#1  0x0000000000efffe6 in my_realloc (key=&lt;optimized out&gt;, ptr=0x7fee5e907380, size=7192160, flags=&lt;optimized out&gt;) at /export/home/pb2/build/sb_0-37309218-1576676711.18/mysql-5.7.29/mysys/my_malloc.c:112</span><br><span class="line">#2  0x0000000000d9a921 in String::mem_realloc (this=0x7feeb80424b0, alloc_length=7192155, force_on_heap=force_on_heap@entry=false) at /export/home/pb2/build/sb_0-37309218-1576676711.18/mysql-5.7.29/sql-common/sql_string.cc:128</span><br><span class="line">#3  0x0000000000d9b9d4 in String::replace (this=this@entry=0x7feeb80424b0, offset=7119079, arg_length=arg_length@entry=1, to=0x7fee5c3f5810 &quot;286381588518215&quot;, to_length=15) at /export/home/pb2/build/sb_0-37309218-1576676711.18/mysql-5.7.29/sql-common/sql_string.cc:804</span><br><span class="line">#4  0x0000000000d9ba81 in String::replace (this=this@entry=0x7feeb80424b0, offset=&lt;optimized out&gt;, arg_length=arg_length@entry=1, to=...) at /export/home/pb2/build/sb_0-37309218-1576676711.18/mysql-5.7.29/sql-common/sql_string.cc:783</span><br><span class="line">#5  0x0000000000d026e2 in Prepared_statement::insert_params (this=this@entry=0x7fee5c171fe0, null_array=null_array@entry=0x7fee5c45240a &quot;&quot;, read_pos=0x7fee5c4ccc05 &quot;\336\274y\206&quot;, &lt;incomplete sequence \303&gt;, read_pos@entry=0x7fee5c46c315 &quot;\016r\342\320\355\242\002&quot;, data_end=0x7fee5c4cdd95 &quot;&quot;, query=query@entry=0x7feeb80424b0) at /export/home/pb2/build/sb_0-37309218-1576676711.18/mysql-5.7.29/sql/sql_prepare.cc:924</span><br><span class="line">#6  0x0000000000d03db6 in Prepared_statement::set_parameters (this=this@entry=0x7fee5c171fe0, expanded_query=expanded_query@entry=0x7feeb80424b0, packet=0x7fee5c46c315 &quot;\016r\342\320\355\242\002&quot;, packet_end=&lt;optimized out&gt;) at /export/home/pb2/build/sb_0-37309218-1576676711.18/mysql-5.7.29/sql/sql_prepare.cc:3496</span><br><span class="line">#7  0x0000000000d0772f in Prepared_statement::execute_loop (this=0x7fee5c171fe0, expanded_query=0x7feeb80424b0, open_cursor=&lt;optimized out&gt;, packet=&lt;optimized out&gt;, packet_end=&lt;optimized out&gt;) at /export/home/pb2/build/sb_0-37309218-1576676711.18/mysql-5.7.29/sql/sql_prepare.cc:3559</span><br><span class="line">#8  0x0000000000d07aa4 in mysqld_stmt_execute (thd=thd@entry=0x7fee5c000b60, stmt_id=&lt;optimized out&gt;, flags=0, params=0x7fee5c45240a &quot;&quot;, params_length=506251) at /export/home/pb2/build/sb_0-37309218-1576676711.18/mysql-5.7.29/sql/sql_prepare.cc:2582</span><br><span class="line">#9  0x0000000000cdf6f5 in dispatch_command (thd=thd@entry=0x7fee5c000b60, com_data=com_data@entry=0x7feeb8042d40, command=COM_STMT_EXECUTE) at /export/home/pb2/build/sb_0-37309218-1576676711.18/mysql-5.7.29/sql/sql_parse.cc:1428</span><br><span class="line">#10 0x0000000000ce00c7 in do_command (thd=thd@entry=0x7fee5c000b60) at /export/home/pb2/build/sb_0-37309218-1576676711.18/mysql-5.7.29/sql/sql_parse.cc:1032</span><br><span class="line">#11 0x0000000000d9cc08 in handle_connection (arg=arg@entry=0x1eb0a010) at /export/home/pb2/build/sb_0-37309218-1576676711.18/mysql-5.7.29/sql/conn_handler/connection_handler_per_thread.cc:313</span><br><span class="line">#12 0x00000000013fc4a4 in pfs_spawn_thread (arg=0x1ea71270) at /export/home/pb2/build/sb_0-37309218-1576676711.18/mysql-5.7.29/storage/perfschema/pfs.cc:2197</span><br><span class="line">#13 0x00007ff30305b3fb in start_thread () from /lib64/libpthread.so.0</span><br><span class="line">#14 0x00007ff302b0de83 in clone () from /lib64/libc.so.6</span><br></pre></td></tr></table></figure>

<h3 id="监控数据"><a href="#监控数据" class="headerlink" title="监控数据"></a>监控数据</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># top 监控</span><br><span class="line">PID     USER   %CPU  TIME+     COMMAND</span><br><span class="line">2554029 mysql  99.3  4:40.64   mysqld  // 单线程 100%</span><br><span class="line"></span><br><span class="line"># show processlist 观察</span><br><span class="line">Id  User  Command  Time  State     Info</span><br><span class="line">382 test  Execute  8     starting  NULL  // SQL 还在组装中</span><br></pre></td></tr></table></figure>

<h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h2><h3 id="✅-方案-1-使用客户端预编译-紧凑格式（强烈推荐）"><a href="#✅-方案-1-使用客户端预编译-紧凑格式（强烈推荐）" class="headerlink" title="✅ 方案 1: 使用客户端预编译 + 紧凑格式（强烈推荐）"></a>✅ 方案 1: 使用客户端预编译 + 紧凑格式（强烈推荐）</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// JDBC 连接串</span></span><br><span class="line"><span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> <span class="string">&quot;jdbc:mysql://host:port/database?useServerPrepStmts=false&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 运行测试</span></span><br><span class="line">./run_test.sh --host localhost --port <span class="number">3306</span> --database test \</span><br><span class="line">  --user root --password mypass --spaces <span class="number">0</span></span><br></pre></td></tr></table></figure>

<p><strong>优点</strong>:</p>
<ul>
<li>✅ 性能最优：仅需 35ms</li>
<li>✅ 不受 SQL 长度影响</li>
<li>✅ 不受参数数量影响</li>
<li>✅ 稳定可靠</li>
</ul>
<p><strong>缺点</strong>:</p>
<ul>
<li>⚠️ 无法享受服务器端查询计划缓存（但对 IN 查询意义不大）</li>
</ul>
<h3 id="🔄-方案-2-优化-SQL-格式（如果必须使用服务器端预编译）"><a href="#🔄-方案-2-优化-SQL-格式（如果必须使用服务器端预编译）" class="headerlink" title="🔄 方案 2: 优化 SQL 格式（如果必须使用服务器端预编译）"></a>🔄 方案 2: 优化 SQL 格式（如果必须使用服务器端预编译）</h3><p>如果由于某些原因必须使用 <code>useServerPrepStmts=true</code>，则务必优化 SQL 格式：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 使用最紧凑格式: ?,?,?,?</span></span><br><span class="line"><span class="comment">// 避免: ?\n  ,\n  ?</span></span><br><span class="line"></span><br><span class="line"><span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> <span class="string">&quot;jdbc:mysql://host:port/database?useServerPrepStmts=true&quot;</span>;</span><br><span class="line"><span class="comment">// 运行时使用 --spaces 0</span></span><br></pre></td></tr></table></figure>

<p><strong>性能</strong>: 645ms（相比未优化的 9,128ms 提升 14 倍）</p>
<h3 id="🔧-方案-3-分批查询"><a href="#🔧-方案-3-分批查询" class="headerlink" title="🔧 方案 3: 分批查询"></a>🔧 方案 3: 分批查询</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 将 50,000 个参数拆分为 50 批，每批 1,000 个</span></span><br><span class="line"><span class="type">int</span> <span class="variable">batchSize</span> <span class="operator">=</span> <span class="number">1000</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; ids.size(); i += batchSize) &#123;</span><br><span class="line">    List&lt;Long&gt; batch = ids.subList(i, Math.min(i + batchSize, ids.size()));</span><br><span class="line">    <span class="comment">// 执行查询</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="🗃️-方案-4-临时表方案"><a href="#🗃️-方案-4-临时表方案" class="headerlink" title="🗃️ 方案 4: 临时表方案"></a>🗃️ 方案 4: 临时表方案</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> TEMPORARY <span class="keyword">TABLE</span> temp_ids (id <span class="type">BIGINT</span>);</span><br><span class="line"><span class="keyword">INSERT INTO</span> temp_ids <span class="keyword">VALUES</span> (?), (?), ...;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> large_table <span class="keyword">WHERE</span> id <span class="keyword">IN</span> (<span class="keyword">SELECT</span> id <span class="keyword">FROM</span> temp_ids);</span><br><span class="line"><span class="keyword">DROP</span> TEMPORARY <span class="keyword">TABLE</span> temp_ids;</span><br></pre></td></tr></table></figure>

<h2 id="最佳实践"><a href="#最佳实践" class="headerlink" title="最佳实践"></a>最佳实践</h2><h3 id="✅-推荐配置"><a href="#✅-推荐配置" class="headerlink" title="✅ 推荐配置"></a>✅ 推荐配置</h3><table>
<thead>
<tr>
<th>场景</th>
<th>useServerPrepStmts</th>
<th>spaces</th>
<th>预期性能</th>
</tr>
</thead>
<tbody><tr>
<td><strong>生产环境</strong></td>
<td>false</td>
<td>0</td>
<td>35ms ⭐ 最优</td>
</tr>
<tr>
<td>标准测试</td>
<td>false</td>
<td>0</td>
<td>35-50ms</td>
</tr>
<tr>
<td>必须服务器端预编译</td>
<td>true</td>
<td>0</td>
<td>645ms</td>
</tr>
</tbody></table>
<h3 id="❌-避免配置"><a href="#❌-避免配置" class="headerlink" title="❌ 避免配置"></a>❌ 避免配置</h3><table>
<thead>
<tr>
<th>场景</th>
<th>useServerPrepStmts</th>
<th>SQL格式</th>
<th>性能</th>
</tr>
</thead>
<tbody><tr>
<td>❌ 带格式化</td>
<td>true</td>
<td>带换行&#x2F;缩进</td>
<td>9,128ms 慢194倍</td>
</tr>
<tr>
<td>❌ 大量空格</td>
<td>true</td>
<td>spaces &gt; 0</td>
<td>27,839ms 慢535倍</td>
</tr>
<tr>
<td>❌ 极端情况</td>
<td>true</td>
<td>大量换行+空格</td>
<td>44,521ms 慢712倍</td>
</tr>
</tbody></table>
<h3 id="🎯-实施建议"><a href="#🎯-实施建议" class="headerlink" title="🎯 实施建议"></a>🎯 实施建议</h3><ol>
<li><p><strong>开发阶段</strong>:</p>
<ul>
<li>设置 <code>useServerPrepStmts=false</code></li>
<li>使用 <code>--spaces 0</code> 测试</li>
</ul>
</li>
<li><p><strong>测试阶段</strong>:</p>
<ul>
<li>对比不同配置的性能</li>
<li>使用 <code>SHOW PROCESSLIST</code> 监控</li>
</ul>
</li>
<li><p><strong>生产环境</strong>:</p>
<ul>
<li>强制使用客户端预编译</li>
<li>避免大参数量 IN 查询</li>
<li>如必须使用，考虑分批或临时表方案</li>
</ul>
</li>
</ol>
<h2 id="完整对比表"><a href="#完整对比表" class="headerlink" title="完整对比表"></a>完整对比表</h2><table>
<thead>
<tr>
<th>配置</th>
<th>SQL格式</th>
<th>SQL长度</th>
<th>false平均</th>
<th>true平均</th>
<th>性能差异</th>
</tr>
</thead>
<tbody><tr>
<td><strong>最优</strong></td>
<td>?,?,?</td>
<td>100KB</td>
<td>35ms</td>
<td>645ms</td>
<td>慢18倍 ⭐</td>
</tr>
<tr>
<td>带换行</td>
<td>?\n,\n?</td>
<td>2.1MB</td>
<td>47ms</td>
<td>9,128ms</td>
<td>慢194倍</td>
</tr>
<tr>
<td>+空格128</td>
<td>?,&lt;128&gt;?</td>
<td>6.5MB</td>
<td>52ms</td>
<td>27,839ms</td>
<td>慢535倍</td>
</tr>
<tr>
<td>带换行+空格128</td>
<td>?\n,\n&lt;128&gt;?</td>
<td>8.5MB</td>
<td>62ms</td>
<td>44,521ms</td>
<td>慢712倍 🔥</td>
</tr>
</tbody></table>
<h2 id="性能改善总结"><a href="#性能改善总结" class="headerlink" title="性能改善总结"></a>性能改善总结</h2><p>通过 SQL 格式优化：</p>
<table>
<thead>
<tr>
<th>指标</th>
<th>优化前</th>
<th>优化后</th>
<th>改善幅度</th>
</tr>
</thead>
<tbody><tr>
<td>SQL 长度</td>
<td>2.1MB</td>
<td>100KB</td>
<td><strong>缩小 95%</strong></td>
</tr>
<tr>
<td>服务器端性能</td>
<td>9,128ms</td>
<td>645ms</td>
<td><strong>提升 14 倍</strong></td>
</tr>
<tr>
<td>性能差异倍数</td>
<td>194倍</td>
<td>18倍</td>
<td><strong>改善 10 倍</strong></td>
</tr>
</tbody></table>
<p><strong>但最终建议</strong>: 使用客户端预编译（35ms）才是最佳方案！</p>
<h2 id="结论"><a href="#结论" class="headerlink" title="结论"></a>结论</h2><ol>
<li><p><strong>SQL 长度是服务器端预编译的致命弱点</strong></p>
<ul>
<li>长度增加 → 性能线性恶化</li>
<li>从 100KB（645ms）到 8.5MB（44,521ms），性能下降 <strong>69 倍</strong></li>
</ul>
</li>
<li><p><strong>SQL 格式优化很重要</strong></p>
<ul>
<li>移除换行和多余空格可提升性能 <strong>14 倍</strong></li>
<li>使用 <code>--spaces 0</code> 获得最紧凑格式</li>
</ul>
</li>
<li><p><strong>客户端预编译几乎不受影响</strong></p>
<ul>
<li>100KB SQL: 35ms</li>
<li>8.5MB SQL: 62ms  </li>
<li>性能稳定可靠</li>
</ul>
</li>
<li><p><strong>生产环境强烈建议</strong></p>
<ul>
<li>✅ 使用 <code>useServerPrepStmts=false</code></li>
<li>✅ 使用最紧凑的 SQL 格式（<code>--spaces 0</code>）</li>
<li>✅ 避免大参数量 IN 查询，或使用分批&#x2F;临时表方案</li>
</ul>
</li>
<li><p><strong>性能差异</strong></p>
<ul>
<li>最优配置（35ms）vs 最差配置（44,521ms）&#x3D; <strong>1,272 倍差异</strong>！</li>
<li>这不是优化问题，而是架构选择问题</li>
</ul>
</li>
</ol>
<h2 id="测试代码仓库"><a href="#测试代码仓库" class="headerlink" title="测试代码仓库"></a>测试代码仓库</h2><ul>
<li>GitHub: <a target="_blank" rel="noopener" href="https://github.com/plantegg/MySQLPrepared">https://github.com/plantegg/MySQLPrepared</a></li>
<li>包含完整的测试代码、脚本和文档</li>
<li>支持 <code>--spaces</code> 参数灵活测试不同 SQL 格式</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://plantegg.github.io/2025/10/25/AWS_RDS_BlueGreen_Upgrade_Guide/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="twitter @plantegg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="plantegg">
      <meta itemprop="description" content="java mysql tcp performance network docker Linux">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | plantegg">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/10/25/AWS_RDS_BlueGreen_Upgrade_Guide/" class="post-title-link" itemprop="url">AWS RDS MySQL 蓝绿部署升级完整指南</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2025-10-25 17:30:03" itemprop="dateCreated datePublished" datetime="2025-10-25T17:30:03+08:00">2025-10-25</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2026-02-06 13:53:24" itemprop="dateModified" datetime="2026-02-06T13:53:24+08:00">2026-02-06</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/MySQL/" itemprop="url" rel="index"><span itemprop="name">MySQL</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="AWS-RDS-MySQL-蓝绿部署升级完整指南"><a href="#AWS-RDS-MySQL-蓝绿部署升级完整指南" class="headerlink" title="AWS RDS MySQL 蓝绿部署升级完整指南"></a>AWS RDS MySQL 蓝绿部署升级完整指南</h1><h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p>本文档基于实际测试记录，详细介绍AWS RDS MySQL从5.7升级到8.0的蓝绿部署全过程。</p>
<p><strong>测试环境:</strong></p>
<ul>
<li>源版本: MySQL 5.7.44-rds.20251212</li>
<li>目标版本: MySQL 8.0.40</li>
<li>实例类型: db.m5.large (2vCPU, 8GB)</li>
<li>Multi-AZ: 启用</li>
<li>区域: ap-southeast-1</li>
</ul>
<h2 id="蓝绿部署流程图"><a href="#蓝绿部署流程图" class="headerlink" title="蓝绿部署流程图"></a>蓝绿部署流程图</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">┌─────────────────────────────────────────────────────────────────────────────┐</span><br><span class="line">│                         蓝绿部署升级完整流程                                  │</span><br><span class="line">├─────────────────────────────────────────────────────────────────────────────┤</span><br><span class="line">│                                                                             │</span><br><span class="line">│  阶段1              阶段2              阶段3              阶段4              │</span><br><span class="line">│  创建读副本          版本升级            配置备份            执行切换           │</span><br><span class="line">│  ┌─────────┐       ┌─────────┐       ┌─────────┐       ┌─────────┐        │</span><br><span class="line">│  │蓝环境    │       │绿环境    │       │绿环境    │       │绿环境    │        │</span><br><span class="line">│  │MySQL5.7 │──复制─▶│MySQL5.7 │──升级─▶│MySQL8.0 │──切换─▶│MySQL8.0│        │</span><br><span class="line">│  │(生产)    │       │(副本)   │        │(就绪)   │       │(新生产)  │        │</span><br><span class="line">│  └─────────┘       └─────────┘       └─────────┘       └─────────┘        │</span><br><span class="line">│       │                 │                 │                 ▲              │</span><br><span class="line">│       │                 │                 │                 │              │</span><br><span class="line">│       └─────────────────┴─────────────────┴─────────────────┘              │</span><br><span class="line">│                        持续数据同步                                         │</span><br><span class="line">│                                                                             │</span><br><span class="line">│  耗时: 10-20分钟      耗时: 10-20分钟    耗时: 几分钟      耗时: 1-5分钟     	   │</span><br><span class="line">│  业务影响: 零         业务影响: 零       业务影响: 零      业务影响: 短暂     		  │</span><br><span class="line">└─────────────────────────────────────────────────────────────────────────────┘</span><br></pre></td></tr></table></figure>

<h2 id="前置条件"><a href="#前置条件" class="headerlink" title="前置条件"></a>前置条件</h2><h3 id="1-检查当前实例状态"><a href="#1-检查当前实例状态" class="headerlink" title="1. 检查当前实例状态"></a>1. 检查当前实例状态</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">aws rds describe-db-instances \</span><br><span class="line">    --db-instance-identifier mysql-test-57 \</span><br><span class="line">    --query <span class="string">&#x27;DBInstances[0].&#123;Status:DBInstanceStatus,Version:EngineVersion,MultiAZ:MultiAZ&#125;&#x27;</span> \</span><br><span class="line">    --profile default --region ap-southeast-1</span><br></pre></td></tr></table></figure>

<h3 id="2-确认可升级的目标版本"><a href="#2-确认可升级的目标版本" class="headerlink" title="2. 确认可升级的目标版本"></a>2. 确认可升级的目标版本</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">aws rds describe-db-engine-versions \</span><br><span class="line">    --engine mysql \</span><br><span class="line">    --engine-version 5.7 \</span><br><span class="line">    --query <span class="string">&#x27;DBEngineVersions[0].ValidUpgradeTarget[?IsMajorVersionUpgrade==`true`].EngineVersion&#x27;</span> \</span><br><span class="line">    --profile default --region ap-southeast-1</span><br></pre></td></tr></table></figure>

<h3 id="3-确保备份已启用"><a href="#3-确保备份已启用" class="headerlink" title="3. 确保备份已启用"></a>3. 确保备份已启用</h3><p>蓝绿部署要求源实例启用自动备份 (BackupRetentionPeriod &gt; 0)</p>
<hr>
<h2 id="阶段1-创建蓝绿部署"><a href="#阶段1-创建蓝绿部署" class="headerlink" title="阶段1: 创建蓝绿部署"></a>阶段1: 创建蓝绿部署</h2><h3 id="命令"><a href="#命令" class="headerlink" title="命令"></a>命令</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">aws rds create-blue-green-deployment \</span><br><span class="line">    --blue-green-deployment-name mysql-57-to-80-upgrade \</span><br><span class="line">    --<span class="built_in">source</span> arn:aws:rds:XXXX:db:mysql-test-57 \</span><br><span class="line">    --target-engine-version 8.0.40 \</span><br><span class="line">    --profile default --region ap-southeast-1</span><br></pre></td></tr></table></figure>

<h3 id="参数说明"><a href="#参数说明" class="headerlink" title="参数说明"></a>参数说明</h3><table>
<thead>
<tr>
<th>参数</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>--blue-green-deployment-name</code></td>
<td>部署名称，用于标识</td>
</tr>
<tr>
<td><code>--source</code></td>
<td>源实例的ARN</td>
</tr>
<tr>
<td><code>--target-engine-version</code></td>
<td>目标MySQL版本</td>
</tr>
</tbody></table>
<h3 id="返回示例"><a href="#返回示例" class="headerlink" title="返回示例"></a>返回示例</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;BlueGreenDeployment&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;BlueGreenDeploymentIdentifier&quot;</span><span class="punctuation">:</span> <span class="string">&quot;bgd-xen1mlsjdt6hlt8r&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;Status&quot;</span><span class="punctuation">:</span> <span class="string">&quot;PROVISIONING&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;Tasks&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">            <span class="punctuation">&#123;</span><span class="attr">&quot;Name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;CREATING_READ_REPLICA_OF_SOURCE&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;Status&quot;</span><span class="punctuation">:</span> <span class="string">&quot;PENDING&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="punctuation">&#123;</span><span class="attr">&quot;Name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;DB_ENGINE_VERSION_UPGRADE&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;Status&quot;</span><span class="punctuation">:</span> <span class="string">&quot;PENDING&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="punctuation">&#123;</span><span class="attr">&quot;Name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;CONFIGURE_BACKUPS&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;Status&quot;</span><span class="punctuation">:</span> <span class="string">&quot;PENDING&quot;</span><span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<hr>
<h2 id="阶段2-监控部署进度"><a href="#阶段2-监控部署进度" class="headerlink" title="阶段2: 监控部署进度"></a>阶段2: 监控部署进度</h2><h3 id="查看部署状态"><a href="#查看部署状态" class="headerlink" title="查看部署状态"></a>查看部署状态</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">aws rds describe-blue-green-deployments \</span><br><span class="line">    --blue-green-deployment-identifier bgd-xen1mlsjdt6hlt8r \</span><br><span class="line">    --profile default --region ap-southeast-1</span><br></pre></td></tr></table></figure>

<h3 id="任务状态说明"><a href="#任务状态说明" class="headerlink" title="任务状态说明"></a>任务状态说明</h3><table>
<thead>
<tr>
<th>任务</th>
<th>说明</th>
<th>预计耗时</th>
</tr>
</thead>
<tbody><tr>
<td>CREATING_READ_REPLICA_OF_SOURCE</td>
<td>创建源实例的读副本</td>
<td>10-20分钟</td>
</tr>
<tr>
<td>DB_ENGINE_VERSION_UPGRADE</td>
<td>升级绿环境到目标版本</td>
<td>10-20分钟</td>
</tr>
<tr>
<td>CONFIGURE_BACKUPS</td>
<td>配置备份策略</td>
<td>几分钟</td>
</tr>
</tbody></table>
<h3 id="状态流转"><a href="#状态流转" class="headerlink" title="状态流转"></a>状态流转</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PROVISIONING → AVAILABLE → SWITCHOVER_IN_PROGRESS → SWITCHOVER_COMPLETED</span><br></pre></td></tr></table></figure>

<h3 id="查看绿环境实例详情"><a href="#查看绿环境实例详情" class="headerlink" title="查看绿环境实例详情"></a>查看绿环境实例详情</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 绿环境实例名称格式: &#123;源实例名&#125;-green-&#123;随机字符&#125;</span></span><br><span class="line">aws rds describe-db-instances \</span><br><span class="line">    --db-instance-identifier mysql-test-57-green-b66gdf \</span><br><span class="line">    --query <span class="string">&#x27;DBInstances[0].&#123;Status:DBInstanceStatus,Version:EngineVersion&#125;&#x27;</span> \</span><br><span class="line">    --profile default --region ap-southeast-1</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="阶段3-执行切换-Switchover"><a href="#阶段3-执行切换-Switchover" class="headerlink" title="阶段3: 执行切换 (Switchover)"></a>阶段3: 执行切换 (Switchover)</h2><h3 id="前置检查"><a href="#前置检查" class="headerlink" title="前置检查"></a>前置检查</h3><p>确保部署状态为 <code>AVAILABLE</code>:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">aws rds describe-blue-green-deployments \</span><br><span class="line">    --blue-green-deployment-identifier bgd-xen1mlsjdt6hlt8r \</span><br><span class="line">    --query <span class="string">&#x27;BlueGreenDeployments[0].Status&#x27;</span> \</span><br><span class="line">    --profile default --region ap-southeast-1</span><br></pre></td></tr></table></figure>

<h3 id="执行切换命令"><a href="#执行切换命令" class="headerlink" title="执行切换命令"></a>执行切换命令</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">aws rds switchover-blue-green-deployment \</span><br><span class="line">    --blue-green-deployment-identifier bgd-xen1mlsjdt6hlt8r \</span><br><span class="line">    --switchover-timeout 300 \</span><br><span class="line">    --profile default --region ap-southeast-1</span><br></pre></td></tr></table></figure>

<h3 id="参数说明-1"><a href="#参数说明-1" class="headerlink" title="参数说明"></a>参数说明</h3><table>
<thead>
<tr>
<th>参数</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>--blue-green-deployment-identifier</code></td>
<td>蓝绿部署ID</td>
</tr>
<tr>
<td><code>--switchover-timeout</code></td>
<td>切换超时时间(秒)，默认300</td>
</tr>
</tbody></table>
<h3 id="切换过程详解"><a href="#切换过程详解" class="headerlink" title="切换过程详解"></a>切换过程详解</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">切换时间线 (实测数据):</span><br><span class="line">────────────────────────────────────────────────────────────────</span><br><span class="line">08:33:35  切换开始，TPS正常 (~263)</span><br><span class="line">08:33:51  TPS开始下降，出现错误 (err/s: 142)</span><br><span class="line">08:33:52  TPS=0，写入完全阻塞</span><br><span class="line">08:36:47  连接完全中断 (QPS=0)</span><br><span class="line">08:37:00  DNS切换完成</span><br><span class="line">08:37:30  切换完成，连接恢复</span><br><span class="line">────────────────────────────────────────────────────────────────</span><br><span class="line">总切换时间: ~4分钟</span><br><span class="line">完全断连时间: ~28秒</span><br></pre></td></tr></table></figure>

<h3 id="切换期间的实例名称变化"><a href="#切换期间的实例名称变化" class="headerlink" title="切换期间的实例名称变化"></a>切换期间的实例名称变化</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">切换前:</span><br><span class="line">  mysql-test-57          → MySQL 5.7 (生产)</span><br><span class="line">  mysql-test-57-green-xxx → MySQL 8.0 (绿环境)</span><br><span class="line"></span><br><span class="line">切换后:</span><br><span class="line">  mysql-test-57          → MySQL 8.0 (新生产，原绿环境)</span><br><span class="line">  mysql-test-57-old1     → MySQL 5.7 (原生产，可用于回滚)</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="阶段4-验证升级结果"><a href="#阶段4-验证升级结果" class="headerlink" title="阶段4: 验证升级结果"></a>阶段4: 验证升级结果</h2><h3 id="检查切换状态"><a href="#检查切换状态" class="headerlink" title="检查切换状态"></a>检查切换状态</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">aws rds describe-blue-green-deployments \</span><br><span class="line">    --blue-green-deployment-identifier bgd-xen1mlsjdt6hlt8r \</span><br><span class="line">    --query <span class="string">&#x27;BlueGreenDeployments[0].&#123;Status:Status,StatusDetails:StatusDetails&#125;&#x27;</span> \</span><br><span class="line">    --profile default --region ap-southeast-1</span><br></pre></td></tr></table></figure>

<h3 id="验证新版本"><a href="#验证新版本" class="headerlink" title="验证新版本"></a>验证新版本</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">aws rds describe-db-instances \</span><br><span class="line">    --db-instance-identifier mysql-test-57 \</span><br><span class="line">    --query <span class="string">&#x27;DBInstances[0].EngineVersion&#x27;</span> \</span><br><span class="line">    --profile default --region ap-southeast-1</span><br></pre></td></tr></table></figure>

<h3 id="连接验证"><a href="#连接验证" class="headerlink" title="连接验证"></a>连接验证</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql -h mysql-test-57.XXX.rds.amazonaws.com \</span><br><span class="line">    -P 3306 -u admin -p -e <span class="string">&quot;SELECT VERSION();&quot;</span></span><br></pre></td></tr></table></figure>

<hr>
<h2 id="阶段5-清理资源"><a href="#阶段5-清理资源" class="headerlink" title="阶段5: 清理资源"></a>阶段5: 清理资源</h2><h3 id="删除蓝绿部署-保留旧实例"><a href="#删除蓝绿部署-保留旧实例" class="headerlink" title="删除蓝绿部署 (保留旧实例)"></a>删除蓝绿部署 (保留旧实例)</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">aws rds delete-blue-green-deployment \</span><br><span class="line">    --blue-green-deployment-identifier bgd-xen1mlsjdt6hlt8r \</span><br><span class="line">    --profile default --region ap-southeast-1</span><br></pre></td></tr></table></figure>

<h3 id="删除蓝绿部署-同时删除旧实例"><a href="#删除蓝绿部署-同时删除旧实例" class="headerlink" title="删除蓝绿部署 (同时删除旧实例)"></a>删除蓝绿部署 (同时删除旧实例)</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">aws rds delete-blue-green-deployment \</span><br><span class="line">    --blue-green-deployment-identifier bgd-xen1mlsjdt6hlt8r \</span><br><span class="line">    --delete-target \</span><br><span class="line">    --profile default --region ap-southeast-1</span><br></pre></td></tr></table></figure>

<h3 id="手动删除旧实例-如需要"><a href="#手动删除旧实例-如需要" class="headerlink" title="手动删除旧实例 (如需要)"></a>手动删除旧实例 (如需要)</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">aws rds delete-db-instance \</span><br><span class="line">    --db-instance-identifier mysql-test-57-old1 \</span><br><span class="line">    --skip-final-snapshot \</span><br><span class="line">    --profile default --region ap-southeast-1</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="回滚方案"><a href="#回滚方案" class="headerlink" title="回滚方案"></a>回滚方案</h2><p>如果升级后发现问题，可以快速回滚:</p>
<h3 id="方法1-切换回旧实例-推荐"><a href="#方法1-切换回旧实例-推荐" class="headerlink" title="方法1: 切换回旧实例 (推荐)"></a>方法1: 切换回旧实例 (推荐)</h3><p>在删除蓝绿部署前，旧实例 (mysql-test-57-old1) 仍然可用:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 修改应用连接字符串指向旧实例</span></span><br><span class="line"><span class="comment"># mysql-test-57-old1.XXXX.amazonaws.com</span></span><br></pre></td></tr></table></figure>

<h3 id="方法2-从快照恢复"><a href="#方法2-从快照恢复" class="headerlink" title="方法2: 从快照恢复"></a>方法2: 从快照恢复</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">aws rds restore-db-instance-from-db-snapshot \</span><br><span class="line">    --db-instance-identifier mysql-test-57-restored \</span><br><span class="line">    --db-snapshot-identifier &lt;snapshot-id&gt; \</span><br><span class="line">    --profile default --region ap-southeast-1</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="实测性能数据"><a href="#实测性能数据" class="headerlink" title="实测性能数据"></a>实测性能数据</h2><h3 id="测试配置"><a href="#测试配置" class="headerlink" title="测试配置"></a>测试配置</h3><ul>
<li>sysbench oltp_read_write</li>
<li>16表 × 100,000行</li>
<li>8并发线程</li>
</ul>
<h3 id="性能对比"><a href="#性能对比" class="headerlink" title="性能对比"></a>性能对比</h3><table>
<thead>
<tr>
<th>指标</th>
<th>MySQL 5.7</th>
<th>MySQL 8.0</th>
<th>变化</th>
</tr>
</thead>
<tbody><tr>
<td>TPS</td>
<td>263</td>
<td>288</td>
<td>+9.5%</td>
</tr>
<tr>
<td>QPS</td>
<td>5,284</td>
<td>5,760</td>
<td>+9.0%</td>
</tr>
<tr>
<td>95%延迟</td>
<td>35ms</td>
<td>35ms</td>
<td>持平</td>
</tr>
</tbody></table>
<h3 id="切换影响"><a href="#切换影响" class="headerlink" title="切换影响"></a>切换影响</h3><table>
<thead>
<tr>
<th>指标</th>
<th>数值</th>
</tr>
</thead>
<tbody><tr>
<td>蓝绿部署总耗时</td>
<td>42分钟</td>
</tr>
<tr>
<td>切换总耗时</td>
<td>4分钟</td>
</tr>
<tr>
<td>完全断连时间</td>
<td>28秒</td>
</tr>
<tr>
<td>数据丢失</td>
<td>0</td>
</tr>
</tbody></table>
<hr>
<h2 id="最佳实践"><a href="#最佳实践" class="headerlink" title="最佳实践"></a>最佳实践</h2><h3 id="1-时间选择"><a href="#1-时间选择" class="headerlink" title="1. 时间选择"></a>1. 时间选择</h3><ul>
<li>选择业务低峰期执行切换</li>
<li>预留足够的监控和回滚时间</li>
</ul>
<h3 id="2-监控准备"><a href="#2-监控准备" class="headerlink" title="2. 监控准备"></a>2. 监控准备</h3><ul>
<li>提前配置CloudWatch告警</li>
<li>准备实时监控脚本</li>
</ul>
<h3 id="3-应用适配"><a href="#3-应用适配" class="headerlink" title="3. 应用适配"></a>3. 应用适配</h3><ul>
<li>确保应用支持MySQL 8.0语法</li>
<li>测试连接池的重连机制</li>
<li>配置合理的连接超时</li>
</ul>
<h3 id="4-回滚准备"><a href="#4-回滚准备" class="headerlink" title="4. 回滚准备"></a>4. 回滚准备</h3><ul>
<li>保留旧实例至少24小时</li>
<li>准备回滚脚本和流程</li>
</ul>
<h3 id="5-通知机制"><a href="#5-通知机制" class="headerlink" title="5. 通知机制"></a>5. 通知机制</h3><ul>
<li>提前通知相关团队</li>
<li>准备故障升级流程</li>
</ul>
<hr>
<h2 id="常见问题"><a href="#常见问题" class="headerlink" title="常见问题"></a>常见问题</h2><h3 id="Q1-蓝绿部署创建失败"><a href="#Q1-蓝绿部署创建失败" class="headerlink" title="Q1: 蓝绿部署创建失败"></a>Q1: 蓝绿部署创建失败</h3><p><strong>原因</strong>: 源实例未启用自动备份<br><strong>解决</strong>: </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">aws rds modify-db-instance \</span><br><span class="line">    --db-instance-identifier mysql-test-57 \</span><br><span class="line">    --backup-retention-period 7 \</span><br><span class="line">    --apply-immediately</span><br></pre></td></tr></table></figure>

<h3 id="Q2-切换超时"><a href="#Q2-切换超时" class="headerlink" title="Q2: 切换超时"></a>Q2: 切换超时</h3><p><strong>原因</strong>: 数据同步延迟过大<br><strong>解决</strong>: 增加 <code>--switchover-timeout</code> 值，或等待复制追平</p>
<h3 id="Q3-切换后应用连接失败"><a href="#Q3-切换后应用连接失败" class="headerlink" title="Q3: 切换后应用连接失败"></a>Q3: 切换后应用连接失败</h3><p><strong>原因</strong>: DNS缓存或连接池未刷新<br><strong>解决</strong>: 重启应用或刷新连接池</p>
<hr>
<h2 id="参考命令汇总"><a href="#参考命令汇总" class="headerlink" title="参考命令汇总"></a>参考命令汇总</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1. 创建蓝绿部署</span></span><br><span class="line">aws rds create-blue-green-deployment \</span><br><span class="line">    --blue-green-deployment-name &lt;name&gt; \</span><br><span class="line">    --<span class="built_in">source</span> &lt;source-arn&gt; \</span><br><span class="line">    --target-engine-version &lt;version&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 查看部署状态</span></span><br><span class="line">aws rds describe-blue-green-deployments \</span><br><span class="line">    --blue-green-deployment-identifier &lt;bgd-id&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. 执行切换</span></span><br><span class="line">aws rds switchover-blue-green-deployment \</span><br><span class="line">    --blue-green-deployment-identifier &lt;bgd-id&gt; \</span><br><span class="line">    --switchover-timeout 300</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4. 删除部署</span></span><br><span class="line">aws rds delete-blue-green-deployment \</span><br><span class="line">    --blue-green-deployment-identifier &lt;bgd-id&gt;</span><br></pre></td></tr></table></figure>


<p><em>基于实际测试环境: AWS ap-southeast-1, Account XXXX</em></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://plantegg.github.io/2025/01/29/%E8%B7%A8Die%E7%83%AD%E8%BF%81%E7%A7%BB%E8%BF%81%E7%A7%BB/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="twitter @plantegg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="plantegg">
      <meta itemprop="description" content="java mysql tcp performance network docker Linux">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | plantegg">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/01/29/%E8%B7%A8Die%E7%83%AD%E8%BF%81%E7%A7%BB%E8%BF%81%E7%A7%BB/" class="post-title-link" itemprop="url">跨 Die 热迁移迁移导致的性能问题</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2025-01-29 17:30:03" itemprop="dateCreated datePublished" datetime="2025-01-29T17:30:03+08:00">2025-01-29</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2025-11-29 15:19:06" itemprop="dateModified" datetime="2025-11-29T15:19:06+08:00">2025-11-29</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CPU/" itemprop="url" rel="index"><span itemprop="name">CPU</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="跨-Die-热迁移迁移导致的性能问题"><a href="#跨-Die-热迁移迁移导致的性能问题" class="headerlink" title="跨 Die 热迁移迁移导致的性能问题"></a>跨 Die 热迁移迁移导致的性能问题</h1><h2 id="场景"><a href="#场景" class="headerlink" title="场景"></a>场景</h2><p>在 ARM 上，本来业务跑在 Die0 上，如果通过taskset 将 CPU 绑到 Die1，经过一段时间运行，内存也会慢慢随着释放&#x2F;新分配慢慢都迁移到 Die1， 但是这之后仍然发现性能比在 Die0 上要差很多。而在 Intel X86 上没碰到过这个问题</p>
<h2 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h2><p>下图是内存带宽使用率监控数据，可以看到跨 Die 绑定后原来的 Die0 带宽急剧增加（7.5% -&gt; 13%）这是因为内存都需要跨 Die 访问了，随着跨 Die 访问并慢慢将内存迁移到 Die1 后内存带宽使用率回落到 5%：</p>
<p><img src="/images/951413iMgBlog/893058e1-0f19-4fc1-a76c-49b48f49317a.png" alt="img"></p>
<p>同时可以看到 CPU 使用率也从 35% 飙升到 76%，随着内存的迁移完毕，CPU  使用率回落到 48%，但仍然比最开始的 35% 高不少：</p>
<p><img src="/images/951413iMgBlog/6b396de3-36cb-42d9-b14b-56be896509f8.png" alt="img"></p>
<h3 id="Intel-X86-下跨-Die-迁移"><a href="#Intel-X86-下跨-Die-迁移" class="headerlink" title="Intel X86 下跨 Die 迁移"></a>Intel X86 下跨 Die 迁移</h3><p>Intel 基本都是一路就是一个 Die，所以你可以理解这里的跨 Die 就是跨路&#x2F;Socket 迁移：</p>
<p><img src="/images/951413iMgBlog/22e39654-d8d3-4d5d-ae88-d2c137be71a0.png" alt="img"></p>
<p><img src="/images/951413iMgBlog/5b4477a5-a8d9-45b2-84e4-fb01cf8cc0b7.png" alt="img"></p>
<h2 id="结论"><a href="#结论" class="headerlink" title="结论"></a>结论</h2><p>ARM 比 X86 差这么多的原因是内存页表跨 Die 访问导致的，业务同学测试了开启 THP 负载的影响，从结果看，THP on 可有效降低cpu水位，但是依然存在跨die迁移cpu水位上升的问题。</p>
<p>alios 对应的 patch：<a target="_blank" rel="noopener" href="https://gitee.com/anolis/cloud-kernel/pulls/2254/commits">https://gitee.com/anolis/cloud-kernel/pulls/2254/commits</a>  不区分 x86 和 arm</p>
<p>页表是进程创建时在内核空间分配好的，所以迁移内存时并不会迁移页表。通过测试页表跨die迁移的poc，验证了跨die页表访问是导致本文所述问题的根本原因</p>
<p>课后作业：</p>
<p>去了解下内存页表&#x2F;THP(透明大页)</p>
<p>学习 CPU 访问内存延时是怎么回事，然后学习 CPU 和内存速度的差异，最后再去看看大学的计算机组成原理</p>
<p>学习下 taskset&#x2F;perf 等命令</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://plantegg.github.io/2025/01/09/CPU%20%E4%BD%BF%E7%94%A8%E7%8E%87%E9%AB%98%E5%B0%B1%E4%B8%80%E5%AE%9A%E6%9C%89%E6%95%88%E7%8E%87%E5%90%97/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="twitter @plantegg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="plantegg">
      <meta itemprop="description" content="java mysql tcp performance network docker Linux">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | plantegg">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/01/09/CPU%20%E4%BD%BF%E7%94%A8%E7%8E%87%E9%AB%98%E5%B0%B1%E4%B8%80%E5%AE%9A%E6%9C%89%E6%95%88%E7%8E%87%E5%90%97/" class="post-title-link" itemprop="url">CPU 使用率高就一定有效率吗？</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2025-01-09 17:30:03" itemprop="dateCreated datePublished" datetime="2025-01-09T17:30:03+08:00">2025-01-09</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2025-11-29 15:19:06" itemprop="dateModified" datetime="2025-11-29T15:19:06+08:00">2025-11-29</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/CPU/" itemprop="url" rel="index"><span itemprop="name">CPU</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="CPU-使用率高就一定有效率吗？"><a href="#CPU-使用率高就一定有效率吗？" class="headerlink" title="CPU 使用率高就一定有效率吗？"></a>CPU 使用率高就一定有效率吗？</h1><h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p>最近碰到一个客户业务跑在8C ECS 上，随着业务压力增加 CPU使用率也即将跑满，于是考虑将 8C 升级到16C，事实是升级后业务 RT 反而略有增加，这个事情也超出了所有程序员们的预料，所以我们接下来分析下这个场景</p>
<h2 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h2><p>通过采集升配前后、以前和正常时段的火焰图对比发现CPU 增加主要是消耗在 自旋锁上了：</p>
<p><img src="/images/951413iMgBlog/image-20240202085410669.png" alt="image-20240202085410669"></p>
<p>用一个案例来解释下自旋锁和锁，如果我们要用多线程对一个整数进行计数，要保证线程安全的话，可以加锁(synchronized), 这个加锁操作也有人叫悲观锁，抢不到锁就让出这个线程的CPU 调度(代价上下文切换一次，几千个时钟周期)</p>
<p>另外一种是用自旋锁(CAS、spin_lock) 来实现，抢不到锁就耍赖占住CPU 死磕不停滴抢(CPU 使用率一直100%)，自旋锁的设计主要是针对抢锁概率小、并发低的场景。这两种方案针对场景不一样各有优缺点</p>
<p>假如你的机器是8C，你有100个线程来对这个整数进行计数的话，你用synchronized 方式来实现会发现CPU 使用率永远达不到50%</p>
<p><img src="/images/951413iMgBlog/image-20240202090428778.png" alt="image-20240202090428778"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">#taskset -a -c 56-63 java LockAccumulator 100 1000000000</span><br><span class="line">累加结果: 1000000000 and time:84267</span><br><span class="line"></span><br><span class="line">Performance counter stats for &#x27;taskset -a -c 56-63 java -Djava.library.path=. LockAccumulator 100 100000000&#x27;:</span><br><span class="line"></span><br><span class="line">      17785.271791      task-clock (msec)         #    2.662 CPUs utilized</span><br><span class="line">           110,351      context-switches          #    0.006 M/sec</span><br><span class="line">            10,094      cpu-migrations            #    0.568 K/sec</span><br><span class="line">            11,724      page-faults               #    0.659 K/sec</span><br><span class="line">    44,187,609,686      cycles                    #    2.485 GHz</span><br><span class="line">   &lt;not supported&gt;      stalled-cycles-frontend</span><br><span class="line">   &lt;not supported&gt;      stalled-cycles-backend</span><br><span class="line">    22,588,807,670      instructions              #    0.51  insns per cycle</span><br><span class="line">     6,919,355,610      branches                  #  389.050 M/sec</span><br><span class="line">        28,707,025      branch-misses             #    0.41% of all branches</span><br></pre></td></tr></table></figure>

<p>如果我们改成自旋锁版本的实现，8个核CPU 都是100%</p>
<p><img src="/images/951413iMgBlog/image-20240202090714845.png" alt="image-20240202090714845"></p>
<p>以下代码累加次数只有加锁版本的10%，时间还长了很多，也就是效率产出实在是低</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">#taskset -a -c 56-63 java -Djava.library.path=. SpinLockAccumulator 100 100000000</span><br><span class="line">累加结果: 100000000</span><br><span class="line">操作耗时: 106593 毫秒</span><br><span class="line"></span><br><span class="line"> Performance counter stats for &#x27;taskset -a -c 56-63 java -Djava.library.path=. SpinLockAccumulator 100 100000000&#x27;:</span><br><span class="line"></span><br><span class="line">      85363.429249      task-clock (msec)         #    7.909 CPUs utilized</span><br><span class="line">            23,010      context-switches          #    0.270 K/sec</span><br><span class="line">             1,262      cpu-migrations            #    0.015 K/sec</span><br><span class="line">            13,403      page-faults               #    0.157 K/sec</span><br><span class="line">   213,191,037,155      cycles                    #    2.497 GHz</span><br><span class="line">   &lt;not supported&gt;      stalled-cycles-frontend</span><br><span class="line">   &lt;not supported&gt;      stalled-cycles-backend</span><br><span class="line">    43,523,454,723      instructions              #    0.20  insns per cycle</span><br><span class="line">    10,306,663,291      branches                  #  120.739 M/sec</span><br><span class="line">        14,704,466      branch-misses             #    0.14% of all branches</span><br></pre></td></tr></table></figure>



<h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><p>我<a target="_blank" rel="noopener" href="https://github.com/plantegg/programmer_case/tree/main/code/spin_lock">放在了github 上</a>，有个带调X86 平台 pause 指令的汇编，Java 中要用JNI 来调用，ChatGPT4帮我写的，并给了编译、运行方案：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">javac SpinLockAccumulator.java</span><br><span class="line">javah -jni SpinLockAccumulator</span><br><span class="line"></span><br><span class="line"># Assuming GCC is installed and the above C code is in SpinLockAccumulator.c</span><br><span class="line">gcc -shared -o libpause.so -fPIC SpinLockAccumulator.c</span><br><span class="line"></span><br><span class="line">java -Djava.library.path=. SpinLockAccumulator</span><br><span class="line"></span><br><span class="line">实际gcc编译要带上jdk的头文件：</span><br><span class="line">gcc -I/opt/openjdk/include/ -I/opt/openjdk/include/linux/ -shared -o libpause.so  -fPIC SpinLockAccumulator.c</span><br></pre></td></tr></table></figure>



<h2 id="在MySQL-INNODB-里怎么优化这个自旋锁"><a href="#在MySQL-INNODB-里怎么优化这个自旋锁" class="headerlink" title="在MySQL INNODB 里怎么优化这个自旋锁"></a>在MySQL INNODB 里怎么优化这个自旋锁</h2><p>MySQL 在自旋锁抢锁的时候每次会调 ut_delay（底层会掉CPU指令，让CPU暂停一下但是不让出——避免上下文切换），发现性能好了几倍。这是MySQL 的官方文档：<a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/5.7/en/innodb-performance-spin_lock_polling.html">https://dev.mysql.com/doc/refman/5.7/en/innodb-performance-spin_lock_polling.html</a></p>
<p>所以我们继续在以上代码的基础上在自旋的时候故意让CPU pause(50个), 这个优化详细案例：<a href="https://plantegg.github.io/2019/12/16/Intel%20PAUSE%E6%8C%87%E4%BB%A4%E5%8F%98%E5%8C%96%E6%98%AF%E5%A6%82%E4%BD%95%E5%BD%B1%E5%93%8D%E8%87%AA%E6%97%8B%E9%94%81%E4%BB%A5%E5%8F%8AMySQL%E7%9A%84%E6%80%A7%E8%83%BD%E7%9A%84/">https://plantegg.github.io/2019/12/16/Intel%20PAUSE%E6%8C%87%E4%BB%A4%E5%8F%98%E5%8C%96%E6%98%AF%E5%A6%82%E4%BD%95%E5%BD%B1%E5%93%8D%E8%87%AA%E6%97%8B%E9%94%81%E4%BB%A5%E5%8F%8AMySQL%E7%9A%84%E6%80%A7%E8%83%BD%E7%9A%84/</a></p>
<h2 id="该你动手了"><a href="#该你动手了" class="headerlink" title="该你动手了"></a>该你动手了</h2><p>随便找一台x86 机器，笔记本也可以，macOS 也行，核数多一些效果更明显。只要有Java环境，就用我编译好的class、libpause.so 理论上也行，不兼容的话按代码那一节再重新编译一下</p>
<p>可以做的实验：</p>
<ul>
<li>重复我前面两个运行，看CPU 使用率以及最终耗时</li>
<li>尝试优化待pause版本的自旋锁实现，是不是要比没有pause性能反而要好</li>
<li>尝试让线程sleep 一下，效果是不是要好？</li>
<li>尝试减少线程数量，慢慢是不是发现自旋锁版本的性能越来越好了</li>
</ul>
<p>改变线程数量运行对比：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">//自旋锁版本线程数对总时间影响很明显，且线程少的话性能要比加锁版本好，这符合自旋锁的设定:大概率不需要抢就用自旋锁</span><br><span class="line">#taskset -a -c 56-63 java -Djava.library.path=. SpinLockAccumulator 1 100000000</span><br><span class="line">累加结果: 100000000</span><br><span class="line">操作耗时: 2542 毫秒</span><br><span class="line"></span><br><span class="line">#taskset -a -c 56-63 java -Djava.library.path=. SpinLockAccumulator 2 100000000</span><br><span class="line">累加结果: 100000000</span><br><span class="line">操作耗时: 2773 毫秒</span><br><span class="line"></span><br><span class="line">#taskset -a -c 56-63 java -Djava.library.path=. SpinLockAccumulator 4 100000000</span><br><span class="line">累加结果: 100000000</span><br><span class="line">操作耗时: 4109 毫秒</span><br><span class="line"></span><br><span class="line">#taskset -a -c 56-63 java -Djava.library.path=. SpinLockAccumulator 8 100000000</span><br><span class="line">累加结果: 100000000</span><br><span class="line">操作耗时: 11931 毫秒</span><br><span class="line"></span><br><span class="line">#taskset -a -c 56-63 java -Djava.library.path=. SpinLockAccumulator 16 100000000</span><br><span class="line">累加结果: 100000000</span><br><span class="line">操作耗时: 13476 毫秒</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">//加锁版本线程数变化对总时间影响不那么大</span><br><span class="line">#taskset -a -c 56-63 java -Djava.library.path=. LockAccumulator 16 100000000</span><br><span class="line">累加结果: 100000000 and time:9074</span><br><span class="line"></span><br><span class="line">#taskset -a -c 56-63 java -Djava.library.path=. LockAccumulator 8 100000000</span><br><span class="line">累加结果: 100000000 and time:8832</span><br><span class="line"></span><br><span class="line">#taskset -a -c 56-63 java -Djava.library.path=. LockAccumulator 4 100000000</span><br><span class="line">累加结果: 100000000 and time:7330</span><br><span class="line"></span><br><span class="line">#taskset -a -c 56-63 java -Djava.library.path=. LockAccumulator 2 100000000</span><br><span class="line">累加结果: 100000000 and time:6298</span><br><span class="line"></span><br><span class="line">#taskset -a -c 56-63 java -Djava.library.path=. LockAccumulator 1 100000000</span><br><span class="line">累加结果: 100000000 and time:3143</span><br></pre></td></tr></table></figure>

<p>设定100并发下，改变机器核数对比：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">//16核机器跑3次 耗时稳定在12秒以上，CPU使用率 1600%</span><br><span class="line">#taskset -a -c 48-63 java -Djava.library.path=. SpinLockAccumulator 100 10000000</span><br><span class="line">累加结果: 10000000</span><br><span class="line">操作耗时: 12860 毫秒</span><br><span class="line"></span><br><span class="line">#taskset -a -c 48-63 java -Djava.library.path=. SpinLockAccumulator 100 10000000</span><br><span class="line">累加结果: 10000000</span><br><span class="line">操作耗时: 12949 毫秒</span><br><span class="line"></span><br><span class="line">#taskset -a -c 48-63 java -Djava.library.path=. SpinLockAccumulator 100 10000000</span><br><span class="line">累加结果: 10000000</span><br><span class="line">操作耗时: 13692 毫秒</span><br><span class="line"></span><br><span class="line">//8核机器跑3次，耗时稳定5秒左右，CPU使用率 800%</span><br><span class="line">#taskset -a -c 56-63 java -Djava.library.path=. SpinLockAccumulator 100 10000000</span><br><span class="line">累加结果: 10000000</span><br><span class="line">操作耗时: 6773 毫秒</span><br><span class="line"></span><br><span class="line">#taskset -a -c 56-63 java -Djava.library.path=. SpinLockAccumulator 100 10000000</span><br><span class="line">累加结果: 10000000</span><br><span class="line">操作耗时: 5557 毫秒</span><br><span class="line"></span><br><span class="line">#taskset -a -c 56-63 java -Djava.library.path=. SpinLockAccumulator 100 10000000</span><br><span class="line">累加结果: 10000000</span><br><span class="line">操作耗时: 2724 毫秒</span><br></pre></td></tr></table></figure>



<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>以后应该不会再对升配后CPU 使用率也上去了，但是最终效率反而没变展现得很惊诧了</p>
<p>从CPU 使用率、上下文切换上理解自旋锁(乐观锁)和锁(悲观锁)</p>
<p>MySQL 里对自旋锁的优化，增加配置 <a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/5.7/en/innodb-parameters.html#sysvar_innodb_spin_wait_delay"><code>innodb_spin_wait_delay</code></a>  来增加不同场景下DBA 的干预手段</p>
<p>这篇文章主要功劳要给 ChatGPT4 ，里面所有演示代码都是它完成的</p>
<h2 id="相关阅读"><a href="#相关阅读" class="headerlink" title="相关阅读"></a>相关阅读</h2><p><a target="_blank" rel="noopener" href="https://articles.zsxq.com/id_332xqfhuxern.html">流量一样但为什么CPU使用率差别很大</a> 同样也是跟CPU 要效率，不过这个案例不是因为自旋锁导致CPU 率高，而是内存延时导致的</p>
<p><a target="_blank" rel="noopener" href="https://t.zsxq.com/16PqQ3p4x">今日短平快，ECS从16核升配到48核后性能没有任何提升（Netflix）</a> 也是CPU 使用率高没有产出，cacheline伪共享导致的</p>
<p><a href="https://plantegg.github.io/2022/03/15/%E8%AE%B0%E4%B8%80%E6%AC%A1%E5%90%AC%E9%A3%8E%E6%89%87%E5%A3%B0%E9%9F%B3%E6%9D%A5%E5%AE%9A%E4%BD%8D%E6%80%A7%E8%83%BD/">听风扇声音来定位性能瓶颈</a></p>
<p>你要是把这个案例以及上面三个案例综合看明白了，相当于把计算机组成原理就学明白了。这里最核心的就是“内存墙”，也就是内存速度没有跟上CPU的发展速度，导致整个计算机内绝大多场景下读写内存缓慢成为主要的瓶颈</p>
<h2 id="如果你觉得看完对你很有帮助可以通过如下方式找到我"><a href="#如果你觉得看完对你很有帮助可以通过如下方式找到我" class="headerlink" title="如果你觉得看完对你很有帮助可以通过如下方式找到我"></a>如果你觉得看完对你很有帮助可以通过如下方式找到我</h2><p>find me on twitter: <a target="_blank" rel="noopener" href="https://twitter.com/plantegg">@plantegg</a></p>
<p>知识星球：<a target="_blank" rel="noopener" href="https://t.zsxq.com/0cSFEUh2J">https://t.zsxq.com/0cSFEUh2J</a></p>
<p>开了一个星球，在里面讲解一些案例、知识、学习方法，肯定没法让大家称为顶尖程序员(我自己都不是)，只是希望用我的方法、知识、经验、案例作为你的垫脚石，帮助你快速、早日成为一个基本合格的程序员。</p>
<p>争取在星球内：</p>
<ul>
<li>养成基本动手能力</li>
<li>拥有起码的分析推理能力–按我接触的程序员，大多都是没有逻辑的</li>
<li>知识上教会你几个关键的知识点</li>
</ul>
<img src="/images/951413iMgBlog/image-20240324161113874-5525714.png" alt="image-20240324161113874" style="zoom:50%;" />


      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://plantegg.github.io/2024/11/02/tcp%E4%BC%9A%E5%81%B6%E5%B0%943%E7%A7%92timeout/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="twitter @plantegg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="plantegg">
      <meta itemprop="description" content="java mysql tcp performance network docker Linux">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | plantegg">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/11/02/tcp%E4%BC%9A%E5%81%B6%E5%B0%943%E7%A7%92timeout/" class="post-title-link" itemprop="url">tcp会偶尔3秒timeout的分析以及如何用php规避这个问题</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-11-02 17:30:03" itemprop="dateCreated datePublished" datetime="2024-11-02T17:30:03+08:00">2024-11-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2025-11-16 19:58:49" itemprop="dateModified" datetime="2025-11-16T19:58:49+08:00">2025-11-16</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/TCP/" itemprop="url" rel="index"><span itemprop="name">TCP</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="tcp会偶尔3秒timeout的分析以及如何用php规避这个问题"><a href="#tcp会偶尔3秒timeout的分析以及如何用php规避这个问题" class="headerlink" title="tcp会偶尔3秒timeout的分析以及如何用php规避这个问题"></a><a target="_blank" rel="noopener" href="https://web.archive.org/web/20170317084941/http://mogu.io/tcp-three-second-timeout-with-php-3">tcp会偶尔3秒timeout的分析以及如何用php规避这个问题</a></h1><blockquote>
<p>这是一篇好文章，随着蘑菇街的完蛋，蘑菇街技术博客也没了，所以特意备份一下这篇</p>
</blockquote>
<ul>
<li><p>作者：蚩尤 </p>
</li>
<li><p>时间：May 27, 2014</p>
</li>
</ul>
<p>2年前做一个cache中间件调用的时候，发现很多通过php的curl调用一个的服务会出现偶尔的connect_time超时, 表现为get_curlinfo的connect_time在3秒左右, 本来没怎么注意, 因为客户端的curl_timeout设置的就是3秒, 某天, 我把这个timeout改到了5秒后, 发现了一个奇怪的现象, 很多慢请求依旧表现为connect_time在3秒左右..看来这个3秒并不是因为客户端设置的timeout引起的.于是开始查找这个原因.</p>
<hr>
<p>首先, 凭借经验调整了linux内核关于tcp的几个参数</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">net.core.netdev_max_backlog = 862144</span><br><span class="line">net.core.somaxconn = 262144</span><br></pre></td></tr></table></figure>

<p>经过观察发现依旧会有3秒超时, 而且数量并没有减少.</p>
<p>第二步, 排除是大并发导致的问题, 在一台空闲机器上也部署同样的服务, 仅让线上一台机器跑空闲机器的服务, 结果发现依旧会有报错.排除并发导致的问题.</p>
<p>最后, 通过查了大量的资料才发现并不是我们才遇到过这个问题, 而且这个问题并不是curl的问题, 它影响到所有tcp的调用, 网上各种说法, 但结论都指向linux内核对于tcp的实现.(某些版本会出现这些问题), 有兴趣的可以看下下面这两个资料.<br><a target="_blank" rel="noopener" href="https://web.archive.org/web/20170317084941/http://www.spinics.net/lists/linux-net/msg17545.html">资料1</a><br><a target="_blank" rel="noopener" href="https://web.archive.org/web/20170317084941/http://marc.info/?t=120655182600018&r=1&w=2">资料2</a></p>
<p>一看深入到linux内核..不管怎样修改的成本一定很大..于是乎, 发挥我们手中的php来规避这个问题的时间到了.</p>
<p>原本的代码, 简单实现，常规curl调用:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">function curl_call($p1, $p2 ...) &#123;</span><br><span class="line">   $ch = curl_init();</span><br><span class="line">   curl_setopt($ch, CURLOPT_TIMEOUT, 5);</span><br><span class="line">   curl_setopt($ch, CURLOPT_URL, &#x27;http://demon.at&#x27;);</span><br><span class="line">   $res = curl_exec($ch);</span><br><span class="line">   if (false === $res) &#123;</span><br><span class="line">      //失败..抛异常..</span><br><span class="line">   &#125;</span><br><span class="line">   return $res;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以看出, 如果用上面的代码, 无法避免3秒connect_time的问题..这种实现对curl版本会有要求(CURLOPT_CONNECTTIMEOUT_MS)，主要的思路是，通过对链接时间进行毫秒级的控制(因为超时往往发生在connect的时候)，加上失败重试机制，来最大限度保证调用的正确性。所以,下面的代码就诞生了:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">function curl_call($p1, $p2, $times = 1) &#123;</span><br><span class="line">   $ch = curl_init();</span><br><span class="line">   curl_setopt($ch, CURLOPT_TIMEOUT, 5);</span><br><span class="line">   curl_setopt($ch, CURLOPT_URL, &#x27;http://demon.at&#x27;);</span><br><span class="line">   $curl_version = curl_version();</span><br><span class="line">   if ($curl_version[&#x27;version_number&#x27;] &gt;= 462850) &#123;</span><br><span class="line">      curl_setopt($ch, CURLOPT_CONNECTTIMEOUT_MS, 20);</span><br><span class="line">      curl_setopt($ch, CURLOPT_NOSIGNAL, 1);</span><br><span class="line">   &#125; else &#123;</span><br><span class="line">      throw new Exception(&#x27;this curl version is too low, version_num : &#x27; </span><br><span class="line">                         . $curl_version[&#x27;version&#x27;]);</span><br><span class="line">   &#125;</span><br><span class="line">   $res = curl_exec($ch);</span><br><span class="line">   curl_close($ch);</span><br><span class="line">   if (false === $res) &#123;</span><br><span class="line">      if (curl_errno($ch) == CURLE_OPERATION_TIMEOUTED</span><br><span class="line">             and $times != 最大重试阀值 ) &#123;</span><br><span class="line">         $times += 1;</span><br><span class="line">         return curl_call($p1, $p2, $times);</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   return $res;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上面这段代码只是一个规避的简单实例, 一些小细节并没有可以完善..比如抛出异常常以后curl资源的手动释放等等..这里不做讨论..当然还漏了一点要说的是，对重试次数最好加上限制 :)</p>
<p>说明一下上面几个数字值的含义:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">462850 //因为php的CURLOPT_CONNECTTIMEOUT_MS需要 curl_version 7.16.2,这个值就是这个版本的数字版本号，还需要注意的是, php版本要大于5.2.3</span><br><span class="line">20 //连接超时的时间, 单位:ms</span><br></pre></td></tr></table></figure>

<hr>
<p>这样这个问题就这样通过php的代码来规避开了.<br>如果有对这个问题有更好的解决方法，欢迎指教.</p>
<hr>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/-pRA12sLJktbXa-srWn02w">tcp connect 的流程是这样的</a>：<br>1、tcp发出SYN建链报文后，报文到ip层需要进行路由查询<br>2、路由查询完成后，报文到arp层查询下一跳mac地址<br>3、如果本地没有对应网关的arp缓存，就需要缓存住这个报文，发起arp请求<br>4、arp层收到arp回应报文之后，从缓存中取出SYN报文，完成mac头填写并发送给驱动。</p>
<p>问题在于，arp层缓存队列长度默认为3。如果你运气不好，刚好赶上缓存已满，这个报文就会被丢弃。</p>
<p>TCP层发现SYN报文发出去3s（默认值）还没有回应，就会重发一个SYN。这就是为什么少数连接会3s后才能建链。</p>
<p>幸运的是，arp层缓存队列长度是可配置的，用 sysctl -a | grep unres_qlen 就能看到，默认值为3。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/19/">19</a><a class="extend next" rel="next" title="下一页" aria-label="下一页" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2026</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">twitter @plantegg</span>
  </div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>

</body>
</html>
