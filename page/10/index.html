<!doctype html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.1" rel="stylesheet" type="text/css">


  <meta name="keywords" content="Hexo, NexT">





  <link rel="alternate" href="/atom.xml" title="plantegg" type="application/atom+xml">




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.1">






<meta name="description" content="java mysql tcp performance network docker Linux">
<meta property="og:type" content="website">
<meta property="og:title" content="plantegg">
<meta property="og:url" content="https://plantegg.github.io/page/10/index.html">
<meta property="og:site_name" content="plantegg">
<meta property="og:description" content="java mysql tcp performance network docker Linux">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="plantegg">
<meta name="twitter:description" content="java mysql tcp performance network docker Linux">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://plantegg.github.io/page/10/">





  <title>plantegg - java tcp mysql performance network docker Linux</title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  















  
  
    
  

  

  <div class="container sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta custom-logo">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">plantegg</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <h1 class="site-subtitle" itemprop="description">java tcp mysql performance network docker Linux</h1>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-categories"></i> <br>
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-sitemap">
          <a href="/sitemap.xml" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-sitemap"></i> <br>
            
            站点地图
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br>
            
            关于
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://plantegg.github.io/2016/08/24/Linux tc qdisc的使用案例/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="twitter @plantegg">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="plantegg">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/08/24/Linux tc qdisc的使用案例/" itemprop="url">Linux tc qdisc的使用案例</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-08-24T17:30:03+08:00">
                2016-08-24
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Linux/" itemprop="url" rel="index">
                    <span itemprop="name">Linux</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Linux-tc-qdisc的使用案例"><a href="#Linux-tc-qdisc的使用案例" class="headerlink" title="Linux tc qdisc的使用案例"></a>Linux tc qdisc的使用案例</h1><p>在linux下通过tc qdisc 很容易对rt延时、丢包、带宽进行控制，这样的话方便重现各种网络问题</p>
<h2 id="延时"><a href="#延时" class="headerlink" title="延时"></a>延时</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">1. give packets from eth0 a delay of 2ms</span><br><span class="line"><span class="meta">bash$</span> tc qdisc add dev eth0 root netem delay 2ms</span><br><span class="line"> </span><br><span class="line">2.change the delay to 300ms</span><br><span class="line"><span class="meta">bash$</span> tc qdisc change dev eth0 root netem delay 3ms</span><br><span class="line"></span><br><span class="line">3.display eth0 delay setting</span><br><span class="line"><span class="meta">bash$</span> tc qdisc show dev eth0</span><br><span class="line"> </span><br><span class="line">4.stop the delay</span><br><span class="line"><span class="meta">bash$</span> tc qdisc del dev eth0 root</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span>corrupt</span><br><span class="line">The following rule corrupts 5% of the packets by introducing single bit error at a random offset in the packet:</span><br><span class="line">tc qdisc change dev eth0 root netem corrupt 5%</span><br></pre></td></tr></table></figure>

<h2 id="模拟网络丢包"><a href="#模拟网络丢包" class="headerlink" title="模拟网络丢包"></a>模拟网络丢包</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tc qdisc add dev eth0 root netem loss 1%</span><br></pre></td></tr></table></figure>

<p>指定ip 172.31.65.30延时17ms， 测试发现181和183这两句命令顺序无所谓。恢复正常：179行命令</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">179  tc qdisc del dev eth0 root</span><br><span class="line">180  tc qdisc add dev eth0 root handle 1: prio</span><br><span class="line">181  tc filter add dev eth0 parent 1:0 protocol ip pref 55 handle ::55 u32 match ip dst 172.31.65.30 flowid 2:1</span><br><span class="line">182  tc qdisc ls</span><br><span class="line">183  tc qdisc add dev eth0 parent 1:1 handle 2: netem delay 17ms</span><br></pre></td></tr></table></figure>

<h2 id="指定ip和端口延时"><a href="#指定ip和端口延时" class="headerlink" title="指定ip和端口延时"></a>指定ip和端口延时</h2><p>指定 eth0 网卡，来源 ip 是 10.0.1.1，目的端口是 3306 的访问延迟 20ms，上下浮动 2ms  100.100.146.3</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># 指定 eth0 网卡，来源 ip 是 10.0.1.1，目的端口是 3306 的访问延迟 20ms，上下浮动 2ms</span><br><span class="line">tc qdisc add dev eth0 root handle 1: prio bands 4</span><br><span class="line">tc qdisc add dev eth0 parent 1:4 handle 40: netem delay 20ms 2ms</span><br><span class="line">tc filter add dev bond0 parent 1: protocol ip prio 4 basic match &quot;cmp(u16 at 2 layer transport eq 80)</span><br><span class="line">                            and cmp(u8 at 16 layer network eq 100)</span><br><span class="line">                            and cmp(u8 at 17 layer network eq 100)</span><br><span class="line">                            and cmp(u8 at 18 layer network eq 146)</span><br><span class="line">                            and cmp(u8 at 19 layer network eq 3)&quot; flowid 1:4</span><br><span class="line">                            </span><br><span class="line"># 删除过滤</span><br><span class="line">sudo tc filter del dev eth0 parent 1: prio 4 basic</span><br><span class="line">sudo tc qdisc  del dev eth0 root</span><br></pre></td></tr></table></figure>

<p>0 layer 代表 sport<br>2 layer 代表 dport</p>
<h2 id="指定端口34001上，延时5ms"><a href="#指定端口34001上，延时5ms" class="headerlink" title="指定端口34001上，延时5ms"></a>指定端口34001上，延时5ms</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">tc qdisc add dev eth0 root handle 1: prio</span><br><span class="line">tc qdisc add dev eth0 parent 1:3 handle 30: netem delay 5ms</span><br><span class="line">tc filter add dev eth0 protocol ip parent 1:0 u32 match ip sport 34001 0xffff flowid 1:3</span><br></pre></td></tr></table></figure>

<h2 id="控制网卡的带宽、延时、乱序、丢包"><a href="#控制网卡的带宽、延时、乱序、丢包" class="headerlink" title="控制网卡的带宽、延时、乱序、丢包"></a>控制网卡的带宽、延时、乱序、丢包</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">sudo tc qdisc add dev bond0 root handle 1: netem delay 10ms reorder 25% 50% loss 0.2%</span><br><span class="line">sudo tc qdisc add dev bond0 parent 1: handle 2: tbf rate 1mbit burst 32kbit latency 10ms</span><br><span class="line"></span><br><span class="line">/sbin/tc qdisc add dev bond0 root tbf rate 500kbit latency 50ms burst 15kb</span><br><span class="line"></span><br><span class="line">// 同时模拟20Mbps带宽，50msRTT和0.1%丢包率  </span><br><span class="line"><span class="meta">#</span> tc qdisc add dev bond0 root handle 1:0 tbf rate 20mbit burst 10kb limit 300000  </span><br><span class="line"><span class="meta">#</span> tc qdisc add dev bond0 parent 1:0 handle 10:0 netem delay 50ms loss 0.1 limit 300000 </span><br><span class="line"></span><br><span class="line">tc qdisc change dev eth0 root netem reorder 50% gap 3 delay 1ms</span><br><span class="line">tc qdisc change dev eth0 root netem delay 1ms reorder 15%</span><br><span class="line"></span><br><span class="line">//在eth0上设置一个tbf队列，网络带宽为200kbit，延迟10ms以内，超出的包会被drop掉，缓冲区为1540个字节</span><br><span class="line">sudo /sbin/tc qdisc add dev eth0 root tbf rate 200kbit latency 10ms burst 15kb</span><br><span class="line">sudo /sbin/tc qdisc ls dev eth0</span><br></pre></td></tr></table></figure>

<p>在eth0上设置一个tbf队列，网络带宽为200kbit，延迟10ms以内，超出的包会被drop掉，缓冲区为1540个字节</p>
<blockquote>
<p>rate表示令牌的产生速率, <em>sustained maximum rate</em><br>latency表示数据包在队列中的最长等待时间, <em>packets with higher latency get dropped</em><br>burst参数表示  maximum allowed burst：<br>  burst means the maximum amount of bytes that tokens can be available for instantaneously.<br>  如果数据包的到达速率与令牌的产生速率一致，即200kbit，则数据不会排队，令牌也不会剩余<br>  如果数据包的到达速率小于令牌的产生速率，则令牌会有一定的剩余。<br>  如果后续某一会数据包的到达速率超过了令牌的产生速率，则可以一次性的消耗一定量的令牌。<br>  burst就是用于限制这“一次性”消耗的令牌的数量的，以字节数为单位。</p>
</blockquote>
<p>tbf: <em>use</em> the <em>token buffer filter to manipulate traffic rates</em></p>
<p>限制10MB，排队等待超过100ms就触发丢包，只限制了出去的流量，没有限制进来的流量:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">tc qdisc ls dev eth0 // 查看eth0上的队列规则  </span><br><span class="line">sudo tc qdisc add dev eth0 root tbf rate 80mbit burst 1mbit latency 100ms </span><br><span class="line"></span><br><span class="line">//限制80MB</span><br><span class="line">sudo tc qdisc add dev eth0 root tbf rate 80mbps burst 1mbps latency 100ms</span><br></pre></td></tr></table></figure>

<h3 id="乱序"><a href="#乱序" class="headerlink" title="乱序"></a>乱序</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1001  [2024-08-08 15:12:01] sudo tc qdisc add dev bond0 root handle 1: prio</span><br><span class="line">1004  [2024-08-08 15:12:44] sudo tc filter add dev bond0 parent 1: protocol ip prio 1 u32 match ip dst 1.2.3.7 flowid 1:1</span><br><span class="line">1005  [2024-08-08 15:13:17] tc qdisc add dev bond0 parent 1:1 handle 10: netem delay 10ms reorder 5% 10%</span><br></pre></td></tr></table></figure>

<h2 id="两地三中心模拟"><a href="#两地三中心模拟" class="headerlink" title="两地三中心模拟"></a>两地三中心模拟</h2><p>针对不同的ip地址可以限制不同的带宽和网络延时，htb较prio多了一个带宽控制</p>
<p>通过htb 只限制带宽和延时</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">//对10.0.3.228、229延时1ms，对 10.0.3.232延时30ms 两地三中心限制延时和带宽</span><br><span class="line">tc qdisc add dev eth0 root handle 1: htb</span><br><span class="line"></span><br><span class="line">tc class add dev eth0 parent 1: classid 1:1 htb rate 600Gbps</span><br><span class="line">tc filter add dev eth0 parent 1: protocol ip prio 1 u32 flowid 1:1 match ip dst 10.0.3.228</span><br><span class="line">tc qdisc add dev eth0 parent 1:1 handle 10: netem delay 1ms</span><br><span class="line"></span><br><span class="line">tc class add dev eth0 parent 1: classid 1:2 htb rate 600Gbps</span><br><span class="line">tc filter add dev eth0 parent 1: protocol ip prio 1 u32 flowid 1:2 match ip dst 10.0.3.229</span><br><span class="line">tc qdisc add dev eth0 parent 1:2 handle 20: netem delay 1ms</span><br><span class="line"></span><br><span class="line">tc class add dev eth0 parent 1: classid 1:3 htb rate 600Gbps</span><br><span class="line">tc filter add dev eth0 parent 1: protocol ip prio 1 u32 flowid 1:3 match ip dst 10.0.3.232</span><br><span class="line">tc qdisc add dev eth0 parent 1:3 handle 30: netem delay 30ms</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/plantegg/plantegg.github.io/images/951413iMgBlog/image-20230607152951762.png" alt="image-20230607152951762"></p>
<p><img src="https://cdn.jsdelivr.net/gh/plantegg/plantegg.github.io/images/951413iMgBlog/TX_path_tc_mqprio-1.png" alt="img"></p>
<p>通过prio 只限制延时</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">//两地三中心限制不同的延时，htb才可以加带宽限制</span><br><span class="line">tc qdisc add dev eth0 root handle 1: prio</span><br><span class="line"></span><br><span class="line">//10.0.3.228/10.0.3.229 延时1ms</span><br><span class="line">tc filter add dev eth0 parent 1: protocol ip prio 1 u32 flowid 1:1 match ip dst 10.0.3.228/31</span><br><span class="line">tc qdisc add dev eth0 parent 1:1 handle 10: netem delay 1ms</span><br><span class="line"></span><br><span class="line">tc filter add dev eth0 parent 1: protocol ip prio 1 u32 flowid 1:2 match ip dst 10.0.3.232</span><br><span class="line">tc qdisc add dev eth0 parent 1:2 handle 20: netem delay 30ms</span><br></pre></td></tr></table></figure>

<h2 id="qdisc的类别"><a href="#qdisc的类别" class="headerlink" title="qdisc的类别"></a><a href="https://cloud.tencent.com/developer/article/1409664" target="_blank" rel="noopener">qdisc的类别</a></h2><p>QDisc(排队规则)是queueing discipline的简写，它是理解流量控制(traffic control)的基础。无论何时，内核如果需要通过某个网络接口发送数据包，它都需要按照为这个接口配置的qdisc(排队规则)把数据包加入队列。然后，内核会尽可能多地从qdisc里面取出数据包，把它们交给网络适配器驱动模块。最简单的QDisc是pfifo它不对进入的数据包做任何的处理，数据包采用先入先出的方式通过队列。不过，它会保存网络接口一时无法处理的数据包。</p>
<p>一个网络接口上如果没有设置QDisc，pfifo_fast就作为缺省的QDisc。</p>
<p>CLASSFUL QDISC(分类QDisc)，可分类的qdisc包括： </p>
<ul>
<li>CBQ： CBQ是Class Based Queueing(基于类别排队)的缩写。它实现了一个丰富的连接共享类别结构，既有限制(shaping)带宽的能力，也具有带宽优先级管理的能力。带宽限制是通过计算连接的空闲时间完成的。空闲时间的计算标准是数据包离队事件的频率和下层连接(数据链路层)的带宽。</li>
<li>HTB： HTB是Hierarchy Token Bucket的缩写。通过在实践基础上的改进，它实现了一个丰富的连接共享类别体系。使用HTB可以很容易地保证每个类别的带宽，它也允许特定的类可以突破带宽上限，占用别的类的带宽。HTB可以通过TBF(Token Bucket Filter)实现带宽限制，也能够划分类别的优先级。</li>
<li>PRIO： PRIO QDisc 不能限制带宽，因为属于不同类别的数据包是顺序离队的。使用PRIO QDisc可以很容易对流量进行优先级管理，只有属于高优先级类别的数据包全部发送完毕，才会发送属于低优先级类别的数据包。为了方便管理，需要使用iptables或者ipchains处理数据包的服务类型(Type Of Service,ToS)。</li>
</ul>
<h3 id="htb分类-qdisc"><a href="#htb分类-qdisc" class="headerlink" title="htb分类 qdisc"></a>htb分类 qdisc</h3><p>tbf能对流量无差别控制，htb可以进一步进行更精细的控制</p>
<h4 id="针对IP、端口限速案例"><a href="#针对IP、端口限速案例" class="headerlink" title="针对IP、端口限速案例"></a>针对IP、端口限速案例</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span>cat qdisc_bw.sh</span><br><span class="line"><span class="meta">#</span>!/bin/bash</span><br><span class="line"><span class="meta">#</span>针对不同的ip进行限速</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span>清空原有规则</span><br><span class="line">tc qdisc del dev eth0 root</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span>创建根序列</span><br><span class="line">tc qdisc add dev eth0 root handle 1: htb default 1</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span>创建一个主分类绑定所有带宽资源（60M）</span><br><span class="line">tc class add dev eth0 parent 1:0 classid 1:1 htb rate 60Mbps burst 15k</span><br><span class="line"><span class="meta">#</span>到这里可以使用了，整机速度限制到了60M</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span>创建子分类，ceil表示最大带宽</span><br><span class="line">tc class add dev eth0 parent 1:1 classid 1:10 htb rate 2Mbps ceil 1Mbps burst 15k</span><br><span class="line">tc class add dev eth0 parent 1:1 classid 1:20 htb rate 20Mbps ceil 30Mbps burst 15k</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span>为了避免一个会话永占带宽,添加随即公平队列sfq.</span><br><span class="line"><span class="meta">#</span>perturb：是多少秒后重新配置一次散列算法，默认为10秒</span><br><span class="line"><span class="meta">#</span>sfq,他可以防止一个段内的一个ip占用整个带宽</span><br><span class="line">tc qdisc add dev eth0 parent 1:10 handle 10: sfq perturb 10</span><br><span class="line">tc qdisc add dev eth0 parent 1:20 handle 20: sfq perturb 10</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span>创建过滤器</span><br><span class="line"><span class="meta">#</span>对所有ip限速到1Mbps</span><br><span class="line">tc filter add dev eth0 protocol ip parent 1:0 prio 2 u32 match ip dst 0.0.0.0/0 flowid 1:10</span><br><span class="line"><span class="meta">#</span>对10.0.186.140限速在30Mbps</span><br><span class="line">tc filter add dev eth0 protocol ip parent 1:0 prio 1 u32 match ip dst 10.0.186.140 flowid 1:20</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span>对端口进行filter限流</span><br><span class="line"><span class="meta">#</span>tc filter add dev eth0 protocol ip parent 1:0 prio 1 u32 match ip sport 22 flowid 1:10</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span>查看以上规则</span><br><span class="line">sudo tc class show dev eth0</span><br><span class="line">sudo tc filter show dev eth0</span><br></pre></td></tr></table></figure>

<p>限流100MB后的实际监控效果</p>
<p><img src="https://cdn.jsdelivr.net/gh/plantegg/plantegg.github.io/images/951413iMgBlog/image-20211031205539407.png" alt="image-20211031205539407"></p>
<h2 id="docker-中使用-tc"><a href="#docker-中使用-tc" class="headerlink" title="docker 中使用 tc"></a>docker 中使用 tc</h2><p>docker里无法使用的bug 可以参考 <a href="https://bugzilla.redhat.com/show_bug.cgi?id=1152231%EF%BC%8C%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95%E5%B0%B1%E6%98%AF%E5%8D%87%E7%BA%A7tc%E7%89%88%E6%9C%AC%EF%BC%8Ctc" target="_blank" rel="noopener">https://bugzilla.redhat.com/show_bug.cgi?id=1152231，解决方法就是升级tc版本，tc</a> qdisc add 时加上direct_qlen参数</p>
<h3 id="场景："><a href="#场景：" class="headerlink" title="场景："></a>场景：</h3><p>故障注入的docker: 10.1.1.149</p>
<p>10.1.1.149上会模拟各种网络故障，但是中控机到该docker的连接需要不受影响</p>
<p>DEVICE_NAME&#x3D;eth0</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"># 根规则，direct_qlen 1000必须加，否则在docker的虚拟网络跑不了</span><br><span class="line">tc qdisc add dev $&#123;DEVICE_NAME&#125; root handle 1: htb  default 1024 direct_qlen 1000</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 建立两个类继承root</span><br><span class="line">tc class add dev $&#123;DEVICE_NAME&#125; parent 1:0 classid 1:1 htb rate 10000mbit</span><br><span class="line">tc class add dev $&#123;DEVICE_NAME&#125; parent 1:0 classid 1:2 htb rate 10000mbit</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#新版本的tc在filter设置完后，所有网络都会断，类似黑名单，需要加qdisc才能恢复, 所以先让两个通道都能跑</span><br><span class="line"># 队列采用公平的调度算法，保证网络通畅，perturb参数是每隔10秒换一次hash，进一步保障平均</span><br><span class="line">tc qdisc add dev $&#123;DEVICE_NAME&#125; parent 1:1 sfq perturb 10</span><br><span class="line">tc qdisc add dev $&#123;DEVICE_NAME&#125; parent 1:2 sfq perturb 10</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 加过滤规则</span><br><span class="line">#1.队列1是和跳板机交互的网络，需要保持通畅</span><br><span class="line">tc filter add dev $&#123;DEVICE_NAME&#125; protocol ip parent 1: prio 10 u32 match ip dst 10.0.0.200/32 flowid 1:1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#2.其他所有主机走队列2，实现网络模拟</span><br><span class="line">tc filter add dev $&#123;DEVICE_NAME&#125; protocol ip parent 1: prio 10 u32 match ip dst 0.0.0.0/0 flowid 1:2</span><br><span class="line"></span><br><span class="line">#队列2 开始网络模拟</span><br><span class="line">#该命令将$&#123;DEVICE_NAME&#125;网卡的耗时随机delay 100ms，延迟的尖刺在标准值的正负30ms, 最后的百分比数字是尖刺的相关系数</span><br><span class="line"></span><br><span class="line"># 这边用replace是因为之前已经用add加过规则了</span><br><span class="line">tc qdisc replace dev $&#123;DEVICE_NAME&#125; parent 1:2 netem delay 100ms 30ms 25%</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#该命令将 $&#123;DEVICE_NAME&#125; 网卡的传输设置为随机丢掉10%的数据包, 成功率为50%</span><br><span class="line">tc qdisc replace dev $&#123;DEVICE_NAME&#125; parent 1:2 netem loss 10% 50%</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#该命令将 $&#123;DEVICE_NAME&#125; 网卡的传输设置为随机产生10%的重复数据包。</span><br><span class="line">tc qdisc replace dev $&#123;DEVICE_NAME&#125; parent 1:2 netem duplicate 10%</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#该命令将 $&#123;DEVICE_NAME&#125; 网卡的传输设置为:有25%的数据包会被立即发送,其他的延迟10ms,相关性是10%,产生乱序</span><br><span class="line">tc qdisc replace dev $&#123;DEVICE_NAME&#125; parent 1:2 netem delay 10ms reorder 25% 10% </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#该命令将 $&#123;DEVICE_NAME&#125; 网卡的传输设置为随机产生9%的损坏的数据包</span><br><span class="line">tc qdisc replace dev $&#123;DEVICE_NAME&#125; parent 1:2 netem corrupt 9%</span><br></pre></td></tr></table></figure>

<p>恢复网络</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">#让网络恢复正常</span><br><span class="line">tc qdisc replace dev $&#123;DEVICE_NAME&#125; parent 1:2 sfq perturb 10</span><br><span class="line"></span><br><span class="line"># =================== 查看规则 ======================</span><br><span class="line">tc filter show dev $&#123;DEVICE_NAME&#125;</span><br><span class="line">tc class show dev $&#123;DEVICE_NAME&#125;</span><br><span class="line">tc qdisc show dev $&#123;DEVICE_NAME&#125;</span><br><span class="line"></span><br><span class="line">#====================== 清理 ======================</span><br><span class="line">tc filter delete dev $&#123;DEVICE_NAME&#125; parent 1:0 protocol ip pref 10</span><br><span class="line">tc qdisc del dev $&#123;DEVICE_NAME&#125; parent 1:2 netem</span><br><span class="line">tc class del dev $&#123;DEVICE_NAME&#125; parent 1:0 classid 1:2</span><br><span class="line">tc class del dev $&#123;DEVICE_NAME&#125; parent 1:0 classid 1:1</span><br><span class="line">tc qdisc del dev $&#123;DEVICE_NAME&#125; root handle 1</span><br></pre></td></tr></table></figure>

<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><p><a href="https://netbeez.net/blog/how-to-use-the-linux-traffic-control/" target="_blank" rel="noopener">https://netbeez.net/blog/how-to-use-the-linux-traffic-control/</a></p>
<p><a href="https://bootlin.com/blog/multi-queue-improvements-in-linux-kernel-ethernet-mvneta/" target="_blank" rel="noopener">https://bootlin.com/blog/multi-queue-improvements-in-linux-kernel-ethernet-mvneta/</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://plantegg.github.io/2016/03/24/ansible 使用手册/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="twitter @plantegg">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="plantegg">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/03/24/ansible 使用手册/" itemprop="url">ansible 手册</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-03-24T17:30:03+08:00">
                2016-03-24
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Ansible/" itemprop="url" rel="index">
                    <span itemprop="name">Ansible</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="ansible-手册"><a href="#ansible-手册" class="headerlink" title="ansible 手册"></a>ansible 手册</h1><h2 id="获取模块信息"><a href="#获取模块信息" class="headerlink" title="获取模块信息"></a>获取模块信息</h2><ul>
<li>获取所有模块信息，100多个</li>
</ul>
<ul>
<li>ansible-doc -l</li>
</ul>
<p>获取每个模块的具体信息 </p>
<ul>
<li><p>ansible-doc<br>example：ansible-doc ping</p>
<p>   PING</p>
<p>   A trivial test module, this module always returns <code>pong&#39; on    successful contact. It does not make sense in playbooks, but it is    useful from </code>&#x2F;usr&#x2F;bin&#x2F;udp’</p>
<p> EXAMPLES:<br> Test ‘webservers’ status</p>
<p> udp webservers -m ping</p>
</li>
</ul>
<h2 id="嵌套执行命令roles"><a href="#嵌套执行命令roles" class="headerlink" title="嵌套执行命令roles"></a>嵌套执行命令roles</h2><pre><code>- name: create jdk home
  file: path={{ remote_jdk_home }} state=directory mode=0755

- name: xxxxxxxxx
  include: ../../init/tasks/main.yml
</code></pre>
<h2 id="defaults-中变量定义"><a href="#defaults-中变量定义" class="headerlink" title="defaults 中变量定义"></a>defaults 中变量定义</h2><pre><code> 1：加双引号；2：变量名和变量之间，有空格；
 diamond_db_key: &quot;{{ diamond_db_ip }}_{{ diamond_db_name }}_dbkey&quot;
 manager_user1: &quot;{{ manager_user_name }}&quot;
</code></pre>
<h1 id="tags"><a href="#tags" class="headerlink" title="tags"></a>tags</h1><p>相同的tasks在不同的环境下面执行，通过tag来进行表面，如下图：</p>
<pre><code>  useage: 
    udp-playbook setup.yml -v -kK -i hosts.ini --tags &quot;ta&quot;

- name: 1
  authorized_key: user={{ ansible_ssh_user }}  key=&quot;{{ lookup('file', '~/.ssh/id_rsa.pub') }}&quot;  state=present
  tags: ta

- name: 2
  group: name={{ remote_user }}
  tags: always

- name: 3
  file: path={{ remote_home }} owner={{ remote_user }} group={{ remote_user }} state=directory recurse=yes mode=0755
  tags: tb
</code></pre>
<h2 id="常见错误"><a href="#常见错误" class="headerlink" title="常见错误"></a>常见错误</h2><p>ansible 中 scp scp: ambiguous target 错误还是因为ssh 增加了 -t 参数, scp不支持 -t 参数</p>
<h2 id="disable-python-warning"><a href="#disable-python-warning" class="headerlink" title="disable python warning"></a><a href="https://docs.ansible.com/ansible/latest/reference_appendices/interpreter_discovery.html" target="_blank" rel="noopener">disable python warning</a></h2><p>To control the discovery behavior:</p>
<ul>
<li>for individual hosts and groups, use the <code>ansible_python_interpreter</code> inventory variable</li>
<li>globally, use the <code>interpreter_python</code> key in the <code>[defaults]</code> section of <code>ansible.cfg</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[defaults]</span><br><span class="line">interpreter_python=auto_silent</span><br></pre></td></tr></table></figure>


          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://plantegg.github.io/2016/03/24/ansible 命令通道使用手册/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="twitter @plantegg">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="plantegg">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/03/24/ansible 命令通道使用手册/" itemprop="url">ansible 命令使用手册</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-03-24T17:30:03+08:00">
                2016-03-24
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Ansible/" itemprop="url" rel="index">
                    <span itemprop="name">Ansible</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="ansible-命令使用手册"><a href="#ansible-命令使用手册" class="headerlink" title="ansible 命令使用手册"></a>ansible 命令使用手册</h1><h2 id="什么是命令通道？"><a href="#什么是命令通道？" class="headerlink" title="什么是命令通道？"></a>什么是命令通道？</h2><p>有时候一些简单任务，没必要写复杂的playbook，所以大多时候我们可以通过ansible命令行来批量操控目标机器</p>
<blockquote>
<p>当我们需要批量操作、查看一组机器，或者在这些机器上批量执行某个命令、修改某个文件，都可以通过命令通道在一台机器上批量并发完成对所有机器的操作</p>
<p>命令通道只是一个帮你将命令发送到多个目标机器，并将执行结果返回来给你的一个执行通道</p>
</blockquote>
<h2 id="使用场景"><a href="#使用场景" class="headerlink" title="使用场景"></a>使用场景</h2><ul>
<li>执行一行命令就能看到几十台机器的负载情况</li>
<li>批量执行远程服务器上已经写好的Shell脚本</li>
<li>查看所有Web服务器最近10000行Log中有没有ERROR</li>
<li>查看所有DB服务器的内存使用情况</li>
<li>批量将所有Diamond服务器的某个端口从7000改成9000</li>
</ul>
<h2 id="开始准备"><a href="#开始准备" class="headerlink" title="开始准备"></a>开始准备</h2><blockquote>
<p>如果不想每次输入ssh密码的话请提前将本地公钥(~&#x2F;.ssh&#x2F;id_rsa.pub 没有的话 ssh-keygen生成一对)复制到目标机器的 ~&#x2F;.ssh&#x2F;authorized_keys 里面，否则每次执行命令都要输入密码</p>
</blockquote>
<h3 id="编写一个-hosts-ini-配置文件，内容如下"><a href="#编写一个-hosts-ini-配置文件，内容如下" class="headerlink" title="编写一个 hosts.ini 配置文件，内容如下:"></a>编写一个 hosts.ini 配置文件，内容如下:</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[server]</span><br><span class="line">10.125.0.169 ansible_ssh_port=9999 #如果只有这台机器ssh走的是9999端口，其它没有设置的还是默认22端口</span><br><span class="line">10.125.3.33</span><br><span class="line">120.26.116.193  </span><br><span class="line"></span><br><span class="line">[worker]</span><br><span class="line">10.125.12.174</span><br><span class="line">10.125.14.238</span><br><span class="line"></span><br><span class="line">[target]</span><br><span class="line">10.125.192.40 </span><br><span class="line">10.125.7.151</span><br><span class="line">192.168.2.[101:107]</span><br></pre></td></tr></table></figure>

<p>server&#x2F;worker&#x2F;target表示将7台机器分成了三组，可以到所有7台机器执行同一个命令，也可以只在server&#x2F;worker&#x2F;target中的一组机器上执行某个命令.all代表所有7台机器</p>
<h2 id="运行命令行"><a href="#运行命令行" class="headerlink" title="运行命令行"></a>运行命令行</h2><h3 id="查看-hosts-ini-里面所有服务器的-uptime"><a href="#查看-hosts-ini-里面所有服务器的-uptime" class="headerlink" title="查看 hosts.ini 里面所有服务器的 uptime"></a>查看 hosts.ini 里面所有服务器的 uptime</h3><pre><code><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">	$ ansible -i hosts.ini all -m raw -a &quot; uptime  &quot; -u admin</span><br><span class="line">	/usr/bin/ansible -i hosts.ini all -m raw -a  uptime   -u admin</span><br><span class="line">	</span><br><span class="line">	success =&gt; 10.125.12.174 =&gt; rc=0 =&gt;</span><br><span class="line">	 11:10:50 up 27 days, 15:40,  1 user,  load average: 0.05, 0.03, 0.05</span><br><span class="line">	success =&gt; 120.26.116.193 =&gt; rc=0 =&gt;</span><br><span class="line">	 11:10:50 up 13 days, 21:07,  1 user,  load average: 0.00, 0.00, 0.00</span><br><span class="line"></span><br><span class="line">命令参数说明</span><br><span class="line"></span><br><span class="line">&gt;    __all:__  表示对hosts.ini里面的所有服务器执行后面的命令 </span><br><span class="line"></span><br><span class="line">&gt;    __-i:__   指定hosts.ini文件所在的位置</span><br><span class="line"></span><br><span class="line">&gt;    __-m raw -a:__ 指定需要执行的命令</span><br><span class="line"></span><br><span class="line">&gt;    __&quot; uptime &quot;__ 双引号里面写上需要执行的命令</span><br><span class="line"></span><br><span class="line">&gt;    __-u admin__ 表示通过用户名admin 去执行命令【如果没有做好免密码，请加上 -k 参数，会出来提示输入SSH密码】</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">### 查看 hosts.ini 里面 server 组服务器的 home目录下的文件结构</span><br><span class="line">	$ ansible -i hosts.ini server -m raw -a &quot; ls -lh ~/  &quot; -u admin</span><br><span class="line">	</span><br><span class="line">	/usr/bin/ansible -i hosts.ini server -m raw -a  ls -lh ~/   -u admin</span><br><span class="line">	</span><br><span class="line">	success =&gt; 10.125.0.169 =&gt; rc=0 =&gt;</span><br><span class="line">	total 12K</span><br><span class="line">	drwxr-xr-x  2 root  root  4.0K Nov 13 12:34 files</span><br><span class="line">	drwxr-xr-x 11 admin admin 4.0K Oct 20 10:49 tomcat</span><br><span class="line">	drwxr-xr-x  3 test  games 4.0K Nov 18 15:40 ansible-engine</span><br><span class="line">	success =&gt; 10.125.3.33 =&gt; rc=0 =&gt;</span><br><span class="line">	total 20K</span><br><span class="line">	-rw-------  1 admin admin 1.4K Nov 12 13:39 authorized_keys</span><br><span class="line">	drwxr-xr-x  2 root  root  4.0K Nov 12 16:24 engine</span><br><span class="line">	drwxr-xr-x  2 root  root  4.0K Nov 13 12:22 files</span><br><span class="line">	drwxr-xr-x 11 admin admin 4.0K Nov 18 15:43 tomcat</span><br><span class="line">	drwxr-xr-x  3 test  games 4.0K Nov 18 15:40 ansible-engine</span><br><span class="line"></span><br><span class="line">### 查看部分机器 hostname</span><br></pre></td></tr></table></figure>
</code></pre>
<h1 id="ansible-i-ccb-test-ini-192-168-2-10-m-shell-a-‘hostname-‘"><a href="#ansible-i-ccb-test-ini-192-168-2-10-m-shell-a-‘hostname-‘" class="headerlink" title="ansible -i ccb_test.ini 192.168.2.10* -m shell -a ‘hostname ‘"></a>ansible -i ccb_test.ini 192.168.2.10* -m shell -a ‘hostname ‘</h1><p>[WARNING]: Invalid characters were found in group names but not replaced, use -vvvv to see details<br>192.168.2.100 | CHANGED | rc&#x3D;0 &gt;&gt;<br>az2-drds-100<br>192.168.2.106 | CHANGED | rc&#x3D;0 &gt;&gt;<br>az2-manager-106<br>192.168.2.101 | CHANGED | rc&#x3D;0 &gt;&gt;<br>az2-alisql-101<br>192.168.2.102 | CHANGED | rc&#x3D;0 &gt;&gt;<br>az2-alisql-102<br>192.168.2.105 | CHANGED | rc&#x3D;0 &gt;&gt;<br>az2-alisql-105<br>192.168.2.104 | CHANGED | rc&#x3D;0 &gt;&gt;<br>az2-alisql-104<br>192.168.2.103 | CHANGED | rc&#x3D;0 &gt;&gt;<br>az2-alisql-103<br>192.168.2.107 | CHANGED | rc&#x3D;0 &gt;&gt;<br>az2-manager-107</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">### 使用环境变量</span><br></pre></td></tr></table></figure>

<p>#config &#x2F;etc&#x2F;hosts<br>ansible -i $1 all -m shell -a  “ sed -i ‘&#x2F;registry&#x2F;d’ &#x2F;etc&#x2F;hosts “<br>ansible -i $1 all -m shell -a  “ echo ‘    registry’ &gt;&#x2F;etc&#x2F;hosts “<br>ansible -i $1 all -m shell -a “ echo ‘ <code>hostname</code>‘ &gt;&gt;&#x2F;etc&#x2F;hosts “<br>ansible -i $1 diamond -m shell -a “ echo ‘   jmenv.tbsite.net’ &gt;&gt; &#x2F;etc&#x2F;hosts “ -u root<br>&#x2F;&#x2F;修改机器hostname<br>ansible -i $1 all -m shell -a “ hostnamectl set-hostname&#x3D;’drds-‘ “ -u root<br>&#x2F;&#x2F;修改机器hostname -i<br>ansible -i $1 all -m shell -a “ echo ‘  drds-‘ &gt;&gt; &#x2F;etc&#x2F;hosts  “ -u root</p>
<p>&#x2F;&#x2F;hostname 修改机器名</p>
<h1 id="ansible-i-ccb-test-ini-192-168-2-101-m-hostname-a-“-name-x3D-az2-alisql-101-“"><a href="#ansible-i-ccb-test-ini-192-168-2-101-m-hostname-a-“-name-x3D-az2-alisql-101-“" class="headerlink" title="ansible -i ccb_test.ini 192.168.2.101 -m hostname -a “ name&#x3D;az2-alisql-101 “"></a>ansible -i ccb_test.ini 192.168.2.101 -m hostname -a “ name&#x3D;az2-alisql-101 “</h1><p>[WARNING]: Invalid characters were found in group names but not replaced, use -vvvv to see details<br>192.168.2.101 | CHANGED &#x3D;&gt; {<br>    “ansible_facts”: {<br>        “ansible_domain”: “”,<br>        “ansible_fqdn”: “iZ2ze9aj0re2ggbqa4dgxkZ”,<br>        “ansible_hostname”: “az2-alisql-101”,<br>        “ansible_nodename”: “az2-alisql-101”,<br>        “discovered_interpreter_python”: “&#x2F;usr&#x2F;bin&#x2F;python”<br>    },<br>    “changed”: true,<br>    “name”: “az2-alisql-101”<br>}</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">### 管理系统service</span><br><span class="line"></span><br><span class="line">设置 docker daemon服务重新启动和开机自动启动</span><br></pre></td></tr></table></figure>

<h1 id="ansible-i-ccb-test-ini-192-168-2-101-m-service-a-“-name-x3D-docker-enabled-x3D-yes-state-x3D-restarted-“"><a href="#ansible-i-ccb-test-ini-192-168-2-101-m-service-a-“-name-x3D-docker-enabled-x3D-yes-state-x3D-restarted-“" class="headerlink" title="ansible -i ccb_test.ini 192.168.2.101 -m service -a “ name&#x3D;docker enabled&#x3D;yes state&#x3D;restarted “"></a>ansible -i ccb_test.ini 192.168.2.101 -m service -a “ name&#x3D;docker enabled&#x3D;yes state&#x3D;restarted “</h1><p>[WARNING]: Invalid characters were found in group names but not replaced, use -vvvv to see details<br>192.168.2.101 | CHANGED &#x3D;&gt; {<br>    “ansible_facts”: {<br>        “discovered_interpreter_python”: “&#x2F;usr&#x2F;bin&#x2F;python”<br>    },<br>    “changed”: true,<br>    “enabled”: true,<br>    “name”: “docker”,<br>    “state”: “started”,<br>    “status”: {<br>        “ActiveEnterTimestamp”: “二 2020-05-12 19:03:57 CST”,<br>        “ActiveEnterTimestampMonotonic”: “1553024093129”,<br>        “ActiveExitTimestamp”: “二 2020-05-12 19:01:24 CST”,<br>        “ActiveExitTimestampMonotonic”: “1552870910912”,<br>        “ActiveState”: “active”,<br>        “After”: “systemd-journald.socket system.slice docker.socket firewalld.service containerd.service network-online.target basic.target”,<br>        “AllowIsolate”: “no”,<br>        “AmbientCapabilities”: “0”,<br>        “AssertResult”: “yes”,<br>        “AssertTimestamp”: “二 2020-05-12 19:03:57 CST”,<br>        “AssertTimestampMonotonic”: “1553023902297”,<br>        “Before”: “multi-user.target shutdown.target”,<br>        “BindsTo”: “containerd.service”,<br>        “BlockIOAccounting”: “no”,<br>        “BlockIOWeight”: “18446744073709551615”,<br>        “CPUAccounting”: “no”,<br>        “CPUQuotaPerSecUSec”: “infinity”,<br>        “CPUSchedulingPolicy”: “0”,<br>        “CPUSchedulingPriority”: “0”,<br>        “CPUSchedulingResetOnFork”: “no”,<br>        “CPUShares”: “18446744073709551615”,<br>        “CanIsolate”: “no”,<br>        “CanReload”: “yes”,<br>        “CanStart”: “yes”,<br>        “CanStop”: “yes”,<br>        “CapabilityBoundingSet”: “18446744073709551615”,<br>        “ConditionResult”: “yes”,<br>        “ConditionTimestamp”: “二 2020-05-12 19:03:57 CST”,<br>        “ConditionTimestampMonotonic”: “1553023902297”,<br>        “Conflicts”: “shutdown.target”,<br>        “ConsistsOf”: “docker.socket”,<br>        “ControlGroup”: “&#x2F;system.slice&#x2F;docker.service”,<br>        “ControlPID”: “0”,<br>        “DefaultDependencies”: “yes”,<br>        “Delegate”: “yes”,<br>        “Description”: “Docker Application Container Engine”,<br>        “DevicePolicy”: “auto”,<br>        “Documentation”: “<a href="https://docs.docker.com/" target="_blank" rel="noopener">https://docs.docker.com</a>“,<br>        “ExecMainCode”: “0”,<br>        “ExecMainExitTimestampMonotonic”: “0”,<br>        “ExecMainPID”: “16213”,<br>        “ExecMainStartTimestamp”: “二 2020-05-12 19:03:57 CST”,<br>        “ExecMainStartTimestampMonotonic”: “1553023907468”,<br>        “ExecMainStatus”: “0”,<br>        “ExecReload”: “{ path&#x3D;&#x2F;bin&#x2F;kill ; argv[]&#x3D;&#x2F;bin&#x2F;kill -s HUP $MAINPID ; ignore_errors&#x3D;no ; start_time&#x3D;[n&#x2F;a] ; stop_time&#x3D;[n&#x2F;a] ; pid&#x3D;0 ; code&#x3D;(null) ; status&#x3D;0&#x2F;0 }”,<br>        “ExecStart”: “{ path&#x3D;&#x2F;usr&#x2F;bin&#x2F;dockerd ; argv[]&#x3D;&#x2F;usr&#x2F;bin&#x2F;dockerd -H fd:&#x2F;&#x2F; -H tcp:&#x2F;&#x2F;0.0.0.0:2376 –data-root&#x3D;&#x2F;var&#x2F;lib&#x2F;docker –log-opt max-size&#x3D;50m –log-opt max-file&#x3D;3 –registry-mirror&#x3D;<a href="https://oqpc6eum.mirror.aliyuncs.com/" target="_blank" rel="noopener">https://oqpc6eum.mirror.aliyuncs.com</a> –containerd&#x3D;&#x2F;run&#x2F;containerd&#x2F;containerd.sock ; ignore_errors&#x3D;no ; start_time&#x3D;[n&#x2F;a] ; stop_time&#x3D;[n&#x2F;a] ; pid&#x3D;0 ; code&#x3D;(null) ; status&#x3D;0&#x2F;0 }”,<br>        “FailureAction”: “none”,<br>        “FileDescriptorStoreMax”: “0”,<br>        “FragmentPath”: “&#x2F;usr&#x2F;lib&#x2F;systemd&#x2F;system&#x2F;docker.service”,<br>        “GuessMainPID”: “yes”,<br>        “IOScheduling”: “0”,<br>        “Id”: “docker.service”,<br>        “IgnoreOnIsolate”: “no”,<br>        “IgnoreOnSnapshot”: “no”,<br>        “IgnoreSIGPIPE”: “yes”,<br>        “InactiveEnterTimestamp”: “二 2020-05-12 19:03:43 CST”,<br>        “InactiveEnterTimestampMonotonic”: “1553009791884”,<br>        “InactiveExitTimestamp”: “二 2020-05-12 19:03:57 CST”,<br>        “InactiveExitTimestampMonotonic”: “1553023907496”,<br>        “JobTimeoutAction”: “none”,<br>        “JobTimeoutUSec”: “0”,<br>        “KillMode”: “process”,<br>        “KillSignal”: “15”,<br>        “LimitAS”: “18446744073709551615”,<br>        “LimitCORE”: “18446744073709551615”,<br>        “LimitCPU”: “18446744073709551615”,<br>        “LimitDATA”: “18446744073709551615”,<br>        “LimitFSIZE”: “18446744073709551615”,<br>        “LimitLOCKS”: “18446744073709551615”,<br>        “LimitMEMLOCK”: “65536”,<br>        “LimitMSGQUEUE”: “819200”,<br>        “LimitNICE”: “0”,<br>        “LimitNOFILE”: “18446744073709551615”,<br>        “LimitNPROC”: “18446744073709551615”,<br>        “LimitRSS”: “18446744073709551615”,<br>        “LimitRTPRIO”: “0”,<br>        “LimitRTTIME”: “18446744073709551615”,<br>        “LimitSIGPENDING”: “379870”,<br>        “LimitSTACK”: “18446744073709551615”,<br>        “LoadState”: “loaded”,<br>        “MainPID”: “16213”,<br>        “MemoryAccounting”: “no”,<br>        “MemoryCurrent”: “58327040”,<br>        “MemoryLimit”: “18446744073709551615”,<br>        “MountFlags”: “0”,<br>        “Names”: “docker.service”,<br>        “NeedDaemonReload”: “no”,<br>        “Nice”: “0”,<br>        “NoNewPrivileges”: “no”,<br>        “NonBlocking”: “no”,<br>        “NotifyAccess”: “main”,<br>        “OOMScoreAdjust”: “0”,<br>        “OnFailureJobMode”: “replace”,<br>        “PermissionsStartOnly”: “no”,<br>        “PrivateDevices”: “no”,<br>        “PrivateNetwork”: “no”,<br>        “PrivateTmp”: “no”,<br>        “ProtectHome”: “no”,<br>        “ProtectSystem”: “no”,<br>        “RefuseManualStart”: “no”,<br>        “RefuseManualStop”: “no”,<br>        “RemainAfterExit”: “no”,<br>        “Requires”: “docker.socket basic.target”,<br>        “Restart”: “always”,<br>        “RestartUSec”: “2s”,<br>        “Result”: “success”,<br>        “RootDirectoryStartOnly”: “no”,<br>        “RuntimeDirectoryMode”: “0755”,<br>        “SameProcessGroup”: “no”,<br>        “SecureBits”: “0”,<br>        “SendSIGHUP”: “no”,<br>        “SendSIGKILL”: “yes”,<br>        “Slice”: “system.slice”,<br>        “StandardError”: “inherit”,<br>        “StandardInput”: “null”,<br>        “StandardOutput”: “journal”,<br>        “StartLimitAction”: “none”,<br>        “StartLimitBurst”: “3”,<br>        “StartLimitInterval”: “60000000”,<br>        “StartupBlockIOWeight”: “18446744073709551615”,<br>        “StartupCPUShares”: “18446744073709551615”,<br>        “StatusErrno”: “0”,<br>        “StopWhenUnneeded”: “no”,<br>        “SubState”: “running”,<br>        “SyslogLevelPrefix”: “yes”,<br>        “SyslogPriority”: “30”,<br>        “SystemCallErrorNumber”: “0”,<br>        “TTYReset”: “no”,<br>        “TTYVHangup”: “no”,<br>        “TTYVTDisallocate”: “no”,<br>        “TasksAccounting”: “no”,<br>        “TasksCurrent”: “58”,<br>        “TasksMax”: “18446744073709551615”,<br>        “TimeoutStartUSec”: “0”,<br>        “TimeoutStopUSec”: “0”,<br>        “TimerSlackNSec”: “50000”,<br>        “Transient”: “no”,<br>        “TriggeredBy”: “docker.socket”,<br>        “Type”: “notify”,<br>        “UMask”: “0022”,<br>        “UnitFilePreset”: “disabled”,<br>        “UnitFileState”: “enabled”,<br>        “WantedBy”: “multi-user.target”,<br>        “Wants”: “network-online.target system.slice”,<br>        “WatchdogTimestamp”: “二 2020-05-12 19:03:57 CST”,<br>        “WatchdogTimestampMonotonic”: “1553024093096”,<br>        “WatchdogUSec”: “0”<br>    }<br>}</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">### 一次执行多个命令</span><br></pre></td></tr></table></figure>

<p>$ ansible -i hosts.ini server -m raw -a “ which nc ; find &#x2F;opt&#x2F;aliUDP&#x2F;logs&#x2F;  “ -u admin</p>
<p>&#x2F;usr&#x2F;bin&#x2F;ansible -i hosts.ini server -m raw -a  which nc ; find &#x2F;opt&#x2F;aliUDP&#x2F;logs&#x2F;   -u admin</p>
<p>FAILED &#x3D;&gt; 120.26.116.193 &#x3D;&gt; rc&#x3D;1 &#x3D;&gt;<br>which: no nc in (&#x2F;usr&#x2F;local&#x2F;sbin:&#x2F;usr&#x2F;local&#x2F;bin:&#x2F;sbin:&#x2F;bin:&#x2F;usr&#x2F;sbin:&#x2F;usr&#x2F;bin)<br>find: &#x2F;opt&#x2F;aliUDP: No such file or directory</p>
<p>success &#x3D;&gt; 10.125.3.33 &#x3D;&gt; rc&#x3D;0 &#x3D;&gt;<br>&#x2F;usr&#x2F;bin&#x2F;nc<br>&#x2F;opt&#x2F;aliUDP&#x2F;logs&#x2F;<br>&#x2F;opt&#x2F;aliUDP&#x2F;logs&#x2F;ansible.log.bak<br>&#x2F;opt&#x2F;aliUDP&#x2F;logs&#x2F;ansible.log</p>
<p>success &#x3D;&gt; 10.125.0.169 &#x3D;&gt; rc&#x3D;0 &#x3D;&gt;<br>&#x2F;usr&#x2F;bin&#x2F;nc<br>&#x2F;opt&#x2F;aliUDP&#x2F;logs&#x2F;<br>&#x2F;opt&#x2F;aliUDP&#x2F;logs&#x2F;ansible.log.bak<br>&#x2F;opt&#x2F;aliUDP&#x2F;logs&#x2F;ansible.log</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">结果说明</span><br><span class="line"></span><br><span class="line">&gt;   其中  120.26.116.193 上没有命令 nc 和 /opt/aliUDP 文件夹所有执行失败，但是其他两台机器都正常返回了结果</span><br><span class="line"></span><br><span class="line">### Copy本地的某个文件到服务器上【前面的例子中都是单独在远程机器上执行的命令】</span><br></pre></td></tr></table></figure>

<p>$ ansible  -i hosts.ini server  -m copy -a “ src&#x3D;’~&#x2F;.ssh&#x2F;id_rsa.pub’ dest&#x3D;’&#x2F;tmp&#x2F;‘ owner&#x3D;admin “ -u admin</p>
<p>SUCCESS &#x3D;&gt; 120.26.116.193 &#x3D;&gt; {<br>    “changed”: true,<br>    “checksum”: “b12ccf236ab788bbaebd7159c563e97411389c9e”,<br>    “dest”: “&#x2F;tmp&#x2F;id_rsa.pub”,<br>    “gid”: 0,<br>    “group”: “root”,<br>    “md5sum”: “b6ba28284ab95aaa0f47602bdab49f46”,<br>    “mode”: “0644”,<br>    “owner”: “root”,<br>    “size”: 392,<br>    “src”: “&#x2F;root&#x2F;.ansible&#x2F;ansible-tmp-1449109886.94-70134064194486&#x2F;source”,<br>    “state”: “file”,<br>    “uid”: 0<br>}</p>
<p>SUCCESS &#x3D;&gt; 10.125.0.169 &#x3D;&gt; {<br>    “changed”: true,<br>    “checksum”: “b12ccf236ab788bbaebd7159c563e97411389c9e”,<br>    “dest”: “&#x2F;tmp&#x2F;id_rsa.pub”,<br>    “gid”: 500,<br>    “group”: “admin”,<br>    “md5sum”: “b6ba28284ab95aaa0f47602bdab49f46”,<br>    “mode”: “0664”,<br>    “owner”: “admin”,<br>    “size”: 392,<br>    “src”: “&#x2F;home&#x2F;admin&#x2F;.ansible&#x2F;ansible-tmp-1449109886.78-98797505042348&#x2F;source”,<br>    “state”: “file”,<br>    “uid”: 500<br>}</p>
<p>SUCCESS &#x3D;&gt; 10.125.3.33 &#x3D;&gt; {<br>    “changed”: true,<br>    “checksum”: “b12ccf236ab788bbaebd7159c563e97411389c9e”,<br>    “dest”: “&#x2F;tmp&#x2F;id_rsa.pub”,<br>    “gid”: 500,<br>    “group”: “admin”,<br>    “md5sum”: “b6ba28284ab95aaa0f47602bdab49f46”,<br>    “mode”: “0664”,<br>    “owner”: “admin”,<br>    “size”: 392,<br>    “src”: “&#x2F;home&#x2F;admin&#x2F;.ansible&#x2F;ansible-tmp-1449109886.81-269249309502640&#x2F;source”,<br>    “state”: “file”,<br>    “uid”: 500<br>}</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">参数说明</span><br><span class="line"></span><br><span class="line">&gt;    __-m copy -a:__ 指定这是 **copy** 的命令</span><br><span class="line">&gt;</span><br><span class="line">&gt;    __&quot;  src=&apos;~/.ssh/id_rsa.pub&apos; dest=&apos;/tmp/&apos; &quot;__ src表示本地文件 dest表示远程目标位置</span><br><span class="line"></span><br><span class="line">### 验证一下刚刚copy上去的文件的MD5值</span><br></pre></td></tr></table></figure>

<p>$ ansible  -i hosts.ini server  -m command -a “ md5sum &#x2F;tmp&#x2F;id_rsa.pub “ -u admin</p>
<p>success &#x3D;&gt; 10.125.0.169 &#x3D;&gt; rc&#x3D;0 &#x3D;&gt;<br>b6ba28284ab95aaa0f47602bdab49f46  &#x2F;tmp&#x2F;id_rsa.pub</p>
<p>success &#x3D;&gt; 10.125.3.33 &#x3D;&gt; rc&#x3D;0 &#x3D;&gt;<br>b6ba28284ab95aaa0f47602bdab49f46  &#x2F;tmp&#x2F;id_rsa.pub</p>
<p>success &#x3D;&gt; 120.26.116.193 &#x3D;&gt; rc&#x3D;0 &#x3D;&gt;<br>b6ba28284ab95aaa0f47602bdab49f46  &#x2F;tmp&#x2F;id_rsa.pub</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">结果说明</span><br><span class="line"></span><br><span class="line">&gt;   md5都是b6ba28284ab95aaa0f47602bdab49f46 跟本地的一致，说明成功复制到目标机器了</span><br><span class="line"></span><br><span class="line">### 执行远程服务器上已经写好的Shell脚本</span><br></pre></td></tr></table></figure>

<p>$ cat test.sh<br>#&#x2F;bin&#x2F;sh</p>
<p>ifconfig | grep ‘inet addr’<br>echo “————-“<br>uptime<br>echo “————-“<br>date</p>
<p>df -lh</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">执行结果</span><br><span class="line"></span><br><span class="line">```shell</span><br><span class="line">$ ansible  -i hosts.ini server  -m command -a &quot; sh /tmp/test.sh &quot; -u admin</span><br><span class="line"></span><br><span class="line">/usr/bin/ansible -i hosts.ini server -m command -a  sh /tmp/test.sh  -u admin</span><br><span class="line"></span><br><span class="line">success =&gt; 10.125.3.33 =&gt; rc=0 =&gt;</span><br><span class="line">          inet addr:10.125.3.33  Bcast:10.125.15.255  Mask:255.255.240.0</span><br><span class="line">          inet addr:127.0.0.1  Mask:255.0.0.0</span><br></pre></td></tr></table></figure>

<h3 id="copy个人笔记本的公钥到服务器上，以后从笔记本登录服务器不再需要输入密码"><a href="#copy个人笔记本的公钥到服务器上，以后从笔记本登录服务器不再需要输入密码" class="headerlink" title="copy个人笔记本的公钥到服务器上，以后从笔记本登录服务器不再需要输入密码"></a>copy个人笔记本的公钥到服务器上，以后从笔记本登录服务器不再需要输入密码</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ansible -i ansible-hosts.ini all -m authorized_key -a &quot; user=admin key=\&quot;&#123;&#123; lookup(&apos;file&apos;, &apos;/tmp/id_rsa.pub&apos;) &#125;&#125; \&quot;  &quot; -u admin -k</span><br></pre></td></tr></table></figure>

<h3 id="Copying-files-between-different-folders-on-the-same-remote-machine"><a href="#Copying-files-between-different-folders-on-the-same-remote-machine" class="headerlink" title="Copying files between different folders on the same remote machine"></a>Copying files between different folders on the same remote machine</h3><p>You can also copy files between the various locations on the remote servers. You have to set the <strong>remote_src</strong> parameter to yes.</p>
<p>The following example copies the hello6 file in the &#x2F;tmp directory of the remote server and pastes it in the &#x2F;etc&#x2F; directory.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">- hosts: blocks</span><br><span class="line">  tasks:</span><br><span class="line">  - name: Ansible copy files remote to remote</span><br><span class="line">    copy:</span><br><span class="line">      src: /tmp/hello6</span><br><span class="line">      dest: /etc</span><br><span class="line">      remote_src: yes</span><br></pre></td></tr></table></figure>

<p>or:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ansible blocks -m copy -a &quot;src=/tmp/hello6 dest=/tmp/hello7etc remote_src=yes&quot; -s -i inventory.ini</span><br></pre></td></tr></table></figure>

<h3 id="效率更高的-copy：synchronize"><a href="#效率更高的-copy：synchronize" class="headerlink" title="效率更高的 copy：synchronize"></a>效率更高的 copy：synchronize</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ansible -i xty_172.ini all -m synchronize -a &quot; src=/home/ren/docker.service dest=/usr/lib/systemd/system/docker.socket &quot; -u root</span><br></pre></td></tr></table></figure>

<h3 id="find-file"><a href="#find-file" class="headerlink" title="find_file"></a>find_file</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">- hosts: all</span><br><span class="line"></span><br><span class="line">  tasks:</span><br><span class="line">    - name: find_file</span><br><span class="line">      find:</span><br><span class="line">        paths: /home/admin/.ssh/</span><br><span class="line">        patterns: &quot;*.rsa&quot;</span><br><span class="line">        recurse: no</span><br><span class="line">      register: file_name</span><br><span class="line"></span><br><span class="line">    - name: copy_file</span><br><span class="line">      fetch:</span><br><span class="line">        src: &quot;&#123;&#123; item.path &#125;&#125;&quot;</span><br><span class="line">        dest: /tmp/sshbak/</span><br><span class="line">        flat: no</span><br><span class="line">      with_items: &quot;&#123;&#123; file_name.files &#125;&#125;&quot;</span><br></pre></td></tr></table></figure>

<p>test</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ansible-playbook -i 127.0.0.1,  ./find_file.yaml</span><br></pre></td></tr></table></figure>

<h3 id="不使用-hosts-ini文件，从命令行中传入目标机的-ip-列表"><a href="#不使用-hosts-ini文件，从命令行中传入目标机的-ip-列表" class="headerlink" title="不使用 hosts.ini文件，从命令行中传入目标机的 ip 列表"></a>不使用 hosts.ini文件，从命令行中传入目标机的 ip 列表</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ ansible -i 10.125.0.169,10.125.192.40 all -e &quot;ansible_ssh_port=22&quot; -a &quot;uptime&quot; -u admin</span><br><span class="line"></span><br><span class="line">success =&gt; 10.125.192.40 =&gt; rc=0 =&gt;</span><br><span class="line"> 12:31:50 up 48 days, 17:01,  0 users,  load average: 0.13, 0.06, 0.05</span><br><span class="line"></span><br><span class="line">success =&gt; 10.125.0.169 =&gt; rc=0 =&gt;</span><br><span class="line"> 12:31:50 up 49 days,  2:25,  0 users,  load average: 0.00, 0.01, 0.05</span><br></pre></td></tr></table></figure>

<p>执行说明</p>
<blockquote>
<p>   -i 后面带入ip列表，注意每个IP后面一定要有 “,” 分割开来，all 关键字也是必须的</p>
</blockquote>
<blockquote>
<p>   -e 中ansible_ssh_port&#x3D;22表示ssh使用22端口（默认），如果ssh使用9999端口在这里将22改成9999即可</p>
</blockquote>
<h3 id="使用root-sudo权限来执行命令"><a href="#使用root-sudo权限来执行命令" class="headerlink" title="使用root sudo权限来执行命令"></a>使用root sudo权限来执行命令</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ansible -i 10.125.6.93, all -m  shell -a &quot; ls -lh /home/admin/&quot;    -u admin --become-user=root --ask-become-pass --become-method=sudo --become -k</span><br></pre></td></tr></table></figure>

<h3 id="给admin授权登录server不需要输入密码（也不知道admin的密码）"><a href="#给admin授权登录server不需要输入密码（也不知道admin的密码）" class="headerlink" title="给admin授权登录server不需要输入密码（也不知道admin的密码）"></a>给admin授权登录server不需要输入密码（也不知道admin的密码）</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">通过 admin(已知密码) 以root 权限将本机pub key复制到server上的 /home/admin, 再通过admin账号登录server就不需要密码了：</span><br><span class="line">ansible -i 10.125.6.93, all -m  authorized_key -a &quot; user=admin key=\&quot;&#123;&#123; lookup(&apos;file&apos;, &apos;/home/ren/.ssh/id_rsa.pub&apos;) &#125;&#125; \&quot;  &quot; -u admin --become-user=root --ask-become-pass --become-method=sudo --become -k</span><br><span class="line"></span><br><span class="line">不需要密码就可以执行：</span><br><span class="line">ansible -i 10.125.6.93, all -m shell -a &quot; ls -lha /home/admin/  &quot; -u admin</span><br></pre></td></tr></table></figure>

<h3 id="fetch-将远程服务器上的public-key-读取到本地"><a href="#fetch-将远程服务器上的public-key-读取到本地" class="headerlink" title="fetch:将远程服务器上的public key 读取到本地"></a>fetch:将远程服务器上的public key 读取到本地</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ansible -i kfc.ini hadoop -m fetch -a &quot; src=/home/admin/.ssh/id_rsa.pub dest=./test/  &quot;  -u admin</span><br><span class="line"></span><br><span class="line">find test/ -type f | xargs cat &gt; ./authorized_keys</span><br><span class="line"></span><br><span class="line">#push all the public keys to the server</span><br><span class="line">ansible -i ~/ali/ansible-edas/kfc.ini hadoop -m  copy -a &quot; src=./authorized_keys dest=/home/admin/.ssh/authorized_keys mode=600  &quot; -u admin</span><br></pre></td></tr></table></figure>

<p>或者循环fetch：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">$cat</span> <span class="string">fetch.yaml</span> </span><br><span class="line"><span class="bullet">-</span> <span class="attr">hosts:</span> <span class="string">all</span>   </span><br><span class="line">  <span class="attr">tasks:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">list</span> <span class="string">the</span> <span class="string">files</span> <span class="string">in</span> <span class="string">the</span> <span class="string">folder</span></span><br><span class="line">      <span class="comment">#command: ls /u01/nmon/tpcc/ </span></span><br><span class="line">      <span class="attr">shell:</span> <span class="string">(cd</span> <span class="string">/remote;</span> <span class="string">find</span> <span class="string">.</span> <span class="string">-maxdepth</span> <span class="number">1</span> <span class="string">-type</span> <span class="string">f)</span> <span class="string">|</span> <span class="string">cut</span> <span class="string">-d'/'</span> <span class="string">-f2</span></span><br><span class="line">      <span class="attr">register:</span> <span class="string">dir_out</span></span><br><span class="line"></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">do</span> <span class="string">the</span> <span class="string">action</span></span><br><span class="line">      <span class="attr">fetch:</span> <span class="string">src=/u01/nmon/tpcc/&#123;&#123;item&#125;&#125;</span> <span class="string">dest=/home/aliyun/nmon_tpcc/</span> <span class="string">flat=no</span></span><br><span class="line">      <span class="attr">with_items:</span> <span class="string">"<span class="template-variable">&#123;&#123;dir_out.stdout_lines&#125;&#125;</span>"</span></span><br></pre></td></tr></table></figure>

<p>执行结果：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">$ansible-playbook -i /home/aliyun/all.ini  fetch.yaml -u admin</span><br><span class="line"></span><br><span class="line">PLAY [all] *******************************************************************************************</span><br><span class="line"></span><br><span class="line">TASK [Gathering Facts] *******************************************************************************</span><br><span class="line">ok: [10.88.88.18]</span><br><span class="line">ok: [10.88.88.16]</span><br><span class="line">ok: [10.88.88.15]</span><br><span class="line">ok: [10.88.88.19]</span><br><span class="line">ok: [10.88.88.17]</span><br><span class="line">ok: [10.88.88.20]</span><br><span class="line"></span><br><span class="line">TASK [list the files in the folder] ******************************************************************</span><br><span class="line">changed: [10.88.88.15]</span><br><span class="line">changed: [10.88.88.16]</span><br><span class="line">changed: [10.88.88.17]</span><br><span class="line">changed: [10.88.88.18]</span><br><span class="line">changed: [10.88.88.19]</span><br><span class="line">changed: [10.88.88.20]</span><br><span class="line"></span><br><span class="line">TASK [do the action] *********************************************************************************</span><br><span class="line">changed: [10.88.88.15] =&gt; (item=uos15_200729_1108.nmon)</span><br><span class="line">changed: [10.88.88.18] =&gt; (item=uos18_200729_1107.nmon)</span><br><span class="line">changed: [10.88.88.16] =&gt; (item=uos16_200729_1106.nmon)</span><br><span class="line">changed: [10.88.88.19] =&gt; (item=adbpg2-PC_200729_1108.nmon)</span><br><span class="line">changed: [10.88.88.17] =&gt; (item=uos17_200729_1107.nmon)</span><br><span class="line">changed: [10.88.88.19] =&gt; (item=adbpg2-PC_200729_1936.nmon)</span><br><span class="line">changed: [10.88.88.20] =&gt; (item=adbpg-PC_200729_1110.nmon)</span><br><span class="line"></span><br><span class="line">PLAY RECAP *******************************************************************************************</span><br><span class="line">10.88.88.15                : ok=3    changed=2    unreachable=0    failed=0   </span><br><span class="line">10.88.88.16                : ok=3    changed=2    unreachable=0    failed=0   </span><br><span class="line">10.88.88.17                : ok=3    changed=2    unreachable=0    failed=0   </span><br><span class="line">10.88.88.18                : ok=3    changed=2    unreachable=0    failed=0   </span><br><span class="line">10.88.88.19                : ok=3    changed=2    unreachable=0    failed=0   </span><br><span class="line">10.88.88.20                : ok=3    changed=2    unreachable=0    failed=0</span><br></pre></td></tr></table></figure>

<h3 id="setup-获取机器配置、参数信息"><a href="#setup-获取机器配置、参数信息" class="headerlink" title="setup:获取机器配置、参数信息"></a>setup:获取机器配置、参数信息</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br><span class="line">673</span><br><span class="line">674</span><br><span class="line">675</span><br><span class="line">676</span><br><span class="line">677</span><br><span class="line">678</span><br><span class="line">679</span><br><span class="line">680</span><br><span class="line">681</span><br><span class="line">682</span><br><span class="line">683</span><br><span class="line">684</span><br><span class="line">685</span><br><span class="line">686</span><br><span class="line">687</span><br><span class="line">688</span><br><span class="line">689</span><br><span class="line">690</span><br><span class="line">691</span><br><span class="line">692</span><br><span class="line">693</span><br><span class="line">694</span><br><span class="line">695</span><br><span class="line">696</span><br><span class="line">697</span><br><span class="line">698</span><br><span class="line">699</span><br><span class="line">700</span><br><span class="line">701</span><br><span class="line">702</span><br><span class="line">703</span><br><span class="line">704</span><br><span class="line">705</span><br><span class="line">706</span><br><span class="line">707</span><br><span class="line">708</span><br><span class="line">709</span><br><span class="line">710</span><br><span class="line">711</span><br><span class="line">712</span><br><span class="line">713</span><br><span class="line">714</span><br><span class="line">715</span><br><span class="line">716</span><br><span class="line">717</span><br><span class="line">718</span><br><span class="line">719</span><br><span class="line">720</span><br><span class="line">721</span><br><span class="line">722</span><br><span class="line">723</span><br><span class="line">724</span><br><span class="line">725</span><br><span class="line">726</span><br><span class="line">727</span><br><span class="line">728</span><br><span class="line">729</span><br><span class="line">730</span><br><span class="line">731</span><br><span class="line">732</span><br><span class="line">733</span><br><span class="line">734</span><br><span class="line">735</span><br><span class="line">736</span><br><span class="line">737</span><br><span class="line">738</span><br><span class="line">739</span><br><span class="line">740</span><br><span class="line">741</span><br><span class="line">742</span><br><span class="line">743</span><br><span class="line">744</span><br><span class="line">745</span><br><span class="line">746</span><br><span class="line">747</span><br><span class="line">748</span><br><span class="line">749</span><br><span class="line">750</span><br><span class="line">751</span><br><span class="line">752</span><br><span class="line">753</span><br><span class="line">754</span><br><span class="line">755</span><br><span class="line">756</span><br><span class="line">757</span><br><span class="line">758</span><br><span class="line">759</span><br><span class="line">760</span><br><span class="line">761</span><br><span class="line">762</span><br><span class="line">763</span><br><span class="line">764</span><br><span class="line">765</span><br><span class="line">766</span><br><span class="line">767</span><br><span class="line">768</span><br><span class="line">769</span><br><span class="line">770</span><br><span class="line">771</span><br><span class="line">772</span><br><span class="line">773</span><br><span class="line">774</span><br><span class="line">775</span><br><span class="line">776</span><br><span class="line">777</span><br><span class="line">778</span><br><span class="line">779</span><br><span class="line">780</span><br><span class="line">781</span><br><span class="line">782</span><br><span class="line">783</span><br><span class="line">784</span><br></pre></td><td class="code"><pre><span class="line"># ansible -i 192.168.1.91, all -m setup -u admin</span><br><span class="line">192.168.1.91 | SUCCESS =&gt; &#123;</span><br><span class="line">    &quot;ansible_facts&quot;: &#123;</span><br><span class="line">        &quot;ansible_all_ipv4_addresses&quot;: [</span><br><span class="line">            &quot;172.17.0.1&quot;, </span><br><span class="line">            &quot;192.168.0.91&quot;, </span><br><span class="line">            &quot;192.168.1.91&quot;</span><br><span class="line">        ], </span><br><span class="line">        &quot;ansible_all_ipv6_addresses&quot;: [], </span><br><span class="line">        &quot;ansible_apparmor&quot;: &#123;</span><br><span class="line">            &quot;status&quot;: &quot;disabled&quot;</span><br><span class="line">        &#125;, </span><br><span class="line">        &quot;ansible_architecture&quot;: &quot;x86_64&quot;, </span><br><span class="line">        &quot;ansible_bios_date&quot;: &quot;04/01/2014&quot;, </span><br><span class="line">        &quot;ansible_bios_version&quot;: &quot;8c24b4c&quot;, </span><br><span class="line">        &quot;ansible_cmdline&quot;: &#123;</span><br><span class="line">            &quot;BOOT_IMAGE&quot;: &quot;/boot/vmlinuz-3.10.0-957.21.3.el7.x86_64&quot;, </span><br><span class="line">            &quot;LANG&quot;: &quot;en_US.UTF-8&quot;, </span><br><span class="line">            &quot;biosdevname&quot;: &quot;0&quot;, </span><br><span class="line">            &quot;console&quot;: &quot;ttyS0,115200n8&quot;, </span><br><span class="line">            &quot;crashkernel&quot;: &quot;auto&quot;, </span><br><span class="line">            &quot;idle&quot;: &quot;halt&quot;, </span><br><span class="line">            &quot;net.ifnames&quot;: &quot;0&quot;, </span><br><span class="line">            &quot;noibrs&quot;: true, </span><br><span class="line">            &quot;quiet&quot;: true, </span><br><span class="line">            &quot;rhgb&quot;: true, </span><br><span class="line">            &quot;ro&quot;: true, </span><br><span class="line">            &quot;root&quot;: &quot;UUID=1114fe9e-2309-4580-b183-d778e6d97397&quot;</span><br><span class="line">        &#125;, </span><br><span class="line">        &quot;ansible_date_time&quot;: &#123;</span><br><span class="line">            &quot;date&quot;: &quot;2020-07-15&quot;, </span><br><span class="line">            &quot;day&quot;: &quot;15&quot;, </span><br><span class="line">            &quot;epoch&quot;: &quot;1594796084&quot;, </span><br><span class="line">            &quot;hour&quot;: &quot;14&quot;, </span><br><span class="line">            &quot;iso8601&quot;: &quot;2020-07-15T06:54:44Z&quot;, </span><br><span class="line">            &quot;iso8601_basic&quot;: &quot;20200715T145444643628&quot;, </span><br><span class="line">            &quot;iso8601_basic_short&quot;: &quot;20200715T145444&quot;, </span><br><span class="line">            &quot;iso8601_micro&quot;: &quot;2020-07-15T06:54:44.643725Z&quot;, </span><br><span class="line">            &quot;minute&quot;: &quot;54&quot;, </span><br><span class="line">            &quot;month&quot;: &quot;07&quot;, </span><br><span class="line">            &quot;second&quot;: &quot;44&quot;, </span><br><span class="line">            &quot;time&quot;: &quot;14:54:44&quot;, </span><br><span class="line">            &quot;tz&quot;: &quot;CST&quot;, </span><br><span class="line">            &quot;tz_offset&quot;: &quot;+0800&quot;, </span><br><span class="line">            &quot;weekday&quot;: &quot;星期三&quot;, </span><br><span class="line">            &quot;weekday_number&quot;: &quot;3&quot;, </span><br><span class="line">            &quot;weeknumber&quot;: &quot;28&quot;, </span><br><span class="line">            &quot;year&quot;: &quot;2020&quot;</span><br><span class="line">        &#125;, </span><br><span class="line">        &quot;ansible_default_ipv4&quot;: &#123;</span><br><span class="line">            &quot;address&quot;: &quot;192.168.0.91&quot;, </span><br><span class="line">            &quot;alias&quot;: &quot;eth0&quot;, </span><br><span class="line">            &quot;broadcast&quot;: &quot;192.168.0.255&quot;, </span><br><span class="line">            &quot;gateway&quot;: &quot;192.168.0.253&quot;, </span><br><span class="line">            &quot;interface&quot;: &quot;eth0&quot;, </span><br><span class="line">            &quot;macaddress&quot;: &quot;00:16:3e:30:d9:a4&quot;, </span><br><span class="line">            &quot;mtu&quot;: 1500, </span><br><span class="line">            &quot;netmask&quot;: &quot;255.255.255.0&quot;, </span><br><span class="line">            &quot;network&quot;: &quot;192.168.0.0&quot;, </span><br><span class="line">            &quot;type&quot;: &quot;ether&quot;</span><br><span class="line">        &#125;, </span><br><span class="line">        &quot;ansible_default_ipv6&quot;: &#123;&#125;, </span><br><span class="line">        &quot;ansible_device_links&quot;: &#123;</span><br><span class="line">            &quot;ids&quot;: &#123;&#125;, </span><br><span class="line">            &quot;labels&quot;: &#123;</span><br><span class="line">                &quot;loop2&quot;: [</span><br><span class="line">                    &quot;CDROM&quot;</span><br><span class="line">                ]</span><br><span class="line">            &#125;, </span><br><span class="line">            &quot;masters&quot;: &#123;&#125;, </span><br><span class="line">            &quot;uuids&quot;: &#123;</span><br><span class="line">                &quot;loop0&quot;: [</span><br><span class="line">                    &quot;2020-07-12-14-26-47-00&quot;</span><br><span class="line">                ], </span><br><span class="line">                &quot;loop1&quot;: [</span><br><span class="line">                    &quot;2020-07-12-20-25-18-00&quot;</span><br><span class="line">                ], </span><br><span class="line">                &quot;loop2&quot;: [</span><br><span class="line">                    &quot;2020-07-13-09-57-36-00&quot;</span><br><span class="line">                ], </span><br><span class="line">                &quot;vda1&quot;: [</span><br><span class="line">                    &quot;1114fe9e-2309-4580-b183-d778e6d97397&quot;</span><br><span class="line">                ]</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, </span><br><span class="line">        &quot;ansible_devices&quot;: &#123;</span><br><span class="line">            &quot;loop0&quot;: &#123;</span><br><span class="line">                &quot;holders&quot;: [], </span><br><span class="line">                &quot;host&quot;: &quot;&quot;, </span><br><span class="line">                &quot;links&quot;: &#123;</span><br><span class="line">                    &quot;ids&quot;: [], </span><br><span class="line">                    &quot;labels&quot;: [], </span><br><span class="line">                    &quot;masters&quot;: [], </span><br><span class="line">                    &quot;uuids&quot;: [</span><br><span class="line">                        &quot;2020-07-12-14-26-47-00&quot;</span><br><span class="line">                    ]</span><br><span class="line">                &#125;, </span><br><span class="line">                &quot;model&quot;: null, </span><br><span class="line">                &quot;partitions&quot;: &#123;&#125;, </span><br><span class="line">                &quot;removable&quot;: &quot;0&quot;, </span><br><span class="line">                &quot;rotational&quot;: &quot;1&quot;, </span><br><span class="line">                &quot;sas_address&quot;: null, </span><br><span class="line">                &quot;sas_device_handle&quot;: null, </span><br><span class="line">                &quot;scheduler_mode&quot;: &quot;&quot;, </span><br><span class="line">                &quot;sectors&quot;: &quot;327924&quot;, </span><br><span class="line">                &quot;sectorsize&quot;: &quot;512&quot;, </span><br><span class="line">                &quot;size&quot;: &quot;160.12 MB&quot;, </span><br><span class="line">                &quot;support_discard&quot;: &quot;4096&quot;, </span><br><span class="line">                &quot;vendor&quot;: null, </span><br><span class="line">                &quot;virtual&quot;: 1</span><br><span class="line">            &#125;, </span><br><span class="line">            &quot;loop1&quot;: &#123;</span><br><span class="line">                &quot;holders&quot;: [], </span><br><span class="line">                &quot;host&quot;: &quot;&quot;, </span><br><span class="line">                &quot;links&quot;: &#123;</span><br><span class="line">                    &quot;ids&quot;: [], </span><br><span class="line">                    &quot;labels&quot;: [], </span><br><span class="line">                    &quot;masters&quot;: [], </span><br><span class="line">                    &quot;uuids&quot;: [</span><br><span class="line">                        &quot;2020-07-12-20-25-18-00&quot;</span><br><span class="line">                    ]</span><br><span class="line">                &#125;, </span><br><span class="line">                &quot;model&quot;: null, </span><br><span class="line">                &quot;partitions&quot;: &#123;&#125;, </span><br><span class="line">                &quot;removable&quot;: &quot;0&quot;, </span><br><span class="line">                &quot;rotational&quot;: &quot;1&quot;, </span><br><span class="line">                &quot;sas_address&quot;: null, </span><br><span class="line">                &quot;sas_device_handle&quot;: null, </span><br><span class="line">                &quot;scheduler_mode&quot;: &quot;&quot;, </span><br><span class="line">                &quot;sectors&quot;: &quot;359172&quot;, </span><br><span class="line">                &quot;sectorsize&quot;: &quot;512&quot;, </span><br><span class="line">                &quot;size&quot;: &quot;175.38 MB&quot;, </span><br><span class="line">                &quot;support_discard&quot;: &quot;4096&quot;, </span><br><span class="line">                &quot;vendor&quot;: null, </span><br><span class="line">                &quot;virtual&quot;: 1</span><br><span class="line">            &#125;, </span><br><span class="line">            &quot;loop2&quot;: &#123;</span><br><span class="line">                &quot;holders&quot;: [], </span><br><span class="line">                &quot;host&quot;: &quot;&quot;, </span><br><span class="line">                &quot;links&quot;: &#123;</span><br><span class="line">                    &quot;ids&quot;: [], </span><br><span class="line">                    &quot;labels&quot;: [</span><br><span class="line">                        &quot;CDROM&quot;</span><br><span class="line">                    ], </span><br><span class="line">                    &quot;masters&quot;: [], </span><br><span class="line">                    &quot;uuids&quot;: [</span><br><span class="line">                        &quot;2020-07-13-09-57-36-00&quot;</span><br><span class="line">                    ]</span><br><span class="line">                &#125;, </span><br><span class="line">                &quot;model&quot;: null, </span><br><span class="line">                &quot;partitions&quot;: &#123;&#125;, </span><br><span class="line">                &quot;removable&quot;: &quot;0&quot;, </span><br><span class="line">                &quot;rotational&quot;: &quot;1&quot;, </span><br><span class="line">                &quot;sas_address&quot;: null, </span><br><span class="line">                &quot;sas_device_handle&quot;: null, </span><br><span class="line">                &quot;scheduler_mode&quot;: &quot;&quot;, </span><br><span class="line">                &quot;sectors&quot;: &quot;128696&quot;, </span><br><span class="line">                &quot;sectorsize&quot;: &quot;512&quot;, </span><br><span class="line">                &quot;size&quot;: &quot;62.84 MB&quot;, </span><br><span class="line">                &quot;support_discard&quot;: &quot;4096&quot;, </span><br><span class="line">                &quot;vendor&quot;: null, </span><br><span class="line">                &quot;virtual&quot;: 1</span><br><span class="line">            &#125;, </span><br><span class="line">            &quot;vda&quot;: &#123;</span><br><span class="line">                &quot;holders&quot;: [], </span><br><span class="line">                &quot;host&quot;: &quot;SCSI storage controller: Red Hat, Inc. Virtio block device&quot;, </span><br><span class="line">                &quot;links&quot;: &#123;</span><br><span class="line">                    &quot;ids&quot;: [], </span><br><span class="line">                    &quot;labels&quot;: [], </span><br><span class="line">                    &quot;masters&quot;: [], </span><br><span class="line">                    &quot;uuids&quot;: []</span><br><span class="line">                &#125;, </span><br><span class="line">                &quot;model&quot;: null, </span><br><span class="line">                &quot;partitions&quot;: &#123;</span><br><span class="line">                    &quot;vda1&quot;: &#123;</span><br><span class="line">                        &quot;holders&quot;: [], </span><br><span class="line">                        &quot;links&quot;: &#123;</span><br><span class="line">                            &quot;ids&quot;: [], </span><br><span class="line">                            &quot;labels&quot;: [], </span><br><span class="line">                            &quot;masters&quot;: [], </span><br><span class="line">                            &quot;uuids&quot;: [</span><br><span class="line">                                &quot;1114fe9e-2309-4580-b183-d778e6d97397&quot;</span><br><span class="line">                            ]</span><br><span class="line">                        &#125;, </span><br><span class="line">                        &quot;sectors&quot;: &quot;838847992&quot;, </span><br><span class="line">                        &quot;sectorsize&quot;: 512, </span><br><span class="line">                        &quot;size&quot;: &quot;399.99 GB&quot;, </span><br><span class="line">                        &quot;start&quot;: &quot;2048&quot;, </span><br><span class="line">                        &quot;uuid&quot;: &quot;1114fe9e-2309-4580-b183-d778e6d97397&quot;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;, </span><br><span class="line">                &quot;removable&quot;: &quot;0&quot;, </span><br><span class="line">                &quot;rotational&quot;: &quot;1&quot;, </span><br><span class="line">                &quot;sas_address&quot;: null, </span><br><span class="line">                &quot;sas_device_handle&quot;: null, </span><br><span class="line">                &quot;scheduler_mode&quot;: &quot;mq-deadline&quot;, </span><br><span class="line">                &quot;sectors&quot;: &quot;838860800&quot;, </span><br><span class="line">                &quot;sectorsize&quot;: &quot;512&quot;, </span><br><span class="line">                &quot;size&quot;: &quot;400.00 GB&quot;, </span><br><span class="line">                &quot;support_discard&quot;: &quot;0&quot;, </span><br><span class="line">                &quot;vendor&quot;: &quot;0x1af4&quot;, </span><br><span class="line">                &quot;virtual&quot;: 1</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, </span><br><span class="line">        &quot;ansible_distribution&quot;: &quot;CentOS&quot;, </span><br><span class="line">        &quot;ansible_distribution_file_parsed&quot;: true, </span><br><span class="line">        &quot;ansible_distribution_file_path&quot;: &quot;/etc/redhat-release&quot;, </span><br><span class="line">        &quot;ansible_distribution_file_variety&quot;: &quot;RedHat&quot;, </span><br><span class="line">        &quot;ansible_distribution_major_version&quot;: &quot;7&quot;, </span><br><span class="line">        &quot;ansible_distribution_release&quot;: &quot;Core&quot;, </span><br><span class="line">        &quot;ansible_distribution_version&quot;: &quot;7.8&quot;, </span><br><span class="line">        &quot;ansible_dns&quot;: &#123;</span><br><span class="line">            &quot;nameservers&quot;: [</span><br><span class="line">                &quot;100.100.2.136&quot;, </span><br><span class="line">                &quot;100.100.2.138&quot;</span><br><span class="line">            ], </span><br><span class="line">            &quot;options&quot;: &#123;</span><br><span class="line">                &quot;attempts&quot;: &quot;3&quot;, </span><br><span class="line">                &quot;rotate&quot;: true, </span><br><span class="line">                &quot;single-request-reopen&quot;: true, </span><br><span class="line">                &quot;timeout&quot;: &quot;2&quot;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, </span><br><span class="line">        &quot;ansible_docker0&quot;: &#123;</span><br><span class="line">            &quot;active&quot;: false, </span><br><span class="line">            &quot;device&quot;: &quot;docker0&quot;, </span><br><span class="line">            &quot;features&quot;: &#123;</span><br><span class="line">                &quot;busy_poll&quot;: &quot;off [fixed]&quot;, </span><br><span class="line">                &quot;fcoe_mtu&quot;: &quot;off [fixed]&quot;, </span><br><span class="line">                &quot;generic_receive_offload&quot;: &quot;on&quot;, </span><br><span class="line">                &quot;generic_segmentation_offload&quot;: &quot;on&quot;, </span><br><span class="line">                &quot;highdma&quot;: &quot;on&quot;, </span><br><span class="line">                &quot;hw_tc_offload&quot;: &quot;off [fixed]&quot;, </span><br><span class="line">                &quot;l2_fwd_offload&quot;: &quot;off [fixed]&quot;, </span><br><span class="line">                &quot;large_receive_offload&quot;: &quot;off [fixed]&quot;, </span><br><span class="line">                &quot;loopback&quot;: &quot;off [fixed]&quot;, </span><br><span class="line">                &quot;netns_local&quot;: &quot;on [fixed]&quot;, </span><br><span class="line">                &quot;ntuple_filters&quot;: &quot;off [fixed]&quot;, </span><br><span class="line">                &quot;receive_hashing&quot;: &quot;off [fixed]&quot;, </span><br><span class="line">                &quot;rx_all&quot;: &quot;off [fixed]&quot;, </span><br><span class="line">                &quot;rx_checksumming&quot;: &quot;off [fixed]&quot;, </span><br><span class="line">                &quot;rx_fcs&quot;: &quot;off [fixed]&quot;, </span><br><span class="line">                &quot;rx_gro_hw&quot;: &quot;off [fixed]&quot;, </span><br><span class="line">                &quot;rx_udp_tunnel_port_offload&quot;: &quot;off [fixed]&quot;, </span><br><span class="line">                &quot;rx_vlan_filter&quot;: &quot;off [fixed]&quot;, </span><br><span class="line">                &quot;rx_vlan_offload&quot;: &quot;off [fixed]&quot;, </span><br><span class="line">                &quot;rx_vlan_stag_filter&quot;: &quot;off [fixed]&quot;, </span><br><span class="line">                &quot;rx_vlan_stag_hw_parse&quot;: &quot;off [fixed]&quot;, </span><br><span class="line">                &quot;scatter_gather&quot;: &quot;on&quot;, </span><br><span class="line">                &quot;tcp_segmentation_offload&quot;: &quot;on&quot;, </span><br><span class="line">                &quot;tx_checksum_fcoe_crc&quot;: &quot;off [fixed]&quot;, </span><br><span class="line">                &quot;tx_checksum_ip_generic&quot;: &quot;on&quot;, </span><br><span class="line">                &quot;tx_checksum_ipv4&quot;: &quot;off [fixed]&quot;, </span><br><span class="line">                &quot;tx_checksum_ipv6&quot;: &quot;off [fixed]&quot;, </span><br><span class="line">                &quot;tx_checksum_sctp&quot;: &quot;off [fixed]&quot;, </span><br><span class="line">                &quot;tx_checksumming&quot;: &quot;on&quot;, </span><br><span class="line">                &quot;tx_fcoe_segmentation&quot;: &quot;on&quot;, </span><br><span class="line">                &quot;tx_gre_csum_segmentation&quot;: &quot;on&quot;, </span><br><span class="line">                &quot;tx_gre_segmentation&quot;: &quot;on&quot;, </span><br><span class="line">                &quot;tx_gso_partial&quot;: &quot;on&quot;, </span><br><span class="line">                &quot;tx_gso_robust&quot;: &quot;on&quot;, </span><br><span class="line">                &quot;tx_ipip_segmentation&quot;: &quot;on&quot;, </span><br><span class="line">                &quot;tx_lockless&quot;: &quot;on [fixed]&quot;, </span><br><span class="line">                &quot;tx_nocache_copy&quot;: &quot;off&quot;, </span><br><span class="line">                &quot;tx_scatter_gather&quot;: &quot;on&quot;, </span><br><span class="line">                &quot;tx_scatter_gather_fraglist&quot;: &quot;on&quot;, </span><br><span class="line">                &quot;tx_sctp_segmentation&quot;: &quot;on&quot;, </span><br><span class="line">                &quot;tx_sit_segmentation&quot;: &quot;on&quot;, </span><br><span class="line">                &quot;tx_tcp6_segmentation&quot;: &quot;on&quot;, </span><br><span class="line">                &quot;tx_tcp_ecn_segmentation&quot;: &quot;on&quot;, </span><br><span class="line">                &quot;tx_tcp_mangleid_segmentation&quot;: &quot;on&quot;, </span><br><span class="line">                &quot;tx_tcp_segmentation&quot;: &quot;on&quot;, </span><br><span class="line">                &quot;tx_udp_tnl_csum_segmentation&quot;: &quot;on&quot;, </span><br><span class="line">                &quot;tx_udp_tnl_segmentation&quot;: &quot;on&quot;, </span><br><span class="line">                &quot;tx_vlan_offload&quot;: &quot;on&quot;, </span><br><span class="line">                &quot;tx_vlan_stag_hw_insert&quot;: &quot;on&quot;, </span><br><span class="line">                &quot;udp_fragmentation_offload&quot;: &quot;on&quot;, </span><br><span class="line">                &quot;vlan_challenged&quot;: &quot;off [fixed]&quot;</span><br><span class="line">            &#125;, </span><br><span class="line">            &quot;hw_timestamp_filters&quot;: [], </span><br><span class="line">            &quot;id&quot;: &quot;8000.0242e441b693&quot;, </span><br><span class="line">            &quot;interfaces&quot;: [], </span><br><span class="line">            &quot;ipv4&quot;: &#123;</span><br><span class="line">                &quot;address&quot;: &quot;172.17.0.1&quot;, </span><br><span class="line">                &quot;broadcast&quot;: &quot;172.17.255.255&quot;, </span><br><span class="line">                &quot;netmask&quot;: &quot;255.255.0.0&quot;, </span><br><span class="line">                &quot;network&quot;: &quot;172.17.0.0&quot;</span><br><span class="line">            &#125;, </span><br><span class="line">            &quot;macaddress&quot;: &quot;02:42:e4:41:b6:93&quot;, </span><br><span class="line">            &quot;mtu&quot;: 1500, </span><br><span class="line">            &quot;promisc&quot;: false, </span><br><span class="line">            &quot;stp&quot;: false, </span><br><span class="line">            &quot;timestamping&quot;: [</span><br><span class="line">                &quot;rx_software&quot;, </span><br><span class="line">                &quot;software&quot;</span><br><span class="line">            ], </span><br><span class="line">            &quot;type&quot;: &quot;bridge&quot;</span><br><span class="line">        &#125;, </span><br><span class="line">        &quot;ansible_domain&quot;: &quot;&quot;, </span><br><span class="line">        &quot;ansible_effective_group_id&quot;: 1000, </span><br><span class="line">        &quot;ansible_effective_user_id&quot;: 1000, </span><br><span class="line">        &quot;ansible_env&quot;: &#123;</span><br><span class="line">            &quot;HISTCONTROL&quot;: &quot;erasedups&quot;, </span><br><span class="line">            &quot;HISTFILESIZE&quot;: &quot;30000&quot;, </span><br><span class="line">            &quot;HISTIGNORE&quot;: &quot;pwd:ls:cd:ll:&quot;, </span><br><span class="line">            &quot;HISTSIZE&quot;: &quot;30000&quot;, </span><br><span class="line">            &quot;HISTTIMEFORMAT&quot;: &quot;%d/%m/%y %T &quot;, </span><br><span class="line">            &quot;HOME&quot;: &quot;/home/admin&quot;, </span><br><span class="line">            &quot;JAVA_HOME&quot;: &quot;/opt/taobao/java&quot;, </span><br><span class="line">            &quot;LANG&quot;: &quot;C&quot;, </span><br><span class="line">            &quot;LC_ADDRESS&quot;: &quot;zh_CN.UTF-8&quot;, </span><br><span class="line">            &quot;LC_ALL&quot;: &quot;C&quot;, </span><br><span class="line">            &quot;LC_IDENTIFICATION&quot;: &quot;zh_CN.UTF-8&quot;, </span><br><span class="line">            &quot;LC_MEASUREMENT&quot;: &quot;zh_CN.UTF-8&quot;, </span><br><span class="line">            &quot;LC_MONETARY&quot;: &quot;zh_CN.UTF-8&quot;, </span><br><span class="line">            &quot;LC_NAME&quot;: &quot;zh_CN.UTF-8&quot;, </span><br><span class="line">            &quot;LC_NUMERIC&quot;: &quot;C&quot;, </span><br><span class="line">            &quot;LC_PAPER&quot;: &quot;zh_CN.UTF-8&quot;, </span><br><span class="line">            &quot;LC_TELEPHONE&quot;: &quot;zh_CN.UTF-8&quot;, </span><br><span class="line">            &quot;LC_TIME&quot;: &quot;zh_CN.UTF-8&quot;, </span><br><span class="line">            &quot;LESSOPEN&quot;: &quot;||/usr/bin/lesspipe.sh %s&quot;, </span><br><span class="line">            &quot;LOGNAME&quot;: &quot;admin&quot;, </span><br><span class="line">            &quot;MAIL&quot;: &quot;/var/mail/admin&quot;, </span><br><span class="line">            &quot;PATH&quot;: &quot;/usr/local/bin:/usr/bin:/opt/taobao/java8/bin:/home/admin/tools&quot;, </span><br><span class="line">            &quot;PROMPT_COMMAND&quot;: &quot;history -a&quot;, </span><br><span class="line">            &quot;PS4&quot;: &quot;+($&#123;BASH_SOURCE&#125;:$&#123;LINENO&#125;): $&#123;FUNCNAME[0]:+$&#123;FUNCNAME[0]&#125;(): &#125;&quot;, </span><br><span class="line">            &quot;PWD&quot;: &quot;/home/admin&quot;, </span><br><span class="line">            &quot;SHELL&quot;: &quot;/bin/bash&quot;, </span><br><span class="line">            &quot;SHLVL&quot;: &quot;2&quot;, </span><br><span class="line">            &quot;SSH_CLIENT&quot;: &quot;192.168.1.79 51412 22&quot;, </span><br><span class="line">            &quot;SSH_CONNECTION&quot;: &quot;192.168.1.79 51412 192.168.1.91 22&quot;, </span><br><span class="line">            &quot;USER&quot;: &quot;admin&quot;, </span><br><span class="line">            &quot;XDG_RUNTIME_DIR&quot;: &quot;/run/user/1000&quot;, </span><br><span class="line">            &quot;XDG_SESSION_ID&quot;: &quot;40120&quot;, </span><br><span class="line">            &quot;_&quot;: &quot;/usr/bin/python&quot;</span><br><span class="line">        &#125;, </span><br><span class="line">        &quot;ansible_eth0&quot;: &#123;</span><br><span class="line">            &quot;active&quot;: true, </span><br><span class="line">            &quot;device&quot;: &quot;eth0&quot;, </span><br><span class="line">            &quot;features&quot;: &#123;</span><br><span class="line">                &quot;busy_poll&quot;: &quot;off [fixed]&quot;, </span><br><span class="line">                &quot;fcoe_mtu&quot;: &quot;off [fixed]&quot;, </span><br><span class="line">                &quot;generic_receive_offload&quot;: &quot;on&quot;, </span><br><span class="line">                &quot;generic_segmentation_offload&quot;: &quot;on&quot;, </span><br><span class="line">                &quot;highdma&quot;: &quot;on [fixed]&quot;, </span><br><span class="line">                &quot;hw_tc_offload&quot;: &quot;off [fixed]&quot;, </span><br><span class="line">                &quot;l2_fwd_offload&quot;: &quot;off [fixed]&quot;, </span><br><span class="line">                &quot;large_receive_offload&quot;: &quot;off [fixed]&quot;, </span><br><span class="line">                &quot;loopback&quot;: &quot;off [fixed]&quot;, </span><br><span class="line">                &quot;netns_local&quot;: &quot;off [fixed]&quot;, </span><br><span class="line">                &quot;ntuple_filters&quot;: &quot;off [fixed]&quot;, </span><br><span class="line">                &quot;receive_hashing&quot;: &quot;off [fixed]&quot;, </span><br><span class="line">                &quot;rx_all&quot;: &quot;off [fixed]&quot;, </span><br><span class="line">                &quot;rx_checksumming&quot;: &quot;on [fixed]&quot;, </span><br><span class="line">                &quot;rx_fcs&quot;: &quot;off [fixed]&quot;, </span><br><span class="line">                &quot;rx_gro_hw&quot;: &quot;off [fixed]&quot;, </span><br><span class="line">                &quot;rx_udp_tunnel_port_offload&quot;: &quot;off [fixed]&quot;, </span><br><span class="line">                &quot;rx_vlan_filter&quot;: &quot;off [fixed]&quot;, </span><br><span class="line">                &quot;rx_vlan_offload&quot;: &quot;off [fixed]&quot;, </span><br><span class="line">                &quot;rx_vlan_stag_filter&quot;: &quot;off [fixed]&quot;, </span><br><span class="line">                &quot;rx_vlan_stag_hw_parse&quot;: &quot;off [fixed]&quot;, </span><br><span class="line">                &quot;scatter_gather&quot;: &quot;on&quot;, </span><br><span class="line">                &quot;tcp_segmentation_offload&quot;: &quot;on&quot;, </span><br><span class="line">                &quot;tx_checksum_fcoe_crc&quot;: &quot;off [fixed]&quot;, </span><br><span class="line">                &quot;tx_checksum_ip_generic&quot;: &quot;on&quot;, </span><br><span class="line">                &quot;tx_checksum_ipv4&quot;: &quot;off [fixed]&quot;, </span><br><span class="line">                &quot;tx_checksum_ipv6&quot;: &quot;off [fixed]&quot;, </span><br><span class="line">                &quot;tx_checksum_sctp&quot;: &quot;off [fixed]&quot;, </span><br><span class="line">                &quot;tx_checksumming&quot;: &quot;on&quot;, </span><br><span class="line">                &quot;tx_fcoe_segmentation&quot;: &quot;off [fixed]&quot;, </span><br><span class="line">                &quot;tx_gre_csum_segmentation&quot;: &quot;off [fixed]&quot;, </span><br><span class="line">                &quot;tx_gre_segmentation&quot;: &quot;off [fixed]&quot;, </span><br><span class="line">                &quot;tx_gso_partial&quot;: &quot;off [fixed]&quot;, </span><br><span class="line">                &quot;tx_gso_robust&quot;: &quot;off [fixed]&quot;, </span><br><span class="line">                &quot;tx_ipip_segmentation&quot;: &quot;off [fixed]&quot;, </span><br><span class="line">                &quot;tx_lockless&quot;: &quot;off [fixed]&quot;, </span><br><span class="line">                &quot;tx_nocache_copy&quot;: &quot;off&quot;, </span><br><span class="line">                &quot;tx_scatter_gather&quot;: &quot;on&quot;, </span><br><span class="line">                &quot;tx_scatter_gather_fraglist&quot;: &quot;off [fixed]&quot;, </span><br><span class="line">                &quot;tx_sctp_segmentation&quot;: &quot;off [fixed]&quot;, </span><br><span class="line">                &quot;tx_sit_segmentation&quot;: &quot;off [fixed]&quot;, </span><br><span class="line">                &quot;tx_tcp6_segmentation&quot;: &quot;on&quot;, </span><br><span class="line">                &quot;tx_tcp_ecn_segmentation&quot;: &quot;on&quot;, </span><br><span class="line">                &quot;tx_tcp_mangleid_segmentation&quot;: &quot;off&quot;, </span><br><span class="line">                &quot;tx_tcp_segmentation&quot;: &quot;on&quot;, </span><br><span class="line">                &quot;tx_udp_tnl_csum_segmentation&quot;: &quot;off [fixed]&quot;, </span><br><span class="line">                &quot;tx_udp_tnl_segmentation&quot;: &quot;off [fixed]&quot;, </span><br><span class="line">                &quot;tx_vlan_offload&quot;: &quot;off [fixed]&quot;, </span><br><span class="line">                &quot;tx_vlan_stag_hw_insert&quot;: &quot;off [fixed]&quot;, </span><br><span class="line">                &quot;udp_fragmentation_offload&quot;: &quot;on&quot;, </span><br><span class="line">                &quot;vlan_challenged&quot;: &quot;off [fixed]&quot;</span><br><span class="line">            &#125;, </span><br><span class="line">            &quot;hw_timestamp_filters&quot;: [], </span><br><span class="line">            &quot;ipv4&quot;: &#123;</span><br><span class="line">                &quot;address&quot;: &quot;192.168.0.91&quot;, </span><br><span class="line">                &quot;broadcast&quot;: &quot;192.168.0.255&quot;, </span><br><span class="line">                &quot;netmask&quot;: &quot;255.255.255.0&quot;, </span><br><span class="line">                &quot;network&quot;: &quot;192.168.0.0&quot;</span><br><span class="line">            &#125;, </span><br><span class="line">            &quot;macaddress&quot;: &quot;00:16:3e:30:d9:a4&quot;, </span><br><span class="line">            &quot;module&quot;: &quot;virtio_net&quot;, </span><br><span class="line">            &quot;mtu&quot;: 1500, </span><br><span class="line">            &quot;pciid&quot;: &quot;virtio2&quot;, </span><br><span class="line">            &quot;promisc&quot;: false, </span><br><span class="line">            &quot;timestamping&quot;: [</span><br><span class="line">                &quot;rx_software&quot;, </span><br><span class="line">                &quot;software&quot;</span><br><span class="line">            ], </span><br><span class="line">            &quot;type&quot;: &quot;ether&quot;</span><br><span class="line">        &#125;, </span><br><span class="line">        &quot;ansible_eth1&quot;: &#123;</span><br><span class="line">            &quot;active&quot;: true, </span><br><span class="line">            &quot;device&quot;: &quot;eth1&quot;, </span><br><span class="line">            &quot;features&quot;: &#123;</span><br><span class="line">                &quot;busy_poll&quot;: &quot;off [fixed]&quot;, </span><br><span class="line">                &quot;fcoe_mtu&quot;: &quot;off [fixed]&quot;, </span><br><span class="line">                &quot;generic_receive_offload&quot;: &quot;on&quot;, </span><br><span class="line">                &quot;generic_segmentation_offload&quot;: &quot;on&quot;, </span><br><span class="line">                &quot;highdma&quot;: &quot;on [fixed]&quot;, </span><br><span class="line">                &quot;hw_tc_offload&quot;: &quot;off [fixed]&quot;, </span><br><span class="line">                &quot;l2_fwd_offload&quot;: &quot;off [fixed]&quot;, </span><br><span class="line">                &quot;large_receive_offload&quot;: &quot;off [fixed]&quot;, </span><br><span class="line">                &quot;loopback&quot;: &quot;off [fixed]&quot;, </span><br><span class="line">                &quot;netns_local&quot;: &quot;off [fixed]&quot;, </span><br><span class="line">                &quot;ntuple_filters&quot;: &quot;off [fixed]&quot;, </span><br><span class="line">                &quot;receive_hashing&quot;: &quot;off [fixed]&quot;, </span><br><span class="line">                &quot;rx_all&quot;: &quot;off [fixed]&quot;, </span><br><span class="line">                &quot;rx_checksumming&quot;: &quot;on [fixed]&quot;, </span><br><span class="line">                &quot;rx_fcs&quot;: &quot;off [fixed]&quot;, </span><br><span class="line">                &quot;rx_gro_hw&quot;: &quot;off [fixed]&quot;, </span><br><span class="line">                &quot;rx_udp_tunnel_port_offload&quot;: &quot;off [fixed]&quot;, </span><br><span class="line">                &quot;rx_vlan_filter&quot;: &quot;off [fixed]&quot;, </span><br><span class="line">                &quot;rx_vlan_offload&quot;: &quot;off [fixed]&quot;, </span><br><span class="line">                &quot;rx_vlan_stag_filter&quot;: &quot;off [fixed]&quot;, </span><br><span class="line">                &quot;rx_vlan_stag_hw_parse&quot;: &quot;off [fixed]&quot;, </span><br><span class="line">                &quot;scatter_gather&quot;: &quot;on&quot;, </span><br><span class="line">                &quot;tcp_segmentation_offload&quot;: &quot;on&quot;, </span><br><span class="line">                &quot;tx_checksum_fcoe_crc&quot;: &quot;off [fixed]&quot;, </span><br><span class="line">                &quot;tx_checksum_ip_generic&quot;: &quot;on&quot;, </span><br><span class="line">                &quot;tx_checksum_ipv4&quot;: &quot;off [fixed]&quot;, </span><br><span class="line">                &quot;tx_checksum_ipv6&quot;: &quot;off [fixed]&quot;, </span><br><span class="line">                &quot;tx_checksum_sctp&quot;: &quot;off [fixed]&quot;, </span><br><span class="line">                &quot;tx_checksumming&quot;: &quot;on&quot;, </span><br><span class="line">                &quot;tx_fcoe_segmentation&quot;: &quot;off [fixed]&quot;, </span><br><span class="line">                &quot;tx_gre_csum_segmentation&quot;: &quot;off [fixed]&quot;, </span><br><span class="line">                &quot;tx_gre_segmentation&quot;: &quot;off [fixed]&quot;, </span><br><span class="line">                &quot;tx_gso_partial&quot;: &quot;off [fixed]&quot;, </span><br><span class="line">                &quot;tx_gso_robust&quot;: &quot;off [fixed]&quot;, </span><br><span class="line">                &quot;tx_ipip_segmentation&quot;: &quot;off [fixed]&quot;, </span><br><span class="line">                &quot;tx_lockless&quot;: &quot;off [fixed]&quot;, </span><br><span class="line">                &quot;tx_nocache_copy&quot;: &quot;off&quot;, </span><br><span class="line">                &quot;tx_scatter_gather&quot;: &quot;on&quot;, </span><br><span class="line">                &quot;tx_scatter_gather_fraglist&quot;: &quot;off [fixed]&quot;, </span><br><span class="line">                &quot;tx_sctp_segmentation&quot;: &quot;off [fixed]&quot;, </span><br><span class="line">                &quot;tx_sit_segmentation&quot;: &quot;off [fixed]&quot;, </span><br><span class="line">                &quot;tx_tcp6_segmentation&quot;: &quot;on&quot;, </span><br><span class="line">                &quot;tx_tcp_ecn_segmentation&quot;: &quot;on&quot;, </span><br><span class="line">                &quot;tx_tcp_mangleid_segmentation&quot;: &quot;off&quot;, </span><br><span class="line">                &quot;tx_tcp_segmentation&quot;: &quot;on&quot;, </span><br><span class="line">                &quot;tx_udp_tnl_csum_segmentation&quot;: &quot;off [fixed]&quot;, </span><br><span class="line">                &quot;tx_udp_tnl_segmentation&quot;: &quot;off [fixed]&quot;, </span><br><span class="line">                &quot;tx_vlan_offload&quot;: &quot;off [fixed]&quot;, </span><br><span class="line">                &quot;tx_vlan_stag_hw_insert&quot;: &quot;off [fixed]&quot;, </span><br><span class="line">                &quot;udp_fragmentation_offload&quot;: &quot;on&quot;, </span><br><span class="line">                &quot;vlan_challenged&quot;: &quot;off [fixed]&quot;</span><br><span class="line">            &#125;, </span><br><span class="line">            &quot;hw_timestamp_filters&quot;: [], </span><br><span class="line">            &quot;ipv4&quot;: &#123;</span><br><span class="line">                &quot;address&quot;: &quot;192.168.1.91&quot;, </span><br><span class="line">                &quot;broadcast&quot;: &quot;192.168.1.255&quot;, </span><br><span class="line">                &quot;netmask&quot;: &quot;255.255.255.0&quot;, </span><br><span class="line">                &quot;network&quot;: &quot;192.168.1.0&quot;</span><br><span class="line">            &#125;, </span><br><span class="line">            &quot;macaddress&quot;: &quot;00:16:3e:2c:a2:c2&quot;, </span><br><span class="line">            &quot;module&quot;: &quot;virtio_net&quot;, </span><br><span class="line">            &quot;mtu&quot;: 1500, </span><br><span class="line">            &quot;pciid&quot;: &quot;virtio4&quot;, </span><br><span class="line">            &quot;promisc&quot;: false, </span><br><span class="line">            &quot;timestamping&quot;: [</span><br><span class="line">                &quot;rx_software&quot;, </span><br><span class="line">                &quot;software&quot;</span><br><span class="line">            ], </span><br><span class="line">            &quot;type&quot;: &quot;ether&quot;</span><br><span class="line">        &#125;, </span><br><span class="line">        &quot;ansible_fibre_channel_wwn&quot;: [], </span><br><span class="line">        &quot;ansible_fips&quot;: false, </span><br><span class="line">        &quot;ansible_form_factor&quot;: &quot;Other&quot;, </span><br><span class="line">        &quot;ansible_fqdn&quot;: &quot;jtdb001&quot;, </span><br><span class="line">        &quot;ansible_hostname&quot;: &quot;jtdb001&quot;, </span><br><span class="line">        &quot;ansible_hostnqn&quot;: &quot;&quot;, </span><br><span class="line">        &quot;ansible_interfaces&quot;: [</span><br><span class="line">            &quot;lo&quot;, </span><br><span class="line">            &quot;docker0&quot;, </span><br><span class="line">            &quot;eth1&quot;, </span><br><span class="line">            &quot;eth0&quot;</span><br><span class="line">        ], </span><br><span class="line">        &quot;ansible_is_chroot&quot;: false, </span><br><span class="line">        &quot;ansible_iscsi_iqn&quot;: &quot;&quot;, </span><br><span class="line">        &quot;ansible_kernel&quot;: &quot;3.10.0-957.21.3.el7.x86_64&quot;, </span><br><span class="line">        &quot;ansible_kernel_version&quot;: &quot;#1 SMP Tue Jun 18 16:35:19 UTC 2019&quot;, </span><br><span class="line">        &quot;ansible_lo&quot;: &#123;</span><br><span class="line">            &quot;active&quot;: true, </span><br><span class="line">            &quot;device&quot;: &quot;lo&quot;, </span><br><span class="line">            &quot;features&quot;: &#123;</span><br><span class="line">                &quot;busy_poll&quot;: &quot;off [fixed]&quot;, </span><br><span class="line">                &quot;fcoe_mtu&quot;: &quot;off [fixed]&quot;, </span><br><span class="line">                &quot;generic_receive_offload&quot;: &quot;on&quot;, </span><br><span class="line">                &quot;generic_segmentation_offload&quot;: &quot;on&quot;, </span><br><span class="line">                &quot;highdma&quot;: &quot;on [fixed]&quot;, </span><br><span class="line">                &quot;hw_tc_offload&quot;: &quot;off [fixed]&quot;, </span><br><span class="line">                &quot;l2_fwd_offload&quot;: &quot;off [fixed]&quot;, </span><br><span class="line">                &quot;large_receive_offload&quot;: &quot;off [fixed]&quot;, </span><br><span class="line">                &quot;loopback&quot;: &quot;on [fixed]&quot;, </span><br><span class="line">                &quot;netns_local&quot;: &quot;on [fixed]&quot;, </span><br><span class="line">                &quot;ntuple_filters&quot;: &quot;off [fixed]&quot;, </span><br><span class="line">                &quot;receive_hashing&quot;: &quot;off [fixed]&quot;, </span><br><span class="line">                &quot;rx_all&quot;: &quot;off [fixed]&quot;, </span><br><span class="line">                &quot;rx_checksumming&quot;: &quot;on [fixed]&quot;, </span><br><span class="line">                &quot;rx_fcs&quot;: &quot;off [fixed]&quot;, </span><br><span class="line">                &quot;rx_gro_hw&quot;: &quot;off [fixed]&quot;, </span><br><span class="line">                &quot;rx_udp_tunnel_port_offload&quot;: &quot;off [fixed]&quot;, </span><br><span class="line">                &quot;rx_vlan_filter&quot;: &quot;off [fixed]&quot;, </span><br><span class="line">                &quot;rx_vlan_offload&quot;: &quot;off [fixed]&quot;, </span><br><span class="line">                &quot;rx_vlan_stag_filter&quot;: &quot;off [fixed]&quot;, </span><br><span class="line">                &quot;rx_vlan_stag_hw_parse&quot;: &quot;off [fixed]&quot;, </span><br><span class="line">                &quot;scatter_gather&quot;: &quot;on&quot;, </span><br><span class="line">                &quot;tcp_segmentation_offload&quot;: &quot;on&quot;, </span><br><span class="line">                &quot;tx_checksum_fcoe_crc&quot;: &quot;off [fixed]&quot;, </span><br><span class="line">                &quot;tx_checksum_ip_generic&quot;: &quot;on [fixed]&quot;, </span><br><span class="line">                &quot;tx_checksum_ipv4&quot;: &quot;off [fixed]&quot;, </span><br><span class="line">                &quot;tx_checksum_ipv6&quot;: &quot;off [fixed]&quot;, </span><br><span class="line">                &quot;tx_checksum_sctp&quot;: &quot;on [fixed]&quot;, </span><br><span class="line">                &quot;tx_checksumming&quot;: &quot;on&quot;, </span><br><span class="line">                &quot;tx_fcoe_segmentation&quot;: &quot;off [fixed]&quot;, </span><br><span class="line">                &quot;tx_gre_csum_segmentation&quot;: &quot;off [fixed]&quot;, </span><br><span class="line">                &quot;tx_gre_segmentation&quot;: &quot;off [fixed]&quot;, </span><br><span class="line">                &quot;tx_gso_partial&quot;: &quot;off [fixed]&quot;, </span><br><span class="line">                &quot;tx_gso_robust&quot;: &quot;off [fixed]&quot;, </span><br><span class="line">                &quot;tx_ipip_segmentation&quot;: &quot;off [fixed]&quot;, </span><br><span class="line">                &quot;tx_lockless&quot;: &quot;on [fixed]&quot;, </span><br><span class="line">                &quot;tx_nocache_copy&quot;: &quot;off [fixed]&quot;, </span><br><span class="line">                &quot;tx_scatter_gather&quot;: &quot;on [fixed]&quot;, </span><br><span class="line">                &quot;tx_scatter_gather_fraglist&quot;: &quot;on [fixed]&quot;, </span><br><span class="line">                &quot;tx_sctp_segmentation&quot;: &quot;on&quot;, </span><br><span class="line">                &quot;tx_sit_segmentation&quot;: &quot;off [fixed]&quot;, </span><br><span class="line">                &quot;tx_tcp6_segmentation&quot;: &quot;on&quot;, </span><br><span class="line">                &quot;tx_tcp_ecn_segmentation&quot;: &quot;on&quot;, </span><br><span class="line">                &quot;tx_tcp_mangleid_segmentation&quot;: &quot;on&quot;, </span><br><span class="line">                &quot;tx_tcp_segmentation&quot;: &quot;on&quot;, </span><br><span class="line">                &quot;tx_udp_tnl_csum_segmentation&quot;: &quot;off [fixed]&quot;, </span><br><span class="line">                &quot;tx_udp_tnl_segmentation&quot;: &quot;off [fixed]&quot;, </span><br><span class="line">                &quot;tx_vlan_offload&quot;: &quot;off [fixed]&quot;, </span><br><span class="line">                &quot;tx_vlan_stag_hw_insert&quot;: &quot;off [fixed]&quot;, </span><br><span class="line">                &quot;udp_fragmentation_offload&quot;: &quot;on&quot;, </span><br><span class="line">                &quot;vlan_challenged&quot;: &quot;on [fixed]&quot;</span><br><span class="line">            &#125;, </span><br><span class="line">            &quot;hw_timestamp_filters&quot;: [], </span><br><span class="line">            &quot;ipv4&quot;: &#123;</span><br><span class="line">                &quot;address&quot;: &quot;127.0.0.1&quot;, </span><br><span class="line">                &quot;broadcast&quot;: &quot;host&quot;, </span><br><span class="line">                &quot;netmask&quot;: &quot;255.0.0.0&quot;, </span><br><span class="line">                &quot;network&quot;: &quot;127.0.0.0&quot;</span><br><span class="line">            &#125;, </span><br><span class="line">            &quot;mtu&quot;: 65536, </span><br><span class="line">            &quot;promisc&quot;: false, </span><br><span class="line">            &quot;timestamping&quot;: [</span><br><span class="line">                &quot;rx_software&quot;, </span><br><span class="line">                &quot;software&quot;</span><br><span class="line">            ], </span><br><span class="line">            &quot;type&quot;: &quot;loopback&quot;</span><br><span class="line">        &#125;, </span><br><span class="line">        &quot;ansible_local&quot;: &#123;&#125;, </span><br><span class="line">        &quot;ansible_lsb&quot;: &#123;&#125;, </span><br><span class="line">        &quot;ansible_machine&quot;: &quot;x86_64&quot;, </span><br><span class="line">        &quot;ansible_machine_id&quot;: &quot;20190711105006363114529432776998&quot;, </span><br><span class="line">        &quot;ansible_memfree_mb&quot;: 33368, </span><br><span class="line">        &quot;ansible_memory_mb&quot;: &#123;</span><br><span class="line">            &quot;nocache&quot;: &#123;</span><br><span class="line">                &quot;free&quot;: 41285, </span><br><span class="line">                &quot;used&quot;: 6079</span><br><span class="line">            &#125;, </span><br><span class="line">            &quot;real&quot;: &#123;</span><br><span class="line">                &quot;free&quot;: 33368, </span><br><span class="line">                &quot;total&quot;: 47364, </span><br><span class="line">                &quot;used&quot;: 13996</span><br><span class="line">            &#125;, </span><br><span class="line">            &quot;swap&quot;: &#123;</span><br><span class="line">                &quot;cached&quot;: 0, </span><br><span class="line">                &quot;free&quot;: 0, </span><br><span class="line">                &quot;total&quot;: 0, </span><br><span class="line">                &quot;used&quot;: 0</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, </span><br><span class="line">        &quot;ansible_memtotal_mb&quot;: 47364, </span><br><span class="line">        &quot;ansible_mounts&quot;: [</span><br><span class="line">            &#123;</span><br><span class="line">                &quot;block_available&quot;: 0, </span><br><span class="line">                &quot;block_size&quot;: 2048, </span><br><span class="line">                &quot;block_total&quot;: 32174, </span><br><span class="line">                &quot;block_used&quot;: 32174, </span><br><span class="line">                &quot;device&quot;: &quot;/dev/loop2&quot;, </span><br><span class="line">                &quot;fstype&quot;: &quot;iso9660&quot;, </span><br><span class="line">                &quot;inode_available&quot;: 0, </span><br><span class="line">                &quot;inode_total&quot;: 0, </span><br><span class="line">                &quot;inode_used&quot;: 0, </span><br><span class="line">                &quot;mount&quot;: &quot;/mnt/yum&quot;, </span><br><span class="line">                &quot;options&quot;: &quot;ro,relatime&quot;, </span><br><span class="line">                &quot;size_available&quot;: 0, </span><br><span class="line">                &quot;size_total&quot;: 65892352, </span><br><span class="line">                &quot;uuid&quot;: &quot;2020-07-13-09-57-36-00&quot;</span><br><span class="line">            &#125;, </span><br><span class="line">            &#123;</span><br><span class="line">                &quot;block_available&quot;: 0, </span><br><span class="line">                &quot;block_size&quot;: 2048, </span><br><span class="line">                &quot;block_total&quot;: 81981, </span><br><span class="line">                &quot;block_used&quot;: 81981, </span><br><span class="line">                &quot;device&quot;: &quot;/dev/loop0&quot;, </span><br><span class="line">                &quot;fstype&quot;: &quot;iso9660&quot;, </span><br><span class="line">                &quot;inode_available&quot;: 0, </span><br><span class="line">                &quot;inode_total&quot;: 0, </span><br><span class="line">                &quot;inode_used&quot;: 0, </span><br><span class="line">                &quot;mount&quot;: &quot;/mnt/iso&quot;, </span><br><span class="line">                &quot;options&quot;: &quot;ro,relatime&quot;, </span><br><span class="line">                &quot;size_available&quot;: 0, </span><br><span class="line">                &quot;size_total&quot;: 167897088, </span><br><span class="line">                &quot;uuid&quot;: &quot;2020-07-12-14-26-47-00&quot;</span><br><span class="line">            &#125;, </span><br><span class="line">            &#123;</span><br><span class="line">                &quot;block_available&quot;: 0, </span><br><span class="line">                &quot;block_size&quot;: 2048, </span><br><span class="line">                &quot;block_total&quot;: 89793, </span><br><span class="line">                &quot;block_used&quot;: 89793, </span><br><span class="line">                &quot;device&quot;: &quot;/dev/loop1&quot;, </span><br><span class="line">                &quot;fstype&quot;: &quot;iso9660&quot;, </span><br><span class="line">                &quot;inode_available&quot;: 0, </span><br><span class="line">                &quot;inode_total&quot;: 0, </span><br><span class="line">                &quot;inode_used&quot;: 0, </span><br><span class="line">                &quot;mount&quot;: &quot;/mnt/drds&quot;, </span><br><span class="line">                &quot;options&quot;: &quot;ro,relatime&quot;, </span><br><span class="line">                &quot;size_available&quot;: 0, </span><br><span class="line">                &quot;size_total&quot;: 183896064, </span><br><span class="line">                &quot;uuid&quot;: &quot;2020-07-12-20-25-18-00&quot;</span><br><span class="line">            &#125;, </span><br><span class="line">            &#123;</span><br><span class="line">                &quot;block_available&quot;: 96685158, </span><br><span class="line">                &quot;block_size&quot;: 4096, </span><br><span class="line">                &quot;block_total&quot;: 103177963, </span><br><span class="line">                &quot;block_used&quot;: 6492805, </span><br><span class="line">                &quot;device&quot;: &quot;/dev/vda1&quot;, </span><br><span class="line">                &quot;fstype&quot;: &quot;ext4&quot;, </span><br><span class="line">                &quot;inode_available&quot;: 26110896, </span><br><span class="line">                &quot;inode_total&quot;: 26214400, </span><br><span class="line">                &quot;inode_used&quot;: 103504, </span><br><span class="line">                &quot;mount&quot;: &quot;/&quot;, </span><br><span class="line">                &quot;options&quot;: &quot;rw,relatime,data=ordered&quot;, </span><br><span class="line">                &quot;size_available&quot;: 396022407168, </span><br><span class="line">                &quot;size_total&quot;: 422616936448, </span><br><span class="line">                &quot;uuid&quot;: &quot;1114fe9e-2309-4580-b183-d778e6d97397&quot;</span><br><span class="line">            &#125;</span><br><span class="line">        ], </span><br><span class="line">        &quot;ansible_nodename&quot;: &quot;jtdb001&quot;, </span><br><span class="line">        &quot;ansible_os_family&quot;: &quot;RedHat&quot;, </span><br><span class="line">        &quot;ansible_pkg_mgr&quot;: &quot;yum&quot;, </span><br><span class="line">        &quot;ansible_proc_cmdline&quot;: &#123;</span><br><span class="line">            &quot;BOOT_IMAGE&quot;: &quot;/boot/vmlinuz-3.10.0-957.21.3.el7.x86_64&quot;, </span><br><span class="line">            &quot;LANG&quot;: &quot;en_US.UTF-8&quot;, </span><br><span class="line">            &quot;biosdevname&quot;: &quot;0&quot;, </span><br><span class="line">            &quot;console&quot;: [</span><br><span class="line">                &quot;tty0&quot;, </span><br><span class="line">                &quot;ttyS0,115200n8&quot;</span><br><span class="line">            ], </span><br><span class="line">            &quot;crashkernel&quot;: &quot;auto&quot;, </span><br><span class="line">            &quot;idle&quot;: &quot;halt&quot;, </span><br><span class="line">            &quot;net.ifnames&quot;: &quot;0&quot;, </span><br><span class="line">            &quot;noibrs&quot;: true, </span><br><span class="line">            &quot;quiet&quot;: true, </span><br><span class="line">            &quot;rhgb&quot;: true, </span><br><span class="line">            &quot;ro&quot;: true, </span><br><span class="line">            &quot;root&quot;: &quot;UUID=1114fe9e-2309-4580-b183-d778e6d97397&quot;</span><br><span class="line">        &#125;, </span><br><span class="line">        &quot;ansible_processor&quot;: [</span><br><span class="line">            &quot;0&quot;, </span><br><span class="line">            &quot;GenuineIntel&quot;, </span><br><span class="line">            &quot;Intel(R) Xeon(R) Platinum 8269CY CPU @ 2.50GHz&quot;, </span><br><span class="line">            &quot;1&quot;, </span><br><span class="line">            &quot;GenuineIntel&quot;, </span><br><span class="line">            &quot;Intel(R) Xeon(R) Platinum 8269CY CPU @ 2.50GHz&quot;, </span><br><span class="line">            &quot;2&quot;, </span><br><span class="line">            &quot;GenuineIntel&quot;, </span><br><span class="line">            &quot;Intel(R) Xeon(R) Platinum 8269CY CPU @ 2.50GHz&quot;, </span><br><span class="line">            &quot;3&quot;, </span><br><span class="line">            &quot;GenuineIntel&quot;, </span><br><span class="line">            &quot;Intel(R) Xeon(R) Platinum 8269CY CPU @ 2.50GHz&quot;, </span><br><span class="line">            &quot;4&quot;, </span><br><span class="line">            &quot;GenuineIntel&quot;, </span><br><span class="line">            &quot;Intel(R) Xeon(R) Platinum 8269CY CPU @ 2.50GHz&quot;, </span><br><span class="line">            &quot;5&quot;, </span><br><span class="line">            &quot;GenuineIntel&quot;, </span><br><span class="line">            &quot;Intel(R) Xeon(R) Platinum 8269CY CPU @ 2.50GHz&quot;, </span><br><span class="line">            &quot;6&quot;, </span><br><span class="line">            &quot;GenuineIntel&quot;, </span><br><span class="line">            &quot;Intel(R) Xeon(R) Platinum 8269CY CPU @ 2.50GHz&quot;, </span><br><span class="line">            &quot;7&quot;, </span><br><span class="line">            &quot;GenuineIntel&quot;, </span><br><span class="line">            &quot;Intel(R) Xeon(R) Platinum 8269CY CPU @ 2.50GHz&quot;, </span><br><span class="line">            &quot;8&quot;, </span><br><span class="line">            &quot;GenuineIntel&quot;, </span><br><span class="line">            &quot;Intel(R) Xeon(R) Platinum 8269CY CPU @ 2.50GHz&quot;, </span><br><span class="line">            &quot;9&quot;, </span><br><span class="line">            &quot;GenuineIntel&quot;, </span><br><span class="line">            &quot;Intel(R) Xeon(R) Platinum 8269CY CPU @ 2.50GHz&quot;, </span><br><span class="line">            &quot;10&quot;, </span><br><span class="line">            &quot;GenuineIntel&quot;, </span><br><span class="line">            &quot;Intel(R) Xeon(R) Platinum 8269CY CPU @ 2.50GHz&quot;, </span><br><span class="line">            &quot;11&quot;, </span><br><span class="line">            &quot;GenuineIntel&quot;, </span><br><span class="line">            &quot;Intel(R) Xeon(R) Platinum 8269CY CPU @ 2.50GHz&quot;</span><br><span class="line">        ], </span><br><span class="line">        &quot;ansible_processor_cores&quot;: 6, </span><br><span class="line">        &quot;ansible_processor_count&quot;: 1, </span><br><span class="line">        &quot;ansible_processor_threads_per_core&quot;: 2, </span><br><span class="line">        &quot;ansible_processor_vcpus&quot;: 12, </span><br><span class="line">        &quot;ansible_product_name&quot;: &quot;Alibaba Cloud ECS&quot;, </span><br><span class="line">        &quot;ansible_product_serial&quot;: &quot;NA&quot;, </span><br><span class="line">        &quot;ansible_product_uuid&quot;: &quot;NA&quot;, </span><br><span class="line">        &quot;ansible_product_version&quot;: &quot;pc-i440fx-2.1&quot;, </span><br><span class="line">        &quot;ansible_python&quot;: &#123;</span><br><span class="line">            &quot;executable&quot;: &quot;/usr/bin/python&quot;, </span><br><span class="line">            &quot;has_sslcontext&quot;: true, </span><br><span class="line">            &quot;type&quot;: &quot;CPython&quot;, </span><br><span class="line">            &quot;version&quot;: &#123;</span><br><span class="line">                &quot;major&quot;: 2, </span><br><span class="line">                &quot;micro&quot;: 5, </span><br><span class="line">                &quot;minor&quot;: 7, </span><br><span class="line">                &quot;releaselevel&quot;: &quot;final&quot;, </span><br><span class="line">                &quot;serial&quot;: 0</span><br><span class="line">            &#125;, </span><br><span class="line">            &quot;version_info&quot;: [</span><br><span class="line">                2, </span><br><span class="line">                7, </span><br><span class="line">                5, </span><br><span class="line">                &quot;final&quot;, </span><br><span class="line">                0</span><br><span class="line">            ]</span><br><span class="line">        &#125;, </span><br><span class="line">        &quot;ansible_python_version&quot;: &quot;2.7.5&quot;, </span><br><span class="line">        &quot;ansible_real_group_id&quot;: 1000, </span><br><span class="line">        &quot;ansible_real_user_id&quot;: 1000, </span><br><span class="line">        &quot;ansible_selinux&quot;: &#123;</span><br><span class="line">            &quot;status&quot;: &quot;disabled&quot;</span><br><span class="line">        &#125;, </span><br><span class="line">        &quot;ansible_selinux_python_present&quot;: true, </span><br><span class="line">        &quot;ansible_service_mgr&quot;: &quot;systemd&quot;, </span><br><span class="line">        &quot;ansible_ssh_host_key_dsa_public&quot;: &quot;AAAAB3NzaC1kc3MAAACBAIjMSdXjIBwLTRwqzzLzJzw52IikcmHpmM65Idw9Q/CCH23SJdmmYzl9LIWFTEf2ZP4dHYibvgWtqfc6AHLFVgM1lz3wwdJJSyBD1TyFet+MPZEA1A9jw2Ke2K9C942dWATCpi3B0nk0KJDp49+V0QjUUjZmzt7I66wDmPLpW7mNAAAAFQDXmbLv48zsFHUgPiixhcKsk29ZPQAAAIAHHM+jfcL3V/X6EovQGj/2OytDN7k5hb4KRNTzBwh9JU5V44+S3r5ZViJDthKBolVT1CLX8jAivBu6d70ImYcZLa75AImOnlSp9D4xGP4TNfdAYrA7CkYpzn8ky15xjFDjkL0BjVmeEg6In+04tZOp/kIi/Ft9/ld63W4xopspwwAAAIAhBCIAMW37rknrsmv3sXmhgt+FeUQA/o8moZKcX+xI5sv27NEavQGGKOvZM4+nhCggRvjWaxC9N1DnO2g52trhGrUhNF0qwn/4iar/yknZWwRyZXzB3YtOdJXxCoJphuuGeqJRsLPb7OEIAF7c3lFJcfMUrwcjWrRtFMUM6mE+gQ==&quot;, </span><br><span class="line">        &quot;ansible_ssh_host_key_ecdsa_public&quot;: &quot;AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBMffg6EX26f+10IIgg/U7+PsCUDs8Ep0MUttUyVh3+bJ7/K7ROMhuc8BTieA4PRj3MOaKMbUuZTqPTmrK/4srqg=&quot;, </span><br><span class="line">        &quot;ansible_ssh_host_key_ed25519_public&quot;: &quot;AAAAC3NzaC1lZDI1NTE5AAAAINIKYkm+FKDTvx6VgENoAnXwOJQ+xZjk3rkvUqZ/4F3i&quot;, </span><br><span class="line">        &quot;ansible_ssh_host_key_rsa_public&quot;: &quot;AAAAB3NzaC1yc2EAAAADAQABAAABAQC1xlLrDTri/jRfph6Uqx6CoY1/+uAE34rR9sR4FtE+2OMM8kUN0+N+hWLL+8r/pzM40RJOUmELYTlibfnjkYDsmYcpxD8kOxonvlYQbpvram8Hx7X8W1thYs//Zdhltmz1ijTiEatCL/yxJnwrpxN1XOtbMtALKgykbOzF+LNevFUG05MxxQR5WVjijXwK/Auf0ce/ei3NISQZLiW+d+IVYPkAQDpbUpH5W/qGDN0W8wT2OGE0bOvrPfDPRhSxeYrcS4mgS7nGvB26sFyeAimgadnxmWaxAveargYKt33jJQhVaA/23kw+/lygQcSN1QJ2mpeHb3ugay0Gv1i/Wd7P&quot;, </span><br><span class="line">        &quot;ansible_swapfree_mb&quot;: 0, </span><br><span class="line">        &quot;ansible_swaptotal_mb&quot;: 0, </span><br><span class="line">        &quot;ansible_system&quot;: &quot;Linux&quot;, </span><br><span class="line">        &quot;ansible_system_capabilities&quot;: [</span><br><span class="line">            &quot;&quot;</span><br><span class="line">        ], </span><br><span class="line">        &quot;ansible_system_capabilities_enforced&quot;: &quot;True&quot;, </span><br><span class="line">        &quot;ansible_system_vendor&quot;: &quot;Alibaba Cloud&quot;, </span><br><span class="line">        &quot;ansible_uptime_seconds&quot;: 11384976, </span><br><span class="line">        &quot;ansible_user_dir&quot;: &quot;/home/admin&quot;, </span><br><span class="line">        &quot;ansible_user_gecos&quot;: &quot;&quot;, </span><br><span class="line">        &quot;ansible_user_gid&quot;: 1000, </span><br><span class="line">        &quot;ansible_user_id&quot;: &quot;admin&quot;, </span><br><span class="line">        &quot;ansible_user_shell&quot;: &quot;/bin/bash&quot;, </span><br><span class="line">        &quot;ansible_user_uid&quot;: 1000, </span><br><span class="line">        &quot;ansible_userspace_architecture&quot;: &quot;x86_64&quot;, </span><br><span class="line">        &quot;ansible_userspace_bits&quot;: &quot;64&quot;, </span><br><span class="line">        &quot;ansible_virtualization_role&quot;: &quot;guest&quot;, </span><br><span class="line">        &quot;ansible_virtualization_type&quot;: &quot;kvm&quot;, </span><br><span class="line">        &quot;discovered_interpreter_python&quot;: &quot;/usr/bin/python&quot;, </span><br><span class="line">        &quot;gather_subset&quot;: [</span><br><span class="line">            &quot;all&quot;</span><br><span class="line">        ], </span><br><span class="line">        &quot;module_setup&quot;: true</span><br><span class="line">    &#125;, </span><br><span class="line">    &quot;changed&quot;: false</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="ansible-xargs-占位符"><a href="#ansible-xargs-占位符" class="headerlink" title="ansible + xargs 占位符"></a>ansible + xargs 占位符</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">//批量执行docker exec</span><br><span class="line">ansible -i host.ini all -m shell -a &quot;docker ps -a | grep pxd-tpcc | grep dn | cut -d &apos; &apos; -f 1 | xargs  -I&#123;&#125; docker exec &#123;&#125; bash -c \&quot;myc -e &apos;shutdown&apos;\&quot;&quot;</span><br></pre></td></tr></table></figure>

<h2 id="指定ip执行playbook"><a href="#指定ip执行playbook" class="headerlink" title="指定ip执行playbook"></a>指定ip执行playbook</h2><blockquote>
<p>ansible-playbook  -i “10.168.101.179,” all test.yml</p>
</blockquote>
<p>或者：</p>
<blockquote>
<p>ansible -i phy.ini 11.167.60.150 -m shell -a ‘docker run -it -d –net&#x3D;host -e diamond_server_list&#x3D;”“ -e diamond_db0&#x3D;”“ -e diamond_db1&#x3D;”“ -e diamond_db2&#x3D;”“ -e HOST_IP&#x3D;”“ -p 8080:8080 -p 9090:9090 –name diamond  ‘ -vvv</p>
</blockquote>
<p>上面这种还能重用phy.ini中所有的变量配置</p>
<h2 id="创建用户并打通账号"><a href="#创建用户并打通账号" class="headerlink" title="创建用户并打通账号"></a>创建用户并打通账号</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">$cat create_user.yml</span><br><span class="line"># create user ren with passwd test and sudo privileges.</span><br><span class="line"># ansible-playbook -i docker.ini create_user.yml</span><br><span class="line">- hosts: all</span><br><span class="line">  user: root</span><br><span class="line">  vars:</span><br><span class="line">    # created with:</span><br><span class="line">    # python -c &apos;import crypt; print crypt.crypt(&quot;password&quot;, &quot;$1$SomeSalt$&quot;)&apos;</span><br><span class="line">    password: $1$SomeSalt$OrX9ouxOCP0ZOpVG9SwnR/</span><br><span class="line"></span><br><span class="line">  tasks:</span><br><span class="line">    - name: create a new user</span><br><span class="line">      user:</span><br><span class="line">       name: &apos;&#123;&#123; user &#125;&#125;&apos;</span><br><span class="line">       password: &apos;&#123;&#123; password &#125;&#125;&apos;</span><br><span class="line">       home: /home/&#123;&#123; user &#125;&#125;</span><br><span class="line">       state: present</span><br><span class="line">       shell: /bin/bash</span><br><span class="line"></span><br><span class="line">    - name: Add user to the sudoers</span><br><span class="line">      copy:</span><br><span class="line">          dest: &quot;/etc/sudoers.d/&#123;&#123; user &#125;&#125;&quot;</span><br><span class="line">          content: &quot;&#123;&#123; user &#125;&#125;  ALL=(ALL)  NOPASSWD: ALL&quot;</span><br><span class="line"></span><br><span class="line">    - name: Deploy SSH Key</span><br><span class="line">      authorized_key: user=&#123;&#123; user &#125;&#125;</span><br><span class="line">           key=&quot;&#123;&#123; lookup(&apos;file&apos;, &apos;/root/.ssh/id_rsa.pub&apos;) &#125;&#125;&quot;</span><br><span class="line">           state=present</span><br></pre></td></tr></table></figure>

<p>然后执行： ansible-playbook -i  all.ini create_user.yml -e “user&#x3D;admin” 。</p>
<p>或者：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"> ansible -i 192.168.2.101, all -m user -a &quot;name=user02 system=yes uid=503 group=root groups=root shell=/etc/nologin home=/home/user02 password=pwd@123&quot;</span><br><span class="line"> 192.168.2.101 | CHANGED =&gt; &#123;</span><br><span class="line">    &quot;ansible_facts&quot;: &#123;</span><br><span class="line">        &quot;discovered_interpreter_python&quot;: &quot;/usr/bin/python&quot;</span><br><span class="line">    &#125;, </span><br><span class="line">    &quot;changed&quot;: true, </span><br><span class="line">    &quot;comment&quot;: &quot;&quot;, </span><br><span class="line">    &quot;create_home&quot;: true, </span><br><span class="line">    &quot;group&quot;: 0, </span><br><span class="line">    &quot;groups&quot;: &quot;root&quot;, </span><br><span class="line">    &quot;home&quot;: &quot;/home/user02&quot;, </span><br><span class="line">    &quot;name&quot;: &quot;user02&quot;, </span><br><span class="line">    &quot;password&quot;: &quot;NOT_LOGGING_PASSWORD&quot;, </span><br><span class="line">    &quot;shell&quot;: &quot;/etc/nologin&quot;, </span><br><span class="line">    &quot;state&quot;: &quot;present&quot;, </span><br><span class="line">    &quot;system&quot;: true, </span><br><span class="line">    &quot;uid&quot;: 503</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>playbook task规范：</p>
<p><img src="https://cdn.jsdelivr.net/gh/plantegg/plantegg.github.io/images/oss/d502a11765273304abd673fb358b482a.png" alt="image.png"></p>
<p><strong>对齐的时候不能用tab和空格混合</strong></p>
<h2 id="修改密码"><a href="#修改密码" class="headerlink" title="修改密码"></a>修改密码</h2><p>创建如下yaml脚本 changepw.yml:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">- name: user <span class="keyword">module</span> demo</span><br><span class="line">  hosts: all</span><br><span class="line">  become: <span class="literal">true</span></span><br><span class="line">  vars:</span><br><span class="line">    user: 'admin'</span><br><span class="line">    mypassword: <span class="string">"PolarDB-X"</span></span><br><span class="line">    <span class="meta">#mypassword: <span class="meta-string">"$1$SomeSalt$PB9C3LT9wCjmaMYdBWsRS1"</span></span></span><br><span class="line"></span><br><span class="line">  tasks:</span><br><span class="line">    - name: change password</span><br><span class="line">      ansible.builtin.user:</span><br><span class="line">        name: <span class="string">"&#123;&#123; user &#125;&#125;"</span></span><br><span class="line">        state: present</span><br><span class="line">        password: <span class="string">"&#123;&#123; mypassword | password_hash('sha512') &#125;&#125;"</span></span><br></pre></td></tr></table></figure>

<p>使用方法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ansible-playbook -i 1.2.3.4, changepw.yml -e &quot;user=root&quot; -e &quot;mypassword=123&quot;</span><br></pre></td></tr></table></figure>

<p>将 root 账号的密码改成123</p>
<p>或者：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ansible -i 1.2.3.4, all -e &quot;newpassword=1234&quot; -m user -a &quot;name=admin update_password=always password=&#123;&#123; newpassword|password_hash(&apos;sha512&apos;) &#125;&#125;&quot;</span><br></pre></td></tr></table></figure>

<h3 id="创建用户以及密码"><a href="#创建用户以及密码" class="headerlink" title="创建用户以及密码"></a>创建用户以及密码</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ansible -i 1.2.3.4, all  -e &quot;newpassword=1234&quot; -m user -a &quot;name=ren state=present shell=/bin/sh update_password=always password=&#123;&#123; newpassword|password_hash(&apos;sha512&apos;) &#125;&#125;&quot;</span><br></pre></td></tr></table></figure>

<h2 id="部署docker-daemon的playbook"><a href="#部署docker-daemon的playbook" class="headerlink" title="部署docker daemon的playbook"></a>部署docker daemon的playbook</h2><p>执行 ansible-playbook site.yml -v  -i test.ini -u admin -e “project&#x3D;docker” -p</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br></pre></td><td class="code"><pre><span class="line">$cat roles/docker/tasks/main.yml </span><br><span class="line"># filename: main.yml</span><br><span class="line">---</span><br><span class="line">#&quot;****************************************************************************&quot;&quot;</span><br><span class="line">- name: copy docker execute file to remote</span><br><span class="line">  copy: src=docker/ dest=/usr/bin/ mode=0755 force=yes</span><br><span class="line">  tags: copytar</span><br><span class="line"></span><br><span class="line">- name: create storage dir</span><br><span class="line">  file: path=&#123;&#123; storage_dir &#125;&#125; state=directory</span><br><span class="line">  ignore_errors: true</span><br><span class="line">  tags: docker</span><br><span class="line"></span><br><span class="line">- name: create the dir</span><br><span class="line">  file: path=/etc/systemd/system/ state=directory</span><br><span class="line">  ignore_errors: true</span><br><span class="line">  tags: docker</span><br><span class="line"></span><br><span class="line">- name: template docker.service to server</span><br><span class="line">  template: src=docker.service dest=/etc/systemd/system/docker.service</span><br><span class="line">  tags: docker</span><br><span class="line"></span><br><span class="line">- name: template docker.socket to server</span><br><span class="line">  template: src=docker.socket dest=/usr/lib/systemd/system/docker.socket</span><br><span class="line">  tags: docker</span><br><span class="line"></span><br><span class="line">- name: create /etc/docker dir to server</span><br><span class="line">  file: path=/etc/docker state=directory</span><br><span class="line">  ignore_errors: true</span><br><span class="line">  tags: docker</span><br><span class="line"></span><br><span class="line">- name: copy daemon.json to server</span><br><span class="line">  template: src=&#123;&#123; inventory_hostname &#125;&#125;/daemon.json dest=/etc/docker/daemon.json</span><br><span class="line">  ignore_errors: true</span><br><span class="line">  tags: docker</span><br><span class="line"></span><br><span class="line">- name: copy the load ovs modules to server</span><br><span class="line">  copy: src=openvswitch.modules dest=/etc/sysconfig/modules/openvswitch.modules mode=0755  force=yes</span><br><span class="line">  tags: docker</span><br><span class="line"></span><br><span class="line">- name: kill docker daemon</span><br><span class="line">  shell: &quot;kill -9 $(cat /var/run/docker.pid)&quot;</span><br><span class="line">  ignore_errors: true</span><br><span class="line">  tags: test</span><br><span class="line"></span><br><span class="line">- name: reload systemctl daemon-reload</span><br><span class="line">  shell: &quot;systemctl daemon-reload&quot;</span><br><span class="line">  tags: docker</span><br><span class="line"></span><br><span class="line">- name: enabled the docker service</span><br><span class="line">  shell: &quot;systemctl enable docker.service&quot;</span><br><span class="line">  ignore_errors: true</span><br><span class="line">  tags: docker</span><br><span class="line"></span><br><span class="line">- name: start docker service</span><br><span class="line">  shell: &quot;systemctl start docker.service&quot;</span><br><span class="line"></span><br><span class="line">- name: remove all containers</span><br><span class="line">  shell: sudo docker ps -a | awk &apos;&#123;print $1&#125;&apos; | xargs sudo docker rm -f -v</span><br><span class="line">  ignore_errors: true</span><br><span class="line"></span><br><span class="line">- name: template /etc/hosts to server</span><br><span class="line">  template: src=hosts dest=/etc/hosts owner=root group=root mode=0644 force=yes</span><br><span class="line">  tags: restorehosts</span><br><span class="line"></span><br><span class="line">- name: mkdir /tmp/etc/</span><br><span class="line">  shell: &quot;mkdir /tmp/etc/ &quot;</span><br><span class="line">  ignore_errors: true</span><br><span class="line">  tags: hosts</span><br><span class="line"></span><br><span class="line">- name: copy remote /etc/hosts to /tmp</span><br><span class="line">  shell: &quot;cp /etc/hosts /tmp/etc/ &quot;</span><br><span class="line">  tags: hosts</span><br><span class="line"></span><br><span class="line">- name: copy /etc/hosts to server</span><br><span class="line">  template: src=etc.host dest=/tmp/etc/ owner=&#123;&#123; remote_user &#125;&#125; group=&#123;&#123; remote_user &#125;&#125; mode=0700 force=yes</span><br><span class="line">  tags: hosts</span><br><span class="line"></span><br><span class="line">- name: merge /etc/hosts</span><br><span class="line">  assemble: src=/tmp/etc dest=/etc/hosts owner=root group=root mode=0644 force=yes</span><br><span class="line">  tags: hosts</span><br><span class="line"></span><br><span class="line">- name: copy docker_rc.sh to server</span><br><span class="line">  template: src=docker_rc.sh dest=&#123;&#123; docker_rc_dir &#125;&#125;/docker_rc.sh owner=root group=root mode=0755 force=yes</span><br><span class="line">  when: use_vxlan!=&quot;true&quot;</span><br><span class="line">  tags: docker_rc</span><br><span class="line"></span><br><span class="line">- name: copy docker_rc.sh to server</span><br><span class="line">  template: src=docker_rc_vm.sh dest=&#123;&#123; docker_rc_dir &#125;&#125;/docker_rc.sh owner=root group=root mode=0755 force=yes</span><br><span class="line">  when: use_vxlan==&quot;true&quot;</span><br><span class="line">  tags: docker_rc</span><br><span class="line"></span><br><span class="line">- name: clean docker_rc in rc.local</span><br><span class="line">  command: su - root -c &quot; sed -i &apos;/docker_rc.sh/d&apos; /etc/rc.d/rc.local &quot;</span><br><span class="line">  ignore_errors: true</span><br><span class="line">  sudo: yes</span><br><span class="line">  tags: docker_rc</span><br><span class="line"></span><br><span class="line">- name: start the docker when the system reboot</span><br><span class="line">  command: su - root -c &quot; echo &apos;su - root -c \&quot;&#123;&#123; docker_rc_dir &#125;&#125;/docker_rc.sh\&quot; &apos; &gt;&gt; /etc/rc.d/rc.local &quot;</span><br><span class="line">  ignore_errors: true</span><br><span class="line">  sudo: yes</span><br><span class="line">  tags: docker_rc</span><br><span class="line"></span><br><span class="line">- name: chown the /etc/rc.d/rc.local</span><br><span class="line">  shell: &quot;chmod +x /etc/rc.d/rc.local &quot;</span><br><span class="line">  ignore_errors: true</span><br><span class="line">  sudo: yes</span><br><span class="line">  tags: docker_rc</span><br><span class="line"></span><br><span class="line">- name: clean previous space occupier</span><br><span class="line">  file: path=&#123;&#123; storage_dir &#125;&#125;/ark.disk&#123;&#123; item &#125;&#125;.tmp state=absent</span><br><span class="line">  with_items:</span><br><span class="line">    - 1</span><br><span class="line">    - 2</span><br><span class="line">  ignore_errors: true</span><br><span class="line">  tags: docker</span><br><span class="line"></span><br><span class="line">- name: Occupy space for docker</span><br><span class="line">  shell: &quot;dd if=/dev/zero of=&#123;&#123; storage_dir &#125;&#125;/ark.disk&#123;&#123; item &#125;&#125;.tmp bs=1M count=1024&quot;</span><br><span class="line">  sudo: yes</span><br><span class="line">  with_items:</span><br><span class="line">    - 1</span><br><span class="line">    - 2</span><br><span class="line">  tags: docker</span><br></pre></td></tr></table></figure>

<h2 id="部署zk"><a href="#部署zk" class="headerlink" title="部署zk"></a>部署zk</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">$cat roles/zookeeper/tasks/main.yml</span><br><span class="line"># filename: main.yml</span><br><span class="line">---</span><br><span class="line">#&quot;****************************************************************************&quot;&quot;</span><br><span class="line">- name: extract zookeeper tgz</span><br><span class="line">  unarchive: src=&#123;&#123; packages_dir &#125;&#125;/lib/&#123;&#123; zk_package_name &#125;&#125; dest=/opt</span><br><span class="line">  sudo: yes</span><br><span class="line"></span><br><span class="line">- name: create zk data and log dir</span><br><span class="line">  file: path=&#123;&#123; zk_data_dir &#125;&#125; state=directory mode=0755</span><br><span class="line">  with_items:</span><br><span class="line">    - &quot;&#123;&#123; zk_data_dir &#125;&#125;&quot;</span><br><span class="line">    - &quot;&#123;&#123; zk_logs_dir &#125;&#125;&quot;</span><br><span class="line"></span><br><span class="line">- name: set the myid</span><br><span class="line">  template: src=myid dest=&#123;&#123; zk_myid_file &#125;&#125;  mode=0644</span><br><span class="line"></span><br><span class="line">- name: template zoo.cfg</span><br><span class="line">  template: src=zoo.cfg dest=&#123;&#123; zk_install_dir &#125;&#125;/conf/ mode=0644</span><br><span class="line"></span><br><span class="line">- name: copy log4j to remote</span><br><span class="line">  template: src=log4j.properties dest=&#123;&#123; zk_install_dir &#125;&#125;/conf/log4j.properties</span><br><span class="line"></span><br><span class="line">- name: determine zk process</span><br><span class="line">  command: su - root -c &quot;ps aux | grep java | grep -v grep | grep &#123;&#123; zk_install_dir &#125;&#125;&quot;</span><br><span class="line">  register: result</span><br><span class="line">  ignore_errors: true</span><br><span class="line"></span><br><span class="line">- name: stop zk server</span><br><span class="line">  command: su - root -c &quot;sh &#123;&#123; zk_install_dir &#125;&#125;/bin/zkServer.sh  stop&quot;</span><br><span class="line">  ignore_errors: true</span><br><span class="line">  when: &quot;result.rc == 0&quot;</span><br><span class="line"></span><br><span class="line">- name: start zk server</span><br><span class="line">  command: su - root -c &quot;sh &#123;&#123; zk_install_dir &#125;&#125;/bin/zkServer.sh start&quot;</span><br><span class="line"></span><br><span class="line">- name: get process info</span><br><span class="line">  command: su - root -c &quot;ps aux | grep java | grep -v grep | grep &#123;&#123; zk_install_dir &#125;&#125;&quot;</span><br><span class="line">  register: result</span><br><span class="line"></span><br><span class="line">- name: clean zk service when the system reboot</span><br><span class="line">  command: su - root -c &quot; sed -i &apos;/&#123;&#123; zk_dir_name &#125;&#125;/d&apos; /etc/rc.d/rc.local &quot;</span><br><span class="line">  ignore_errors: true</span><br><span class="line">  sudo: yes</span><br><span class="line"></span><br><span class="line">- name: start the zk service when the system reboot</span><br><span class="line">  command: su - root -c &quot; echo &apos;su - root -c \&quot;&#123;&#123; zk_install_dir &#125;&#125;/bin/zkServer.sh start\&quot; &apos; &gt;&gt; /etc/rc.d/rc.local &quot;</span><br><span class="line">  ignore_errors: true</span><br><span class="line">  sudo: yes</span><br><span class="line"></span><br><span class="line">- name: start the zk service when the system reboot</span><br><span class="line">  shell: &quot;chmod +x /etc/rc.d/rc.local &quot;</span><br><span class="line">  ignore_errors: true</span><br><span class="line">  sudo: yes</span><br></pre></td></tr></table></figure>

<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><p><a href="https://www.mydailytutorials.com/how-to-copy-files-and-directories-in-ansible-using-copy-and-fetch-modules/" target="_blank" rel="noopener">How to Copy Files and Directories in Ansible Using Copy and Fetch Modules</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://plantegg.github.io/2016/03/24/ansible 常见问题/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="twitter @plantegg">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="plantegg">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/03/24/ansible 常见问题/" itemprop="url">ansible 常见问题</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-03-24T17:30:03+08:00">
                2016-03-24
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Ansible/" itemprop="url" rel="index">
                    <span itemprop="name">Ansible</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="ansible-常见问题"><a href="#ansible-常见问题" class="headerlink" title="ansible 常见问题"></a>ansible 常见问题</h1><h2 id="获取模块信息"><a href="#获取模块信息" class="headerlink" title="获取模块信息"></a>获取模块信息</h2><ul>
<li>获取所有模块信息，100多个</li>
</ul>
<ul>
<li>ansible-doc -l</li>
</ul>
<p>获取每个模块的具体信息 </p>
<ul>
<li><p>ansible-doc<br>example：ansible-doc ping</p>
<p>   PING</p>
<p>   A trivial test module, this module always returns <code>pong&#39; on    successful contact. It does not make sense in playbooks, but it is    useful from </code>&#x2F;usr&#x2F;bin&#x2F;udp’</p>
<p> EXAMPLES:<br> Test ‘webservers’ status</p>
<p> udp webservers -m ping</p>
</li>
</ul>
<h2 id="嵌套执行命令roles"><a href="#嵌套执行命令roles" class="headerlink" title="嵌套执行命令roles"></a>嵌套执行命令roles</h2><pre><code>- name: create jdk home
  file: path={{ remote_jdk_home }} state=directory mode=0755

- name: xxxxxxxxx
  include: ../../init/tasks/main.yml
</code></pre>
<h2 id="defaults-中变量定义"><a href="#defaults-中变量定义" class="headerlink" title="defaults 中变量定义"></a>defaults 中变量定义</h2><pre><code> 1：加双引号；2：变量名和变量之间，有空格；
 diamond_db_key: &quot;{{ diamond_db_ip }}_{{ diamond_db_name }}_dbkey&quot;
 manager_user1: &quot;{{ manager_user_name }}&quot;
</code></pre>
<h1 id="tags"><a href="#tags" class="headerlink" title="tags"></a>tags</h1><p>相同的tasks在不同的环境下面执行，通过tag来进行表面，如下图：</p>
<pre><code>  useage: 
    udp-playbook setup.yml -v -kK -i hosts.ini --tags &quot;ta&quot;

- name: 1
  authorized_key: user={{ ansible_ssh_user }}  key=&quot;{{ lookup('file', '~/.ssh/id_rsa.pub') }}&quot;  state=present
  tags: ta

- name: 2
  group: name={{ remote_user }}
  tags: always

- name: 3
  file: path={{ remote_home }} owner={{ remote_user }} group={{ remote_user }} state=directory recurse=yes mode=0755
  tags: tb
</code></pre>
<h2 id="常见错误"><a href="#常见错误" class="headerlink" title="常见错误"></a>常见错误</h2><p>ansible 中 scp scp: ambiguous target 错误还是因为ssh 增加了 -t 参数, scp不支持 -t 参数</p>
<h2 id="disable-python-warning"><a href="#disable-python-warning" class="headerlink" title="disable python warning"></a><a href="https://docs.ansible.com/ansible/latest/reference_appendices/interpreter_discovery.html" target="_blank" rel="noopener">disable python warning</a></h2><p>To control the discovery behavior:</p>
<ul>
<li>for individual hosts and groups, use the <code>ansible_python_interpreter</code> inventory variable</li>
<li>globally, use the <code>interpreter_python</code> key in the <code>[defaults]</code> section of <code>ansible.cfg</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[defaults]</span><br><span class="line">interpreter_python=auto_silent</span><br></pre></td></tr></table></figure>

<h3 id="其它常见错误"><a href="#其它常见错误" class="headerlink" title="其它常见错误"></a>其它常见错误</h3><table>
<thead>
<tr>
<th>问题</th>
<th>解决方案</th>
</tr>
</thead>
<tbody><tr>
<td>性能</td>
<td>ansible现在并发执行的任务好像还不够，执行批量传大文件的任务等的比较久 — 用 synchronize  并将 fork 默认的5改大</td>
</tr>
<tr>
<td>sudoers</td>
<td>尝试解决ansible不能执行的问题，搜索各种英文文档，有人说版本的原因，有人反馈是脚本错误，最终无解。 继续在本地进行测试，发现使用原始的ansible命令可以执行ls，但是sudo ls时会提示 sudo need tty 之类的报错。 定位这个错误是因为在&#x2F;etc&#x2F;sudoers文件中设置了  Defaults requiretty，修改为 #Defaults requiretty，重试发现问题解决。 手工修改所有机器的配置文件，问题解决。{“msg”: “ssh connection closed waiting for a privilege escalation password prompt”}—实际在部分机器上执行ansible命令时仍然有：sudo: no tty present and no askpass program specified  可以给ssh 增加-t&#x2F;-tt参数来强制分配一个tty</td>
</tr>
<tr>
<td>failed to transfer file to  xxx</td>
<td>远端机器磁盘已经满,查看df -h，特别是&#x2F;tmp</td>
</tr>
<tr>
<td>requires a json module, none found</td>
<td>问题已经通过nginx进行解决部署,安装ansible的时候，在目标机器上面安装 python-simplejson 通过如下命令：yum install python-simplejson -y</td>
</tr>
<tr>
<td>openssh升级后无法登录报错</td>
<td>sshrpm 升级后会修改&#x2F;etc&#x2F;pam.d&#x2F;sshd 文件。需要升级前备份此文件最后还原即可登录。</td>
</tr>
<tr>
<td>安装EagleEye出现的问题</td>
<td>1.hadoop name -format 这个需要输入Y&#x2F;N；2.ssh-key没搞定；3.我们原来可以for循环的地方，古谦脚本只能1条1条的加</td>
</tr>
<tr>
<td>使用lineinfile方法时，内容不能包含”: “(冒号+空格)，这个与ansible底层的分隔符冲突；</td>
<td>让用户在内容中不要包含”: “</td>
</tr>
<tr>
<td>https 相关</td>
<td>SSL validation is not available in your version of python. You can use validate_certs&#x3D;no, however this is unsafe and not recommended. You can also install python-ssl from EPEL</td>
</tr>
<tr>
<td>You need a C++ compiler for C++ support</td>
<td>yum install -y gcc gcc-c++</td>
</tr>
<tr>
<td>１：udp权限问题，有时候会出现权限认证失败；２：udp如何执行本地命令；　３：udp线上有什么方便的安装方法</td>
<td>问题1:方法一 去掉sudo试试（报访问文件 &#x2F;opt&#x2F;aliUDP&#x2F;logs&#x2F;udp.log 失败，备份重新建一个udp.log 文件给于 777 权限）; 方法二 指定 –private-key&#x3D;PRIVATE_KEY_FILE （先试试直接ssh登录某台目标机器行不行）  问题2：udp支持直接运行目标机器上的命令，用法：udp server  -i ~&#x2F;ali&#x2F;udp-roles&#x2F;roles&#x2F;udp-install&#x2F;udp-hosts.ini  -m shell -a “ uptime ; df -lh “ -u admin</td>
</tr>
<tr>
<td>同一个ip部署不同的工程时，定义的变量会冲突；例如ip1同时部署mysql和diamond，都定义project_name；这样上面的会生效，下面定义的会被冲掉</td>
<td>Wiki：<a href="http://gitlab.alibaba-inc.com/middleware-udp/udp-doc/wikis/Different_Hosts_With_Different_Variables" target="_blank" rel="noopener">http://gitlab.alibaba-inc.com/middleware-udp/udp-doc/wikis/Different_Hosts_With_Different_Variables</a>  将变量分别定义在 .&#x2F;roles&#x2F;mysql&#x2F;defaults&#x2F;main.yml 和 .&#x2F;roles&#x2F;diamond&#x2F;defaults&#x2F;main.yml中 或者使用不同的变量名</td>
</tr>
<tr>
<td>执行udp-play-book 时会报找不到key的问题</td>
<td>在udp机器上执行 ssh-keygen 来生成key，解决</td>
</tr>
<tr>
<td>ssh 的时候需要手工 yes&#x2F;no</td>
<td>增加参数 -o StrictHostKeyChecking no 就不需要输入了</td>
</tr>
<tr>
<td>防火墙问题，本地可以访问，远程不能</td>
<td>通过抓包&#x2F;telnet等方式来确认这个问题， 通过iptables stop 来临时关闭防火墙； 修改iptables 的配置永久关闭或者增加所有其它节点到白名单中</td>
</tr>
<tr>
<td></td>
<td>重要！ hostname -i 一定要是本机在局域网内的真实ip地址（不是127.0.0.1 ）。  要绑定etc&#x2F;hosts 下面 把自己的hostname绑定到对应的真实ip上。</td>
</tr>
<tr>
<td>在UDP PlayBook中如何定义不同的机器、不同的Role使用不同的变量</td>
<td><a href="http://gitlab.alibaba-inc.com/middleware-udp/udp-doc/wikis/Different_Hosts_With_Different_Variables" target="_blank" rel="noopener">http://gitlab.alibaba-inc.com/middleware-udp/udp-doc/wikis/Different_Hosts_With_Different_Variables</a></td>
</tr>
<tr>
<td>Dauth部署问题总结</td>
<td><a href="http://gitlab.alibaba-inc.com/middleware-udp/udp-doc/wikis/Dauth-UDP-deployment-issues" target="_blank" rel="noopener">http://gitlab.alibaba-inc.com/middleware-udp/udp-doc/wikis/Dauth-UDP-deployment-issues</a></td>
</tr>
<tr>
<td>Device or resource busy</td>
<td>一般出现在Docker中修改&#x2F;etc&#x2F;hosts会有这个问题，ansible会rm它，实际它是-v进去的，通过脚本补丁绕过去</td>
</tr>
</tbody></table>
<p>ansible 中 scp scp: ambiguous target 错误还是因为ssh 增加了 -t 参数, scp不支持 -t 参数</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://plantegg.github.io/2016/03/22/ansible PlayBook 变量/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="twitter @plantegg">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="plantegg">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/03/22/ansible PlayBook 变量/" itemprop="url">在ansible PlayBook中如何定义不同的机器、不同的Role使用不同的变量</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-03-22T17:30:03+08:00">
                2016-03-22
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Ansible/" itemprop="url" rel="index">
                    <span itemprop="name">Ansible</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="在ansible-PlayBook中如何定义不同的机器、不同的Role使用不同的变量"><a href="#在ansible-PlayBook中如何定义不同的机器、不同的Role使用不同的变量" class="headerlink" title="在ansible PlayBook中如何定义不同的机器、不同的Role使用不同的变量"></a>在ansible PlayBook中如何定义不同的机器、不同的Role使用不同的变量</h1><h2 id="问题场景1"><a href="#问题场景1" class="headerlink" title="问题场景1"></a>问题场景1</h2><blockquote>
<p> 在安装Edas Agent脚本的时候发现在不同的机房[深圳、杭州、北京]有不同的网络定义[VPC、Normal],希望不同机房的机器在不同网络下使用不同的下载地址</p>
</blockquote>
<h2 id="问题场景2"><a href="#问题场景2" class="headerlink" title="问题场景2"></a>问题场景2</h2><blockquote>
<p> 在同一台机器上安装MySQL和Diamond，需要定义一个Project_Name, 如果定义在Hosts.ini中必然会覆盖，一台机器相当于一个作用域【同一个函数中也不允许你定义两个一样的名字吧！】</p>
</blockquote>
<h2 id="问题场景1的解决"><a href="#问题场景1的解决" class="headerlink" title="问题场景1的解决"></a>问题场景1的解决</h2><h3 id="在hosts-ini文件中定义不同的机器和变量"><a href="#在hosts-ini文件中定义不同的机器和变量" class="headerlink" title="在hosts.ini文件中定义不同的机器和变量"></a>在hosts.ini文件中定义不同的机器和变量</h3><pre><code>[sz_vpc]
10.125.0.169 
10.125.192.40

[sz_normal]
10.125.12.174 

[sz:children]
sz_vpc
sz_normal

[hz_vpc]
10.125.3.33  
[hz_normal]
10.125.14.238

[hz:children]
hz_vpc
hz_normal

############variables
[sz_vpc:vars]
script_url=&quot;sz_vpc&quot;

[sz_normal:vars]
script_url=&quot;sz_normal&quot;

[hz_vpc:vars]
script_url=&quot;hz_vpc&quot;

[hz_normal:vars]
script_url=&quot;hz_normal&quot;
</code></pre>
<h3 id="执行代码"><a href="#执行代码" class="headerlink" title="执行代码"></a>执行代码</h3><pre><code>- name: test variables
  debug: msg={{ script_url }}  #对所有机器输出他们的url来验证一下我们的定义生效没有
  tags: test
</code></pre>
<h3 id="执行结果"><a href="#执行结果" class="headerlink" title="执行结果"></a>执行结果</h3><pre><code>$udp-playbook -i udp-hosts.ini site.yml -b -u admin -t test    

UDP-PLAY-START: [apply common configuration to all nodes] ********************* 

UDP-TASK: [test variables] **************************************************** 
ok =&gt; 10.125.3.33 =&gt; {
    &quot;msg&quot;: &quot;hz_vpc&quot;
}
ok =&gt; 10.125.0.169 =&gt; {
    &quot;msg&quot;: &quot;sz_vpc&quot;
}
ok =&gt; 10.125.192.40 =&gt; {
    &quot;msg&quot;: &quot;sz_vpc&quot;
}
ok =&gt; 10.125.14.238 =&gt; {
    &quot;msg&quot;: &quot;hz_normal&quot;
}
ok =&gt; 10.125.12.174 =&gt; {
    &quot;msg&quot;: &quot;sz_normal&quot;
}
</code></pre>
<h2 id="问题场景2的解决"><a href="#问题场景2的解决" class="headerlink" title="问题场景2的解决"></a>问题场景2的解决</h2><blockquote>
<p>在这里变量不要放在hosts.ini中，到MySQL、Diamond的roles中新建两个yml文件,在 里面分别写上 MySQL和Diamond的 Project_Name 这样就不会覆盖了</p>
</blockquote>
<h3 id="目录结构"><a href="#目录结构" class="headerlink" title="目录结构"></a>目录结构</h3><pre><code><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$ find roles</span><br><span class="line">roles/</span><br><span class="line">roles/mysql</span><br><span class="line">roles/mysql/tasks</span><br><span class="line">roles/mysql/tasks/main.yml</span><br><span class="line">roles/mysql/defaults</span><br><span class="line">roles/mysql/defaults/main.yml</span><br><span class="line">roles/diamond</span><br><span class="line">roles/diamond/tasks</span><br><span class="line">roles/diamond/tasks/main.yml</span><br><span class="line">roles/diamond/defaults</span><br><span class="line">roles/diamond/defaults/main.yml</span><br></pre></td></tr></table></figure>
</code></pre>
<h3 id="变量定义"><a href="#变量定义" class="headerlink" title="变量定义"></a>变量定义</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$ cat roles/mysql/defaults/main.yml</span><br><span class="line"></span><br><span class="line">project: &#123;</span><br><span class="line">        &quot;project_name&quot;: mysql,</span><br><span class="line">		&quot;version&quot;: 5.6.0</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">$ cat roles/daimond/defaults/main.yml</span><br><span class="line"></span><br><span class="line">project: &#123;</span><br><span class="line">        &quot;project_name&quot;: daimond,</span><br><span class="line">		&quot;version&quot;: 3.5.0</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>

<h3 id="变量使用"><a href="#变量使用" class="headerlink" title="变量使用"></a>变量使用</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">- name: print the tar file name</span><br><span class="line">  debug: msg=&quot;&#123;&#123; project.project_name &#125;&#125;&quot;</span><br><span class="line">  tags: test</span><br></pre></td></tr></table></figure>

<h2 id="role-和-playbook-用法"><a href="#role-和-playbook-用法" class="headerlink" title="role 和 playbook 用法"></a>role 和 playbook 用法</h2><p>role中文件夹含义</p>
<ul>
<li>tasks目录：存放task列表。若role要生效，此目录必须要有一个主task文件main.yml，在main.yml中可以使用include包含同目录(即tasks)中的其他文件。</li>
<li>handlers目录：存放handlers的目录，若要生效，则文件必须名为main.yml文件。</li>
<li>files目录：在task中执行copy或script模块时，如果使用的是相对路径，则会到此目录中寻找对应的文件。</li>
<li>templates目录：在task中执行template模块时，如果使用的是相对路径，则会到此目录中寻找对应的模块文件。</li>
<li>vars目录：定义<strong>专属</strong>于该role的变量，如果要有var文件，则必须为main.yml文件。</li>
<li>defaults目录：<strong>定义角色默认变量，角色默认变量的优先级最低</strong>，会被任意其他层次的同名变量覆盖。如果要有var文件，则必须为main.yml文件。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ansible-playbook 11.harbor.yml --list-tasks</span><br></pre></td></tr></table></figure>


          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://plantegg.github.io/2014/06/02/tcp会偶尔3秒timeout/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="twitter @plantegg">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="plantegg">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2014/06/02/tcp会偶尔3秒timeout/" itemprop="url">tcp会偶尔3秒timeout的分析以及如何用php规避这个问题</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2014-06-02T17:30:03+08:00">
                2014-06-02
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/TCP/" itemprop="url" rel="index">
                    <span itemprop="name">TCP</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="tcp会偶尔3秒timeout的分析以及如何用php规避这个问题"><a href="#tcp会偶尔3秒timeout的分析以及如何用php规避这个问题" class="headerlink" title="tcp会偶尔3秒timeout的分析以及如何用php规避这个问题"></a><a href="https://web.archive.org/web/20170317084941/http://mogu.io/tcp-three-second-timeout-with-php-3" target="_blank" rel="noopener">tcp会偶尔3秒timeout的分析以及如何用php规避这个问题</a></h1><blockquote>
<p>这是一篇好文章，随着蘑菇街的完蛋，蘑菇街技术博客也没了，所以特意备份一下这篇</p>
</blockquote>
<ul>
<li><p>作者：蚩尤 </p>
</li>
<li><p>时间：May 27, 2014</p>
</li>
</ul>
<p>2年前做一个cache中间件调用的时候，发现很多通过php的curl调用一个的服务会出现偶尔的connect_time超时, 表现为get_curlinfo的connect_time在3秒左右, 本来没怎么注意, 因为客户端的curl_timeout设置的就是3秒, 某天, 我把这个timeout改到了5秒后, 发现了一个奇怪的现象, 很多慢请求依旧表现为connect_time在3秒左右..看来这个3秒并不是因为客户端设置的timeout引起的.于是开始查找这个原因.</p>
<hr>
<p>首先, 凭借经验调整了linux内核关于tcp的几个参数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">net.core.netdev_max_backlog = 862144</span><br><span class="line">net.core.somaxconn = 262144</span><br></pre></td></tr></table></figure>

<p>经过观察发现依旧会有3秒超时, 而且数量并没有减少.</p>
<p>第二步, 排除是大并发导致的问题, 在一台空闲机器上也部署同样的服务, 仅让线上一台机器跑空闲机器的服务, 结果发现依旧会有报错.排除并发导致的问题.</p>
<p>最后, 通过查了大量的资料才发现并不是我们才遇到过这个问题, 而且这个问题并不是curl的问题, 它影响到所有tcp的调用, 网上各种说法, 但结论都指向linux内核对于tcp的实现.(某些版本会出现这些问题), 有兴趣的可以看下下面这两个资料.<br><a href="https://web.archive.org/web/20170317084941/http://www.spinics.net/lists/linux-net/msg17545.html" target="_blank" rel="noopener">资料1</a><br><a href="https://web.archive.org/web/20170317084941/http://marc.info/?t=120655182600018&r=1&w=2" target="_blank" rel="noopener">资料2</a></p>
<p>一看深入到linux内核..不管怎样修改的成本一定很大..于是乎, 发挥我们手中的php来规避这个问题的时间到了.</p>
<p>原本的代码, 简单实现，常规curl调用:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">function curl_call($p1, $p2 ...) &#123;</span><br><span class="line">   $ch = curl_init();</span><br><span class="line">   curl_setopt($ch, CURLOPT_TIMEOUT, 5);</span><br><span class="line">   curl_setopt($ch, CURLOPT_URL, &apos;http://demon.at&apos;);</span><br><span class="line">   $res = curl_exec($ch);</span><br><span class="line">   if (false === $res) &#123;</span><br><span class="line">      //失败..抛异常..</span><br><span class="line">   &#125;</span><br><span class="line">   return $res;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以看出, 如果用上面的代码, 无法避免3秒connect_time的问题..这种实现对curl版本会有要求(CURLOPT_CONNECTTIMEOUT_MS)，主要的思路是，通过对链接时间进行毫秒级的控制(因为超时往往发生在connect的时候)，加上失败重试机制，来最大限度保证调用的正确性。所以,下面的代码就诞生了:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">function curl_call($p1, $p2, $times = 1) &#123;</span><br><span class="line">   $ch = curl_init();</span><br><span class="line">   curl_setopt($ch, CURLOPT_TIMEOUT, 5);</span><br><span class="line">   curl_setopt($ch, CURLOPT_URL, &apos;http://demon.at&apos;);</span><br><span class="line">   $curl_version = curl_version();</span><br><span class="line">   if ($curl_version[&apos;version_number&apos;] &gt;= 462850) &#123;</span><br><span class="line">      curl_setopt($ch, CURLOPT_CONNECTTIMEOUT_MS, 20);</span><br><span class="line">      curl_setopt($ch, CURLOPT_NOSIGNAL, 1);</span><br><span class="line">   &#125; else &#123;</span><br><span class="line">      throw new Exception(&apos;this curl version is too low, version_num : &apos; </span><br><span class="line">                         . $curl_version[&apos;version&apos;]);</span><br><span class="line">   &#125;</span><br><span class="line">   $res = curl_exec($ch);</span><br><span class="line">   curl_close($ch);</span><br><span class="line">   if (false === $res) &#123;</span><br><span class="line">      if (curl_errno($ch) == CURLE_OPERATION_TIMEOUTED</span><br><span class="line">             and $times != 最大重试阀值 ) &#123;</span><br><span class="line">         $times += 1;</span><br><span class="line">         return curl_call($p1, $p2, $times);</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   return $res;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上面这段代码只是一个规避的简单实例, 一些小细节并没有可以完善..比如抛出异常常以后curl资源的手动释放等等..这里不做讨论..当然还漏了一点要说的是，对重试次数最好加上限制 :)</p>
<p>说明一下上面几个数字值的含义:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">462850 //因为php的CURLOPT_CONNECTTIMEOUT_MS需要 curl_version 7.16.2,这个值就是这个版本的数字版本号，还需要注意的是, php版本要大于5.2.3</span><br><span class="line">20 //连接超时的时间, 单位:ms</span><br></pre></td></tr></table></figure>

<hr>
<p>这样这个问题就这样通过php的代码来规避开了.<br>如果有对这个问题有更好的解决方法，欢迎指教.</p>
<hr>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p><a href="https://mp.weixin.qq.com/s/-pRA12sLJktbXa-srWn02w" target="_blank" rel="noopener">tcp connect 的流程是这样的</a>：<br>1、tcp发出SYN建链报文后，报文到ip层需要进行路由查询<br>2、路由查询完成后，报文到arp层查询下一跳mac地址<br>3、如果本地没有对应网关的arp缓存，就需要缓存住这个报文，发起arp请求<br>4、arp层收到arp回应报文之后，从缓存中取出SYN报文，完成mac头填写并发送给驱动。</p>
<p>问题在于，arp层缓存队列长度默认为3。如果你运气不好，刚好赶上缓存已满，这个报文就会被丢弃。</p>
<p>TCP层发现SYN报文发出去3s（默认值）还没有回应，就会重发一个SYN。这就是为什么少数连接会3s后才能建链。</p>
<p>幸运的是，arp层缓存队列长度是可配置的，用 sysctl -a | grep unres_qlen 就能看到，默认值为3。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/9/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/9/">9</a><span class="page-number current">10</span>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image" src="/images/avatar.gif" alt="twitter @plantegg">
          <p class="site-author-name" itemprop="name">twitter @plantegg</p>
           
              <p class="site-description motion-element" itemprop="description"></p>
           
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">186</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">17</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">274</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js">
</script>

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">twitter @plantegg</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>

<span id="busuanzi_container_site_pv">
    本站总访问量<span id="busuanzi_value_site_pv_footer"></span>次
</span>
<span id="busuanzi_container_site_uv">
  本站访客数<span id="busuanzi_value_site_uv_footer"></span>人次
</span>


        
<div class="busuanzi-count">
  <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv">
      <i class="fa fa-user"></i> 访问人数
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
      人
    </span>
  

  
    <span class="site-pv">
      <i class="fa fa-eye"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
      次
    </span>
  
</div>


        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.1"></script>



  
  

  
    <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.1"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.1"></script>

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.1"></script>



  


  




	





  





  





  






  





  

  
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>


  

  

  

  

</body>
</html>
